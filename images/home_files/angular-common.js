
(function(){'use strict';angular.module('common.utils',[]);})();(function(){'use strict';var app=angular.module('common.utils');app.factory('validate',[function(){var _isArray,_isArrayLike,_isArrayOfStrings,_isArrayOfStringsNonWhiteSpace,_isBoolean,_isDefined,_isFunction,_isFacetObjectWithTextTerm,_isImage,_isInArray,_isInstanceOf,_isNull,_isNullOrUndefined,_isNumber,_isNumberGreaterThanZero,_isNotNull,_isObject,_isString,_isStringNotWhiteSpace,_isUndefined;_isArray=function(data){return angular.isArray(data);};_isArrayLike=function(data){return angular.isArrayLike(data);};_isArrayOfStrings=function(data){var isValid=_isArray(data),i;isValid=isValid&&data.length>0;if(isValid){for(i=0;i<data.length;i++){if(!_isString(data[i])){isValid=false;break;}}}
return isValid;};_isArrayOfStringsNonWhiteSpace=function(data){var isValid=_isArray(data),i;isValid=isValid&&data.length>0;if(isValid){for(i=0;i<data.length;i++){if(!_isStringNotWhiteSpace(data[i])){isValid=false;break;}}}
return isValid;};_isBoolean=function(data){return typeof data==='boolean';};_isDefined=function(data){return(angular.isDefined(data));};_isFacetObjectWithTextTerm=function(data){var isValid=_isObject(data);isValid=isValid&&(data.hasOwnProperty('text'));isValid=isValid&&(_isArrayOfStringsNonWhiteSpace(data.text));return isValid;};_isFunction=function(data){return angular.isFunction(data);};_isImage=function(data){return(_isDefined(data)&&(data instanceof HTMLImageElement));};_isInstanceOf=function(object,type){if(_isUndefined(object)){return false;}else{return(object instanceof type);}};_isInArray=function(needle,hayStack){var key,isInArray=false;if(_isArray(hayStack)){for(key in hayStack){if(hayStack[key]===needle){isInArray=true;break;}}}
return isInArray;};_isNull=function(data){return(data===null);};_isNullOrUndefined=function(data){return(_isNull(data)||_isUndefined(data));};_isNumber=function(data){return angular.isNumber(data);};_isNumberGreaterThanZero=function(data){return(_isNumber(data)&&data>0);};_isNotNull=function(data){return(!_isNull(data));};_isObject=function(data){return angular.isObject(data)&&_isNotNull(data);};_isString=function(data){return angular.isString(data);};_isStringNotWhiteSpace=function(data){var isValid=_isString(data);isValid=isValid&&(data.trim()!=='');return isValid;};_isUndefined=function(data){return angular.isUndefined(data);};return{isArray:_isArray,isArrayLike:_isArrayLike,isArrayOfStrings:_isArrayOfStrings,isArrayOfStringsNonWhiteSpace:_isArrayOfStringsNonWhiteSpace,isBoolean:_isBoolean,isDefined:_isDefined,isFacetObjectWithTextTerm:_isFacetObjectWithTextTerm,isFunction:_isFunction,isImage:_isImage,isInArray:_isInArray,isInstanceOf:_isInstanceOf,isNumber:_isNumber,isNull:_isNull,isNullOrUndefined:_isNullOrUndefined,isNumberGreaterThanZero:_isNumberGreaterThanZero,isNotNull:_isNotNull,isObject:_isObject,isString:_isString,isStringNotWhiteSpace:_isStringNotWhiteSpace,isUndefined:_isUndefined};}]);}());(function(){'use strict';var app=angular.module('common.utils');app.factory('fifoCache',['validate',function(validate){var _getLockerPerDriver,_getLockerPerNameSpace,_reduceCountToThreshold,_fitInLockerSpace,_getOldestKey,_get,_put,_validDrivers=['local','session'];_getLockerPerDriver=function(locker,driver){var lockerPerDriver=locker,errorMessage='The argument for <driver> was invalid. '+'Allowed values are \'local\' or \'session\'.';if(validate.isDefined(driver)){if(validate.isInArray(driver,_validDrivers)){lockerPerDriver=locker.driver(driver);}else{throw new Error(errorMessage);}}
return lockerPerDriver;};_getLockerPerNameSpace=function(lockerPerDriver,namespace){var lockerPerNameSpace=lockerPerDriver,errorMessage='The argument for <namespace> must be undefined or a string. ';if(validate.isDefined(namespace)){if(validate.isStringNotWhiteSpace(namespace)){lockerPerNameSpace=lockerPerDriver.namespace(namespace);}else{throw new Error(errorMessage);}}
return lockerPerNameSpace;};_getOldestKey=function(keySet){var pointer={timestamp:Date.now()},key,oldestKey;for(key in keySet){if(keySet[key].timestamp<pointer.timestamp){pointer=keySet[key];oldestKey=key;}}
return oldestKey;};_reduceCountToThreshold=function(lockerSpace,threshold){var keySet,oldestKey,numLockerItems=lockerSpace.count();if(numLockerItems>=threshold){keySet=lockerSpace.all();oldestKey=_getOldestKey(keySet);lockerSpace.forget(oldestKey);_reduceCountToThreshold(lockerSpace,threshold);}};_fitInLockerSpace=function(lockerSpace,key,value){var keySet,oldestKey;try{lockerSpace.put(key,value);}catch(err){keySet=lockerSpace.all();oldestKey=_getOldestKey(keySet);lockerSpace.forget(oldestKey);if(lockerSpace.count()>0){_fitInLockerSpace(lockerSpace,key,value);}}};_get=function(locker,key,defaultValue,namespace,driver){var _locker;if(locker.supported()===false){return;}
_locker=_getLockerPerDriver(locker,driver);_locker=_getLockerPerNameSpace(_locker,namespace);return _locker.get(key,defaultValue);};_put=function(locker,key,value,threshold,namespace,driver){var _locker;if(locker.supported()===false){return;}
_locker=_getLockerPerDriver(locker,driver);_locker=_getLockerPerNameSpace(_locker,namespace);if(validate.isNumberGreaterThanZero(threshold)){if(_locker.count()>=threshold){_locker.forget(key);_reduceCountToThreshold(_locker,threshold);}}
_fitInLockerSpace(_locker,key,value);};return{get:_get,put:_put};}]);}());(function(){'use strict';var NS='common.controllers';angular.module(NS,[]);}());(function(){'use strict';angular.module('common.controllers').controller('OmnitureCtrl',['$scope','omnitureService','OMNITURE_EVENTS',function($scope,omnitureService,OMNITURE_EVENTS){$scope.$on(OMNITURE_EVENTS.CTA_CLICK,function(event,ctaText){omnitureService.ctaClick(ctaText);});$scope.$on(OMNITURE_EVENTS.ADP.ADP_LOAD,function(event,args){omnitureService.adpPageLoad(args);});$scope.$on(OMNITURE_EVENTS.ADP.CAROUSELS_LOAD,function(event,args){omnitureService.adpCarouselsLoad(args);});$scope.$on(OMNITURE_EVENTS.ADP.CAROUSELS_SEE_ALL_CLICK,function(event,args){omnitureService.adpCarouselSeeAllClick(args);});$scope.$on(OMNITURE_EVENTS.ADP.FILE_DOWNLOAD,function(event,args){omnitureService.adpDownload(args);});$scope.$on(OMNITURE_EVENTS.LB_TOGGLE,function(event,args){omnitureService.toggleLightbox(args);});$scope.$on(OMNITURE_EVENTS.LB_ADD,function(event,args){omnitureService.addToLightbox(args);});$scope.$on(OMNITURE_EVENTS.LB_CREATE,function(event,args){omnitureService.createLightbox(args);});$scope.$on(OMNITURE_EVENTS.LB_SAVE_PAGE,function(event,args){omnitureService.savePageToLightbox(args);});$scope.$on(OMNITURE_EVENTS.ADP.SIMILAR_FILE_CLICK,function(event,args){omnitureService.similarFileClick(args);});$scope.$on(OMNITURE_EVENTS.ADP.PORTFOLIO_LINK_CLICK,function(event,args){omnitureService.portfolioLinkClick(args);});$scope.$on(OMNITURE_EVENTS.ADP.FILE_ZOOM_CLICK,function(event,args){omnitureService.fileZoomClick(args);});$scope.$on(OMNITURE_EVENTS.SRP.SCROLL_TO_TOP_ARROW,function(event,args){omnitureService.scrollToTopArrowClick(args);});}]);}());(function(){'use strict';var NS='common.constants';angular.module(NS,[]);}());(function(){'use strict';var APP=angular.module('common.constants');APP.constant('ERROR_MESSAGING',{LIGHTBOX_ERROR:'LIGHTBOX_ERROR',DROPBOX_ERROR:{DROPBOX_ALREADY_CONNECTED:'DROPBOX_ALREADY_CONNECTED',OAUTH_TOKEN_BROKEN:'OAUTH_TOKEN_BROKEN',API_LIMIT_ERROR:'API_LIMIT_ERROR',SERVER_ERROR:'SERVER_ERROR',STORAGE_FULL:'STORAGE_FULL',ERROR:'ERROR'}});})();(function(){'use strict';angular.module('common.constants').constant('OMNITURE_EVENTS',{CTA_CLICK:'cta-click',LB_CREATE:'lb-create',LB_ADD:'lb-add',LB_TOGGLE:'lb-toggle',LB_SAVE_PAGE:'lb-save-page',ADP:{ADP_LOAD:'adp-load',SIMILAR_FILE_CLICK:'adp-similar-file-click',FILE_ZOOM_CLICK:'adp-file-zoom-click',FILE_DOWNLOAD:'adp-file-download',CAROUSELS_LOAD:'adp-carousels-load',PORTFOLIO_LINK_CLICK:'adp-portfolio-link-click',CAROUSELS_SEE_ALL_CLICK:'adp-carousels-see-all-click'},SRP:{SRP_SEARCH_UPDATE:'srp-search-update',RELATED_TERMS_RESULTS:'related-terms-results',SCROLL_TO_TOP_ARROW:'scroll-to-top-arrow'}});}());(function(){'use strict';angular.module('common.constants').constant('MEDIAPLAYER_STATES',{PLAY:'play',PAUSE:'pause',STOP:'stop'});}());(function(){'use strict';angular.module('common.constants').constant('ABSTRACT_TYPE',{'photos':1,'photo':1,'flash':4,'illustrations':7,'vector':7,'video':8,'audio':9});}());(function(){'use strict';angular.module('common.constants').value('SEARCH_STATE',{EXECUTING_SEARCH:true}).constant('SEARCH',{FORMATTED_KEY:'f',FACET_PREFERENCES:{perPage:100,filterContent:false,exclude:false,pageNumber:1},MAX_RESULTS_CACHE_TIME:86400000,MAX_CACHED_RESULT_COUNT:10,EVENT_TRIGGER:'triggerSearchEvent',PAGE_CHANGED:'pageChangedEvent'});})();(function(){'use strict';angular.module('common.constants').constant('LIGHTBOX_EVENTS',{LB_REMOVED_EVENT:'lightbox-removed',LB_OPEN_EVENT:'lightbox-opened',LB_CLOSE_EVENT:'lightbox-closed'});}());(function(){'use strict';angular.module('common.constants').constant('PRELOAD_IMAGES',{LOADING:'loading',COMPLETE:'complete',ERROR:'error',TIMEOUT:'timedOut'});})();(function(){'use strict';angular.module('common.services',['restangular']).config(['RestangularProvider',function(RestangularProvider){RestangularProvider.setBaseUrl('/api/');RestangularProvider.setDefaultHeaders({'Content-Type':'application/json'});RestangularProvider.setResponseExtractor(function(response){if(response.data&&response.status){return response.data;}
return response;});}]);}());(function(){'use strict';angular.module('common.services').factory('mediaPlayerService',[function(){var self,mediaPlayerCache={};self={_register:function(mediaPlayerScope){mediaPlayerCache[mediaPlayerScope.$id]=mediaPlayerScope;},_unregister:function(mediaPlayerId){delete mediaPlayerCache[mediaPlayerId];},playMedia:function(mediaPlayerId){angular.forEach(mediaPlayerCache,function(mediaPlayer){if(mediaPlayer.$id!==mediaPlayerId){mediaPlayer.state.stop(true);}});mediaPlayerCache[mediaPlayerId].state.play();},getCache:function(){return mediaPlayerCache;}};return self;}]);}());(function(i){'use strict';var NS='common.services';angular.module(NS).constant('url',i.url);}(istock));(function(){'use strict';angular.module('common.services').factory('authorizationService',['OptionsRestangular','$q',function(OptionsRestangular,$q){var AUTH_ENDPOINT='authorization',_refreshToken,_signInUser,response;_refreshToken=function(){var deferred=$q.defer(),restangular;restangular=OptionsRestangular.getPhpRestConfig().one(AUTH_ENDPOINT,1);restangular.put().then(function(data){response=data;deferred.resolve(response);}).catch(function(error){deferred.reject(error);});return deferred.promise;};_signInUser=function(identity,credential,eloqua){var deferred=$q.defer(),data={identity:identity,credential:credential,eloqua:eloqua},restangular;restangular=OptionsRestangular.getPhpRestConfig().one(AUTH_ENDPOINT);restangular.customPOST(data).then(function(response){deferred.resolve(response);}).catch(function(error){deferred.reject(error);});return deferred.promise;};return{refreshToken:_refreshToken,signInUser:_signInUser};}]);}());(function(i){'use strict';var NS='common.services';angular.module(NS).constant('cookielessUrl',i.cookielessUrl);}(istock));(function(i){'use strict';var NS='common.services';angular.module(NS).constant('cacheKey',i.cachekey);}(istock));(function(){'use strict';angular.module('common.services').factory('dropdownService',[function(){var self,dropdownCache={};self={_register:function(dropdownScope,callback){var container={};container.dropdownScope=dropdownScope;container.callback=callback;dropdownCache[dropdownScope.$id]=container;},_unregister:function(dropdownId){delete dropdownCache[dropdownId];},show:function(dropdownId){if(self.validate(dropdownId)){angular.forEach(dropdownCache,function(dropdown){if(dropdown.dropdownScope&&dropdown.dropdownScope.$id!==dropdownId){self.hide(dropdown.dropdownScope.$id);}});if(dropdownCache[dropdownId].dropdownScope){dropdownCache[dropdownId].dropdownScope.isVisible=true;if(dropdownCache[dropdownId].callback){dropdownCache[dropdownId].callback();}}}},hide:function(dropdownId){if(self.validate(dropdownId)){if(dropdownCache[dropdownId].dropdownScope){dropdownCache[dropdownId].dropdownScope.isVisible=false;if(dropdownCache[dropdownId].callback){dropdownCache[dropdownId].callback();}}}},toggle:function(dropdownId){if(self.validate(dropdownId)){if(dropdownCache[dropdownId].dropdownScope&&dropdownCache[dropdownId].dropdownScope.isVisible){self.hide(dropdownId);}else{self.show(dropdownId);}}},getCache:function(){return dropdownCache;},validate:function(dropdownId){if(dropdownId&&dropdownCache&&dropdownCache[dropdownId]){return true;}
return false;}};return self;}]);}());(function(){'use strict';angular.module('common.services').service('formValidationService',['VATService','formFieldsValidatorService',function(VATService,formFieldsValidatorService){var expressions,defaultMsgKey,descriptions,usZipMatchState,doesZipMatchState=true;usZipMatchState=function(){var result=doesZipMatchState;doesZipMatchState=true;return result;};expressions={required:/^.+$/,number:/^\d*$/,alphanumeric:/^[a-zA-Z0-9]+$/,onlyLetters:/^\D+$/,vat:VATService.validate,usZip:/^\d{5}([\-\s]?\d{4})?$/,usZipMatchState:usZipMatchState,cdnZip:/^[ABCEGHJKLMNPRSTVXYabceghjklmnprstvxy]\d[A-Za-z][ -]?\s*\d[A-Za-z]\d$/,alphanumericKatakana:/^[\u30A0-\u30FFA-z0-9 ]+$/,requiredSelect:function(selectedItem){return selectedItem;},emailValidation:function(emailValue){return formFieldsValidatorService.emailValidation(emailValue);},cpfCnpjNumber:/^([0-9]{11}|[0-9]{14}|\d{3}\.\d{3}\.\d{3}-\d{2}|\d{2}\.\d{3}\.\d{3}\/\d{4}-\d{2})$/};descriptions={required:'This is a required field, can not be blank',number:'Numbers only',onlyLetters:'Anything EXCEPT for numbers (\\D regex flag)',vat:'Valid VAT codes',usZip:'American ZIP codes',usZipMatchState:'Zip code must match state',cdnZip:'Canadian Postal Codes',alphanumeric:'lower and uppercase letters and nubers 0-9',alphanumericKatakana:'katacana characters only',requiredSelect:'Validates that the element is in the select box',emailValidation:'Has to be an email address',cpfCnpjNumber:'Brazilian Individual or Company ID Code'};defaultMsgKey={required:{error:'ERROR_REQUIRED'},requiredSelect:{error:'ERROR_REQUIRED'},emailValidation:{error:'ERROR_EMAIL'},number:{error:'ERROR_NUMBER'},onlyLetters:{error:'ERROR_ONLY_LETTERS'},vat:{error:'ERROR_VAT'},usZip:{error:'ERROR_US_ZIP'},usZipMatchState:{error:'ERROR_US_ZIP_MATCH_STATE'},cdnZip:{error:'ERROR_CDN_ZIP'},alphanumeric:{error:'ERROR_ALPHANUMERIC'},alphanumericKatakana:{error:'ERROR_ALPHA_NUMERIC_KATAKANA'},cpfCnpjNumber:{error:'ERROR_CPF_CPNJ_NUMBER'}};this.allExpressions=function(){return expressions;};this.allDescriptions=function(){return descriptions;};this.setExpression=function(obj){angular.extend(expressions,obj);};this.getExpression=function(expr){return expressions[expr];};this.setDefaultMsgKey=function(obj){angular.extend(defaultMsgKey,obj);};this.getDefaultMsgKey=function(msg){return defaultMsgKey[msg];};this.process=function(type,value){var validation=this.getExpression(type),validationType=validation.constructor;if(validationType===Function){return validation(value);}else if(validationType===RegExp){return value!==undefined&&validation.test(value);}};this.setZipMatchState=function(match){doesZipMatchState=match;};}]);}());(function(){'use strict';angular.module('common.services').factory('cartService',['$q','Restangular',function($q,Restangular){var CART_ENDPOINT='carts',USERS_ENDPOINT='users',_getCart,_getDeferred,_deleteItem,_deleteItemForUser,_deleteItemFromSessionCart,_transferSessionCartToUserCart,cartService;_getDeferred=function(){return $q.defer();};_getCart=function(postdata){return Restangular.all(CART_ENDPOINT).post(postdata);};_deleteItem=function(deleteData){if(deleteData.newUser){return cartService.deleteSessionCartItem(deleteData);}else{return cartService.deleteItemForUser(deleteData);}};_deleteItemForUser=function(deleteData){return Restangular.one(USERS_ENDPOINT,deleteData.userId).one(CART_ENDPOINT+'/'+deleteData.type).withHttpConfig({timeout:3000}).customDELETE(deleteData.assetId);};_deleteItemFromSessionCart=function(deleteData){return Restangular.one(CART_ENDPOINT+'/'+deleteData.type).withHttpConfig({timeout:3000}).customDELETE(deleteData.assetId,{type:deleteData.type});};_transferSessionCartToUserCart=function(putData){return Restangular.one(CART_ENDPOINT,putData.userId).put(putData,{type:'credits'});};cartService={getDeferred:_getDeferred,getCart:_getCart,deleteItem:_deleteItem,deleteItemForUser:_deleteItemForUser,deleteSessionCartItem:_deleteItemFromSessionCart,transferSessionToCart:_transferSessionCartToUserCart};return cartService;}]);}());(function(){'use strict';angular.module('common.services').factory('orderService',['Restangular','$q','OptionsRestangular',function(Restangular,$q,OptionsRestangular){var ORDERS_ENDPOINT='orders',USERS_ENDPOINT='users',cart={items:[],subInfo:{}},currencyInfo={},taxes={},subTotal={},convertedTotal={},total={},specialCodes={},periodicBillingOptions={},self;self={encodeOrder:function(order){var params=[];params.push('id'+'='+encodeURIComponent(order.userId));params.push('type'+'='+encodeURIComponent(order.type));params.push('companyname'+'='+encodeURIComponent(order.billingInformation.companyName));params.push('countrycode'+'='+encodeURIComponent(order.billingInformation.country.GettyCountryCode));params.push('countryname'+'='+encodeURIComponent(order.billingInformation.country.ENName));params.push('postalcode'+'='+encodeURIComponent(order.billingInformation.postalCode));params.push('stateprov'+'='+encodeURIComponent(order.billingInformation.stateProv));params.push('city'+'='+encodeURIComponent(order.billingInformation.city));if(typeof order.billingInformation.notes!==undefined){params.push('notesjob'+'='+encodeURIComponent(order.billingInformation.notes.job));params.push('notesordernum'+'='+encodeURIComponent(order.billingInformation.notes.orderNumber));params.push('notesorderedby'+'='+encodeURIComponent(order.billingInformation.notes.orderedBy));}
if(typeof order.specialCodes.promoCode!==undefined){params.push('promocode'+'='+encodeURIComponent(order.specialCodes.promoCode));params.push('vat'+'='+encodeURIComponent(order.specialCodes.vat));}
return params.join('&');},createOrder:function(order,billingInfoUpdated){if(order.paymentInformation.type==='paypal'&&order.paymentInformation.token===undefined){var param=self.encodeOrder(order);billingInfoUpdated.then(function(){window.location.href='/credit-paypal/index/?'+param;});return $q.reject({isPaypalRedirrect:true});}
return OptionsRestangular.getPhpRestConfig(true).all(ORDERS_ENDPOINT).post(order);},getOrder:function(orderId,userId,type){return Restangular.one(USERS_ENDPOINT,userId).one(ORDERS_ENDPOINT).customGET(orderId,{type:type});},setCurrencyInfo:function(info){currencyInfo=info;return currencyInfo;},getItemsNotPendingDelete:function(){return cart.items.filter(function(arg){return arg.pendingDelete===false;});},getCurrencyInfo:function(){return currencyInfo;},setSpecialCodes:function(sc){specialCodes=sc;return specialCodes;},getSpecialCodes:function(){return specialCodes;},setPeriodicBillingOptions:function(options){periodicBillingOptions=options;return periodicBillingOptions;},getPeriodicBillingOptions:function(){return periodicBillingOptions;},setTaxes:function(t){taxes=t;return taxes;},getTaxes:function(){return taxes;},setSubTotal:function(st){subTotal=st;return st;},getSubTotal:function(){return subTotal;},setConvertedTotal:function(ct){convertedTotal=ct;},getConvertedTotal:function(){return convertedTotal;},setTotal:function(t){total=t;},getTotal:function(){return total;},deleteItem:function(item){var index=cart.item.indexOf(item);if(index<0){return undefined;}
return cart.item.splice(index,1);},addItem:function(item){return cart.items.push(item);},getItems:function(){return cart.items;},clearItems:function(){cart.items=[];return cart.items;},containsAnnualSubscription:function(){if(this.getPeriodicBillingOptions()===undefined){return false;}
return this.getItems().length===1&&this.getItems()[0].type==='sub'&&Object.keys(this.getPeriodicBillingOptions()).length>1;},isTaxInclusive:function(){if(this.getCurrencyInfo().code==='BRL'){return true;}
return false;}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('preferenceService',['$q','accountService','facetStateService','OptionsRestangular','authorizationService','$injectedData','locker',function($q,accountService,facetStateService,OptionsRestangular,authorizationService,$injectedData,locker){var PREFERENCE_ENDPOINT='user/preference',self;self={defaultSearchPreferences:{'removeAdultContent':false,'excludeEditorial':false,'showDetails':false,'resultsPerPage':100},attemptedRefreshes:0,initSearchPreferences:function(preferences){var deferred=self._getDeferred(),filterContent;if(!preferences){preferences=self.defaultSearchPreferences;if(facetStateService.getFacet('perPage')!==0){preferences.resultsPerPage=facetStateService.getFacet('perPage');}
if(facetStateService.getActiveValues('editorial').length){preferences.excludeEditorial=facetStateService.getActiveValues('editorial')[0]==='false';}
if(facetStateService.getActiveValues('filterContent').length){filterContent=facetStateService.getActiveValues('filterContent');preferences.removeAdultContent=(filterContent[0]==='false');}
self.setPreferences(preferences);}
facetStateService.setFacet('perPage',parseInt(preferences.resultsPerPage));facetStateService.setFacetOption('editorial',false,preferences.excludeEditorial);facetStateService.setFacetOption('filterContent',false,preferences.removeAdultContent);facetStateService.showFileDetails=preferences.showDetails||false;deferred.resolve(preferences);return deferred.promise;},getPreferences:function(){var deferred=self._getDeferred();if(accountService.isLoggedIn()===false){if(locker.supported()===false){deferred.resolve();return deferred.promise;}
deferred.resolve(locker.get('preferences'));}else{OptionsRestangular.getJavaRestConfig().one(PREFERENCE_ENDPOINT).get().then(deferred.resolve).catch(function(response){if(response.status&&response.status===401){authorizationService.refreshToken().then(function(data){$injectedData.token=data.token;}).catch(function(){self.updatePreference(self.defaultSearchPreferences);}).finally(function(){self.attemptedRefreshes++;if(self.attemptedRefreshes>1){self.updatePreference(self.defaultSearchPreferences);}else{self.initSearchPreferences();}});}else{self.updatePreference(self.defaultSearchPreferences);}});}
return deferred.promise;},setPreferences:function(prefs){var deferred=self._getDeferred();if(accountService.isLoggedIn()===false){if(locker.supported()===false){deferred.resolve();return deferred.promise;}
prefs=angular.toJson(prefs);deferred.resolve(locker.put('preferences',prefs));}else{OptionsRestangular.getJavaRestConfig().one(PREFERENCE_ENDPOINT).customPUT(prefs).then(function(response){deferred.resolve(response);},function(response){deferred.reject(response);});}},updatePreference:function(prefs){self.setPreferences(prefs);facetStateService.setFacet('perPage',prefs.resultsPerPage);facetStateService.setFacetOption('editorial',false,prefs.excludeEditorial);facetStateService.setFacetOption('filterContent',false,prefs.removeAdultContent);},getPreferenceFacetMapping:function(){return{'removeAdultContent':'filterContent','excludeEditorial':'editorial','resultsPerPage':'perPage'};},_getDeferred:function(){return $q.defer();}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('userService',['Restangular','$q','urlBuilder','$http',function(Restangular,$q,urlBuilder,$http){var USERS_ENDPOINT='users',lastUser,expiredStatus,activeStatus,suspendedStatus,self={getUser:function(userId,isBillingRequest,bypassCache){var params=null,cacheControl={};if(isBillingRequest){params={'isBillingRequest':true,'nocache':new Date().getTime()};}
if(bypassCache){cacheControl={'Cache-Control':'no-cache'};}
return Restangular.one(USERS_ENDPOINT,userId).get(params,cacheControl).then(function(user){lastUser=user;return user;});},currentUser:function(){return lastUser;},setCurrentUser:function(user){lastUser=user;},updateBillingInfo:function(userId,address){return Restangular.one(USERS_ENDPOINT,userId).customPUT({address:address});},activeSubscription:function(userId){if(typeof activeStatus==='undefined'){activeStatus=Restangular.one(USERS_ENDPOINT,userId).one('subscriptions').one('active').get();}
return activeStatus;},hasActualSuspendedSubscription:function(userId){if(typeof suspendedStatus==='undefined'){suspendedStatus=Restangular.one(USERS_ENDPOINT,userId).one('subscriptions').one('actual_suspended').get();}
return suspendedStatus;},createUser:function(email,password,country,optin,options){var payload={email:email,password:password,password_confirmation:password,country_code:country,optin:optin,logIn:true},elqOptions;if(options){elqOptions={elqFormName:options.elqFormName,siteId:options.siteId,customerGUID:options.customerGUID,cookieWrite:options.cookieWrite};angular.extend(payload,payload,elqOptions);}
return $http({method:'POST',url:'/register.json',data:payload}).then(function(){return self.getUser();});},isAlreadyUser:function(userEmail){var deferred=$q.defer(),params={'email':encodeURIComponent(userEmail)};Restangular.one(USERS_ENDPOINT).head(params).then(function(){deferred.resolve(true);},function(){deferred.reject(false);});return deferred.promise;},subscriptionExpirationStatus:function(userId){if(typeof expiredStatus==='undefined'){expiredStatus=Restangular.one(USERS_ENDPOINT,userId).one('subscriptions').one('expiration_status').get();}
return expiredStatus;},getProfileUri:function(username){var baseUrl='/profile/'+encodeURIComponent(username.toLowerCase()),siteInfix=urlBuilder.getUrlInfix();if(siteInfix){return siteInfix.toLowerCase()+baseUrl;}else{return baseUrl;}
return'/profile/'+encodeURIComponent(username.toLowerCase());},getPortfolioUri:function(username){return'/portfolio/'+encodeURIComponent(username.toLowerCase());}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('countryService',['Restangular','$q','siteRegion',function(Restangular,$q,siteRegion){var COUNTRIES_ENDPOINT='countries',getCountries,getSupportedSubCountries,getCurrentCountryCode,countries,paypalBannedCountries=['China','Turkey'],supportedCountries,currentCountryCode;getCountries=function(){var deferred;if(countries===undefined){return Restangular.all(COUNTRIES_ENDPOINT).getList().then(function(data){countries=data;return countries;});}
deferred=$q.defer();deferred.resolve(countries);return deferred.promise;};getSupportedSubCountries=function(){var deferred;if(supportedCountries===undefined){return Restangular.all(COUNTRIES_ENDPOINT).getList({noSubEmbargo:true}).then(function(data){supportedCountries=data;return supportedCountries;});}
deferred=$q.defer();deferred.resolve(supportedCountries);return deferred.promise;};getCurrentCountryCode=function(){var deferred;if(currentCountryCode===undefined){currentCountryCode={};currentCountryCode.countryCode=angular.uppercase(siteRegion);}
deferred=$q.defer();deferred.resolve(currentCountryCode);return deferred.promise;};return{getCountries:getCountries,getSupportedSubCountries:getSupportedSubCountries,paypalBannedCountries:paypalBannedCountries,getCurrentCountryCode:getCurrentCountryCode};}]);}());(function(){'use strict';var module=angular.module('common.services'),serviceFn;serviceFn=function($window){return{to:function(url){$window.location.href=url;}};};module.factory('redirect',['$window',serviceFn]);}());(function(i){'use strict';var NS='common.services';angular.module(NS).constant('baseUrl',i.baseUrl);}(istock));(function(i){'use strict';var NS='common.services';angular.module(NS).constant('restUrl',i.restUrl);}(istock));(function(){'use strict';var hintSvc,HINT_ENDPOINT='search-hints';hintSvc=function(OptionsRestangular,$q){var _getHints,_handleHints,cache={},fromCache=true,startTime=-1,requestTime=-1,version=0,language='en_US',currentQuery='',previousDeferred=null;_handleHints=function(response){if(!response){return;}
requestTime=Math.round((new Date()).getTime())-startTime;if(response.hasOwnProperty('language')){language=response.language;}
if(response.hasOwnProperty('version')){version=response.version;}
if(response.hasOwnProperty('from-cache')){fromCache=response['from-cache'];}
var deferred=$q.defer(),namespace='',suggestions={galleries:[],hints:[],members:[],version:version,requestTime:requestTime,source:namespace,cache:fromCache,language:language,startTime:startTime},pattern=new RegExp('('+currentQuery.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,'\\$&')+')','ig'),contributorPattern=new RegExp('(.+:)','ig'),highlight='<span class="hint-highlight">$1</span>',contributor='<span class="contributor">$1</span>',hints=response;if(response.version===1&&response.query){namespace=response.query.substring(0,3);cache[namespace]=response;}
if('gallerynames'in hints){hints.gallerynames.forEach(function(gallery,index){var galleryData=hints.gallerynamedata[index],displayString=gallery.replace(pattern,highlight);galleryData.galleryString=gallery;galleryData.displayString=displayString.replace(contributorPattern,contributor);suggestions.galleries.push(galleryData);});}
if('suggestions'in hints){hints.suggestions.forEach(function(hint,index){var hintData=hints.data[index];hintData.userString=hint;hintData.displayString=hint.replace(pattern,highlight);suggestions.hints.push(hintData);});}
if('membernames'in hints){hints.membernames.forEach(function(member,index){var memberData=hints.membernamedata[index],displayString=member.replace(pattern,highlight);memberData.userString=member;memberData.displayString=displayString.replace(contributorPattern,contributor);suggestions.members.push(memberData);});}
deferred.resolve(suggestions);return deferred.promise;};_getHints=function(){var deferred=$q.defer(),namespace;startTime=Math.round((new Date()).getTime());if(previousDeferred){previousDeferred.resolve(null);previousDeferred=null;}
if(typeof currentQuery==='undefined'||currentQuery.length<1){deferred.reject('Query is undefined or too short');}else{if(version<2){namespace=currentQuery.substring(0,3);}else{namespace=currentQuery;}
if(namespace in cache){deferred.resolve(cache[namespace]);fromCache=true;previousDeferred=null;}else{fromCache=false;previousDeferred=deferred;OptionsRestangular.getSearchConfig().one(HINT_ENDPOINT,[namespace,version]).withHttpConfig({ignoreLoadingBar:true,timeout:deferred.promise}).get().then(function(response){if(response){deferred.resolve(response);}}).finally(function(){previousDeferred=null;});}}
return deferred.promise;};return{getHints:function(query){var deferred=$q.defer();currentQuery=query;_getHints().then(_handleHints).then(deferred.resolve)
['catch'](deferred.reject);return deferred.promise;}};};angular.module('common.services').factory('hints',['OptionsRestangular','$q',hintSvc]);}());(function(){'use strict';var urlBuilderSvc;urlBuilderSvc=function($q,$interpolate,$injectedData,urlSvc,fileTypeStorageService,ABSTRACT_TYPE){var _handleInput,_getUrl,_getSearchUrl,portfolioUrl=$interpolate('{{baseUrl}}/portfolio/{{string}}'),lightboxUrl=$interpolate('{{baseUrl}}/search/lightbox/{{lightboxId}}'),fileIdUrl=$interpolate('{{baseUrl}}/search/text/{{text}}{{fileTypes}}');_getUrl=function(term,pattern){var deferred=$q.defer(),url;url=pattern(term).replace(/([^:]\/)\/+/g,'$1');deferred.resolve(url);return deferred.promise;};_getSearchUrl=function(term,fileTypes){var deferred=$q.defer(),searchUrl,slug,fileType='PAGE_SRP_PHOTO';if(term.fileType==='photos'){fileType='PAGE_SRP_PHOTO';}else if(term.fileType==='illustrations'){fileType='PAGE_SRP_ILLUSTRATION';}else if(term.fileType==='videos'){fileType='PAGE_SRP_VIDEO';}else if(term.fileType==='music'){fileType='PAGE_SRP_AUDIO';}
slug=window.istock.urls.translatedUrls[fileType].split('/')[1];searchUrl=$interpolate('{{baseUrl}}/'+slug+'/{{text}}');_getUrl(term,searchUrl).then(function(url){if(fileTypes==='photos,illustrations'){url+='?facets={"34":["'+ABSTRACT_TYPE.photos+'","'+
ABSTRACT_TYPE.illustrations+'"],"35":["'+term.text+'"]}';}
deferred.resolve(url);});return deferred.promise;};_handleInput=function(query,fileTypes,source){var deferred=$q.defer(),searchTerm={text:null,fileTypes:null,disambiguation:null,source:null,baseUrl:urlSvc,fileType:fileTypeStorageService.getFileTypeForUrl(fileTypes)},tmp;if(typeof query==='object'&&query.hasOwnProperty('userId')){_getUrl(query,portfolioUrl).then(deferred.resolve);}else if(typeof query==='object'&&query.hasOwnProperty('lightboxId')){_getUrl(query,lightboxUrl).then(deferred.resolve);}else if(typeof query==='number'){searchTerm.text=query;searchTerm.fileTypes='/filetypes/'+fileTypes;_getUrl(searchTerm,fileIdUrl).then(deferred.resolve);}else{if(typeof query==='string'){tmp=encodeURIComponent(query);query={string:tmp.replace(/%20/g,'+')};}else{tmp=encodeURIComponent(query.string);query.string=tmp.replace(/%20/g,'+');}
searchTerm.text=query.string;if(typeof fileTypes==='string'&&fileTypes!==''){searchTerm.fileTypes='/filetypes/'+fileTypes;}
if(source){searchTerm.source='/source/'+source;}
_getSearchUrl(searchTerm,fileTypes).then(deferred.resolve);}
return deferred.promise;};return{build:function(query,fileTypes,source){var deferred=$q.defer();if(!query||query.length===0){deferred.reject('input not defined');}else{_handleInput(query,fileTypes,source).then(deferred.resolve);}
return deferred.promise;},buildCountryUrl:function(path,secure){if(secure){return window.istock.urls.secure+path;}else{return window.istock.urls.unsecure+path;}},getTranslatedUrl:function(key){var urlTemplate='',i;if(window.istock.urls.translatedUrls[key]){urlTemplate=window.istock.urls.translatedUrls[key];if(arguments.length>1){for(i=1;i<arguments.length;++i){urlTemplate=urlTemplate.replace(/%s|%d/,arguments[i]);}}}
return urlTemplate;},getUrlInfix:function(slash){var infix=window.istock.urls.urlInfix||'';slash=typeof slash!=='undefined'?slash:true;if(slash&&infix){infix='/'+infix;}
return infix;},buildUrl:function(path,secure){if(secure===true){return $injectedData.uris.secure+path;}else{return $injectedData.uris.unsecure+path;}},buildReturnUrl:function(pageType,previousUrl,previousUrlWithInfix){var urlInfix=this.getUrlInfix();if(previousUrlWithInfix===true){return urlInfix+'/'+pageType+'?returnUrl='+window.encodeURIComponent(previousUrl);}
return urlInfix+'/'+pageType+'?returnUrl='+window.encodeURIComponent(urlInfix+previousUrl);}};};angular.module('common.services').factory('urlBuilder',['$q','$interpolate','$injectedData','url','fileTypeStorageService','ABSTRACT_TYPE',urlBuilderSvc]);}());(function(){'use strict';angular.module('common.services').factory('facetService',['$filter',function($filter){var audioFacets=function(){var keys={'any':'ANY','undefined':'UNDEFINED','A':'A','A major':'A_MAJOR','A minor':'A_MINOR','A flat':'A_FLAT','A flat major':'A_FLAT_MAJOR','A flat minor':'A_FLAT_MINOR','B':'B','B major':'B_MAJOR','B minor':'B_MINOR','B flat':'B_FLAT','B flat major':'B_FLAT_MAJOR','B flat minor':'B_FLAT_MINOR','C':'C','C major':'C_MAJOR','C minor':'C_MINOR','C sharp':'C_SHARP','C sharp major':'C_SHARP_MAJOR','C sharp minor':'C_SHARP_MINOR','D':'D','D major':'D_MAJOR','D minor':'D_MINOR','E':'E','E major':'E_MAJOR','E minor':'E_MINOR','E flat':'E_FLAT','E flat major':'E_FLAT_MAJOR','E flat minor':'E_FLAT_MINOR','F':'F','F major':'F_MAJOR','F minor':'F_MINOR','F sharp':'F_SHARP','F sharp major':'F_SHARP_MAJOR','F sharp minor':'F_SHARP_MINOR','G':'G','G major':'G_MAJOR','G minor':'G_MINOR'},facets={};angular.forEach(keys,function(value,key){facets[key]={display:$filter('i18n')(value),accessibility:'public',value:key};});return facets;},self={config:{abstractType:{facets:{images:{display:$filter('i18n')('IMAGES'),accessibility:'public',value:'images'},photos:{display:$filter('i18n')('PHOTOS'),accessibility:'public',value:'photos'},illustrations:{display:$filter('i18n')('ILLUSTRATIONS'),accessibility:'public',value:'illustrations'},video:{display:$filter('i18n')('VIDEO'),accessibility:'public',value:'video'},audio:{display:$filter('i18n')('AUDIO'),accessibility:'public',value:'audio'},all:{display:$filter('i18n')('ALL'),accessibility:'private',value:'all'}},type:''},order:{facets:{bestMatch:{display:$filter('i18n')('BEST_MATCH'),accessibility:'public',value:'bestMatch'},bestMatchAlternate:{display:$filter('i18n')('BEST_MATCH_ALTERNATE'),accessibility:'private',value:'bestMatchAlternate'},new:{display:$filter('i18n')('NEW'),accessibility:'public',value:'new'},mostPopular:{display:$filter('i18n')('MOST_POPULAR'),accessibility:'public',value:'yearPopular'}},subFacets:{monthPopular:{display:$filter('i18n')('THIS_MONTH'),accessibility:'public',value:'monthPopular'},yearPopular:{display:$filter('i18n')('THIS_YEAR'),accessibility:'public',value:'yearPopular'},allTimePopular:{display:$filter('i18n')('ALL_TIME'),accessibility:'public',value:'allTimePopular'}},standardFacets:{bestMatch:{display:$filter('i18n')('BEST_MATCH'),accessibility:'public',value:'bestMatch'},new:{display:$filter('i18n')('NEW'),accessibility:'public',value:'new'},monthPopular:{display:$filter('i18n')('MOST_POPULAR_THIS_MONTH'),accessibility:'public',value:'monthPopular'},yearPopular:{display:$filter('i18n')('MOST_POPULAR_THIS_YEAR'),accessibility:'public',value:'yearPopular'},allTimePopular:{display:$filter('i18n')('MOST_POPULAR_ALL_TIME'),accessibility:'public',value:'allTimePopular'}},type:'single',default:'bestMatch',forceInclude:true},date:{facets:{allTimes:{display:$filter('i18n')('ALL_TIME'),accessibility:'public',value:'allTimes'},oneDay:{display:$filter('i18n')('TODAY'),accessibility:'public',value:'oneDay'},oneWeek:{display:$filter('i18n')('THIS_WEEK'),accessibility:'public',value:'oneWeek'},oneMonth:{display:$filter('i18n')('THIS_MONTH'),accessibility:'public',value:'oneMonth'},threeMonths:{display:$filter('i18n')('PAST_THREE_MONTHS'),accessibility:'public',value:'threeMonths'},sixMonths:{display:$filter('i18n')('PAST_SIX_MONTHS'),accessibility:'public',value:'sixMonths'}},groupName:$filter('i18n')('UPLOAD_DATE'),groupNameMobile:$filter('i18n')('UPLOAD_DATE_MOBILE'),default:'allTimes',type:'single'},editorial:{facets:{creative:{display:$filter('i18n')('CREATIVE'),accessibility:'public',value:false},editorial:{display:$filter('i18n')('EDITORIAL'),accessibility:'public',value:true,class:'icon editorial'}},type:'multi-null-complete'},collectionPrice:{facets:{essentials:{display:$filter('i18n')('ESSENTIALS'),subtitle:'- '+$filter('i18n')('LOWEST_PRICE'),accessibility:'public',value:'essentials'},signature:{display:$filter('i18n')('SIGNATURE'),subtitle:'- '+$filter('i18n')('BEST_QUALITY'),accessibility:'public',value:'signature'}},type:'switch'},exclusiveContributor:{facets:{onlyFromiStock:{display:$filter('i18n')('ONLY_FROM_ISTOCK'),accessibility:'public',value:true}},type:'multi'},showPeople:{facets:{people:{display:$filter('i18n')('PEOPLE'),accessibility:'public',value:true,class:'icon people'},noPeople:{display:$filter('i18n')('NO_PEOPLE'),accessibility:'public',value:false,class:'icon no-people'}},type:'multi-null-complete'},orientation:{facets:{horizontal:{display:$filter('i18n')('LANDSCAPE'),accessibility:'public',value:'horizontal',class:'icon horizontal'},vertical:{display:$filter('i18n')('PORTRAIT'),accessibility:'public',value:'vertical',class:'icon vertical'},square:{display:$filter('i18n')('SQUARE'),accessibility:'public',value:'square',class:'icon square'}},type:'multi-null-complete'},aspectRatioVideo:{facets:{'4:3':{display:'4:3',accessibility:'public',value:'4:3'},'16:9':{display:'16:9',accessibility:'public',value:'16:9'}},type:'multi-null-complete'},videoSize:{facets:{'hd1080':{display:'HD 1080',accessibility:'public',value:'hd1080'},'hd720':{display:'HD 720',accessibility:'public',value:'hd720'},'pal':{display:'SD PAL',accessibility:'public',value:'pal'},'ntsc':{display:'SD NTSC',accessibility:'public',value:'ntsc'},'dv':{display:'SD DV',accessibility:'public',value:'dv'}},type:'multi-null-complete'},videoSizeCondensed:{facets:{'hd':{display:'HD',accessibility:'public',value:'hd',mapping:['hd1080','hd720'],hiddenFacetIsActive:false},'sd':{display:'SD',accessibility:'public',value:'sd',mapping:['pal','ntsc','dv'],hiddenFacetIsActive:false}},type:'multi-null-complete'},tempo:{facets:{'all':{display:$filter('i18n')('ANY'),accessibility:'public',value:'all'},'very slow':{display:$filter('i18n')('VERY_SLOW'),subtitle:'(0 - 79 bpm)',accessibility:'public',value:'very slow'},'slow':{display:$filter('i18n')('SLOW'),subtitle:'(80 - 119 bpm)',accessibility:'public',value:'slow'},'medium':{display:$filter('i18n')('MEDIUM'),subtitle:'(120 - 139 bpm)',accessibility:'public',value:'medium'},'fast':{display:$filter('i18n')('FAST'),subtitle:'(140 - 159 bpm)',accessibility:'public',value:'fast'},'very fast':{display:$filter('i18n')('VERY_FAST'),subtitle:'(160+)',accessibility:'public',value:'very fast'}},type:'single',default:'all'},audioKey:{facets:audioFacets(),type:'audioKey',default:'all'},audioPrice:{facets:{'basic':{display:$filter('i18n')('BASIC'),accessibility:'public',value:'basic'},'moderate':{display:$filter('i18n')('MODERATE'),accessibility:'public',value:'moderate'},'detailed':{display:$filter('i18n')('DETAILED'),accessibility:'public',value:'detailed'},'complex':{display:$filter('i18n')('COMPLEX'),accessibility:'public',value:'complex'},'elaborate':{display:$filter('i18n')('ELABORATE'),accessibility:'public',value:'elaborate'}},type:'multi-null-complete'},photoSize:{facets:{'xsmall':{display:'',accessibility:'hidden',subtitle:'',value:'xsmall'},'small':{display:'',accessibility:'hidden',subtitle:'',value:'small'},'medium':{display:'',accessibility:'hidden',subtitle:'',value:'medium'},'large':{display:'',accessibility:'hidden',subtitle:'',value:'large'},'xl':{display:$filter('i18n')('XL'),accessibility:'public',subtitle:$filter('i18n')('MIN_4200_PX'),value:'xl'},'2xl':{display:$filter('i18n')('2XL'),accessibility:'public',subtitle:$filter('i18n')('MIN_4900_PX'),value:'xxl'},'3xl':{display:$filter('i18n')('3XL'),accessibility:'public',subtitle:$filter('i18n')('MIN_5500_PX'),value:'xxxl'}},groupName:$filter('i18n')('SIZE'),type:'multi-null-complete'},color:{type:'color'},filterContent:{type:'single',default:'true',forceInclude:true}},getConfig:function(){return self.config;},getFacetGroup:function(facetName){return self.config[facetName];}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('facetStateService',['$location','$rootScope','facetService','SEARCH',function($location,$rootScope,facetService,SEARCH){var self={facetState:{text:[],pageNumber:1,perPage:100,abstractType:{photos:false,illustrations:false,video:false,audio:false},date:{allTimes:false,oneHour:false,oneDay:false,oneWeek:false,oneMonth:false,threeMonths:false,sixMonths:false},order:{bestMatch:false,bestMatchAlternate:false,new:false,allTimePopular:false,monthPopular:false,yearPopular:false},editorial:{true:false,false:false},collectionPrice:{essentials:false,signature:false},exclusiveContributor:{true:false,false:false},showPeople:{true:false,false:false},filterContent:{true:true,false:false},orientation:{horizontal:false,vertical:false,square:false},aspectRatioVideo:{'4:3':false,'16:9':false},videoSize:{hd1080:false,hd720:false,pal:false,ntsc:false,dv:false},tempo:{all:false,'very slow':false,slow:false,medium:false,fast:false,'very fast':false},audioKey:{'all':false,'undefined':false,'A':false,'A major':false,'A minor':false,'A flat':false,'A flat major':false,'A flat minor':false,'B':false,'B major':false,'B minor':false,'B flat':false,'B flat major':false,'B flat minor':false,'C':false,'C major':false,'C minor':false,'C sharp':false,'C sharp major':false,'C sharp minor':false,'D':false,'D major':false,'D minor':false,'E':false,'E major':false,'E minor':false,'E flat':false,'E flat major':false,'E flat minor':false,'F':false,'F major':false,'F minor':false,'F sharp':false,'F sharp major':false,'F sharp minor':false,'G':false,'G major':false,'G minor':false},audioPrice:{basic:false,moderate:false,detailed:false,complex:false,elaborate:false},subscriptionCollection:{standard:false},color:'',portfolioID:[],lightboxID:[],additionalAudio:'',adminSearch:false,fileCollection:{essentials:false,vetta:false,value:false,signature:false,'signature+':false},fileIdSet:[],noCache:{true:false,false:false},photoSize:{'xsmall':false,'small':false,'medium':false,'large':false,'xl':false,'xxl':false,'xxxl':false},loginToken:'',keywordLanguage:'',deduplicate:[],gettyMasterIdSet:[],exclusiveEditorsPickVetta:{onlyFromIstock:false,editorsPick:false,vetta:false},filterVector:{true:false,false:false},countryID:'',editorsPick:{true:false,false:false},textDisambiguation:[],copySpace:[],timeSignature1:'',timeSignature2:'',decoration:[],priceLevel:[],searchId:'',activeStatus:'',bestMatchMix:[],vectorPrice:[],similarity:[],shuffleFiletypeCycle:'',userPartition:'',shufflePriceLevelCycle:'',keywordRankAdjustment:'',latestFiles:''},cachedFacets:null,photosFacets:['photoSize'],imagesFacets:['editorial','showPeople','orientation','color','photoSize'],audioFacets:['tempo','audioKey','audioPrice','additionalAudio','timeSignature1','timeSignature2'],videoFacets:['aspectRatioVideo','videoSize'],filterFacets:['editorial','collectionPrice','exclusiveContributor','showPeople','orientation','photoSize','aspectRatioVideo','videoSize','tempo','audioKey','audioPrice','color'],noOptionArrayFacets:['text','fileIdSet','deduplicate','gettyMasterIdSet','priceLevel','textDisambiguation','copySpace','decoration','bestMatchMix','vectorPrice','similarity','lightboxID','portfolioID'],defaultFacets:['order','date'],showFileDetails:false,cachedSearchId:'',initialized:false,dirty:false,initFromFacets:function(facets){angular.copy(self.defaultState,self.facetState);angular.forEach(facets,function(facetValue,facetName){if(facetName!=='additionalAudio'){self.clearFacetGroup(facetName);}
if(angular.isArray(facetValue)){if(facetName==='text'){self.setFacet(facetName,self.formatKeywords(facetValue.join(' ')));}else if(self.noOptionArrayFacets.indexOf(facetName)!==-1){self.setFacet(facetName,facetValue);}else{angular.forEach(facetValue,function(filterValue){filterValue=self.mapLegacyFacetValue(filterValue);if(filterValue==='audio'){self.setFacet('additionalAudio','true');}
self.setFacetOption(facetName,filterValue,true);});}}else if(angular.isObject(self.facetState[facetName])){self.setFacetOption(facetName,facetValue,true);}else if(facetName!==SEARCH.FORMATTED_KEY){self.setFacet(facetName,facetValue);}});},initDefaultValues:function(){var list=self.defaultFacets,def;list.forEach(function(facetName){def=facetService.getFacetGroup(facetName).default;if(def&&self.getActiveValues(facetName).length===0){self.setFacetOption(facetName,def,true);}});angular.copy(self.facetState,self.defaultState);self.initialized=true;},isInitialized:function(){return self.initialized;},getFacet:function(name){return self.facetState[name];},getOptionState:function(name,value){return self.facetState[name][value];},toggleFacet:function(name,value){self.facetState[name][value]=!self.facetState[name][value];self.dirty=true;},setFacet:function(name,value){if(typeof self.facetState[name]===typeof value){if('text'===name){value=self.formatKeywords(value.join(' '));}
if(!angular.equals(self.facetState[name],value)){self.facetState[name]=value;self.dirty=true;if(name==='pageNumber'){self.applySearchId();}}}else{throw new TypeError();}},setFacetOption:function(name,option,value,dirty){var facetGroup=facetService.getFacetGroup(name),setDirty=(typeof dirty==='undefined')?true:dirty;if(typeof self.facetState[name][option]===typeof value){if(self.isSingleFacet(facetGroup)){if(option===true){self.facetState[name]['false']=false;}else if(option===false){self.facetState[name]['true']=false;}else{angular.forEach(self.facetState[name],function(facetOptionValue,facetOption){self.facetState[name][facetOption]=false;});}}else if(self.isSwitchFacet(facetGroup)){angular.forEach(self.facetState[name],function(facetOptionValue,facetOption){if(facetOption===option){self.facetState[name][facetOption]=value;}else{self.facetState[name][facetOption]=false;}});}
self.facetState[name][option]=value;if(setDirty){self.dirty=true;}}else{throw new TypeError();}},clearFacetGroup:function(name,setDirty){if(self.noOptionArrayFacets.indexOf(name)!==-1||name==='searchId'){self.clearFacet(name);}else{angular.forEach(self.facetState[name],function(value,key){self.setFacetOption(name,key,false,setDirty);});}},clearFacet:function(name){if(self.noOptionArrayFacets.indexOf(name)!==-1){self.facetState[name]=[];}else if(name==='searchId'){self.facetState[name]='';}},setFileTypeFacet:function(fileTypeSelected){angular.forEach(self.facetState.abstractType,function(value,key){self.facetState.abstractType[key]=false;});self.facetState.additionalAudio='';self.facetState.pageNumber=1;self.clearFileTypeFacetGroups(fileTypeSelected);if(fileTypeSelected==='images'){self.facetState.abstractType.photos=true;self.facetState.abstractType.illustrations=true;}else if(fileTypeSelected==='all'){self.facetState.abstractType.photos=true;self.facetState.abstractType.illustrations=true;self.facetState.abstractType.video=true;self.facetState.abstractType.audio=true;self.facetState.additionalAudio='true';}else{self.facetState.abstractType[fileTypeSelected]=true;if(fileTypeSelected==='audio'){self.facetState.additionalAudio='true';}}
self.dirty=true;},clearFileTypeFacetGroups:function(fileTypeSelected){if(fileTypeSelected==='images'||fileTypeSelected==='photos'||fileTypeSelected==='illustrations'){self.clearFileTypeFacets(self.audioFacets);self.clearFileTypeFacets(self.videoFacets);if(fileTypeSelected==='images'){self.clearFileTypeFacets(self.photosFacets);}
if(fileTypeSelected==='illustrations'){self.clearFacetGroup('editorial',false);self.clearFacetGroup(self.photosFacets,false);}}else if(fileTypeSelected==='video'){self.clearFileTypeFacets(self.imagesFacets);self.clearFileTypeFacets(self.audioFacets);}else if(fileTypeSelected==='audio'){self.clearFileTypeFacets(self.imagesFacets);self.clearFileTypeFacets(self.videoFacets);}else{self.clearAllFileTypeFacets();}},clearFileTypeFacets:function(fileType){angular.forEach(fileType,function(value){self.clearFacetGroup(value,false);});},clearAllFileTypeFacets:function(){self.clearFileTypeFacets(self.imagesFacets);self.clearFileTypeFacets(self.videoFacets);self.clearFileTypeFacets(self.audioFacets);self.clearFacetGroup('collectionPrice',false);self.clearFacetGroup('exclusiveContributor',false);self.clearFacetGroup('order',false);self.facetState.pageNumber=1;angular.forEach(self.facetState.order,function(value,key){if(key==='bestMatch'){self.facetState.order[key]=true;}else{self.facetState.order[key]=false;}});},clearAltViewFacets:function(){self.setFacet('portfolioID',[]);self.setFacet('lightboxID',[]);},setFileTypeToDefault:function(){self.clearFacetGroup('abstractType');self.setFacet('additionalAudio','');self.toggleFacet('abstractType','photos');self.toggleFacet('abstractType','illustrations');},getActiveValues:function(nameAry){var result=[];if(!angular.isArray(nameAry)){nameAry=nameAry.split(',');}
angular.forEach(nameAry,function(name){if(typeof self.facetState[name]!=='object'){result.push(self.facetState[name]);}else{angular.forEach(self.facetState[name],function(value,key){if(self.facetState[name][key]===true){result.push(key);}});}});return result;},mapLegacyFacetValue:function(value){if(value==='videos'){value='video';}else if(value==='music'){value='audio';}
return value;},allOptionsActive:function(name){var allSelected=true,facetGroup=facetService.getFacetGroup(name).facets;angular.forEach(self.facetState[name],function(value,key){if(!(facetGroup.hasOwnProperty(key)&&facetGroup[key].accessibility==='hidden')&&(self.facetState[name][key]===false)){allSelected=false;}});return allSelected;},activateAllOptions:function(name){angular.forEach(self.facetState[name],function(value,key){self.setFacetOption(name,key,true);});},hasActiveFacets:function(list){var hasActiveValues=false,activeValue=[];if(!angular.isArray(list)){list=list.split(',');}
list.forEach(function(facetName){activeValue=self.getActiveValues(facetName);if(!self.isOnlyDefaultSet(facetName)&&((activeValue.length>0)&&(activeValue.indexOf('')===-1))){hasActiveValues=true;return;}});return hasActiveValues;},isOnlyDefaultSet:function(name){var active=self.getActiveValues(name),def,facetGroup;if(self.facetState[name]&&active.length===1){facetGroup=facetService.getFacetGroup(name);if(facetGroup){def=facetGroup.default;}
if(def&&active[0]===def){return true;}}
return false;},build:function(forceInclude){var facets={};angular.forEach(self.facetState,function(value,filterName){var facetGroup=facetService.getFacetGroup(filterName);if(!angular.isArray(value)&&!angular.isObject(value)&&value){facets[filterName]=value;}else{angular.forEach(value,function(facetValue,facetType){var singleFacetType,isFacetDefault,shouldInclude;if(self.isNoOptionFacet(filterName)){self.setArrayFacet(facets,filterName,facetValue);}
singleFacetType=self.isSingleFacet(facetGroup);if(singleFacetType){isFacetDefault=self.isFacetDefault(facetGroup,facetType);shouldInclude=self.shouldInclude(facetGroup,facetType,forceInclude);if(facetValue===true&&(!isFacetDefault||shouldInclude)){facets[filterName]=facetType;}}else if(!singleFacetType&&facetValue===true){self.setArrayFacet(facets,filterName,facetType);}});}});self.cachedFacets=angular.copy(facets);return facets;},setArrayFacet:function(facets,name,value){if(!facets[name]){facets[name]=[];}
facets[name].push(value);},shouldInclude:function(facetGroup,value,forceInclude){return(typeof facetGroup!=='undefined'&&(forceInclude===true||'forceInclude'in facetGroup));},isFacetDefault:function(facetGroup,value){return(typeof facetGroup!=='undefined'&&'default'in facetGroup&&facetGroup.default===value);},isDefaultPref:function(filterName,value){var DEFAULTS=SEARCH.FACET_PREFERENCES;return(filterName in DEFAULTS&&DEFAULTS[filterName]===value);},isNoOptionFacet:function(filterName){return self.noOptionArrayFacets.indexOf(filterName)!==-1;},isSingleFacet:function(facetGroup){return(typeof facetGroup!=='undefined'&&'type'in facetGroup&&facetGroup.type==='single');},isSwitchFacet:function(facetGroup){return(typeof facetGroup!=='undefined'&&'type'in facetGroup&&facetGroup.type==='switch');},formatKeywords:function(keywordString){var keywords,ret=[],booleans=['NOT','OR'];if(keywordString.indexOf('+')!==-1){keywords=keywordString.split('+');}else{keywords=keywordString.split(' ');}
angular.forEach(keywords,function(word,index){if(booleans.indexOf(word.toUpperCase())!==-1&&index+1<keywords.length){ret.push([word.toUpperCase(),keywords[index+1]].join(' '));keywords.splice(index+1,1);}else{ret.push(word);}});if(ret[0]){return[ret.join(' ')];}
return[];},getCachedFacets:function(){if(self.cachedFacets===null){self.build();}
return self.cachedFacets;},correctSpelling:function(suggestion,misspelled){var tempText=[];angular.forEach(self.facetState.text,function(keyword){tempText.push(keyword.replace(misspelled,suggestion));});self.setFacet('text',tempText);},isDirty:function(){return self.dirty;},resetDirty:function(){self.dirty=false;},setSearchId:function(id){self.cachedSearchId=id;self.applySearchId();},unsetSearchId:function(){self.facetState.searchId='';},applySearchId:function(){if(self.cachedSearchId){if(self.facetState.pageNumber>1){self.facetState.searchId=self.cachedSearchId;}else{self.facetState.searchId='';}}}};self.defaultState=angular.copy(self.facetState);return self;}]);}());(function(i){'use strict';var NS='common.services',CONSTANT='siteLang',constant;constant=i.siteLang;angular.module(NS).constant(CONSTANT,constant);}(istock));(function(i){'use strict';var NS='common.services',CONSTANT='siteRegion',constant;constant=i.siteRegion;angular.module(NS).constant(CONSTANT,constant);}(istock));(function(){'use strict';angular.module('common.services').factory('spinnerService',[function(){var self,spinnerCache={};self={_register:function(spinnerScope){if(spinnerCache[spinnerScope.id]){spinnerCache[spinnerScope.id]=angular.extend(spinnerScope,spinnerCache[spinnerScope.id]);}else{spinnerCache[spinnerScope.id]=spinnerScope;}},_unregister:function(spinnerId){delete spinnerCache[spinnerId];},_unregisterGroup:function(spinnerGroup){var spinnerId;for(spinnerId in spinnerCache){if(spinnerCache[spinnerId].group===spinnerGroup){delete spinnerCache[spinnerId];}}},show:function(spinnerId){if(!spinnerCache[spinnerId]){spinnerCache[spinnerId]={};}
spinnerCache[spinnerId].showSpinner=true;},hide:function(spinnerId){if(!spinnerCache[spinnerId]){spinnerCache[spinnerId]={};}
spinnerCache[spinnerId].showSpinner=false;},showGroup:function(spinnerGroup){var spinnerId;for(spinnerId in spinnerCache){if(spinnerCache[spinnerId].group===spinnerGroup){this.show(spinnerId);}}},hideGroup:function(spinnerGroup){var spinnerId;for(spinnerId in spinnerCache){if(spinnerCache[spinnerId].group===spinnerGroup){this.hide(spinnerId);}}},getCache:function(){return spinnerCache;}};return self;}]);}());(function(translations){'use strict';var NS='common.services',key,formattedTranslations=[];for(key in translations){if(translations.hasOwnProperty(key)){formattedTranslations.push({key:key,value:translations[key],description:''});}}
angular.module(NS).constant('translations',formattedTranslations);}(window.translations));(function(){'use strict';angular.module('common.services').factory('VATService',[function(){var invalidCodes=[],regex,regexPatterns=['(AT)?U[0-9]{8}','(BE)?0[0-9]{9}','(BG)?[0-9]{9,10}','(CY)?[0-9]{8}L','(CZ)?[0-9]{8,10}','(DE)?[0-9]{9}','(DK)?[0-9]{8}','(EE)?[0-9]{9}','(EL|GR)?[0-9]{9}','(ES)?[0-9A-Z][0-9]{7}[0-9A-Z]','(FI)?[0-9]{8}','(FR)?[0-9A-Z]{2}[0-9]{9}','(GB)?([0-9]{9}([0-9]{3})?|[A-Z]{2}[0-9]{3})','(HU)?[0-9]{8}','(IE)?[0-9]S[0-9]{5}L','(IT)?[0-9]{11}','(LT)?([0-9]{9}|[0-9]{12})','(LU)?[0-9]{8}','(LV)?[0-9]{11}','(MT)?[0-9]{8}','(NL)?[0-9]{9}B[0-9]{2}','(PL)?[0-9]{10}','(PT)?[0-9]{9}','(RO)?[0-9]{2,10}','(SE)?[0-9]{12}','(SI)?[0-9]{8}','(SK)?[0-9]{10}'],vatHintText='';return{validate:function(vatCode){var isValid,i;if(!vatCode){return false;}
for(i=0;i<invalidCodes.length;i++){if(invalidCodes[i]===vatCode){return false;}}
regex=new RegExp('^('+regexPatterns.join('|')+')$');isValid=regex.test(vatCode);if(!isValid&&vatCode){isValid=regex.test(vatCode.replace(/ /g,''));}
return isValid;},clearInvalidCodes:function(){invalidCodes.length=0;},addInvalidVat:function(vatCode){invalidCodes[invalidCodes.length]=vatCode;},setVatHintText:function(text){vatHintText=text;},getVatHintText:function(){return vatHintText;}};}]);}());(function(){'use strict';angular.module('common.services').factory('omnitureService',['$window','$timeout','fileTypeStorageService','$location','$injectedData',function($window,$timeout,fileTypeStorageService,$location,$injectedData){var _commonPageLoad,_adpPageLoad,_getRequestedServers,_getCarouselDataSource,_adpCarouselsLoad,_adpCarouselSeeAllClick,_carouselTypeSanitized,_ctaClick,_adpDownload,_fileZoomClick,_savePageToLightbox,_toggleLightbox,_createLightbox,_addToLightbox,_similarFileClick,_portfolioLinkClick,_setSubsProp,_findDaysBetween,_adpDropboxCtaClick,_srpPageLoad,_toggleRefinePanel,_playAudioFile,_checkCookie,_getCookie,_deleteCookie,_srpSearchDetails='pageName,channel,server,prop1,eVar1,prop3,eVar3,prop4,eVar4,'+'prop5,eVar5,eVar6,prop7,eVar7,prop11,eVar11,prop12,eVar12,prop13,prop14,eVar14,'+'prop15,eVar15,prop16,eVar16,prop18,prop28,eVar28,prop31,eVar31,prop38,eVar38,prop39,eVar39,prop40,eVar40,'+'prop41,eVar41,prop44,eVar44,prop45,prop53,eVar53,prop60,prop70,prop73,prop74,prop75',_signInJoinPageLoad,_scrollToTopArrowClick,_weTransferModalOpen,_weTransferRequestSent,imageCarouselData=[],carouselLoadTimeout=null,carouselDataSource='';_commonPageLoad=function(){var joinEnd='JOIN_END',signInCookie='SIGNIN_COOKIE',unisporkalNewRegistrationCookie='new_registration',unisporkalTrackingCookie='trk-event';s.server=istock.baseUrl;if(s.prop3){s.prop3=istock.locale+'|'+s.prop3;}else{s.prop3=istock.locale;}
s.eVar3=istock.locale;s.prop5=$window.location.href;s.eVar7=s.prop7=s.getPreviousValue(s.pageName,'gpv_07');s.prop18=s.getPercentPageViewed();s.eVar28=s.prop28=s.getDaysSinceLastVisit('s_lv');if(s.prop40===undefined||s.prop40===null){s.prop40=s.eVar40='Authenticated';}
if(s.prop41===undefined||s.prop41===null){s.prop41=s.eVar41='Client';}
s.prop70='D=s_vi';if($window.timestamps){var temp74;s.prop73=$window.timestamps.serverEnd-$window.timestamps.serverStart;temp74=$window.timestamps.cssEnd-$window.timestamps.htmlStart+s.prop73;s.prop74=temp74+'|'+($window.timestamps.htmlEnd-$window.timestamps.cssEnd+temp74);if(!s.prop75){s.prop75='null';}
s.prop75=s.prop75+'|render:'+($window.timestamps.htmlEnd-$window.timestamps.serverStart);}
if(_checkCookie(joinEnd)){if(s.events){s.events+=',event21';}else{s.events='event21';}
_deleteCookie(joinEnd);}
if(_getCookie(unisporkalNewRegistrationCookie)){var registerEventValue=_getCookie(unisporkalTrackingCookie);if(registerEventValue){if(s.events){s.events+=','+registerEventValue;}else{s.events=registerEventValue;}
_deleteCookie(unisporkalTrackingCookie);}
_deleteCookie(unisporkalNewRegistrationCookie);}
if(_checkCookie(signInCookie)){if(s.events){s.events+=',event32';}else{s.events='event32';}
_deleteCookie(signInCookie);}};_ctaClick=function(ctaTitle){ctaTitle=ctaTitle.replace(/\s+/g,'');ctaTitle=ctaTitle.replace(/<\/?[^>]+(>|$)/g,'');s.linkTrackVars='events,prop65';s.linkTrackEvents='event45';s.events='event45';s.tl(true,'o',ctaTitle);};_adpPageLoad=function(args){var asset=args.asset,user=args.user,assetId=args.assetId,name='iStock|Product|'+asset.presentation.type+'FCP',segmentString=args.segmentString,classification='Creative',assetClickedFromSRP,typesSelectedSRP,regexSRP=new RegExp('st='),similarFilesServerRequest=args.similarFilesSource;s.pageName=s.eVar5=name;s.channel='Product';s.events='event3';if(asset.presentation.editorialCaption){classification='Editorial';}
s.eVar13=[classification,asset.presentation.type,asset.presentation.bestMatchCollection].join('|');s.prop26=new Date(asset.approvalDate);s.eVar39=segmentString;assetClickedFromSRP=localStorage.getItem('assetClickedFromSRP');if(assetClickedFromSRP){assetClickedFromSRP=angular.fromJson(assetClickedFromSRP);s.prop44=assetClickedFromSRP.column+':'+assetClickedFromSRP.row;localStorage.removeItem('assetClickedFromSRP');}
s.eVar47=_getRequestedServers();carouselDataSource='ADP_'+asset.source.toUpperCase()+'|Same_'+
similarFilesServerRequest.toUpperCase()+'|Sim_LUST';s.eVar48=carouselDataSource;s.prop56=assetId;s.prop65='iStockADP_New';if(typeof args.paymentClarityVersion!=='undefined'){s.prop65=s.eVar65=['ADP_2016_',args.paymentClarityVersion,'_Control'].join('');}
if(asset.isAdultContent){s.prop61=s.eVar61='Adult';}
if(user){s.prop4=s.eVar4=user.userId;s.prop58=s.eVar58=user.numCredits;if(user.hasSub){_setSubsProp(user);}}
_commonPageLoad();typesSelectedSRP=fileTypeStorageService.getFileType();if(typesSelectedSRP&&regexSRP.test(s.prop5)){s.prop16=s.eVar16=typesSelectedSRP.join('|');}
s.t();};_getRequestedServers=function(type){var serverRequest='LUST',adpString='ADP_',sameString='Same_',similarString='Sim_LUST',omnitureString;if(!!($injectedData.useAssetService)){serverRequest='AS';}
if(!type){omnitureString=adpString+serverRequest+'|'+sameString+serverRequest+'|'+similarString;}else if(type==='KEYWORDS'){omnitureString='Sim_LUST';}else if(type==='SIMILARFILES'){omnitureString=sameString+serverRequest;}
return omnitureString;};_getCarouselDataSource=function(type){var searchTerm='',dataSources=carouselDataSource.split('|'),counter=0;if(type==='KEYWORDS'){searchTerm='Sim';}else if(type==='SIMILARFILES'){searchTerm='Same';}else{return'';}
while(dataSources[counter].indexOf(searchTerm)<0){counter++;}
return dataSources[counter];};_adpCarouselsLoad=function(args){var carouselType=_carouselTypeSanitized(args.carouselType);if(imageCarouselData.indexOf(carouselType)>-1){return;}
imageCarouselData.push(carouselType);var imageCarouselOmnitureString=imageCarouselData.join('|');s.prop62=imageCarouselOmnitureString;if(carouselLoadTimeout!==null){$timeout.cancel(carouselLoadTimeout);}
carouselLoadTimeout=$timeout(function(){s.t();carouselLoadTimeout=null;},2000);};_carouselTypeSanitized=function(carouselType){var carouselTypeCleansed='';switch(carouselType){case'KEYWORDS':carouselTypeCleansed='SimilarImages';break;case'SIMILARFILES':carouselTypeCleansed='SameSeries';break;case'XSELL':carouselTypeCleansed='CrossSell';break;}
return carouselTypeCleansed;};_adpCarouselSeeAllClick=function(args){s.events='event44';s.prop62=_carouselTypeSanitized(args.carouselType);s.linkTrackVars='events,prop62';s.linkTrackEvents='event44';if(args.carouselType==='KEYWORDS'||args.carouselType==='SIMILARFILES'){s.linkTrackVars+=',eVar47,eVar48';s.eVar47=_getRequestedServers(args.carouselType);s.eVar48=_getCarouselDataSource(args.carouselType);}
s.tl(true,'o','SeeAllClick');};_adpDropboxCtaClick=function(requestTitle){s.linkTrackEvents=s.events='event28';s.tl(true,'o',requestTitle);};_srpPageLoad=function(){_commonPageLoad();s.t();};_adpDownload=function(args){var asset=args.asset,user=args.user,assetId=args.assetId,downloadInfo=args.downloadInfo,creditsRemaining=args.creditsRemaining,segmentString=args.segmentString,classification='Creative';s.events='event4';s.prop59='adp|download';s.eVar39=segmentString;if(asset.presentation.editorialCaption){classification='Editorial';}
s.eVar13=[classification,asset.presentation.type,asset.presentation.bestMatchCollection].join('|');s.prop72=assetId;s.prop58=s.eVar58=creditsRemaining;if(downloadInfo.acquiredWithCredits){s.eVar62='Credits';s.events='event4,event23';s.products=';;;;event23='+downloadInfo.creditBurned+';;';}else{s.eVar62='Subscription';s.products=';SUBISTOCK1M';_setSubsProp(user);if(user.sub.autoRenewal===true){s.prop24+='|on';}else if(user.sub.autoRenewal===false){s.prop24+='|off';}}
if(downloadInfo.creditBurned===0&&!downloadInfo.acquiredUnderSubscription){s.events='event33';}
s.linkTrackVars='events,products,prop24,prop59,eVar13,eVar39,prop72,prop58,eVar62,prop65';s.linkTrackEvents='event4,event23,event33';s.tl('DownloadConfirm','o','DownloadConfirm');};_fileZoomClick=function(args){var asset=args.asset,classification='Creative';if(asset.presentation.editorialCaption){classification='Editorial';}
s.eVar13=[classification,asset.presentation.type,asset.presentation.bestMatchCollection].join('|');s.prop23='Zoom';s.linkTrackVars='prop23,eVar13,prop65';s.tl('ImageZoomADP','o','ImageZoomADP');};_toggleLightbox=function(args){var assetId=args.assetId,classification='Creative',assetIsEditorial=args.assetIsEditorial,assetType=args.assetType,assetCollection=args.assetCollection,appId=args.appId;if(appId==='srp'){if(assetIsEditorial){classification='Editorial';}
s.eVar13=[classification,assetType,assetCollection].join('|');s.prop56=assetId;s.linkTrackVars='prop56,eVar13';s.linkTrackVars+=','+_srpSearchDetails;s.events='event6,event62';s.linkTrackEvents='event6,event62';s.tl(true,'o','SRP-LightboxModalLoad');}};_createLightbox=function(args){var lightboxName=args.name,assetId=args.assetId||null,appId=args.appId;s.events='event5,event6';s.prop10=s.eVar10=lightboxName;s.linkTrackVars='events,prop10,eVar10,eVar13,prop65';if(assetId){s.prop56=assetId;s.linkTrackVars+=',prop56';}
s.linkTrackEvents='event5,event6';if(appId==='srp'){s.linkTrackVars+=','+_srpSearchDetails;s.tl(true,'o','SRP-AddCreateLightbox');}else{s.tl('LightboxCreate','o','LightboxCreate');}};_addToLightbox=function(args){var assetType=args.assetType,assetCollection=args.assetCollection,assetId=args.assetId,assetIsEditorial=args.assetIsEditorial,appId=args.appId,lightboxName=args.name,classification='Creative';s.prop10=s.eVar10=lightboxName;s.events='event5';s.prop72=s.prop56=assetId;if(assetIsEditorial){classification='Editorial';}
if(assetCollection==='Essentials'){assetCollection='Main';}
s.eVar13=[classification,assetType,assetCollection].join('|');s.linkTrackVars='events,prop10,prop72,eVar10,eVar13,prop65,prop56';s.linkTrackEvents='event5';if(appId==='srp'){s.linkTrackVars+=','+_srpSearchDetails;s.tl(true,'o','SRP-AddToLightbox');}else{s.tl('LightboxAdd','o','LightboxAdd');}};_savePageToLightbox=function(args){var lightboxName=args.name;s.prop10=s.eVar10=lightboxName;s.events='event37';s.linkTrackVars='events,prop10,eVar10';s.linkTrackEvents='event37';s.tl(true,'o','Save page');};_similarFileClick=function(args){s.events='event44';s.prop62=_carouselTypeSanitized(args.carouselType);s.linkTrackVars='events,prop62,prop65';s.linkTrackEvents='event44';if(args.carouselType==='KEYWORDS'||args.carouselType==='SIMILARFILES'){s.linkTrackVars+=',eVar47,eVar48';s.eVar47=_getRequestedServers(args.carouselType);s.eVar48=_getCarouselDataSource(args.carouselType);}
s.tl(true,'o','SimilarFileClick');};_portfolioLinkClick=function(args){s.pageName='iStock|Product|'+args.asset.presentation.type+'FCP';s.events='event28';s.channel=s.prop1=s.prop2='Product';s.prop4=args.asset.contributor.id;s.prop17=args.asset.contributor.username;s.prop56=args.assetId;s.linkTrackVars='events,channel,prop1,prop2,prop4,prop17,prop56,prop37,evar20';s.linkTrackEvents='event28';s.tl(true,'o','CopyrightName');};_setSubsProp=function(user){var daysRemaining,dlRemaining=user.sub.downloadsRemaining,expiryTimestamp=user.sub.expires,dlTotal=user.sub.downloadCount;daysRemaining=_findDaysBetween(expiryTimestamp);s.prop24=dlRemaining+'|'+dlTotal+'|'+daysRemaining;};_findDaysBetween=function(expiry){var dayMs=1000*60*60*24,difference,todayDate,futureDate;todayDate=new Date(Date.now()).getTime();futureDate=new Date(expiry).getTime();difference=futureDate-todayDate;return Math.round(difference/dayMs);};_toggleRefinePanel=function(refinePanelOpen){var name='SRP-RefinePanelClose';if(refinePanelOpen){name='SRP-RefinePanelOpen';}
s.linkTrackVars+=','+_srpSearchDetails;s.tl(true,'o',name);};_playAudioFile=function(){s.linkTrackVars+=','+_srpSearchDetails;s.tl(true,'o','AudioSRP-PlayFile');};_signInJoinPageLoad=function(){_commonPageLoad();s.t();};_checkCookie=function(name){var cookieValue=_getCookie(name);return(cookieValue!=='');};_getCookie=function(name){var cookieName=name+'=',cookieList=document.cookie.split(';'),i=0,cookie='';for(i=0;i<cookieList.length;i++){cookie=cookieList[i];while(cookie.charAt(0)===' '){cookie=cookie.substring(1);}
if(cookie.indexOf(cookieName)===0){return cookie.substring(cookieName.length,cookie.length);}}
return'';};_deleteCookie=function(name){document.cookie=name+'=; expires=Thu, 01 Jan 1970 00:00:00 UTC ;domain=.istockphoto.com;path=/';};_scrollToTopArrowClick=function(eventName){s.linkTrackVars='events,prop4,prop11';s.linkTrackEvents=s.events='event28';s.tl(true,'o',eventName);};_weTransferModalOpen=function(){s.channel=s.prop1=s.eVar1=s.prop2=s.eVar2='Product';s.events='event28';s.linkTrackVars='events,channel,prop1,prop2,prop4,prop56,prop37,eVar20';s.linkTrackEvents='event28';s.tl(true,'o','WeTransfer');};_weTransferRequestSent=function(message){s.channel=s.prop1=s.eVar1=s.prop2=s.eVar2='Product';s.events='event49';s.prop19=message;s.linkTrackVars='events,channel,prop1,prop2,prop4,prop19,prop56,prop37,eVar20';s.linkTrackEvents='event49';s.tl(true,'o',message);};return{adpDownload:_adpDownload,adpPageLoad:_adpPageLoad,getRequestedServers:_getRequestedServers,getCarouselDataSource:_getCarouselDataSource,adpCarouselsLoad:_adpCarouselsLoad,adpCarouselSeeAllClick:_adpCarouselSeeAllClick,commonPageLoad:_commonPageLoad,addToLightbox:_addToLightbox,createLightbox:_createLightbox,ctaClick:_ctaClick,fileZoomClick:_fileZoomClick,savePageToLightbox:_savePageToLightbox,toggleLightbox:_toggleLightbox,similarFileClick:_similarFileClick,portfolioLinkClick:_portfolioLinkClick,adpDropboxCtaClick:_adpDropboxCtaClick,srpPageLoad:_srpPageLoad,toggleRefinePanel:_toggleRefinePanel,playAudioFile:_playAudioFile,srpSearchDetails:_srpSearchDetails,signInJoinPageLoad:_signInJoinPageLoad,checkCookie:_checkCookie,getCookie:_getCookie,deleteCookie:_deleteCookie,scrollToTopArrowClick:_scrollToTopArrowClick,weTransferModalOpen:_weTransferModalOpen,weTransferRequestSent:_weTransferRequestSent};}]);}());(function(){'use strict';angular.module('common.services').factory('marketingTrackingService',['$document',function($document){var _signInLoad,_signInSuccess,_joinLoad,_joinSuccess,_signInJoinToggle;_signInLoad=function(){$document.trigger('marketing.signInLoad');};_signInSuccess=function(){$document.trigger('marketing.signInSuccess');};_joinLoad=function(){$document.trigger('marketing.joinLoad');};_joinSuccess=function(){$document.trigger('marketing.joinSuccess');};_signInJoinToggle=function(){$document.trigger('marketing.signInJoinToggle');};return{signInLoad:_signInLoad,signInSuccess:_signInSuccess,joinLoad:_joinLoad,joinSuccess:_joinSuccess,signInJoinToggle:_signInJoinToggle};}]);}());(function(){'use strict';angular.module('common.services').factory('accountService',['$q','ipCookie','OptionsRestangular','$injectedData','authorizationService',function($q,ipCookie,OptionsRestangular,$injectedData,authorizationService){var ACCOUNT_ENDPOINT='user/account',CONTRIBUTOR_ENDPOINT='portfolio-banner/userid',SUBTYPE_COOKIE='subtype',defer,accountData,attemptedRefreshes=0,self={getAccount:function(){var result;defer=$q.defer();if(!self.isLoggedIn()){defer.resolve(null);}else{if($injectedData.accountInfo){result=$injectedData.accountInfo;self.handleCookie(result);defer.resolve(result);attemptedRefreshes=0;}else{OptionsRestangular.getJavaRestConfig().one(ACCOUNT_ENDPOINT).get().then(function(account){self.setAccountData(account);defer.resolve(accountData);attemptedRefreshes=0;}).catch(function(error){if(error.status===401&&attemptedRefreshes<=1){attemptedRefreshes++;authorizationService.refreshToken().then(function(data){$injectedData.token=data.data.token;self.getAccount();}).catch(function(){accountData=error;defer.reject(error);});}else{accountData=error;defer.reject(error);}});}}
return defer.promise;},setAccountData:function(account){var result=account;result.hasSub=account.hasSubscription;result.numCredits=account.creditBalance;result.userId=account.istockUserId;if(account.hasSubscription){result.sub={type:account.subscriptionInfo.collectionName,downloadsRemaining:account.subscriptionInfo.downloadCountRemaining,downloadCount:account.subscriptionInfo.downloadCount,expires:account.subscriptionInfo.expiration,sku:account.subscriptionInfo.sku,duration:account.subscriptionInfo.duration,autoRenewal:account.subscriptionInfo.isAutoRenew};}
self.handleCookie(result);accountData=result;},getAccountData:function(){return accountData;},isLoggedIn:function(){return OptionsRestangular.userLoggedIn();},handleCookie:function(result){if(result.hasSub){if(!ipCookie(SUBTYPE_COOKIE)||(ipCookie(SUBTYPE_COOKIE)&&ipCookie(SUBTYPE_COOKIE)!==result.sub.type)){ipCookie(SUBTYPE_COOKIE,result.sub.type,{path:'/',expires:7});}}else if(ipCookie(SUBTYPE_COOKIE)){ipCookie.remove(SUBTYPE_COOKIE);}},getSubTypeCookie:function(){return ipCookie(SUBTYPE_COOKIE);},getContributorAccount:function(id){defer=$q.defer();OptionsRestangular.getPhpRestConfig().one(CONTRIBUTOR_ENDPOINT,id).get().then(function(response){defer.resolve(response);}).catch(function(error){defer.reject(error);});return defer.promise;}};return self;}]);}());(function(){'use strict';var APP=angular.module('common.services');APP.factory('OptionsRestangular',['Restangular','$injectedData','siteLang','siteRegion','resultsService','languageService',function(Restangular,$injectedData,siteLang,siteRegion,resultsService,languageService){var self={getQueryString:function(param){var href=window.location.href,reg=new RegExp('[?&]'+param+'=([^&#]*)','i'),string=reg.exec(href);if(string&&string[1]){return string[1];}
return null;},getJavaRestConfig:function(referer){return Restangular.withConfig(function(RestangularConfigurer){var headers={'Content-Type':'application/json','Accept-Language':languageService.getIETFCode(istock.siteLang),'X-Istock-Search-Token':self.getQueryString('st')||resultsService.getSearchToken(),'X-Search':!!($injectedData.useAssetService)};if($injectedData.token){headers.Authorization='Bearer '+$injectedData.token;headers['X-Istock-Auth']=$injectedData.token;}
if($injectedData.guid){headers['X-Istock-VID']=$injectedData.guid;}
headers['X-Istock-Region']=siteRegion;if(referer){headers['X-Previous-Url']=referer;}
RestangularConfigurer.setBaseUrl(istock.restUrl);RestangularConfigurer.setDefaultHeaders(headers);RestangularConfigurer.setDefaultHttpFields({cache:true});});},getJavaRestWithDescription:function(referer){return Restangular.withConfig(function(RestangularConfigurer){var headers={'Content-Type':'application/json','Accept-Language':languageService.getIETFCode(istock.siteLang),'X-Istock-Search-Token':self.getQueryString('st')||resultsService.getSearchToken(),'X-Istock-Include-Description':true,'X-Search':!!($injectedData.useAssetService)};if($injectedData.token){headers.Authorization='Bearer '+$injectedData.token;headers['X-Istock-Auth']=$injectedData.token;}
if($injectedData.guid){headers['X-Istock-VID']=$injectedData.guid;}
headers['X-Istock-Region']=siteRegion;if(referer){headers['X-Previous-Url']=referer;}
RestangularConfigurer.setBaseUrl(istock.restUrl);RestangularConfigurer.setDefaultHeaders(headers);RestangularConfigurer.setDefaultHttpFields({cache:true});});},getPhpRestConfig:function(sendLanguageHeader){return Restangular.withConfig(function(RestangularConfigurer){var headers={'Content-Type':'application/json'};if(sendLanguageHeader){headers['Accept-Language']=languageService.formatRegionLanguageCode(siteLang,siteRegion);}
RestangularConfigurer.setBaseUrl('/api/');RestangularConfigurer.setDefaultHeaders(headers);RestangularConfigurer.setDefaultHttpFields({cache:true});});},userLoggedIn:function(){return $injectedData.token!==null&&$injectedData.token!==undefined;},getJavaFullResponseConfig:function(referer){return Restangular.withConfig(function(RestangularConfigurer){var headers={'Content-Type':'application/json','Accept-Language':languageService.getIETFCode(istock.siteLang),'X-Istock-Search-Token':self.getQueryString('st')||resultsService.getSearchToken()};if($injectedData.token){headers.Authorization='Bearer '+$injectedData.token;headers['X-Istock-Auth']=$injectedData.token;}
if($injectedData.guid){headers['X-Istock-VID']=$injectedData.guid;}
headers['X-Istock-Region']=siteRegion;if(referer){headers['X-Previous-Url']=referer;}
RestangularConfigurer.setBaseUrl(istock.restUrl);RestangularConfigurer.setDefaultHeaders(headers);RestangularConfigurer.setFullResponse(true);RestangularConfigurer.setDefaultHttpFields({cache:true});});},getSearchConfig:function(){return Restangular.withConfig(function(RestangularConfigurer){var headers={'Content-Type':'application/json'};if(siteLang&&siteRegion){headers['Accept-Language']=languageService.formatCountryLanguage(siteLang,siteRegion);}
RestangularConfigurer.setDefaultHeaders(headers);});}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('gettyMasterIdService',['$q','OptionsRestangular',function($q,OptionsRestangular){var CONVERT_ID_ENDPOINT='assets/convert/afid',cachedData={},_getMasterId;_getMasterId=function(assetId){var defer=$q.defer();if(!(assetId in cachedData)){OptionsRestangular.getJavaRestConfig().one(CONVERT_ID_ENDPOINT,assetId).get().then(function(gettyObject){cachedData[assetId]=gettyObject;defer.resolve(cachedData[assetId]);},function(error){defer.reject(error);});}else{defer.resolve(cachedData[assetId]);}
return defer.promise;};return{getMasterId:_getMasterId};}]);}());(function(){'use strict';angular.module('common.services').factory('colorService',[function(){var self={isHexadecimalValue:function(hex){return/(^#?[0-9A-Fa-f]{6}$)/i.test(hex);},formatHexadecimalValue:function(hex){if(!self.isHexadecimalValue(hex)){return hex;}
return hex.replace('#','').toUpperCase();},getMostVisibleColor:function(hexadecimal,light,dark){if(!self.isHexadecimalValue(hexadecimal)){return light;}
var hex=self.formatHexadecimalValue(hexadecimal),r=parseInt(hex.substr(0,2),16),g=parseInt(hex.substr(2,2),16),b=parseInt(hex.substr(4,2),16),yiq=((r*299)+(g*587)+(b*114))/1000;return(yiq>=128)?dark:light;},rgbToHex:function(R,G,B){return'#'+self.toHex(R)+self.toHex(G)+self.toHex(B);},toHex:function(value){var hex='00';if(value===null||value<=0){return hex;}
hex=value.toString(16).toUpperCase();if(hex.length===1){hex='0'+hex;}
return hex;}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('categoriesService',['urlBuilder',function(urlBuilder){var self={categories:{'animals and pets':{urlTranslation:{'en_US':'animals+or+pets','de_DE':'tier+or+haustier','es_ES':'animal+or+animales+domésticos','fr_FR':'faune+ou+animaux+familiers','it_IT':'animale+or+animale+domestico','ja_JP':'動物+or+ペット','ko_KR':'동물+or+애완 동물','pl_PL':'zwierzę+or+pieszczochy','pt_BR':'animal+or+pet','pt_PT':'animal+or+pet','ru_RU':'животное+or+балует'}},'animals':{urlTranslation:{'en_US':'animals','de_DE':'tier','es_ES':'animal','fr_FR':'faune','it_IT':'animale','ja_JP':'動物','ko_KR':'동물','pl_PL':'zwierzę','pt_BR':'animal','pt_PT':'animal','ru_RU':'животное'}},'pets':{urlTranslation:{'en_US':'pets','de_DE':'haustier','es_ES':'animales+domésticos','fr_FR':'animaux+familiers','it_IT':'animale+domestico','ja_JP':'ペット','ko_KR':'애완 동물','pl_PL':'pieszczochy','pt_BR':'pet','pt_PT':'pet','ru_RU':'балует'}},'dogs':{urlTranslation:{'en_US':'dogs','de_DE':'hund','es_ES':'perro','fr_FR':'chien','it_IT':'cane','ja_JP':'犬','ko_KR':'축산','pl_PL':'dobytek','pt_BR':'criacão','pt_PT':'criacão','ru_RU':'фермерское+животное'}},'wild animals':{urlTranslation:{'en_US':'wild+animals','de_DE':'wildtier','es_ES':'salvaje','fr_FR':'faune+sauvage','it_IT':'selvaggio','ja_JP':'野生の生き物','ko_KR':'야외+동물','pl_PL':'dzika+fauna','pt_BR':'selvagem','pt_PT':'selvagem','ru_RU':'дикая+фауна'}},'architecture and buildings':{urlTranslation:{'en_US':'architecture','de_DE':'architektionisch','es_ES':'arquitectura','fr_FR':'architecture','it_IT':'architettura','ja_JP':'構築物','ko_KR':'건축','pl_PL':'architektura','pt_BR':'arquitetura','pt_PT':'arquitetura','ru_RU':'архитектура'}},'architecture':{urlTranslation:{'en_US':'architecture','de_DE':'architektionisch','es_ES':'arquitectura','fr_FR':'architecture','it_IT':'architettura','ja_JP':'構築物','ko_KR':'건축','pl_PL':'architektura','pt_BR':'arquitetura','pt_PT':'arquitetura','ru_RU':'архитектура'}},'arts abstract':{urlTranslation:{'en_US':'arts+abstract','de_DE':'kunst+abstrakt','es_ES':'arte+abstracto','fr_FR':'art+abstrait','it_IT':'arte+astratto','ja_JP':'美術+抽象的','ko_KR':'예술+추상적인','pl_PL':'sztuka+abstrakcyjny','pt_BR':'arte+abstrato','pt_PT':'arte+abstrato','ru_RU':'искусство+реферат'}},'beauty and health':{urlTranslation:{'en_US':'beauty+and+health','de_DE':'schönheit+and+gesundheit','es_ES':'belleza+and+salud','fr_FR':'beauté+et+santé','it_IT':'bellezza+and+salute','ja_JP':'美しさ+and+健康','ko_KR':'아름다움+and+피트니스','pl_PL':'piękno+and+zdrowy','pt_BR':'beleza+and+saúde','pt_PT':'beleza+and+saúde','ru_RU':'красота+and+здоровый'}},'beauty':{urlTranslation:{'en_US':'beauty','de_DE':'schönheit','es_ES':'belleza','fr_FR':'beauté','it_IT':'bellezza','ja_JP':'美しさ','ko_KR':'아름다움','pl_PL':'piękno','pt_BR':'beleza','pt_PT':'beleza','ru_RU':'красота'}},'body':{urlTranslation:{'en_US':'body','de_DE':'koerperteile','es_ES':'parte+del+cuerpo+humano','fr_FR':'corps','it_IT':'anatomia+umana','ja_JP':'人間の身体各部','ko_KR':'인체','pl_PL':'ludzkie+ciało','pt_BR':'corpo+humano','pt_PT':'corpo+humano','ru_RU':'человеческое+тело'}},'fashion':{urlTranslation:{'en_US':'fashion','de_DE':'mode','es_ES':'moda','fr_FR':'secteur+de+la+mode','it_IT':'moda','ja_JP':'ファッション','ko_KR':'패션','pl_PL':'fason','pt_BR':'moda+e+roupas','pt_PT':'moda+e+roupas','ru_RU':'мода'}},'medicine':{urlTranslation:{'en_US':'medicine','de_DE':'medikament','es_ES':'medicina','fr_FR':'médicament','it_IT':'medicina','ja_JP':'医薬品','ko_KR':'약','pl_PL':'medycyna','pt_BR':'remédio','pt_PT':'remédio','ru_RU':'медицина'}},'business':{urlTranslation:{'en_US':'business','de_DE':'geschaeftsleben','es_ES':'negocio','fr_FR':'affaires','it_IT':'affari','ja_JP':'びじねすこんせぷと','ko_KR':'비즈니스','pl_PL':'handlowy','pt_BR':'negócios','pt_PT':'negócios','ru_RU':'бизнес'}},'concepts and ideas':{urlTranslation:{'en_US':'concepts','de_DE':'konzepte','es_ES':'conceptos','fr_FR':'concepts','it_IT':'concetti','ja_JP':'コンセプト','ko_KR':'개념','pl_PL':'pojęcia','pt_BR':'conceitos','pt_PT':'conceitos','ru_RU':'концепции'}},'feelings and emotions':{urlTranslation:{'en_US':'emotions','de_DE':'gefühl','es_ES':'emoción+humana','fr_FR':'émotive','it_IT':'emozione','ja_JP':'ふるまい','ko_KR':'행위','pl_PL':'zachowanie','pt_BR':'comportamento','pt_PT':'emoção+humana','ru_RU':'поведение'}},'healthy lifestyle':{urlTranslation:{'en_US':'healthy+lifestyle','de_DE':'gesundheit','es_ES':'salud','fr_FR':'santé','it_IT':'salute','ja_JP':'健康','ko_KR':'피트니스','pl_PL':'zdrowy','pt_BR':'saúde','pt_PT':'saúde','ru_RU':'здоровый+обычай'}},'food and drink':{urlTranslation:{'en_US':'food+and+drink','de_DE':'essen+und+trinken','es_ES':'comida+y+bebida','fr_FR':'alimentation+et+boisson','it_IT':'cibo+e+bevande','ja_JP':'飲食','ko_KR':'음식과+음료','pl_PL':'jadło+i+pijają','pt_BR':'comida+e+bebida','pt_PT':'comida+e+bebida','ru_RU':'пища+и+пьют'}},'food':{urlTranslation:{'en_US':'food','de_DE':'essen','es_ES':'comida','fr_FR':'alimentation','it_IT':'cibo','ja_JP':'飲食','ko_KR':'음식과','pl_PL':'jadło','pt_BR':'comida','pt_PT':'comida','ru_RU':'пища'}},'holidays':{urlTranslation:{'en_US':'holidays','de_DE':'feiertag','es_ES':'celebraciones+públicas','fr_FR':'évènement+public','it_IT':'festa','ja_JP':'祝賀行事','ko_KR':'holidays','pl_PL':'święto','pt_BR':'holidays','pt_PT':'feriado','ru_RU':'праздник'}},'celebration':{urlTranslation:{'en_US':'holidays','de_DE':'feiertag','es_ES':'celebraciones+públicas','fr_FR':'évènement+public','it_IT':'festa','ja_JP':'祝賀行事','ko_KR':'holidays','pl_PL':'święto','pt_BR':'holidays','pt_PT':'feriado','ru_RU':'праздник'}},'health care':{urlTranslation:{'en_US':'healthcare','de_DE':'gesundheitsfuersorge','es_ES':'medico','fr_FR':'médecine','it_IT':'medicina','ja_JP':'薬と健康管理','ko_KR':'치료','pl_PL':'zdrowy','pt_BR':'saudáveis','pt_PT':'saudáveis','ru_RU':'здоровый'}},'lifestyle':{urlTranslation:{'en_US':'lifestyle','de_DE':'lebensstil','es_ES':'estilos+de+vida','fr_FR':'style+de+vie','it_IT':'stili+di+vita','ja_JP':'ライフスタイル','ko_KR':'생활+방식','pl_PL':'życie','pt_BR':'estilo+de+vida','pt_PT':'estilos+de+vida','ru_RU':'стиль+живущего'}},'babies':{urlTranslation:{'en_US':'babies','de_DE':'baby','es_ES':'bebé','fr_FR':'bébé','it_IT':'infante','ja_JP':'赤ちゃん','ko_KR':'아기','pl_PL':'niemowlę','pt_BR':'bebê','pt_PT':'bebê','ru_RU':'младенец'}},'children':{urlTranslation:{'en_US':'children','de_DE':'kind','es_ES':'niño','fr_FR':'enfant','it_IT':'bambino','ja_JP':'子供','ko_KR':'아이','pl_PL':'dziecko','pt_BR':'criança','pt_PT':'criança','ru_RU':'ребенок'}},'family':{urlTranslation:{'en_US':'families','de_DE':'familie','es_ES':'familias','fr_FR':'famille','it_IT':'famiglia','ja_JP':'家族','ko_KR':'가족','pl_PL':'rodzina','pt_BR':'família','pt_PT':'familia','ru_RU':'семья'}},'medicine and science':{urlTranslation:{'en_US':'medicine+science','de_DE':'medikament+or+wissenschaft','es_ES':'medicina+or+ciencia','fr_FR':'médicament+ou+science','it_IT':'medicina+or+scienza','ja_JP':'医薬品+or+科学','ko_KR':'약+or+과학','pl_PL':'medycyna+or+nauka','pt_BR':'remédio+or+ciência','pt_PT':'remédio+or+ciência','ru_RU':'медицина+or+наука'}},'medical':{urlTranslation:{'en_US':'medical','de_DE':'medizin','es_ES':'medico','fr_FR':'médecine','it_IT':'medicina','ja_JP':'薬と健康管理','ko_KR':'치료','pl_PL':'medyczny','pt_BR':'saudável','pt_PT':'medicina','ru_RU':'медицинский'}},'research':{urlTranslation:{'en_US':'research','de_DE':'forschen','es_ES':'Investigación','fr_FR':'recherche','it_IT':'ricerca','ja_JP':'研究','ko_KR':'연구','pl_PL':'badanie','pt_BR':'pesquisa','pt_PT':'pesquisa','ru_RU':'исследование'}},'nature':{urlTranslation:{'en_US':'nature','de_DE':'natur','es_ES':'naturaleza','fr_FR':'nature','it_IT':'natura','ja_JP':'自然','ko_KR':'자연','pl_PL':'natura','pt_BR':'natureza','pt_PT':'natureza','ru_RU':'природа'}},'flowers':{urlTranslation:{'en_US':'flowers','de_DE':'blume','es_ES':'flor','fr_FR':'fleur','it_IT':'fiore','ja_JP':'ハナヲツケナガラ','ko_KR':'꽃','pl_PL':'kwiat','pt_BR':'flor','pt_PT':'flor','ru_RU':'цветок'}},'landscapes':{urlTranslation:{'en_US':'landscapes','de_DE':'landschaft','es_ES':'paisaje','fr_FR':'paysage','it_IT':'paesaggio','ja_JP':'自然の風景','ko_KR':'풍경','pl_PL':'krajobraz','pt_BR':'paisagem','pt_PT':'paisagem','ru_RU':'пейзаж'}},'people':{urlTranslation:{'en_US':'people','de_DE':'menschen','es_ES':'personas','fr_FR':'personne','it_IT':'persone','ja_JP':'人','ko_KR':'사람','pl_PL':'ludzie','pt_BR':'pessoas','pt_PT':'pessoas','ru_RU':'люди'}},'sports':{urlTranslation:{'en_US':'sports','de_DE':'sport','es_ES':'deportes','fr_FR':'sport','it_IT':'sport','ja_JP':'スポーツ','ko_KR':'스포츠','pl_PL':'zabawa','pt_BR':'esporte','pt_PT':'desporto','ru_RU':'спорт'}},'fitness':{urlTranslation:{'en_US':'fitness','de_DE':'durchtrainiertem','es_ES':'entrenamientos','fr_FR':'exercice+physique','it_IT':'riscaldamento','ja_JP':'わーくあうと','ko_KR':'운동','pl_PL':'fizyczny+ruch','pt_BR':'exercitam','pt_PT':'malhação','ru_RU':'личная+пригодность+обучение'}},'technology':{urlTranslation:{'en_US':'technology','de_DE':'technologie','es_ES':'tecnología','fr_FR':'technologie','it_IT':'tecnologia','ja_JP':'ギジュツ','ko_KR':'기술','pl_PL':'technologia','pt_BR':'tecnologia','pt_PT':'tecnologia','ru_RU':'технология'}},'travel':{urlTranslation:{'en_US':'travel','de_DE':'reisen','es_ES':'viajes','fr_FR':'voyage','it_IT':'viaggi','ja_JP':'旅行','ko_KR':'여행','pl_PL':'przesuw','pt_BR':'viagem','pt_PT':'viagem','ru_RU':'путешествие'}},'landmarks':{urlTranslation:{'en_US':'landmarks','de_DE':'sehenswürdigkeit','es_ES':'lugar+de+interés','fr_FR':'lieu+touristique','it_IT':'luogo+d\'interesse','ja_JP':'観光地','ko_KR':'유명한+장소','pl_PL':'miejsce+zainteresowania','pt_BR':'ponto+tturístico','pt_PT':'lugar+de+interesse','ru_RU':'место+представляющее+интерес'}}},translate:function(category){var str=category.toLowerCase(),url='',categoryInfo=self.categories[str];if(istock.locale&&categoryInfo){url=categoryInfo.urlTranslation[istock.locale];}
if(url===''){url=str.replace(/\s/g,'+');}
return url;},categoryUrl:function(category){var baseUrl='/royalty-free/'+self.translate(category),siteInfix=urlBuilder.getUrlInfix();if(siteInfix){return siteInfix.toLowerCase()+baseUrl;}else{return baseUrl;}}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('assetService',['$q','OptionsRestangular',function($q,OptionsRestangular){var ASSETS_ENDPOINT='assets',rest,cachedData={},_getDeferred,_getAsset;_getAsset=function(gettyId,hasCookie,user){var defer=$q.defer(),referer=document.referrer;if(!(gettyId in cachedData)){if(!hasCookie&&user===null){rest=OptionsRestangular.getJavaRestWithDescription(referer);}else{rest=OptionsRestangular.getJavaRestConfig(referer);}
rest.one(ASSETS_ENDPOINT,gettyId).get().then(function(asset){cachedData[gettyId]=asset;defer.resolve(cachedData[gettyId]);},function(error){defer.reject(error);});}else{defer.resolve(cachedData[gettyId]);}
return defer.promise;};return{getAsset:_getAsset,getDeferred:_getDeferred};}]);}());(function(){'use strict';angular.module('common.services').factory('legacyFacetService',['facetStateService',function(facetStateService){var self={facetMapping:{0:'searchId',2:'lightboxID',3:'portfolioID',4:'color',5:'copySpace',6:'activeStatus',7:'fileCollection',9:'filterContent',12:'showPeople',15:'tempo',16:'audioKey',17:'timeSignature1',18:'timeSignature2',19:'date',20:'orientation',21:'exclusiveContributor',25:'order',26:'bestMatchMix',30:'perPage',34:'abstractType',35:'text',36:'textDisambiguation',39:'pageNumber',40:'noCache',41:'photoSize',42:'vectorPrice',44:'videoSize',45:'audioPrice',46:'priceLevel',47:'editorsPick',50:'fileIdSet',51:'decoration',52:'subscriptionCollection',53:'loginToken',54:'keywordLanguage',55:'deduplicate',56:'gettyMasterIdSet',57:'similarity',420:'exclusiveEditorsPickVetta',1002:'countryID',1003:'additionalAudio',1004:'editorial',1006:'shuffleFiletypeCycle',1008:'adminSearch',1009:'userPartition',1010:'shufflePriceLevelCycle',1012:'aspectRatioVideo',3001:'latestFiles',3003:'filterVector',3004:'keywordRankAdjustment',3005:'collectionPrice'},optionsMapping:{editorsPick:{0:'false',1:'true'},noCache:{0:'false',1:'true'},filterVector:{0:'false',1:'true'},exclusiveEditorsPickVetta:{1:'onlyFromIstock',2:'editorsPick',4:'vetta'},photoSize:{1:'xl',2:'large',3:'medium',4:'small',10:'xxl',35:'xsmall',85:'xxxl'},fileCollection:{2:'essentials',4:'vetta',8:'value',9:'signature',16:'signature+'},abstractType:{1:'photos',7:'illustrations',8:'video',9:'audio'},order:{4:'new',6:'bestMatch',7:'yearPopular',10:'bestMatchAlternate',12:'allTimePopular',13:'monthPopular'},editorial:{0:false,1:true},collectionPrice:{1:'essentials',2:'signature'},exclusiveContributor:{0:false,1:true},showPeople:{0:false,1:true},filterContent:{0:false,1:true},orientation:{1:'vertical',2:'square',4:'horizontal'},aspectRatioVideo:{1:'4:3',2:'16:9'},videoSize:{18:'ntsc',21:'pal',23:'hd1080',24:'hd720',33:'dv'},tempo:{1:'all',2:'very slow',3:'slow',4:'medium',5:'fast',6:'very fast'},audioKey:{0:'all',1:'undefined',2:'A',3:'A major',4:'A minor',5:'A flat',6:'A flat major',7:'A flat minor',8:'B',9:'B major',10:'B minor',11:'B flat',12:'B flat major',13:'B flat minor',14:'C',15:'C major',16:'C minor',17:'C sharp',18:'C sharp major',19:'C sharp minor',20:'D',21:'D major',22:'D minor',23:'E',24:'E major',25:'E minor',26:'E flat',27:'E flat major',28:'E flat minor',29:'F',30:'F major',31:'F minor',32:'F sharp',33:'F sharp major',34:'F sharp minor',35:'G',36:'G major',37:'G minor'},audioPrice:{68:'basic',75:'moderate',102:'detailed',77:'complex',79:'elaborate'},subscriptionCollection:{standard:'standard'},date:{1:'oneHour',2:'oneDay',3:'oneWeek',4:'oneMonth',5:'threeMonths',6:'sixMonths'}},initFromLegacyFacets:function(legacyFacets){var name='',option='',tempArray=[];angular.forEach(legacyFacets,function(value,key){name=self.facetMapping[key];if(angular.isArray(facetStateService.getFacet(name))&&!angular.isArray(value)){tempArray.push(value);value=tempArray;tempArray=[];}
if(self.optionsMapping[name]){if(angular.isArray(value)){angular.forEach(value,function(v){option=self.optionsMapping[name][v];if(option!==undefined){facetStateService.setFacetOption(name,option,true);}});}else{option=self.optionsMapping[name][value];if(option!==undefined){facetStateService.setFacetOption(name,option,true);}}}else if(name!==undefined){switch(typeof facetStateService.getFacet(name)){case'number':value=Number(value);break;case'boolean':value=value==='true';break;}
facetStateService.setFacet(name,value);}});self.setAppropriateAbstractFileType();},setAppropriateAbstractFileType:function(){var images=facetStateService.hasActiveFacets(facetStateService.imagesFacets),audio=facetStateService.hasActiveFacets(facetStateService.audioFacets),video=facetStateService.hasActiveFacets(facetStateService.videoFacets),abstractType=facetStateService.getFacet('abstractType'),fileType=facetStateService.getActiveValues('abstractType');if(fileType.length===1){if((fileType.indexOf('photos')!==-1||fileType.indexOf('illustrations')!==-1)&&(audio||video)){facetStateService.clearFileTypeFacetGroups('images');abstractType.audio=false;abstractType.video=false;}else{if(fileType.indexOf('video')!==-1&&(images||audio)){facetStateService.clearFileTypeFacetGroups('video');abstractType.audio=false;abstractType.photos=false;abstractType.illustrations=false;}else if(fileType.indexOf('audio')!==-1&&(images||video)){facetStateService.clearFileTypeFacetGroups('audio');abstractType.video=false;abstractType.photos=false;abstractType.illustrations=false;}}}else{if(images+audio+video>1){facetStateService.setFileTypeToDefault();facetStateService.clearFileTypeFacetGroups('images');}else if(images){abstractType.photos=true;abstractType.illustrations=true;abstractType.video=false;abstractType.audio=false;}else if(audio){abstractType.audio=true;abstractType.photos=false;abstractType.illustrations=false;abstractType.video=false;}else if(video){abstractType.video=true;abstractType.audio=false;abstractType.photos=false;abstractType.illustrations=false;}else{if(fileType.length>1){facetStateService.setFileTypeToDefault();}}}}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('dropboxService',['$q','OptionsRestangular','dropboxErrorHandlerService',function($q,OptionsRestangular,dropboxErrorHandlerService){var DROPBOX_ENDPOINT='oauthclient/dropbox',DROPBOX_ASSETPUSH_ENDPOINT='user/preference/assetpush';return{getAuthenticationUrl:function(dropboxKey,state,redirectUri){var metaLang=angular.element('html').attr('lang').split('-')[0].toLowerCase();return['https://www.dropbox.com/1/oauth2/authorize','?response_type=code&client_id=',dropboxKey,'&redirect_uri=',redirectUri,'&locale=',metaLang,'&state=',state].join('');},connectAccount:function(code,redirectUri){var unencodedDropboxData={'code':code,'redirect_uri':redirectUri},params,str=[],deferred=$q.defer();for(params in unencodedDropboxData){if(params!==undefined){str.push(encodeURIComponent(params)+'='+encodeURIComponent(unencodedDropboxData[params]));}}
str=str.join('&');OptionsRestangular.getJavaRestConfig().one(DROPBOX_ENDPOINT).customPOST(str,null,null,{'Content-Type':'application/x-www-form-urlencoded'}).then(function(response){if(response.status===201){deferred.resolve({'connected':true,'timeStamp':response.data});}},function(error){deferred.reject({'connected':false,'error':error,'message':dropboxErrorHandlerService.getErrorMessage(error.status)});});return deferred.promise;},disconnectAccount:function(){var deferred=$q.defer();OptionsRestangular.getJavaRestConfig().one(DROPBOX_ENDPOINT).remove().then(function(response){if(response.status===200){deferred.resolve({'disconnected':true});}},function(error){deferred.reject({'disconnected':false,'error':error,'message':dropboxErrorHandlerService.getErrorMessage(error.status)});});return deferred.promise;},getAccountStatus:function(){var deferred=$q.defer();OptionsRestangular.getJavaRestConfig().one(DROPBOX_ENDPOINT).get().then(function(response){if(response.status===200){deferred.resolve({'connected':true});}},function(error){if(error.status===404){deferred.resolve({'connected':false});}else{deferred.reject({'connected':false,'message':dropboxErrorHandlerService.getErrorMessage(error.status)});}});return deferred.promise;},setAssetPushStatus:function(backUpFutureDownloads,daysBack){var settings={'Dropbox':{'backUpFutureDownloads':backUpFutureDownloads,'daysBack':daysBack}},deferred=$q.defer();OptionsRestangular.getJavaRestConfig().one(DROPBOX_ASSETPUSH_ENDPOINT).customPUT(settings).then(function(response){if(response.status===200){deferred.resolve({'updated':true});}},function(error){deferred.reject({'updated':false,'message':dropboxErrorHandlerService.getErrorMessage(error.status)});});return deferred.promise;},getAssetPushStatus:function(){var deferred=$q.defer();OptionsRestangular.getJavaRestConfig().one(DROPBOX_ASSETPUSH_ENDPOINT).get().then(function(response){if(response.status===200){deferred.resolve({'error':false,'daysBack':response.data.Dropbox.daysBack,'downloadsFromDate':response.data.Dropbox.backUpFutureLastSet,'lastUpdateDate':response.data.Dropbox.daysBackSettingLastSet});}},function(error){deferred.resolve({'error':true,'message':dropboxErrorHandlerService.getErrorMessage(error.status)});});return deferred.promise;},getErrorMessages:function(statusCodes){return dropboxErrorHandlerService.getErrorMessages(statusCodes);}};}]);}());(function(){'use strict';angular.module('common.services').factory('dropboxErrorHandlerService',['ERROR_MESSAGING','$filter',function(ERROR_MESSAGING,$filter){var self={getErrorMessage:function(statusCode){var errorMessage='';switch(statusCode){case 400:errorMessage=$filter('i18n')(ERROR_MESSAGING.DROPBOX_ERROR.DROPBOX_ALREADY_CONNECTED,statusCode);break;case 403:case 401:case 502:errorMessage=$filter('i18n')(ERROR_MESSAGING.DROPBOX_ERROR.OAUTH_TOKEN_BROKEN,statusCode);break;case 429:errorMessage=$filter('i18n')(ERROR_MESSAGING.DROPBOX_ERROR.API_LIMIT_ERROR,'/contact_ticket',statusCode);break;case 507:errorMessage=$filter('i18n')(ERROR_MESSAGING.DROPBOX_ERROR.STORAGE_FULL,statusCode);break;case 404:errorMessage=$filter('i18n')(ERROR_MESSAGING.DROPBOX_ERROR.SERVER_ERROR,'/contact_ticket',statusCode);break;default:errorMessage=$filter('i18n')(ERROR_MESSAGING.DROPBOX_ERROR.ERROR,'/contact_ticket');}
return errorMessage;},getErrorMessages:function(statusCodes){var message=[];angular.forEach(statusCodes,function(statusCode){message.push(self.getErrorMessage(statusCode));});return message.join('<br><br>');}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('imagePreloadService',['$q','$timeout','PRELOAD_IMAGES',function($q,$timeout,PRELOAD_IMAGES){var _getPreLoadingImage;_getPreLoadingImage=function(srcUrl,timoutValue){var deferred=$q.defer(),promise,image=new Image(),preLoadingImage={state:PRELOAD_IMAGES.LOADING,image:image},_init,_timer,_loadComplete,_loadError,_timeOut,_dispose;_loadComplete=function(){preLoadingImage.state=PRELOAD_IMAGES.COMPLETE;_dispose();deferred.resolve(preLoadingImage);};_loadError=function(){preLoadingImage.state=PRELOAD_IMAGES.ERROR;preLoadingImage.image=null;_dispose();deferred.resolve(preLoadingImage);};_timeOut=function(){if(image!==null){preLoadingImage.state=PRELOAD_IMAGES.TIMEOUT;preLoadingImage.image=null;_dispose();deferred.resolve(preLoadingImage);}};_dispose=function(){if(typeof _timer!=='undefined'&&_timer!==null){$timeout.cancel(_timer);_timer=null;}
if((typeof image!=='undefined')&&image!==null){image.removeEventListener('load',_loadComplete,true);image.removeEventListener('error',_loadError,true);image=null;}};_init=function(){image.addEventListener('load',_loadComplete,true);image.addEventListener('error',_loadError,true);image.src=srcUrl;if(image.complete){preLoadingImage.state=PRELOAD_IMAGES.COMPLETE;promise=$q.when(preLoadingImage);_dispose();}else{promise=deferred.promise;_timer=$timeout(_timeOut,timoutValue);}};_init();return promise;};return{getPreLoadingImage:_getPreLoadingImage};}]);}());(function(){'use strict';var RENDER_DELAY=100,DOCUMENT_DELAY=2000;angular.module('common.services').factory('lazyImageService',['$document','$window','$timeout',function($document,$window,$timeout){var renderDelay=RENDER_DELAY,documentDelay=DOCUMENT_DELAY,documentHeight=$document.height(),win=angular.element($window),isWatchingWindow=false,renderTimer=null,documentTimer=null,self={enabled:false,images:[],prioritizeFirstBatch:false,addImage:function(element,onLoad,tag){var image={source:null,isRendered:false,height:null,element:element,tag:tag||'src',onLoad:onLoad};self.images.push(image);if(!renderTimer){self.startRenderTimer();}
if(!isWatchingWindow){self.startWatchingWindow();}
return image;},removeImage:function(image){var index=self.images.indexOf(image);if(index!==-1){self.images.splice(index,1);}
if(self.images.length===0){self.clearRenderTimer();self.stopWatchingWindow();}},checkDocumentHeight:function(){var currentDocumentHeight=$document.height();if(renderTimer||currentDocumentHeight===documentHeight){return;}
documentHeight=currentDocumentHeight;self.startRenderTimer();},checkImages:function(){var visible=[],hidden=[],windowHeight=win.height(),scrollTop=win.scrollTop(),topFoldOffset=scrollTop,bottomFoldOffset=(topFoldOffset+windowHeight);angular.forEach(self.images,function(image){if(self.isVisible(image,topFoldOffset,bottomFoldOffset)){visible.push(image);}else{hidden.push(image);}});var visibleCount=visible.length;angular.forEach(visible,function(img){self.render(img);if(self.prioritizeFirstBatch){img.element.load(function(){visibleCount--;if(visibleCount===0){angular.forEach(self.images,function(img){self.render(img);});self.images=[];self.clearRenderTimer();self.stopWatchingWindow();}});}});self.images=hidden;self.clearRenderTimer();if(self.images.length===0){self.stopWatchingWindow();}},clearRenderTimer:function(){if(renderTimer){$timeout.cancel(renderTimer);renderTimer=null;}},startRenderTimer:function(){if(renderTimer===null){renderTimer=$timeout(self.checkImages,renderDelay);}},startWatchingWindow:function(){if(!isWatchingWindow){isWatchingWindow=true;win.on('resize.lazySrc',self.windowChanged);win.on('scroll.lazySrc',self.windowChanged);documentTimer=$timeout(self.checkDocumentHeight,documentDelay);}},stopWatchingWindow:function(){if(isWatchingWindow){isWatchingWindow=false;win.off('resize.lazySrc');win.off('scroll.lazySrc');$timeout.cancel(documentTimer);}},windowChanged:function(){if(renderTimer===null){self.startRenderTimer();}},isVisible:function(image,topFoldOffset,bottomFoldOffset){var top,bottom;if(!image.element.is(':visible')){return false;}
if(image.height===null){image.height=image.element.height();}
top=image.element.offset().top;bottom=(top+image.height);return(((top<=bottomFoldOffset)&&(top>=topFoldOffset))||((bottom<=bottomFoldOffset)&&(bottom>=topFoldOffset))||((top<=topFoldOffset)&&(bottom>=bottomFoldOffset)));},render:function(image){image.isRendered=true;self.renderSource(image);},setSource:function(image,newSource){image.source=newSource;if(!self.enabled||image.isRendered){self.renderSource(image);}},renderSource:function(imageData){var image;if(self.enabled){image=new Image();image.onload=imageData.onLoad;image.src=imageData.source;}
imageData.element.attr(imageData.tag,imageData.source);}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('flattenService',[function(){var flatten,unflatten,isObject,SEPARATOR='.';isObject=function(value){var type=Object.prototype.toString.call(value);return(type==='[object Object]'||type==='[object Array]');};flatten=function(target){var output={},step;step=function(obj,prev){Object.keys(obj).forEach(function(key){var value=obj[key],newKey=key;if(prev){newKey=[prev,key].join(SEPARATOR);}
if(isObject(value)&&Object.keys(value).length){return step(value,newKey);}
output[newKey]=value;});};step(target);return output;};unflatten=function(target){var result={},getKey;if(!isObject(target)){return target;}
getKey=function(key){var parsedKey=Number(key);if(isNaN(parsedKey)||key.indexOf(SEPARATOR)!==-1){return key;}else{return parsedKey;}};Object.keys(target).forEach(function(key){var keys=key.split(SEPARATOR),key1=getKey(keys.shift()),key2=getKey(keys[0]),container=result;while(typeof key2!=='undefined'){if(typeof container[key1]==='undefined'){if(typeof key2==='number'){container[key1]=[];}else{container[key1]={};}}
container=container[key1];if(keys.length>0){key1=getKey(keys.shift());key2=getKey(keys[0]);}}
container[key1]=unflatten(target[key]);});return result;};return{flatten:flatten,unflatten:unflatten};}]);}());(function(){'use strict';angular.module('common.services').factory('hashService',[function(){var hashCode;hashCode=function(str){var hash=0,i,chr,len;if(str.length===0){return hash;}
for(i=0,len=str.length;i<len;i++){chr=str.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash|=0;}
return hash;};return{hashCode:hashCode};}]);}());(function(){'use strict';angular.module('common.services').factory('boomerangService',['$q','$window','accountService',function($q,$window,accountService){var methods,timers=[];methods={initBoomerang:function(target,targetURLContains){if($window.BOOMR&&target){var IstockTimingConfig={},isLoggedIn=accountService.isLoggedIn()||false,pluginObject={'is_complete':function(){return checkDone();}};$window.BOOMR.plugins.iStockNG=pluginObject;$window.BOOMR.addVar('ng_is_logged_in',(isLoggedIn)?1:0);if(targetURLContains!==undefined){IstockTimingConfig.targetElementsURLContains=targetURLContains;IstockTimingConfig.pageType=target;}
$window.BOOMR.init({'beacon_url':'/boomerang/'+target,log:null,IstockTiming:IstockTimingConfig});}},startRoundTripTimer:function(timerName){if($window.BOOMR&&$window.BOOMR.plugins&&$window.BOOMR.plugins.RT){$window.BOOMR.plugins.RT.startTimer(timerName);}},endRoundTripTimer:function(timerName){if($window.BOOMR&&$window.BOOMR.plugins&&$window.BOOMR.plugins.RT){$window.BOOMR.plugins.RT.endTimer(timerName);}},createTimer:function(type,subtype,startTime){var deferred=$q.defer(),timer={type:type,subtype:subtype,st:startTime||new Date().valueOf(),end:null};timers.push(timer);deferred.promise.then(function(value){timer.end=value||new Date().valueOf();checkTimeEnd();},function(){var i=timers.indexOf(timer);timers.splice(i,1);checkTimeEnd();});return{finish:function(value){deferred.resolve(value);},cancel:function(reason){deferred.reject(reason);},promise:deferred.promise};},getTimers:function(){return timers;}};function checkTimeEnd(){if(!checkDone()){return false;}
$window.BOOMR.addVar('ng_data',JSON.stringify(timers));$window.BOOMR.sendBeacon();return true;}
function checkDone(){for(var i=0;i<timers.length;i++){var timer=timers[i];if(!timer.st||!timer.end){return false;}}
return true;}
return methods;}]);}());(function(){'use strict';angular.module('common.services').factory('formFieldsValidatorService',['$window','$location','userService','urlBuilder',function($window,$location,userService,urlBuilder){var self={getRedirectUrl:function(){var redirectUrl=$window.location.pathname;return $location.protocol()+'://'+$location.host()+
urlBuilder.buildReturnUrl('sign-in',redirectUrl,true);},checkUserEmailNotExists:function(email){if(email){return userService.isAlreadyUser(email).then(function(status){return!status;},function(){return true;});}
return true;},checkPasswordLength:function(password){var valid=true;if(password){if(password.length<8){valid=false;}}else{valid=false;}
return valid;},checkPasswordCharacters:function(password){var valid=true;if(password){if((password.search(/\d/)===-1)||(password.search(/[a-z]|[A-Z]/)===-1)){valid=false;}}else{valid=false;}
return valid;},checkSpacesInPassword:function(password){var valid=true;if(password){if(/^\s/.test(password)||/\s$/.test(password)){valid=false;}}else{valid=false;}
return valid;},checkEmailNotInPassword:function(email,password){var valid=true,beforeSymbol='',foundEmailInPassword=false;if(email){if(password){beforeSymbol=email.split('@',1)[0];foundEmailInPassword=(password.indexOf(beforeSymbol)>-1);valid=!foundEmailInPassword;}else{valid=false;}}
return valid;},checkCountrySelected:function(country){return country&&angular.isDefined(country.ID);},emailValidation:function(emailValue){var emailRegex,response=false;if(!emailValue){return true;}
if(emailValue!==undefined){emailRegex=new RegExp(['^[-a-z0-9~!$%^&*_=+}{\\\'?]+(\\.[-a-z0-9~!$%^&*_=+}{\\\'?]+)*','@([a-z0-9_][-a-z0-9_]*(\\.[-a-z0-9_]+)*\\.','(aero|arpa|biz|com|coop|edu|gov|info|int|mil','|museum|name|net|org|pro|travel|mobi|[a-z][a-z])','|([0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}))(:[0-9]{1,5})?$'].join(''));response=emailRegex.test(emailValue.toLowerCase());}
return response;}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('lightboxService',['$q','OptionsRestangular','arrayHelperService',function($q,OptionsRestangular,arrayHelperService){var LIGHTBOX_ENDPOINT='favorites',ASSETS_ENDPOINT='assets',SEARCH_ENDPOINT='search',defers={},self={searchedBoxes:{favorites:[]},defaultNameCount:0,incrementDefaultNameCount:function(){self.defaultNameCount++;return self.defaultNameCount;},getLightboxInfo:function(lightboxId){var deferred=$q.defer();OptionsRestangular.getJavaRestConfig().one(LIGHTBOX_ENDPOINT).withHttpConfig({ignoreLoadingBar:true}).customGET(lightboxId).then(function(response){deferred.resolve(response);},function(response){deferred.reject(response);});return deferred.promise;},searchLightboxes:function(assets,pageNumber,itemsPerPage,includeAll){var deferred=$q.defer(),data;data={pageNumber:pageNumber,itemsPerPage:itemsPerPage,includeAll:includeAll,assets:assets};OptionsRestangular.getJavaRestConfig().one(LIGHTBOX_ENDPOINT).one(SEARCH_ENDPOINT).withHttpConfig({ignoreLoadingBar:true}).customPOST(data).then(function(response){deferred.resolve(response);if(includeAll){self.searchedBoxes=response;}},function(response){deferred.reject(response);});return deferred.promise;},createLightbox:function(newName){var data={name:newName};if(!(newName in defers)){defers[newName]=$q.defer();self.searchLightboxes([],1,1,true).then(function(){OptionsRestangular.getJavaFullResponseConfig().one(LIGHTBOX_ENDPOINT).withHttpConfig({ignoreLoadingBar:true}).customPOST(data).then(function(response){var location=response.headers('Location'),lightboxId=parseInt(location.substr(location.lastIndexOf('/')+1));self.searchedBoxes.favorites.unshift({name:newName,id:lightboxId,assets:[]});defers[newName].resolve(lightboxId);},function(){defers[newName].reject();});}).catch(function(){defers[newName].reject();});}
return defers[newName].promise;},addToLightbox:function(lightboxId,gettyMasterIds){var deferred=$q.defer(),referer=document.referrer;self.searchLightboxes([],1,1,true).then(function(){OptionsRestangular.getJavaRestConfig(referer).one(LIGHTBOX_ENDPOINT,lightboxId).all(ASSETS_ENDPOINT).withHttpConfig({ignoreLoadingBar:true}).customPOST(gettyMasterIds).then(function(){for(var i=0;i<self.searchedBoxes.favorites.length;++i){if(self.searchedBoxes.favorites[i].id===lightboxId&&!arrayHelperService.containsArray(self.searchedBoxes.favorites[i].assets,gettyMasterIds)){self.searchedBoxes.favorites[i].assets=arrayHelperService.unique(self.searchedBoxes.favorites[i].assets.concat(gettyMasterIds));self.searchedBoxes.favorites.unshift(self.searchedBoxes.favorites.splice(i,1)[0]);break;}}
deferred.resolve();},function(response){deferred.reject(response);});});return deferred.promise;},removeFromLightbox:function(lightboxId,gettyMasterIds){var deferred=$q.defer();self.searchLightboxes([],1,1,true).then(function(){OptionsRestangular.getJavaRestConfig().one(LIGHTBOX_ENDPOINT,lightboxId).one(ASSETS_ENDPOINT).withHttpConfig({ignoreLoadingBar:true}).customPUT({toRemove:gettyMasterIds}).then(function(){for(var i=0;i<self.searchedBoxes.length;++i){if(self.searchedBoxes[i].id===lightboxId&&!arrayHelperService.containsArray(self.searchedBoxes.favorites[i].assets,gettyMasterIds)){arrayHelperService.removeFromArray(self.searchedBoxes.favorites[i].assets,gettyMasterIds);break;}}
deferred.resolve();},function(response){deferred.reject(response);});});return deferred.promise;}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('fileTypeStorageService',['ABSTRACT_TYPE','locker',function(ABSTRACT_TYPE,locker){var _convertToAbstractId,_convertFromAbstractId,_getFileType,_setFileType,fileTypeStorageService,_getFileTypeForUrl;_convertToAbstractId=function(abstractType){var abstractId=null;if(ABSTRACT_TYPE.hasOwnProperty(abstractType)){abstractId=ABSTRACT_TYPE[abstractType].toString();}
return abstractId;};_convertFromAbstractId=function(abstractId){var key,abstractType='';for(key in ABSTRACT_TYPE){if(ABSTRACT_TYPE[key].toString()===abstractId){abstractType=key;break;}}
return abstractType;};_getFileType=function(){var fileTypes=[],legacyFileTypes,fileTypeName;if(locker.supported()){legacyFileTypes=angular.fromJson(locker.driver('session').namespace('global').get('typesSelected'));}
angular.forEach(legacyFileTypes,function(value){fileTypeName=_convertFromAbstractId(value);if(fileTypeName){fileTypes.push(fileTypeName);}});return fileTypes;};_setFileType=function(fileTypes){var activeLegacyFileTypes=[],fileTypeName;angular.forEach(fileTypes,function(fileType){fileTypeName=_convertToAbstractId(fileType);if(fileTypeName){activeLegacyFileTypes.push(fileTypeName);}});if(locker.supported()){locker.driver('session').namespace('global').put('typesSelected',angular.toJson(activeLegacyFileTypes));}};_getFileTypeForUrl=function(fileTypes){var fileType='photos';if(typeof fileTypes==='object'){if(fileTypes.hasOwnProperty('illustrations')&&fileTypes.illustrations===true){fileType='illustrations';if(fileTypes.hasOwnProperty('photos')&&fileTypes.photos===true){fileType='photos,illustrations';}}else if(fileTypes.hasOwnProperty('video')&&fileTypes.video===true){fileType='videos';}else if(fileTypes.hasOwnProperty('music')&&fileTypes.music===true){fileType='audio';}}else{if(fileTypes){if(fileTypes.indexOf('photos')>-1&&fileTypes.indexOf('illustrations')>-1){fileType='photos';}else if(fileTypes.indexOf('video')>-1){fileType='videos';}else if(fileTypes.indexOf('audio')>-1){fileType='music';}else{fileType=fileTypes;}}}
return fileType;};fileTypeStorageService={getFileType:_getFileType,setFileType:_setFileType,getFileTypeForUrl:_getFileTypeForUrl};return fileTypeStorageService;}]);}());(function(){'use strict';angular.module('common.services').factory('weTransferService',['$q','OptionsRestangular',function($q,OptionsRestangular){var WETRANSFER_ENDPOINT='wetransfer',_getDeferred,_sendToWeTransfer;_sendToWeTransfer=function(params){var defer=$q.defer();OptionsRestangular.getJavaFullResponseConfig().one(WETRANSFER_ENDPOINT).customPOST(params).then(function(response){defer.resolve(response);},function(error){defer.reject(error);});return defer.promise;};return{sendToWeTransfer:_sendToWeTransfer,getDeferred:_getDeferred};}]);}());(function(){'use strict';angular.module('common.services').factory('arrayHelperService',[function(){var _unique,_containsArray,_removeFromArray,_smartJoin,arrayHelperService;_unique=function(array){var uniqueValues={},result=[],i=0;for(i;i<array.length;i++){if(!uniqueValues[array[i]]){uniqueValues[array[i]]=true;result.push(array[i]);}}
return result;};_containsArray=function(containerArray,array){var result=true,i=0;if(array.length===0){result=false;}else if(containerArray.length<array.length){result=false;}else{for(i;i<array.length;i++){if(containerArray.indexOf(array[i])<0){result=false;break;}}}
return result;};_removeFromArray=function(array,itemsToRemove){angular.forEach(itemsToRemove,function(itemToRemove){var index=array.indexOf(itemToRemove);if(index>=0){array.splice(index,1);}});};_smartJoin=function smartJoin(array,joiner){var s='';for(var i in array){if(array[i]||array[i]===0){s=s+((s!=='')?joiner:'')+array[i];}}
return s;};arrayHelperService={unique:_unique,containsArray:_containsArray,removeFromArray:_removeFromArray,smartJoin:_smartJoin};return arrayHelperService;}]);}());(function(){'use strict';angular.module('common.services').factory('kountService',['OptionsRestangular',function(OptionsRestangular){var KOUNT_ENDPOINT='kount/session',_getKountSession;_getKountSession=function(){return OptionsRestangular.getJavaRestConfig().one(KOUNT_ENDPOINT).get();};return{getKountSession:_getKountSession};}]);}());(function(){'use strict';angular.module('common.services').factory('resultsService',[function(){var self={searchResponse:'',searchId:'',searchToken:'',setSearchToken:function(token){self.searchToken=token;},getSearchToken:function(){return self.searchToken;},setSearchResponse:function(response){self.searchResponse=response;},getSearchId:function(){return self.searchId;},setSearchId:function(id){self.searchId=id;},getResults:function(){return self.searchResponse.results;},getTotalResults:function(){var totalResults=self.searchResponse.totalResults;if(typeof totalResults==='undefined'||totalResults===null){return 0;}else{return totalResults;}}};return self;}]);}());;(function(){'use strict';angular.module('common.services').factory('mobileUIService',['$window',function($window){var body=angular.element($window.document.body),lastPos=0;return{disableBodyScrolling:function(){lastPos=angular.element($window).scrollTop();body.addClass('mobile-no-scroll');angular.element($window).scrollTop(lastPos);body.css('margin-top','-'+lastPos+'px');},enableBodyScrolling:function(){body.removeClass('mobile-no-scroll');body.css('margin-top','');if(lastPos){angular.element($window).scrollTop(lastPos);}
lastPos=0;}};}]);})();(function(){'use strict';angular.module('common.services').factory('languageService',[function(){var _getIETFCode,_formatRegionLanguageCode,_formatCountryLanguage;_getIETFCode=function(strCode,ignoreBrazil){if(!ignoreBrazil&&strCode.indexOf('PT_BR')>-1){return strCode;}
if(strCode.indexOf('_')>-1){return strCode.split('_')[0];}
return strCode;};_formatRegionLanguageCode=function(languageCode,regionCode){var formattedCode='';if(angular.isString(regionCode)&&angular.isString(languageCode)&&languageCode&&regionCode){formattedCode=_getIETFCode(languageCode.toLowerCase(),true)+'_'+regionCode.toUpperCase();}
return formattedCode;};_formatCountryLanguage=function(languageCode,regionCode){var formattedCode='';if(angular.isString(regionCode)&&angular.isString(languageCode)&&languageCode&&regionCode){if(languageCode.toLowerCase().indexOf('pt')!==-1){languageCode='pt';}
formattedCode=regionCode.toUpperCase()+'/'+_getIETFCode(languageCode.toLowerCase(),true);}
return formattedCode;};return{getIETFCode:_getIETFCode,formatRegionLanguageCode:_formatRegionLanguageCode,formatCountryLanguage:_formatCountryLanguage};}]);}());(function(){'use strict';angular.module('common.services').factory('countrySitesService',['$q','$injectedData',function($q,$injectedData){var _getCountrySitesData,countrySitesData,_getPlansAndPricingTranslation,pAndPTranslation;_getCountrySitesData=function(){var deferred=$q.defer();if(countrySitesData===undefined){countrySitesData=$injectedData.countrySitesData;}
if(angular.isUndefined(countrySitesData)||countrySitesData===null){deferred.reject('Could not retrieve country sites data');}else{deferred.resolve(countrySitesData);}
return deferred.promise;};_getPlansAndPricingTranslation=function(){var deferred=$q.defer();if(pAndPTranslation===undefined){pAndPTranslation=$injectedData.pAndPTranslation;}
if(angular.isUndefined(pAndPTranslation)||pAndPTranslation===null){deferred.reject('Could not retrieve country sites data');}else{deferred.resolve(pAndPTranslation);}
return deferred.promise;};return{getCountrySitesData:_getCountrySitesData,getPlansAndPricingTranslation:_getPlansAndPricingTranslation};}]);}());(function(){'use strict';angular.module('common.services').factory('adpPaymentClarityService',['$cookies','$injectedData',function($cookies,$injectedData){var self={validTestValues:{3:'B',4:'C',5:'D',6:'A'},paymentClarityDataMapping:{1:{'assetPriceFragment':'$12','subsPriceFragment':{3:'Save $1 to $11',4:'$11 to $0.22',5:'save more than 23%'},'creditPackId':360},3:{'assetPriceFragment':'$33','subsPriceFragment':{3:'Save $3 to $32',4:'$30 to $0.22',5:'save more than 23%'},'creditPackId':362}},getAssetPriceFragment:function(creditCost){if(typeof self.paymentClarityDataMapping[creditCost]!=='undefined'){return self.paymentClarityDataMapping[creditCost].assetPriceFragment;}},getCreditPackId:function(creditCost){if(typeof self.paymentClarityDataMapping[creditCost]!=='undefined'){return self.paymentClarityDataMapping[creditCost].creditPackId;}},getCurrentTestValue:function(){return $injectedData.paymentClarityTestNum;},getReadableTestVersion:function(testVal){return self.validTestValues[testVal];},getSubscriptionPriceFragment:function(creditCost,testNum){if(typeof self.paymentClarityDataMapping[creditCost]!=='undefined'){return self.paymentClarityDataMapping[creditCost].subsPriceFragment[testNum];}},isInTest:function(useCookie){var reference=$injectedData.paymentClarityTestNum,adpCookieName;if(useCookie===true){adpCookieName='splitTestPath_adp2';reference=($cookies[adpCookieName]%10).toString();}
return reference!=='6'&&Object.keys(self.validTestValues).indexOf(reference)!==-1;}};return self;}]);}());(function(){'use strict';angular.module('common.services').factory('veerService',['OptionsRestangular','$q',function(OptionsRestangular,$q){var VEER_ENDPOINT='veer',_checkUser;_checkUser=function(identity){var deferred=$q.defer(),data={identity:identity},restangular;restangular=OptionsRestangular.getPhpRestConfig().one(VEER_ENDPOINT);restangular.customPOST(data).then(function(response){deferred.resolve(response);}).catch(function(error){deferred.reject(error);});return deferred.promise;};return{checkUser:_checkUser};}]);}());(function(){'use strict';var NS='common.directives';angular.module(NS,['ngDebounce','common.services']);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpAudioInfoPane',[function(){return{restrict:'E',require:'^mediaPlayer',templateUrl:'/static/js/angular/common/partials/media-player/_audioInfoPane.html',link:function(scope,elem,attrs,ctrl){scope.result=ctrl.getResultData();}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mediaPlayer',['MEDIAPLAYER_STATES','mediaPlayerService',function(MEDIAPLAYER_STATES,mediaPlayerService){return{restrict:'E',scope:{media:'=',mediaData:'='},transclude:true,templateUrl:function(elem,attrs){return['/static/js/angular/common/partials/media-player/_',attrs.media,'.html'].join('');},controller:function($scope){var t=this;$scope.state={currentState:MEDIAPLAYER_STATES.STOP,currentTime:0,loop:false,mutedVolume:'1.0',previewUrl:'',timeLeft:0,totalTime:0,volume:'1.0'};this.inferType=function(media){var type;switch(media){case'audio':type='audio/mp3';break;case'video':type='video/mp4';break;}
return type;};this.getSource=function(media){var previewUrl;switch(media){case'audio':previewUrl=['/audio_mp3_preview.php?id=',$scope.mediaData.fileId].join('');break;case'video':previewUrl=$scope.mediaData.previewUrl;break;}
$scope.state.previewUrl=previewUrl;return $scope.state.previewUrl;};this.getPreviewUrl=function(){return $scope.state.previewUrl;};this.setState=function(newState){if(newState&&newState!==$scope.state.currentState){$scope.state.currentState=newState;}};this.play=function(){$scope.mediaElement[0].play();t.setState(MEDIAPLAYER_STATES.PLAY);};this.pause=function(){$scope.mediaElement[0].pause();t.setState(MEDIAPLAYER_STATES.PAUSE);};this.stop=function(hardStop){if($scope.state.loop&&!hardStop){$scope.mediaElement[0].currentTime=0;$scope.mediaElement[0].play();}else if(!$scope.mediaElement[0].paused||$scope.mediaElement[0].currentTime!==0){$scope.mediaElement[0].pause();$scope.mediaElement[0].currentTime=0;this.setState(MEDIAPLAYER_STATES.STOP);}};this.playToggle=function(){if($scope.mediaElement[0].paused){mediaPlayerService.playMedia($scope.$id);}else{this.pause();}};this.getVolume=function(){return $scope.state.volume;};this.setVolume=function(value){$scope.state.volume=value;$scope.mediaElement[0].volume=value;};this.muteVolume=function(){$scope.state.mutedVolume=$scope.state.volume;$scope.state.setVolume(0.0);};this.restoreVolume=function(){$scope.state.setVolume($scope.state.mutedVolume);};this.seekTime=function(value){$scope.mediaElement[0].currentTime=value;$scope.state.currentTime=value;};this.getResultData=function(){return $scope.mediaData;};this.getDuration=function(){var duration=$scope.state.totalTime;if(!duration){if($scope.mediaData.audio&&$scope.mediaData.audio.duration){duration=$scope.mediaData.audio.duration;}else{duration=$scope.mediaElement[0].duration;}
$scope.state.totalTime=duration;}
return duration;};this.onUpdateTime=function(event){var duration=t.getDuration();$scope.state.currentTime=event.target.currentTime;if(t.getDuration()!==Infinity){$scope.state.timeLeft=duration-event.target.currentTime;}
$scope.$apply();};this.onComplete=function(){t.stop();};this.canPlay=function(){var loader=angular.element('.dots-loader-no-background'),dimmer=angular.element('.loader-dimmer'),parent=angular.element('.media-loader');loader.fadeOut('slow');dimmer.fadeOut('slow',parent.remove);};$scope.state=this;},link:function(scope,elem,attrs,ctrl){var canPlay;scope.mediaElement=elem.find(attrs.media);if(attrs.loop!==undefined){scope.state.loop=true;}
scope.$watch('mediaData',function(data){if(data&&scope.mediaElement[0].canPlayType){scope.type=ctrl.inferType(attrs.media);canPlay=scope.mediaElement[0].canPlayType(scope.type);if(canPlay==='maybe'||canPlay==='probably'){scope.mediaElement.attr('src',scope.state.getSource(attrs.media));scope.mediaElement.attr('type',scope.type);}}});if(attrs.playOnHover!==undefined&&attrs.hoverTrigger){elem.closest(attrs.hoverTrigger)[0].addEventListener('mouseover',ctrl.play,false);elem.closest(attrs.hoverTrigger)[0].addEventListener('mouseout',ctrl.pause,false);}
if(attrs.autoplay!==undefined){scope.mediaElement[0].addEventListener('loadedmetadata',ctrl.playToggle,false);}
scope.mediaElement[0].addEventListener('loadedmetadata',ctrl.onUpdateTime,false);scope.mediaElement[0].addEventListener('loadedmetadata',ctrl.setVolume(1.0),false);scope.mediaElement[0].addEventListener('timeupdate',ctrl.onUpdateTime,false);scope.mediaElement[0].addEventListener('ended',ctrl.onComplete,false);scope.mediaElement[0].addEventListener('canplay',ctrl.canPlay,false);mediaPlayerService._register(scope);}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpPlayButton',['MEDIAPLAYER_STATES','omnitureService',function(MEDIAPLAYER_STATES,omnitureService){return{restrict:'E',require:'^mediaPlayer',templateUrl:'/static/js/angular/common/partials/media-player/_playButton.html',link:function(scope,elem,attrs,ctrl){scope.onPlayPause=function(){ctrl.playToggle();if(scope.playerState.play){omnitureService.playAudioFile();}};scope.changeIcon=function(newState){switch(newState){case MEDIAPLAYER_STATES.PLAY:scope.playerState={pause:true};break;case MEDIAPLAYER_STATES.PAUSE:case MEDIAPLAYER_STATES.STOP:scope.playerState={play:true};break;}};scope.playerState={play:true};scope.$watch(function(){return ctrl.currentState;},function(newState,oldState){if(newState!==oldState){scope.changeIcon(newState);}});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpScrubBar',['$document',function($document){return{restrict:'E',require:'^mediaPlayer',templateUrl:'/static/js/angular/common/partials/media-player/_scrubBar.html',link:function(scope,elem,attrs,ctrl){var scrubber=elem.find('.scrub-bar'),dragMask=elem.find('.scrubber-drag-mask');scope.updateTime=function updateTime(newCurrentTime){var scrubberElem=elem.find('.scrubber'),percentTime;if(typeof newCurrentTime==='number'&&ctrl.getDuration()){percentTime=100*(newCurrentTime/ctrl.getDuration());scrubberElem.css('width',percentTime+'%');}else{scrubberElem.css('width',0);}};scope.scrubSeek=function scrubSeek(event){var scrubberWidth=scrubber.width(),clickOffset,scrubberPercent;if(event.offsetX===undefined){clickOffset=event.pageX-elem.find('.scrub-bar').offset().left;}else{clickOffset=event.offsetX;}
scrubberPercent=clickOffset/scrubberWidth;scope.updateTime(ctrl.getDuration()*scrubberPercent);ctrl.seekTime(ctrl.getDuration()*scrubberPercent);};scope.$watch(function(){return ctrl.currentTime;},function(newVal){scope.updateTime(newVal);});scope.scrubberMouseup=function scrubberMouseup(event){scope.scrubSeek(event);dragMask.unbind('mouseout',scope.scrubberMouseup);$document.unbind('mousemove',scope.scrubSeek);$document.unbind('mouseup',scope.scrubberMouseup);};dragMask.on('mousedown',function(event){event.preventDefault();dragMask.on('mouseout',scope.scrubberMouseup);$document.on('mousemove',scope.scrubSeek);$document.on('mouseup',scope.scrubberMouseup);});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpTime',['MEDIAPLAYER_STATES',function(MEDIAPLAYER_STATES){return{restrict:'E',require:'^mediaPlayer',templateUrl:'/static/js/angular/common/partials/media-player/_time.html',scope:{duration:'='},link:function(scope,elem,attrs,ctrl){scope.isStopped=true;scope.mediaLength=0;if(scope.duration!==undefined){scope.mediaLength=scope.duration;}
scope.$watch(function(){return ctrl.totalTime;},function(totalTime){if(totalTime!==Infinity&&totalTime!==undefined&&!isNaN(totalTime)){scope.mediaLength=totalTime;}});scope.$watch(function(){return ctrl.currentTime;},function(newVal){scope.currentTime=newVal;});scope.$watch(function(){return ctrl.currentState;},function(newState){switch(newState){case MEDIAPLAYER_STATES.PLAY:case MEDIAPLAYER_STATES.PAUSE:scope.isStopped=false;break;case MEDIAPLAYER_STATES.STOP:scope.isStopped=true;break;}});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpVolume',['$document',function($document){return{restrict:'E',require:'^mediaPlayer',templateUrl:'/static/js/angular/common/partials/media-player/_volume.html',link:function(scope,elem,attrs,ctrl){var scrubber=elem.find('.volume-scrub-bar'),dragMask=elem.find('.volume-scrubber-drag-mask');scope.adjustVolume=function adjustVolume(event){var scrubberWidth=scrubber.width(),clickOffset,scrubberPercent;if(event.offsetX===undefined){clickOffset=event.pageX-scrubber.offset().left;}else{clickOffset=event.offsetX;}
scrubberPercent=clickOffset/scrubberWidth;if(scrubberPercent>1.0){scrubberPercent=1.0;}else if(scrubberPercent<0.0){scrubberPercent=0.1;}
scope.updateVolume(scrubberPercent);ctrl.setVolume(scrubberPercent);};scope.updateVolume=function updateVolume(newVolume){var scrubberElem=elem.find('.scrubber'),iconElem=elem.find('.volume-icon'),volumePercent=newVolume*100;scrubberElem.css('width',volumePercent+'%');iconElem.removeClass('high-volume low-volume mute-volume');if(volumePercent===0){iconElem.addClass('mute-volume');}else if(volumePercent<50.0){iconElem.addClass('low-volume');}else{iconElem.addClass('high-volume');}};scope.toggleMute=function toggleMute(){if(ctrl.volume===0.0){scope.updateVolume(ctrl.mutedVolume);ctrl.restoreVolume();}else{scope.updateVolume(0.0);ctrl.muteVolume();}};scope.volumeMouseup=function volumeMouseup(event){scope.adjustVolume(event);dragMask.unbind('mouseout',scope.volumeMouseup);$document.unbind('mousemove',scope.adjustVolume);$document.unbind('mouseup',scope.volumeMouseup);};dragMask.on('mousedown',function(event){event.preventDefault();dragMask.on('mouseout',scope.volumeMouseup);$document.on('mousemove',scope.adjustVolume);$document.on('mouseup',scope.volumeMouseup);});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mpWaveform',[function(){return{restrict:'E',require:'^mediaPlayer',link:function(scope,elem,attrs,ctrl){var wavesurfer;elem.css('display','block');scope.$watch(function(){return ctrl.getPreviewUrl();},function(previewUrl){var options=angular.extend({container:elem[0]},attrs);options.interact=false;options.cursorColor='#666e6e';wavesurfer=WaveSurfer.create(options);if(previewUrl!==''){wavesurfer.load(previewUrl,attrs.data||null);}});scope.$watch(function(){return ctrl.currentTime;},function(newTime){wavesurfer.seekTo(newTime/ctrl.totalTime);});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('notificationBar',['cookielessUrl',function(cookielessUrl){return{restrict:'E',replace:true,scope:{notification:'=',closeCallback:'&?'},template:['<section class="notification-bar {{ notification.type }}">','<span class="text" data-i18n="{{ notification.content }}"></span><span class="close">','<a class="close" ng-click="removeBar()">','<img src="',cookielessUrl,'/static/images/blank.gif" class="general-icon-x" />','</a>','</span>','</section>'].join(''),controller:function($scope,$element){$scope.removeBar=function(){if(typeof($scope.closeCallback)==='function'){$scope.closeCallback();}
jQuery($element.parent()).slideUp('500ms',function(){$element.parent().remove();});};}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('dropdown',['$document','dropdownService','SEARCH_STATE',function($document,dropdownService,SEARCH_STATE){return{restrict:'E',scope:{activationMethod:'@',label:'@',labelClass:'@',activeOption:'@',orientation:'@',disableDropdownLabel:'@',multiGroup:'@',mobileActiveOption:'@'},templateUrl:'/static/js/angular/common/partials/_dropdown.html',transclude:true,link:function(scope,element){scope.showActive='true';scope.isVisible=false;dropdownService._register(scope);scope.dropdownToggle=function(_isVisible){dropdownService.toggle(scope.$id);scope.isVisible=_isVisible;};scope.isFileTypeExecutingSearch=function(){if(scope.labelClass==='search-file-type-selector'){return SEARCH_STATE.EXECUTING_SEARCH;}
return;};if(scope.activationMethod==='hover'){if(Modernizr.touch){element.on('click',function(event){if(event.target.tagName.toLowerCase()!=='select'){scope.dropdownToggle(!scope.isVisible);}});}else{element.on('mouseenter',function(){scope.dropdownToggle(true);scope.$apply();}).on('mouseleave',function(event){if(event.target.tagName.toLowerCase()!=='select'){scope.dropdownToggle(false);scope.$apply();}});}}else{element.on('click',function(){scope.dropdownToggle(!scope.isVisible);}).on('mouseleave',function(event){if(event.target.tagName.toLowerCase()!=='select'){scope.dropdownToggle(false);scope.$apply();}});}}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('dropdownItem',['$document','dropdownService',function($document,dropdownService){return{restrict:'E',scope:{activationMethod:'@',label:'@',labelClass:'@',orientation:'@',disableDropdownLabel:'@',translate:'=',expanded:'@',translationKey:'@',locator:'@'},templateUrl:'/static/js/angular/common/partials/_dropdownItem.html',transclude:true,link:function(scope,element){scope.isVisible=false;dropdownService._register(scope,function(){if(scope.isVisible){element.addClass('active');}else{element.removeClass('active');}});scope.dropdownToggle=function(){dropdownService.toggle(scope.$id);};scope.setVisibleStatus=function(){if(scope.expanded&&scope.expanded===scope.label){scope.dropdownToggle();}};scope.addTranslation=function(){var elem=element.find(scope.locator);if(elem){elem.attr('data-i18n',scope.translationKey);}};if(scope.activationMethod==='hover'){if(Modernizr.touch){element.on('click',function(){scope.dropdownToggle();});}else{element.on('mouseenter',function(){scope.dropdownToggle();}).on('mouseleave',function(){scope.dropdownToggle();});}}
if(scope.activationMethod==='click'){$document.bind('click',function(event){var clickedElementChild=element.find(event.target).length;if(clickedElementChild>0){return;}});}
if(scope.translate){scope.addTranslation();}
scope.setVisibleStatus();}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('validator',['$compile','$animate','formValidationService',function($compile,$animate,formValidationService){return{restrict:'A',require:'ngModel',scope:true,link:function(scope,element,attrs,ctrl){scope.elementName=element[0].name;scope.deregistrationFuncs=[];scope.shouldValidate=true;scope.optional=false;scope.setValidity=function(name,valid){if(scope.optional===true){if(valid){element.removeClass('ng-warning');if(name.length>0){element.removeClass(['ng-',name,'-warning'].join(''));}}else{element.addClass('ng-warning');if(name.length>0){element.addClass(['ng-',name,'-warning'].join(''));}}}else{ctrl.$setValidity(name,valid);}};scope.setupListeners=function(validators){var modelWatch,eventListener,validMethods,watch;if(attrs.optional===''||attrs.optional==='true'){scope.optional=true;}
ctrl.$validate=function(){scope.updateValidation(validators);};if(attrs.validateIf){watch=scope.$watch(attrs.validateIf,function(){if(scope.$eval(attrs.validateIf)){scope.shouldValidate=true;}else{scope.shouldValidate=false;scope.removeMessage();}},true);scope.deregistrationFuncs.push(watch);}
scope.$on('form-submit',function(){scope.updateValidation(validators);});if(typeof attrs.validMethod!=='undefined'){validMethods=attrs.validMethod.split(/\s*,\s*/);validMethods.forEach(function(validMethod){if(validMethod==='blur'||validMethod==='change'){element.bind(validMethod+'.validate',function(){scope.$apply(function(){if(ctrl.$pristine){return;}
scope.updateValidation(validators);});});}else if(validMethod==='emailInputMethod'){element.bind('keydown keypress',function(event){if(event.keyCode===32||event.keyCode===44||event.keyCode===13||event.keyCode===9||event.keyCode===188){scope.$apply(function(){if(ctrl.$pristine){return;}
scope.updateValidation(validators);});}});}else if(validMethod!=='submit'){modelWatch=scope.$watch(attrs.ngModel,function(){scope.updateValidation(validators);});scope.deregistrationFuncs.push(modelWatch);}});}
eventListener=scope.$on(ctrl.$name+'submit',function(){scope.updateValidation(validators);});scope.deregistrationFuncs.push(eventListener);if(attrs.validMethod!=='submit'&&!ctrl.$pristine){scope.updateValidation(validators);}};scope.deregisterListeners=function(){element.unbind('blur.validate');element.unbind('change.validate');scope.deregistrationFuncs.forEach(function(deregFunc){deregFunc();});scope.deregistrationFuncs=[];};scope.onValidatorChange=function(newVal){var validatorList;if(!newVal){return;}
validatorList=attrs.validator.split(/\s*,+\s*/);scope.deregisterListeners();scope.setupListeners(validatorList);};scope.removeMessage=function(){var inputContainer=element.closest('.input-container'),messageContainer=inputContainer.parent().find('.message-container'),message=messageContainer.find('.message');scope.setValidity(ctrl.$name,true);if(message.children().not('.'+element.attr('name')).length>0){message.find('.'+element.attr('name')).remove();}else{if(messageContainer.length>0){$animate.leave(messageContainer);}}};scope.addMessage=function(container,translationKey){var domElement='<span class="'+element.attr('name')+'" data-error="'+ctrl.$name+'" data-i18n= "'+translationKey+'">'+'</span>',compiledElement=$compile(domElement)(scope);container.append(compiledElement);};scope.showErrors=function(haveErrors,invalidValidator,isPromise){var translationKey,inputContainer=element.closest('.input-container'),messageContainer=inputContainer.parent().find('.message-container'),message=messageContainer.find('.message');if(haveErrors){if(messageContainer.length===0){messageContainer=angular.element('<div class="message-container"></div>');message=angular.element('<div class="message"></div>');messageContainer.append(message);$animate.enter(messageContainer,'',inputContainer);}
message.find('.'+element.attr('name')).remove();translationKey=attrs[invalidValidator+'ErrorMessageKey']||formValidationService.getDefaultMsgKey(invalidValidator).error;scope.addMessage(message,translationKey);}else{if(isPromise===false||(isPromise===true&&invalidValidator!==undefined)){scope.removeMessage();}}};scope.updateValidation=function(validators){if(scope.shouldValidate===false){return;}
var haveErrors=false,inputValue=ctrl.$viewValue,isPromise=false,invalidValidator;validators.forEach(function(validator){var isValid=formValidationService.process(validator,inputValue);if(typeof isValid==='object'&&!haveErrors){isValid.then(function(status){scope.setValidity(ctrl.$name,status);ctrl.$setViewValue(ctrl.$viewValue);scope.showErrors(!status,validator,true);if(attrs.afterValidation){scope.$eval(attrs.afterValidation);}},function(){scope.setValidity(ctrl.$name,false);ctrl.$setViewValue(ctrl.$viewValue);scope.showErrors(true,validator,true);if(attrs.afterValidation){scope.$eval(attrs.afterValidation);}});isValid=true;isPromise=true;}
if(!haveErrors&&!isValid){haveErrors=true;invalidValidator=validator;scope.setValidity(ctrl.$name,false);ctrl.$setViewValue(ctrl.$viewValue);isPromise=false;}});scope.showErrors(haveErrors,invalidValidator,isPromise);if(attrs.afterValidation){scope.$eval(attrs.afterValidation);}};attrs.$observe('validator',scope.onValidatorChange);}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('headroom',function(){return{restrict:'E',scope:{tolerance:'=',offset:'=',classes:'=',enabled:'='},link:function(scope,element){scope.$on('destroy',function(){scope.headroom.destroy();});scope.$watch('enabled',function(newVal){if(newVal&&scope.headroom===undefined){scope.initHeadroom();}});scope.initHeadroom=function(){var options={};angular.forEach(Headroom.options,function(value,key){options[key]=scope[key]||Headroom.options[key];});options.offset=180;if(scope.offset){options.offset=scope.offset;}
options.onTop=function(){element.removeClass('searchbar-pinned');};scope.headroom=new Headroom(element[0],options).init();};}};});}());(function(){'use strict';var module=angular.module('common.directives');module.directive('fancyInputs',[function(){return{restrict:'A',require:'^form',scope:true,link:function(scope,element,attrs,ctrl){var inputNameList,unregister;scope.formClass=attrs.fancyInputsClass||'fancy-inputs';scope.inputFilledClass=attrs.fancyInputsFilledClass||'input-filled';scope.inputElemList=[];element.addClass(scope.formClass);if(attrs.fancyInputs){inputNameList=attrs.fancyInputs.split(' ');}
scope.addInputFilledClass=function(elem){var inputEl=angular.element(elem),inputTagID='tags-input-field';if(!inputNameList||(inputNameList&&inputNameList.indexOf(inputEl.attr('name'))!==-1)){scope.inputElemList.push(inputEl);inputEl.on('input blur keyup change click',function(){if(inputEl.val().trim().length>0){inputEl.parent().addClass(scope.inputFilledClass);}else{if(inputEl.context.id!==inputTagID||(inputEl.context.id===inputTagID&&angular.element('.tag-item').length===0)){inputEl.parent().removeClass(scope.inputFilledClass);}}
unregister();});}};angular.forEach(element.find('input'),function(elem){scope.addInputFilledClass(elem);});angular.forEach(element.find('textarea'),function(elem){scope.addInputFilledClass(elem);});unregister=scope.$watch(function(){return ctrl.$dirty;},function(newValue,oldValue){if(newValue!==oldValue){angular.forEach(scope.inputElemList,function(elem){elem.parent().addClass(scope.inputFilledClass);});unregister();}});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('focusInput',[function(){return{restrict:'A',scope:true,link:function(scope,element,attrs){element.on('click',function(){jQuery('#'+attrs.focusInput).focus();});}};}]);}());(function(){'use strict';angular.module('common.directives').directive('prettyPrice',function(){return{restrict:'E',transclude:true,scope:{symbol:'@',isPrefixSymbol:'@',shortName:'@',showShortName:'@'},template:['<span class="symbol" ng-show="isPrefixSymbol">{{ symbol }}</span>','<span class="amount" ng-transclude></span>','<span class="symbol" ng-hide="isPrefixSymbol">{{ symbol }}</span>','<span ng-show="showShortName">{{ shortName }}</span>'].join('')};});}());(function(){'use strict';var module=angular.module('common.directives');module.directive('loadingButton',function(){return{restrict:'A',transclude:true,scope:{loading:'='},template:['<span ng-transclude></span><div class="loader">','<div class="circle"></div><div class="circle"></div><div class="circle"></div>','</div>'].join(''),link:function(scope,element){scope.$watch('loading',function(val){if(val===true){element.addClass('loading');}else{element.removeClass('loading');}});}};});}());(function(){  'use strict';  var module=angular.module('common.directives');  module.directive('searchFileTypeSelector',['OMNITURE_EVENTS','facetService','facetStateService','$rootScope','fileTypeStorageService',function(OMNITURE_EVENTS,facetService,facetStateService,$rootScope,fileTypeStorageService){    return{      restrict:'E',scope:{resultCount:'@',fileType:'@'},templateUrl:'/static/js/angular/common/partials/_searchFileTypeSelector.html',controller:function($scope,$element,$attrs){$scope.fileTypeTranslations={};if($attrs.hasOwnProperty('filetypetranslations')){$scope.fileTypeTranslations=$scope.$eval($attrs.filetypetranslations).FILE_TYPES;}
$scope.setDefaultAbstractTypes=function(){facetStateService.toggleFacet('abstractType','photos');facetStateService.toggleFacet('abstractType','illustrations');facetStateService.setFacet('additionalAudio','');};$rootScope.$on('setFileTypeSelected',function(e,data){var sizesSelected,typesSelectedPrevious=[];sizesSelected=facetStateService.getActiveValues('photoSize');if(facetStateService.allOptionsActive('photoSize')||sizesSelected.length===0){try{if(!(typesSelectedPrevious=localStorage.getItem('typesSelectedPrevious'))){return;}}catch(e){}
if(typesSelectedPrevious.indexOf('photos')>-1&&typesSelectedPrevious.indexOf('illustrations')>-1){data.fileType='images';}else if(typesSelectedPrevious.indexOf('photos')>-1&&typesSelectedPrevious.indexOf('illustrations')===-1){data.fileType='photos';}else{data.fileType='images';}
try{localStorage.removeItem('typesSelectedPrevious');}catch(e){}}
$scope.fileTypeSelected(data.fileType);});$scope.initializeFileTypeSelection=function(){var initialValue=[];if($scope.fileType){facetStateService.clearFacetGroup('abstractType');if($scope.fileType==='images'){$scope.setDefaultAbstractTypes();}else{facetStateService.toggleFacet('abstractType',$scope.fileType);}}else if(facetStateService.getActiveValues('abstractType').length===0){initialValue=fileTypeStorageService.getFileType();if(initialValue&&initialValue.length){if(initialValue.length===1){facetStateService.toggleFacet('abstractType',initialValue[0]);if(initialValue[0]==='audio'){facetStateService.setFacet('additionalAudio','true');}}else{$scope.setDefaultAbstractTypes();}}else{$scope.setDefaultAbstractTypes();}}};$scope.fileTypeSelected=function(value){facetStateService.setFileTypeFacet(value);fileTypeStorageService.setFileType(facetStateService.getActiveValues('abstractType'));$scope.selectedFileType=value;$scope.$emit(OMNITURE_EVENTS.SRP.SRP_SEARCH_UPDATE,'fileType',$scope.selectedFileType);$rootScope.$broadcast('fileTypeChanged');};$scope.initializeFileTypeSelection();},      link:function(scope,element,attrs){var totalNumberOfAbstractType=Object.keys(facetStateService.getFacet('abstractType')).length,lightboxID=facetStateService.getFacet('lightboxID'),portfolioID=facetStateService.getFacet('portfolioID'),adminSearch=facetStateService.getFacet('adminSearch'),legacyFileSearch=facetStateService.getFacet('gettyMasterIdSet').length||facetStateService.getFacet('fileIdSet').length,onSRP=attrs.hasOwnProperty('srp');scope.facetGroup=facetService.getFacetGroup('abstractType').facets;scope.facetGroup.photos.isImageSubFacet=true;scope.facetGroup.illustrations.isImageSubFacet=true;scope.$watch(function(){return facetStateService.getActiveValues('abstractType');},function(newActiveValue){if(newActiveValue.length===totalNumberOfAbstractType){if(lightboxID.length||portfolioID.length||adminSearch||legacyFileSearch){scope.selectedFileType='all';}else{scope.selectedFileType='images';}}else if(newActiveValue.length===1){scope.selectedFileType=newActiveValue;}else{scope.selectedFileType='images';}},true);scope.getFileTypeOptionState=function(value){return scope.selectedFileType.toString()===value;};scope.checkAccessibility=function(accessibility){var lightboxID=facetStateService.getFacet('lightboxID'),portfolioID=facetStateService.getFacet('portfolioID'),adminSearch=facetStateService.getFacet('adminSearch'),legacyFileSearch=facetStateService.getFacet('gettyMasterIdSet').length||facetStateService.getFacet('fileIdSet').length;if(accessibility==='private'){if(onSRP&&(lightboxID.length||portfolioID.length||adminSearch||legacyFileSearch)){return true;}
return false;}
return true;};scope.displayFileType=function(facet){if(!facet){return'';}else if(facet.display&&facet.display.length){return facet.display;}else{return scope.fileTypeTranslations[facet.value];}};      }
    };    }]);}());(function(){  'use strict';  var module=angular.module('common.directives');  module.directive('scrollTo',[function(){    return{      restrict:'A',scope:'true',      link:function(scope){scope.$on('scrollTo',function(event,scrollElement){angular.element('html, body').stop().animate({scrollTop:scrollElement.offset().top},1000,'easeOutQuart');});      }
    };  }]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('spinner',['spinnerService',function(spinnerService){return{restrict:'E',replace:true,scope:{id:'@',group:'@?',showSpinner:'@?',type:'@?'},template:['<span class="ouroboros-spinner {{type}}" ng-show="showSpinner">','<span class="left"><span class="animation"></span></span>','<span class="right"><span class="animation"></span></span>','</span>'].join(''),controller:function($scope){spinnerService._register($scope);}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('affix',function($window){return function(scope,element,attrs){var winElem=angular.element($window),item;if(scope._stickyElements===undefined){scope._stickyElements=[];winElem.bind('scroll.affix',function(){var winTop=winElem.scrollTop(),i,item;for(i=0;i<scope._stickyElements.length;i++){item=scope._stickyElements[i];item.scroll(winTop);}});winElem.bind('resize',function(){var i,item,winTop=winElem.scrollTop(),winBottom=winElem.scrollTop()+winElem.height();for(i=0;i<scope._stickyElements.length;i++){item=scope._stickyElements[i];item.resize(winTop,winBottom);}});winElem.bind('load',function(){var i,item;for(i=0;i<scope._stickyElements.length;i++){item=scope._stickyElements[i];item.isFixed=item.element.hasClass('affix');if(!item.isFixed){item.start=item.element.offset().top;}else if(angular.isElement(item.placeholder)){item.start=item.placeholder.offset().top;}}});}
item={element:element,isFixed:element.hasClass('affix'),placeholder:attrs.useplaceholder!==undefined,placeholderClass:attrs.placeholderclass||'',start:element.offset().top,useBottomAnchor:attrs.bottomanchor!==undefined,bottomAnchor:angular.element(attrs.bottomanchor),scroll:function(winScrollTop){var diff;if(!this.isFixed&&winScrollTop>this.start){this.element.css('width',this.element.outerWidth()+'px');this.element.css('left',this.element.offset().left+'px');this.element.addClass('affix');this.isFixed=true;if(this.placeholder===true){this.placeholder=angular.element('<div class="affix-placeholder '+this.placeholderClass+'"></div>').css('height',item.element.outerHeight()+'px').insertBefore(item.element);}}else if(this.isFixed&&winScrollTop<=this.start){this.element.removeClass('affix');this.element.css('width','');this.element.css('left','');this.element.css('margin-top','');this.isFixed=false;if(angular.isElement(this.placeholder)){this.placeholder.remove();this.placeholder=true;}}
if(this.isFixed&&this.useBottomAnchor){diff=(this.bottomAnchor.offset().top)-(winScrollTop+this.element.outerHeight());if(diff<0){this.element.css('margin-top',diff+'px');}else{this.element.css('margin-top','');}}},resize:function(winScrollTop){this.element.removeClass('affix');this.element.css('width','');this.element.css('left','');this.isFixed=false;if(angular.isElement(this.placeholder)){this.placeholder.remove();this.placeholder=true;}
this.scroll(winScrollTop);}};scope.$watch(function(){return[element[0].clientWidth,element[0].clientHeight].join('x');},function(){item.resize(winElem.scrollTop());});scope._stickyElements.push(item);};});}());(function(){'use strict';var module=angular.module('common.directives');module.directive('mbox',[function(){return{restrict:'E',scope:true,transclude:true,template:'<div id="{{campaign}}" ng-transclude></div>',link:function(scope,element,attrs){scope.otherAttrs={};scope.init=function(){if(!attrs.campaign||typeof attrs.campaign!=='string'){console.log('mbox attr "campaign" is required.');return false;}
scope.campaign=attrs.campaign;window.mboxDefine(scope.campaign,scope.campaign);angular.forEach(attrs,function(value,key){var closureFunction=function(){var theKey=key;return function(value){scope.update(false,value,theKey);};};if(key!=='campaign'&&key.charAt(0)!=='$'){scope.otherAttrs[key]=value;attrs.$observe(key,closureFunction());}});return true;};scope.update=function(isFirstTime,value,key){var updateArgs=[scope.campaign],theKey,hasEmptyValues=false,hasChanged=true;if(!isFirstTime){hasChanged=(value!==scope.otherAttrs[key]);scope.otherAttrs[key]=value;}
for(theKey in scope.otherAttrs){if(scope.otherAttrs.hasOwnProperty(theKey)){if(!scope.otherAttrs[theKey]){hasEmptyValues=true;break;}
if(scope.otherAttrs[theKey]!=='null'){updateArgs.push(theKey+'='+scope.otherAttrs[theKey]);}}}
if(!hasEmptyValues&&hasChanged){window.mboxUpdate.apply(this,updateArgs);}};if(scope.init()){scope.update(true);}}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('replaceWith',['$debounce','$compile',function($debounce,$compile){var triggerReady=$debounce(function(){angular.element(document).triggerHandler('replaceWith:ready');},20,false);return{restrict:'A',link:function(scope,element,attrs){var jsVar=null;if(attrs.replaceWith!==''){scope.$watch(function(){try{jsVar=eval(attrs.replaceWith);}catch(e){}
return jsVar;},function(newval){if(typeof newval==='string'){element.html($compile('<span>'+newval+'</span>')(scope));triggerReady();}});}
triggerReady();element.bind('refresh',function(){scope.$digest();});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('removeItem',[function(){return{restrict:'A',scope:{callbackFunction:'&removeCallback'},compile:function(tElement,tAttrs){var prependedElement,ngshow='';if(tAttrs.removeItem){ngshow='ng-show="'+tAttrs.removeItem+'"';}
prependedElement=tElement.prepend('<div class="remove-item-wrapper"><div class="remove-item" '+
ngshow+'></div></div>');return{post:function postLink(scope,element){var removeElement;removeElement=angular.element(element.find('.remove-item'));removeElement.on('click',function(){element.hide(function(){scope.callbackFunction({removeData:{}});});});}};}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('highlightChange',[function(){return{restrict:'A',scope:true,link:function(scope,element,attrs){scope.$watch(attrs.highlightChange,function(oldValue,newValue){if(newValue){element.stop(true,true).effect('highlight',{color:'#ffd900'},1500);}});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('cmsWell',['$http','$location','$compile','$injectedData','boomerangService',function($http,$location,$compile,$injectedData,boomerangService){return{restrict:'E',scope:{passthru:'@',fallback:'&',callback:'&'},link:function(scope,element,attrs){var boomerangEvent=null,referer=document.referrer;if(scope.passthru){var url='/cms/angular?passthru='+scope.passthru;if($injectedData.assetId){url+='&assetid='+$injectedData.assetId;}
if($injectedData.callingUrl){url+='&callingurl='+$injectedData.callingUrl;}
if(referer){url+='&referer='+referer;}
if($location.search().cmsDisable){url+='&cmsDisable';}
boomerangEvent=boomerangService.createTimer('cms-well_load',scope.passthru);$http.get(url).success(function(data){if(data.length<=0){if(scope.callback){scope.callback({result:'callback'});}else{element.html(attrs.fallback);}}else{data=$compile(data.Content)(scope.$parent);element.html(data);if(scope.callback){scope.callback({result:'CMS'});}}
boomerangEvent.finish();}).error(function(){boomerangEvent.cancel();if(scope.callback){scope.callback({result:'callback'});}else{element.html(attrs.fallback);}});}else{if(scope.callback){scope.callback({result:'callback'});}else{element.html(attrs.fallback);}}}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('dotdotdot',function(){return function(scope,element){element.dotdotdot();};});}());(function(){'use strict';var m=angular.module('common.services');m.directive('script',function($injectedData){return{restrict:'E',compile:function(el,attrs){if(attrs.type!=='text/injected'){return;}
var data=angular.fromJson(el.text());if(attrs.hasOwnProperty('name')){$injectedData[attrs.name]=data;}else{angular.extend($injectedData,data);}}};});m.value('$injectedData',{});}());(function(){'use strict';var module=angular.module('common.directives');module.directive('iterateOver',['$compile',function($compile){return{restrict:'A',link:function(scope,element,attrs){var jsVar=null,iter=null;if(attrs.iterateOver!==''&&attrs.flexkey!==''){scope.$watch(function(){try{jsVar=eval(attrs.iterateOver);iter=eval(attrs.flexkey);}catch(e){}
if(Array.isArray(iter)&&iter.length>0){for(var i=0;i<iter.length;i++){if(iter[i].active){return jsVar[iter[i].sku];}}}
if(jsVar===null){return null;}
return jsVar['default'];},function(newval){if(typeof newval==='string'){element.html($compile('<span>'+newval+'</span>')(scope));}});}}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('dropboxIntroModal',['ipCookie','$timeout','urlBuilder','omnitureService',function(ipCookie,$timeout,urlBuilder,omnitureService){return{restrict:'E',link:function(scope){var cookieName='dropboxIntroModalHide',userClosed=false;scope.canBeSeen=false;scope.appLink=urlBuilder.buildCountryUrl('account/apps',true);$timeout(function(){scope.setCanBeSeen();},100);scope.$on('closeDropboxModal',function(){scope.close();});scope.dontShowMe=function(){var expires='',d=new Date(),years=10;d.setTime(d.getTime()+(years*365*24*60*60*1000));expires=d.toUTCString();document.cookie=cookieName+'='+true+';expires='+
expires+';domain=.istockphoto.com;path=/';omnitureService.adpDropboxCtaClick('DontShowDropbox');scope.close();};scope.getStarted=function(){omnitureService.adpDropboxCtaClick('GetStartedDropbox');};scope.close=function(){userClosed=true;scope.canBeSeen=false;};scope.setCanBeSeen=function(){if(userClosed){scope.canBeSeen=!userClosed;}else{scope.canBeSeen=!ipCookie(cookieName);}};}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('lazySrc',['$window','$document','lazyImageService',function($window,$document,lazyImageService){function link($scope,element,attributes){var parentLi=element.closest('li'),image,target;if(attributes.lazyTag){target=attributes.lazyTag;}
image=lazyImageService.addImage(element,function(){parentLi.removeClass('loading');},target);attributes.$observe('lazySrc',function(src){if(src!==null){if(lazyImageService.enabled){parentLi.addClass('loading');}
lazyImageService.setSource(image,src);}});$scope.$on('$destroy',function(){lazyImageService.removeImage(image);});}
return{link:link,restrict:'A'};}]);}());(function(){'use strict';var MAX_LIGHTBOX_COUNT=3,module=angular.module('common.directives');module.directive('lightbox',['OMNITURE_EVENTS','ERROR_MESSAGING','LIGHTBOX_EVENTS','SEARCH','lightboxService','$animate','$timeout','$window','$filter','$location','$rootScope','ipCookie','arrayHelperService','urlBuilder',function(OMNITURE_EVENTS,ERROR_MESSAGING,LIGHTBOX_EVENTS,SEARCH,lightboxService,$animate,$timeout,$window,$filter,$location,$rootScope,ipCookie,arrayHelperService,urlBuilder){return{restrict:'E',scope:{assetType:'=',assetCollection:'=',gettyIds:'=',fileIds:'=',assetLicense:'=',assetIsEditorial:'=',appId:'=',user:'=',error:'='},templateUrl:'/static/js/angular/common/partials/lightbox/_lightboxButton.html',link:function(scope,element,attrs){scope.savePage=attrs.hasOwnProperty('savePage');scope.maxLightboxes=MAX_LIGHTBOX_COUNT;scope.lightboxCreated=false;scope.lightboxUpdatedText='';scope.lighboxTooltip=$filter('i18n')('ADD_TO_LIGHTBOX');scope.lightboxPlaceholder='LIGHTBOX_PLACEHOLDER';scope.menuOpen=false;scope.hideExcessBoxes=false;scope.lightboxes=[];scope.editing={newLightboxName:''};scope.error={showErrorMessage:false,errorMessage:''};scope.alreadySaved=false;scope.isCheckboxSelected=function(lightboxAssets){return arrayHelperService.containsArray(lightboxAssets,scope.gettyIds);};scope.toggleLightbox=function(index){var lightbox=scope.lightboxes[index],oldCount,newCount,promise,updatedText;if(arrayHelperService.containsArray(lightbox.assets,scope.gettyIds)){promise=lightboxService.removeFromLightbox(lightbox.id,scope.gettyIds);scope.error.showErrorMessage=false;arrayHelperService.removeFromArray(lightbox.assets,scope.gettyIds);lightbox.count-=scope.gettyIds.length;updatedText=$filter('i18n')('REMOVED_FROM_LIGHTBOXNAME',lightbox.name);}else{promise=lightboxService.addToLightbox(lightbox.id,scope.gettyIds).then(function(){oldCount=lightbox.assets.length;scope.error.showErrorMessage=false;lightbox.assets=arrayHelperService.unique(lightbox.assets.concat(scope.gettyIds));newCount=lightbox.assets.length;lightbox.count+=(newCount-oldCount);scope.sendToOmniture(OMNITURE_EVENTS.LB_ADD,{lightboxName:lightbox.name});});updatedText=$filter('i18n')('ADDED_TO_LIGHTBOXNAME',lightbox.name);}
scope.toggleMenuOpen(false,true);scope.showLightboxUpdated(updatedText);promise.catch(function(){scope.displayError();});};scope.clearLightboxCache=function(){for(var i=0;i<localStorage.length;i++){if(localStorage.key(i).indexOf('lightbox-')>-1){localStorage.removeItem(localStorage.key(i));}}};scope.processLightboxes=function(serviceBoxes,assets,pageNumber,itemsPerPage,includeAll){scope.lightboxes=angular.copy(serviceBoxes.favorites);scope.error.showErrorMessage=false;scope.hideExcessBoxes=false;if(serviceBoxes.totalResults>MAX_LIGHTBOX_COUNT){scope.hideExcessBoxes=true;}
lightboxService.searchLightboxes(assets,pageNumber,itemsPerPage,includeAll).then(function(serviceBoxes){scope.lightboxes=angular.copy(serviceBoxes.favorites);scope.alreadySaved=false;if(scope.lightboxes.length>0&&scope.lightboxes[0].assets.length>0){scope.alreadySaved=true;}
scope.error.showErrorMessage=false;}).catch(function(){scope.displayError();});};scope.retrieveLightboxes=function(assets,pageNumber,itemsPerPage,includeAll){var localStorageKey;localStorageKey='lightbox-'+JSON.stringify({pageNumber:pageNumber,itemsPerPage:itemsPerPage,includeAll:includeAll,assets:assets});if(!localStorage.getItem(localStorageKey)){lightboxService.searchLightboxes([],pageNumber,itemsPerPage,includeAll).then(function(serviceBoxes){scope.processLightboxes(serviceBoxes,assets,pageNumber,itemsPerPage,includeAll);}).catch(function(){scope.displayError();});}else{scope.processLightboxes(angular.fromJson(localStorage.getItem(localStorageKey)),assets,pageNumber,itemsPerPage,includeAll);}};scope.displayMenu=function(){if(scope.user){if(!scope.menuOpen){scope.toggleMenuOpen(true,false);}else{scope.toggleMenuOpen(false,true);}}else{var redirectUrl=$location.url(),userCookie='u_c',searchQuery;ipCookie('lightbox_referrer',true,{path:'/',secure:true,expires:5,expirationUnit:'minutes'});searchQuery=$window.location.search;if(searchQuery.indexOf('facets')<0){redirectUrl='/'+scope.assetType.toLowerCase()+redirectUrl;}
if(ipCookie(userCookie)){$window.location=urlBuilder.buildReturnUrl('sign-in',redirectUrl);}else{$window.location=urlBuilder.buildReturnUrl('join',redirectUrl);}}};scope.addNewLightbox=function(){var lightboxName=scope.editing.newLightboxName,generatedName;if(lightboxName===''){generatedName=scope.generateLightboxName();lightboxName=$filter('i18n')('LIGHTBOX_EMPTY_NAME',generatedName);scope.editing.newLightboxName=lightboxName;}
scope.createLightboxReq(lightboxName).then(function(lightboxId){scope.lightboxAddReq(lightboxId,lightboxName).catch(function(){scope.displayError();});}).catch(function(){scope.displayError();});scope.clearLightboxCache();scope.toggleMenuOpen(false,true);scope.showLightboxUpdated($filter('i18n')('SAVED_TO_LIGHTBOXNAME',lightboxName));};scope.createLightboxReq=function(lightboxName){return lightboxService.createLightbox(lightboxName).then(function(newId){scope.error.showErrorMessage=false;scope.sendToOmniture(OMNITURE_EVENTS.LB_CREATE,{lightboxName:lightboxName});return newId;});};scope.lightboxAddReq=function(lightboxId,lightboxName){return lightboxService.addToLightbox(lightboxId,scope.gettyIds).then(function(){scope.sendToOmniture(OMNITURE_EVENTS.LB_ADD,{lightboxName:lightboxName});});};scope.generateLightboxName=function(){var date=new Date(),days=[date.getMonth()+1,date.getDate(),date.getFullYear()];return'('+days.join('/')+')-'+lightboxService.incrementDefaultNameCount();};scope.extendLightboxList=function(){scope.hideExcessBoxes=false;lightboxService.searchLightboxes([],1,3,true).then(function(serviceBoxes){scope.hideAddDialog();scope.lightboxes=angular.copy(serviceBoxes.favorites);scope.error.showErrorMessage=false;scope.maxLightboxes=serviceBoxes.totalResults;if(scope.savePage){$timeout(scope.positionRelativeToTop,0);}
lightboxService.searchLightboxes(scope.gettyIds,1,3,true).then(function(serviceBoxes){scope.lightboxes=angular.copy(serviceBoxes.favorites);scope.error.showErrorMessage=false;}).catch(function(){scope.displayError();});}).catch(function(){scope.displayError();});};scope.toggleMenuOpen=function(open,ignoreRetrieval){if(open!==undefined){scope.menuOpen=open;}else{scope.menuOpen=!scope.menuOpen;}
if(!ignoreRetrieval){scope.retrieveLightboxes(scope.gettyIds,1,3,false);}
if(scope.menuOpen){scope.setupModalOutClick();scope.editing.newLightboxName='';$rootScope.$broadcast(LIGHTBOX_EVENTS.LB_OPEN_EVENT,{fileId:scope.fileIds});scope.sendToOmniture(OMNITURE_EVENTS.LB_TOGGLE);if(scope.savePage){$timeout(scope.positionRelativeToTop,0);}}else{scope.maxLightboxes=MAX_LIGHTBOX_COUNT;scope.hideExcessBoxes=false;scope.clearModalOutClick();}};scope.hideAddDialog=function(){var lightboxListEl=element.find('.lightbox-wrapper.save-multiple-files .lightbox-add-wrapper');if(!Breakpoints.isMatched({name:'SMALL_BREAKPOINT'})){lightboxListEl.css('display','none');}};scope.positionRelativeToTop=function(){var lightboxListEl=element.find('.lightbox-wrapper.save-multiple-files .lightbox-add-wrapper'),lightboxBtn=element.find('.lightbox-btn'),separation=10,top=-lightboxBtn.height()-lightboxListEl.height()-separation;if(!Breakpoints.isMatched({name:'SMALL_BREAKPOINT'})){lightboxListEl.css('top',top+'px');lightboxListEl.css('display','block');}};scope.shouldDisplayOnRight=function(){var lightboxListEl=element.find('.lightbox-add-wrapper,.lightbox-create-wrapper'),lightboxBtn=element.find('.lightbox-btn'),lightboxOffsetLeft;lightboxOffsetLeft=lightboxBtn.offset().left-lightboxListEl.width();return(lightboxOffsetLeft<0);};scope.showLightboxUpdated=function(text){scope.lightboxUpdatedText=text;scope.lightboxCreated=true;$timeout(function(){scope.lightboxCreated=false;scope.alreadySaved=true;},2000);};scope.sendToOmniture=function(event,args){var omnitureArgs={};if(event===OMNITURE_EVENTS.LB_ADD&&scope.savePage){event=OMNITURE_EVENTS.LB_SAVE_PAGE;}
switch(event){case OMNITURE_EVENTS.LB_TOGGLE:omnitureArgs=scope.prepareToggleEvent();break;case OMNITURE_EVENTS.LB_ADD:omnitureArgs=scope.prepareAddEvent(args);break;case OMNITURE_EVENTS.LB_SAVE_PAGE:omnitureArgs=scope.prepareAddPageEvent(args);break;case OMNITURE_EVENTS.LB_CREATE:omnitureArgs=scope.prepareCreateEvent(args);break;}
if(omnitureArgs){$rootScope.$broadcast(event,omnitureArgs);}};scope.prepareAddEvent=function(lightboxArgs){var args=null;if(!scope.savePage){args={assetType:scope.assetType,assetCollection:scope.assetCollection,assetId:scope.fileIds[0],assetIsEditorial:scope.assetLicense==='Editorial'||scope.assetIsEditorial,appId:scope.appId,name:lightboxArgs.lightboxName};}
return args;};scope.prepareAddPageEvent=function(lightboxArgs){var args=null;if(scope.savePage){args={name:lightboxArgs.lightboxName};}
return args;};scope.prepareToggleEvent=function(){var args=null;if(!scope.savePage){args={assetId:scope.fileIds[0],assetIsEditorial:(scope.assetLicense==='Editorial'||scope.assetIsEditorial),assetType:scope.assetType,assetCollection:scope.assetCollection,appId:scope.appId};}
return args;};scope.prepareCreateEvent=function(lightboxArgs){var args={appId:scope.appId,name:lightboxArgs.lightboxName};if(!scope.savePage){args.assetId=scope.fileIds[0];}
return args;};scope.displayError=function(){scope.error.showErrorMessage=true;scope.error.errorMessage=ERROR_MESSAGING.LIGHTBOX_ERROR;};scope.setupModalOutClick=function(){$timeout(function(){$window.onclick=function(event){var targetEl=angular.element(event.target),lightboxListEl=angular.element('.lightbox-add-wrapper'),lightboxAddEl=angular.element('.lightbox-create-wrapper');if((!lightboxListEl.is(targetEl)&&lightboxListEl.has(targetEl).length===0)&&(!lightboxAddEl.is(targetEl)&&lightboxAddEl.has(targetEl).length===0)){if(scope.menuOpen){scope.toggleMenuOpen(false,true);}}};});};scope.clearModalOutClick=function(){$window.onclick=null;};}};}]);}());(function(){'use strict';var module=angular.module('common.directives'),DARK='#000000',LIGHT='#D1D1D1',DEFAULT='# HEX';module.directive('colorPicker',['$timeout','colorService','facetStateService',function($timeout,colorService,facetStateService){var currentFacetColor;return{restrict:'E',scope:{facetColor:'=',change:'&'},templateUrl:'/static/js/angular/common/partials/_colorPicker.html',controller:function($scope){$scope.placeholder=DEFAULT;$scope.input='';$scope.cursorMove={color:'',X:0,Y:0,showCursor:false};if($scope.facetColor&&$scope.facetColor!==''){$scope.input='#'+colorService.formatHexadecimalValue($scope.facetColor);}
$scope.$watch(function(){return facetStateService.isInitialized();},function(){$scope.facetColor=colorService.formatHexadecimalValue(facetStateService.getFacet('color'));$scope.input=facetStateService.getFacet('color');});this.setColorSelection=function(hex){$scope.facetColor=colorService.formatHexadecimalValue(hex);$scope.input=hex;$scope.$apply();$scope.change();};this.setCursor=function(color,X,Y){$scope.cursorMove.color=color;$scope.cursorMove.X=X;$scope.cursorMove.Y=Y;$scope.$apply();};this.showCursor=function(show){$scope.cursorMove.showCursor=show;$scope.$apply();};$scope.clearColor=function(){$timeout(function(){$scope.input='';$scope.facetColor='';$scope.cursorMove.showCursor=false;$scope.$apply();$scope.change();});};$scope.getTextColor=function(hex){if(colorService.isHexadecimalValue(hex)){return colorService.getMostVisibleColor(hex,LIGHT,DARK);}else{return LIGHT;}};$scope.getHexadecimalValue=function(){var hex='';if(colorService.isHexadecimalValue($scope.input)){if($scope.input.indexOf('#')===-1){hex='#';}
hex+=$scope.input;}
return hex;};$scope.inputChanged=function(){if(colorService.isHexadecimalValue($scope.input)){$timeout(function(){$scope.facetColor=colorService.formatHexadecimalValue($scope.input);$scope.$apply();$scope.change();$scope.cursorMove.showCursor=false;});}};$scope.inputSize=function(){var size=6;if($scope.input.indexOf('#')!==-1){size=7;}
return size;};},link:function($scope){$scope.$watch('facetColor',function(newValue){if(currentFacetColor!==newValue){currentFacetColor=newValue;}});$scope.$watch(function(){return currentFacetColor;},function(newValue){var newInputValue='';if(newValue&&newValue!==''){newInputValue='#'+colorService.formatHexadecimalValue(newValue);}
if($scope.input!==newInputValue){$scope.input=newInputValue;$scope.cursorMove.showCursor=false;}});}};}]);}());(function(){'use strict';var module=angular.module('common.directives'),RADIUS=67;module.directive('colorWheel',['$document','colorService',function($document,colorService){return{restrict:'A',require:'^colorPicker',link:function(scope,element,attrs,colorPickerCtrl){var ctx=element[0].getContext('2d'),img=new Image(),mousedown=false;img.src='/static/images/banshee/colorpicker/Color-Picker.png';img.onload=function(){ctx.drawImage(img,0,0);};element.on('mouseenter',function(){toggleMouseEvents(true);});element.on('mouseleave',function(){mousedown=false;toggleMouseEvents(false);});element.on('mousedown',function(event){var hex='',position=convertPosition(event);if(distance(position.X,position.Y)>RADIUS){return;}
mousedown=true;hex=getHexValue(position.X,position.Y);colorPickerCtrl.setCursor(hex,translateXCoordinate(position.X),translateYCoordinate(position.Y));colorPickerCtrl.showCursor(true);toggleMouseEvents(true);});function mousemove(event){var position=convertPosition(event),d=0,hex='';if(!mousedown){return;}
if(position.X<0){position.X=0;}
if(position.Y<0){position.Y=0;}
d=distance(position.X,position.Y);if(d>RADIUS){position.X=closestPointWithinWheel(d,position.X);position.Y=closestPointWithinWheel(d,position.Y);}
hex=getHexValue(position.X,position.Y);colorPickerCtrl.setCursor(hex,translateXCoordinate(position.X),translateYCoordinate(position.Y));}
function mouseup(event){if(mousedown){var position=convertPosition(event),hex=getHexValue(position.X,position.Y);mousedown=false;colorPickerCtrl.setColorSelection(hex);toggleMouseEvents(false);}}
function toggleMouseEvents(on){if(on){$document.on('mousemove',mousemove);$document.on('mouseup',mouseup);}else{$document.off('mousemove',mousemove);$document.off('mouseup',mouseup);}}
function convertPosition(event){var newPosition={X:event.offsetX,Y:event.offsetY};if(newPosition.X===undefined||newPosition.Y===undefined){newPosition.X=event.pageX-angular.element(event.target).offset().left;newPosition.Y=event.pageY-angular.element(event.target).offset().top;}
return newPosition;}
function getHexValue(x,y){var rgb=[],hex='';if(x<0||y<0){return'#000000';}
rgb=ctx.getImageData(x,y,1,1).data;hex=colorService.rgbToHex(rgb[0],rgb[1],rgb[2]);return hex;}
function distance(x,y){return Math.sqrt(Math.pow(RADIUS-x,2)+Math.pow(RADIUS-y,2));}
function closestPointWithinWheel(distance,p){var angle=Math.abs(RADIUS-p)/distance,newDistance=angle*(distance-RADIUS),newPoint=(p<RADIUS)?p+newDistance:p-newDistance;return newPoint;}
function translateXCoordinate(x){return x+(element.parent().outerWidth()-element.outerWidth())/2;}
function translateYCoordinate(y){return y+(element.parent().outerHeight()-element.outerHeight())/2;}}};}]);}());;(function(){'use strict';var module=angular.module('common.directives');module.directive('blurBackground',['$window',function($window){return{scope:{src:'@',blur:'@'},restrict:'E',link:function(scope,element){var lastRenderedInputs={blur:null,src:null},blurAmount=0.2;scope.$watch('src',function(){render();});scope.$watch('blur',function(){if(scope.blur===''){blurAmount=0.2;}else{blurAmount=Number(scope.blur);}
render();});function render(){if(!scope.src){element.removeAttr('style');return;}
if(lastRenderedInputs.src===scope.src&&lastRenderedInputs.blur===scope.blur){return;}
lastRenderedInputs.src=scope.src;lastRenderedInputs.blur=scope.blur;var image=new Image();image.onload=function(){var canvas,scale=200/Math.sqrt((image.naturalWidth*image.naturalHeight));image.width=image.naturalWidth*scale;image.height=image.naturalHeight*scale;canvas=$window.document.createElement('canvas');$window.StackBlur.stackBlurImage(this,canvas,Math.round(this.width*blurAmount),false);element.css({'background-image':'url('+canvas.toDataURL()+')'});};image.src=scope.src;}}};}]);})();(function(){'use strict';var directiveFn,GALLERY_LIMIT=1,HINT_LIMIT=7,MEMBER_LIMIT=4,ARROW_INDEX=-1,KEYED_VALUE='',isOmnitureLoaded=false;directiveFn=function($q,$window,$filter,$location,$timeout,hints){return{restrict:'E',transclude:true,templateUrl:function(elem,attrs){if(attrs.hasOwnProperty('useDefaultSearchBar')){return'/static/js/angular/common/partials/search-bar/_searchBar.html';}else{return'/static/js/angular/common/partials/search-bar/_asynchSearchBar.html';}},scope:{peekingOffset:'@',searchData:'='},link:function($scope,element,attrs){var keyDownQuery='',hintsTimeout=null;$scope.galleryLimit=attrs.galleryLimit||GALLERY_LIMIT;$scope.hintLimit=attrs.hintLimit||HINT_LIMIT;$scope.memberLimit=attrs.memberLimit||MEMBER_LIMIT;$scope.data={query:''};$scope.hints=[];$scope.galleries=[];$scope.members=[];$scope.peeking=attrs.hasOwnProperty('peeking');$scope.useDefault=attrs.hasOwnProperty('useDefaultSearchBar');$scope.data.placeholderTranslations='';$scope.initialLoad=false;if(attrs.hasOwnProperty('placeholdertranslations')){var placeholderTranslations=$scope.$eval(attrs.placeholdertranslations);$scope.data.placeholderTranslations=placeholderTranslations.PLACEHOLDERS;}
$scope.$on('focus',function(e,query){$scope.triggerQuery(query);element.find('.search-bar').addClass('focus');element.find('.search-file-type-selector').addClass('focus');});$scope.$on('blur',function(){element.find('.search-bar').removeClass('focus');element.find('.search-file-type-selector').removeClass('focus');});$scope.keyDown=function(e,query){var KEY_BACKSPACE=8,KEY_RETURN=13,LIS=element.find('.hints li');if(e.keyCode===KEY_RETURN){if(ARROW_INDEX<0){$scope.$broadcast('performSearchRequest',{doSearch:ARROW_INDEX<0,query:query});}else{setTimeout(function(){LIS.eq(ARROW_INDEX).triggerHandler('mousedown');},0);}}
if(e.keyCode&&e.keyCode===KEY_BACKSPACE){keyDownQuery=query;}};$scope.keyUp=function(e,query){var KEY_UP=38,KEY_DOWN=40,LIS=element.find('.hints li'),MAX=LIS.length-1,thisLi,stripTags;LIS.removeClass('active');switch(e.keyCode){case KEY_UP:ARROW_INDEX--;if(ARROW_INDEX<-1){ARROW_INDEX=-1;}
break;case KEY_DOWN:ARROW_INDEX++;if(ARROW_INDEX>MAX){ARROW_INDEX=MAX;}
break;default:KEYED_VALUE=query;ARROW_INDEX=-1;}
if(e.keyCode===KEY_UP||e.keyCode===KEY_DOWN){if(ARROW_INDEX<0){$scope.$broadcast('changeInputValue',KEYED_VALUE);}else{thisLi=LIS.eq(ARROW_INDEX);thisLi.addClass('active');stripTags=String(thisLi.html()).replace(/<[^>]+>/gm,'');$scope.$broadcast('changeInputValue',stripTags);}}};$scope.performSearch=function(hint){$scope.$broadcast('performSearch',hint);};$scope.$on('searchPerformed',function(){$scope.clearHints();});$scope.$on('performSearchResponse',function(event,data){if(data.doSearch){$scope.performSearch(data.query);}else{setTimeout(function(){element.find('.hints li').eq(ARROW_INDEX).triggerHandler('click');},0);}});$scope.$watch('data.query',function(query){if($scope.initialLoad){$scope.initialLoad=false;}else{$scope.triggerQuery(query);}});$scope.triggerQuery=function(query){if(typeof query==='string'&&query.length<1){$scope.clearHints();return undefined;}
$scope.$broadcast('decorateInput');if(hintsTimeout){$timeout.cancel(hintsTimeout);}
hintsTimeout=$timeout(function(){hintsTimeout=null;hints.getHints(query).then(function(data){if(!data){$scope.hints=[];$scope.members=[];$scope.galleries=[];return;}
$scope.galleries=data.galleries;$scope.hints=data.hints;$scope.members=data.members;$scope.version=data.version;$scope.requestTime=data.requestTime;$scope.fromCache=data.cache;$scope.keyword=data.source;$scope.language=data.language;$scope.startTime=data.startTime;})
['finally'](function(){$scope.$broadcast('undecorateInput');$scope.displayTime=Math.round((new Date()).getTime())-$scope.startTime;});},200);};$scope.clearHints=function(){$window.setTimeout(function(){$scope.galleries=[];$scope.hints=[];$scope.members=[];$scope.$broadcast('undecorateInput');$scope.$apply();},10);};$scope.$on('triggerOmniture',function(e,data){if(!isOmnitureLoaded){jQuery(document).on('omniture:trackingLoaded',function(){isOmnitureLoaded=true;jQuery(document).trigger('omniture:autoSuggest',$scope.getOmnitureString(data));});}else{jQuery(document).trigger('omniture:autoSuggest',$scope.getOmnitureString(data));}});$scope.getOmnitureString=function(item){var omnitureString,time=0,time1=0,time2=0,index=-1,isGallery=false,isContributor=false,hasHints=$scope.hasHints();if(hasHints){omnitureString=$scope.version;}else{omnitureString=0;}
if($scope.fromCache){omnitureString+='|1|';}else{omnitureString+='|0|';}
if(hasHints){time=($scope.requestTime-($scope.requestTime%100))/100;time1=($scope.displayTime-($scope.displayTime%100))/100;var clickTime=Math.round((new Date()).getTime())-$scope.startTime;time2=(clickTime-(clickTime%100))/100;}
omnitureString+=time+'*'+time1+'*'+time2+'|';isContributor=item.hasOwnProperty('userId');isGallery=item.hasOwnProperty('lightboxId');if(isGallery){index=$scope.galleries.indexOf(item);omnitureString+=index+'|2|';}else if(isContributor){index=$scope.members.indexOf(item);omnitureString+=index+'|1|';}else{index=$scope.hints.indexOf(item);omnitureString+=index+'|0|';}
if(hasHints){omnitureString+=$scope.language+'|'+$scope.keyword;}else{omnitureString+='en_US|'+item;}
return omnitureString;};$scope.showHints=function(){return $scope.hasHints()&&element.find('.search-bar').hasClass('focus');};$scope.hasHints=function(){var flag=false,queryLower='',i;if(typeof $scope.data.query!=='undefined'){queryLower=$scope.data.query.toLowerCase();}
if(queryLower.length&&(('galleries'in $scope&&$scope.galleries.length>0)||('hints'in $scope&&$scope.hints.length>0)||('members'in $scope&&$scope.members.length>0))){for(i in $scope.galleries){if($scope.galleries.hasOwnProperty(i)){var gallery=$scope.galleries[i].string;if(gallery.toLowerCase().indexOf($scope.query)>-1){flag=true;}}}
for(i in $scope.hints){if($scope.hints.hasOwnProperty(i)){if($scope.hints[i].string.toLowerCase().indexOf(queryLower)>-1){flag=true;}}}
for(i in $scope.members){if($scope.members.hasOwnProperty(i)&&$scope.members[i].string.toLowerCase().indexOf(queryLower)>-1){flag=true;}}
return flag;}
return false;};if($window.addEventListener){$window.addEventListener('click',function(){$scope.clearHints();});}
$scope.searchSubmit=function(e){var query=$scope.data.query||element.find('.search-bar-input').val();if(query){$scope.performSearch(query);if(e){e.stopPropagation();}}};}};};angular.module('common.directives').directive('searchBar',['$q','$window','$filter','$location','$timeout','hints',directiveFn]);jQuery(document).on('omniture:trackingLoaded',function(){isOmnitureLoaded=true;});}());(function(){'use strict';var module=angular.module('common.directives');module.directive('sbAsynch',['facetStateService','$timeout',function(facetStateService,$timeout){return{restrict:'E',templateUrl:'/static/js/angular/common/partials/search-bar/_sbAsynch.html',link:function($scope,element,attrs){$scope.placeHolder='';$scope.placeHolderMobile='';$scope.searchData=$scope.$eval(attrs.data);$scope.initialLoad=true;if($scope.searchData.searchTermsInUse&&$scope.searchData.searchTermsInUse[0]){$scope.data.query=$scope.searchData.searchTermsInUse.join(' ');}else{$scope.data.query='';}
$scope.focus=function(){$scope.$emit('focus',$scope.data.query);};$scope.blur=function(){$scope.$emit('blur');};$scope.$on('performSearchRequest',function(event,data){$scope.$emit('performSearchResponse',{doSearch:(data.doSearch||$scope.isAlternateView()),query:data.query});});$scope.$on('changeInputValue',function(event,keyedValue){element.find('input').val(keyedValue);});$scope.$on('decorateInput',function(){element.find('input').addClass('loading');});$scope.$on('undecorateInput',function(){element.find('input').removeClass('loading');});$scope.clearQuery=function(){if($scope.isAlternateView()){facetStateService.setFacet('text',[]);}
$scope.data.query='';$timeout(function(){angular.element('#search-bar-input').focus();},0,false);};$scope.$on('performSearch',function(event,data){$scope.performSearch(data);});$scope.performSearch=function(hint){if(typeof hint==='string'){hint=hint.replace(/["\(\)\{\}\[\]]+/g,'');}
$scope.$emit('triggerOmniture',hint);if(hint.length===0&&!$scope.isAlternateView()){return;}else{facetStateService.setFacet('pageNumber',1);facetStateService.clearFacetGroup('searchId');if(facetStateService.getFacet('gettyMasterIdSet').length||facetStateService.getFacet('fileIdSet').length){facetStateService.clearFacetGroup('gettyMasterIdSet');facetStateService.clearFacetGroup('fileIdSet');if(facetStateService.allOptionsActive('abstractType')){facetStateService.setFileTypeToDefault();}}
if(typeof hint==='object'){if(!angular.isUndefined(hint.userId)&&hint.userId!==null){$scope.searchData.singleView.clearSingleAlternateView();facetStateService.setFacet('portfolioID',[hint.userId]);$scope.searchData.singleView.setAlternateView('portfolio',{state:true,name:hint.string},hint.userId);facetStateService.activateAllOptions('abstractType');facetStateService.setFacet('additionalAudio','true');}else{$scope.searchData.singleView.clearSingleAlternateView();facetStateService.setFacet('lightboxID',[hint.lightboxId]);$scope.searchData.singleView.setAlternateView('lightbox',{state:true,name:hint.string},hint.lightboxId);facetStateService.activateAllOptions('abstractType');facetStateService.setFacet('additionalAudio','true');}}else if(hint.search(/lean ?in ?collection ?/i)!==-1){$scope.searchData.singleView.clearSingleAlternateView();facetStateService.setFacet('lightboxID',[15518390]);$scope.searchData.singleView.setAlternateView('lightbox',{state:true,name:'Lean In Collection'},15518390);facetStateService.activateAllOptions('abstractType');facetStateService.setFacet('additionalAudio','true');hint=hint.replace(/lean ?in ?collection ?/i,'');}
if(!$scope.searchData.searchResponse.pendingKeywords){$scope.searchData.searchResponse.pendingKeywords=[];}
if(!hint||typeof hint==='object'){facetStateService.setFacet('text',[]);$scope.searchData.searchResponse.keywordTerms=[];$scope.data.query='';}else if(facetStateService.getFacet('text').join(' ')!==hint){$scope.searchData.searchResponse.pendingKeywords.push(hint);facetStateService.setFacet('text',[hint]);$scope.data.query=hint;}else{$timeout(function(){angular.element('#search-bar-input').blur();},0,false);}
if(Breakpoints.isMatched({name:'SMALL_BREAKPOINT'})||Breakpoints.isMatched({name:'MEDIUM_BREAKPOINT'})){if(typeof hint!=='object'){$scope.data.query=hint;}}
$scope.$emit('searchPerformed');}};$scope.setPlaceholder=function(){return $scope.placeHolder;};$scope.isAlternateView=function(){return facetStateService.getFacet('portfolio')||facetStateService.getFacet('lightboxID').length;};angular.element(window).bind('pageshow',function(event){if(event.originalEvent.persisted){$timeout(function(){angular.element('input').val($scope.data.query);},100,false);}});}};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('sbDefault',['urlBuilder','facetStateService','redirect','$timeout','$filter','fileTypeStorageService',function(urlBuilder,facetStateService,redirect,$timeout,$filter,fileTypeStorageService){return{restrict:'E',templateUrl:'/static/js/angular/common/partials/search-bar/_sbDefault.html',link:function($scope,element,attrs){$scope.placeHolder='';$scope.placeHolderMobile='';$scope.source=attrs.source||null;var placeholderSelection={};if($scope.data.placeholderTranslations){placeholderSelection=$scope.data.placeholderTranslations;$scope.placeHolderMobile=placeholderSelection.mobile;}else{placeholderSelection={'image':$filter('i18n')('PERFECT_IMAGES'),'photos':$filter('i18n')('PERFECT_PHOTOS'),'illustrations':$filter('i18n')('PERFECT_ILLUSTRATIONS'),'video':$filter('i18n')('PERFECT_VIDEOS'),'audio':$filter('i18n')('PERFECT_AUDIO')};$scope.placeHolderMobile=$filter('i18n')('SEARCHING');}
$scope.focus=function(query){$scope.$emit('focus',query);};$scope.blur=function(){$scope.$emit('blur');};$scope.$on('performSearchRequest',function(event,data){$scope.$emit('performSearchResponse',data);});$scope.$on('changeInputValue',function(event,keyedValue){element.find('input').val(keyedValue);});$scope.$on('decorateInput',function(){element.find('input').addClass('loading');});$scope.$on('undecorateInput',function(){element.find('input').removeClass('loading');});$scope.clearQuery=function(){$scope.data.query='';$timeout(function(){angular.element('#search-bar-input').focus();},0,false);};$scope.$on('fileTypeChanged',function(){$scope.performSearch($scope.data.query);});$scope.$on('performSearch',function(event,data){$scope.performSearch(data);});$scope.performSearch=function(hint){var activeFileTypes=facetStateService.getActiveValues('abstractType');if(typeof hint==='string'){hint=hint.replace(/["\(\)\{\}\[\]]+/g,'');}
$scope.$emit('triggerOmniture',hint);fileTypeStorageService.setFileType(activeFileTypes);urlBuilder.build(hint,activeFileTypes.join(),$scope.source).then(function(url){if(typeof hint==='string'){hint={userString:hint};}
$scope.data.query=hint.userString;$scope.$emit('searchPerformed');redirect.to(url);});};$scope.initBreakpoints=function(){Breakpoints.on({name:'LESSTHAN800_BREAKPOINT',el:jQuery('#content-root')[0],matched:function(){$scope.setPlaceholder();$scope.$apply();}});Breakpoints.on({name:'GREATERTHAN800_BREAKPOINT',el:jQuery('#content-root')[0],matched:function(){$scope.setPlaceholder();$scope.$apply();}});};$timeout($scope.initBreakpoints);$scope.setPlaceholder=function(){var filetype=facetStateService.getActiveValues('abstractType');if(Breakpoints.isMatched({name:'LESSTHAN800_BREAKPOINT',el:jQuery('#content-root')[0]})){$scope.placeHolder=$scope.placeHolderMobile;}else{if(filetype.length>1||filetype.length===0){$scope.placeHolder=placeholderSelection.image;}else{$scope.placeHolder=placeholderSelection[filetype[0]];}}
return $scope.placeHolder;};}};}]);}());(function(){'use strict';var directiveFn;directiveFn=function($rootScope,$timeout,facetStateService,locker,omnitureService,mobileUIService){return{restrict:'E',templateUrl:'/static/js/angular/common/partials/_refineSearch.html',controller:function($scope){$scope.toggleRefinePanel=function(){$scope.refineData.showRefinePanel=!($scope.refineData.showRefinePanel);omnitureService.toggleRefinePanel($scope.refineData.showRefinePanel);if(!$scope.refineData.refinePanelMobile&&locker.supported()){locker.driver('local').namespace('srp').put($scope.refineData.REFINE_LOCAL_STORAGE_NAME,$scope.refineData.showRefinePanel);}};$scope.showBadge=function(){var filterFacets=angular.copy(facetStateService.filterFacets),index=filterFacets.indexOf('collectionPrice');if(index>-1){filterFacets.splice(index,1);}
return facetStateService.hasActiveFacets(filterFacets);};$scope.$watchGroup(['refineData.refinePanelMobile','refineData.showRefinePanel'],function(){$rootScope.$emit('syncRefinePanel',$scope.refineData);});$rootScope.$on('syncRefinePanel',function(event,args){$scope.refineData.showRefinePanel=args.showRefinePanel;});},link:function($scope){$scope.refineData={showRefinePanel:false,refinePanelMobile:false,allowRefineFacets:true,REFINE_LOCAL_STORAGE_NAME:'srpRefinementVisible'};$scope.refineData.allowRefineFacets=!facetStateService.allOptionsActive('abstractType');$scope.$watch(function(){if(locker.supported){return locker.driver('local').namespace('srp').get($scope.refineData.REFINE_LOCAL_STORAGE_NAME);}else{return false;}},function(showRefineVar){$scope.refineData.showRefinePanel=showRefineVar;});$scope.showAndHideRefinePanel=function(){if(!$scope.refineData.allowRefineFacets){$scope.refineData.showRefinePanel=false;}else{if($scope.refineData.refinePanelMobile){$scope.refineData.showRefinePanel=false;}else if(locker.supported()){$scope.refineData.showRefinePanel=locker.driver('local').namespace('srp').get($scope.refineData.REFINE_LOCAL_STORAGE_NAME,false);}}};$scope.showAndHideRefineButton=function(){var element=jQuery('.search-container');if($scope.refineData.allowRefineFacets===false){element.addClass('hide-refine-section');}else{element.removeClass('hide-refine-section');}};$scope.$watch(function(){return facetStateService.allOptionsActive('abstractType');},function(allOptionsActive){$scope.refineData.allowRefineFacets=!allOptionsActive;$scope.showAndHideRefineButton();$scope.showAndHideRefinePanel();},true);$scope.$watch('refineData.showRefinePanel',function(newValue){if(newValue&&$scope.refineData.refinePanelMobile){mobileUIService.disableBodyScrolling();}else{mobileUIService.enableBodyScrolling();}});$timeout(function(){if(!$scope.refineData.refinePanelMobile&&$scope.refineData.allowRefineFacets){if(locker.supported()){$scope.refineData.showRefinePanel=locker.driver('local').namespace('srp').get($scope.refineData.REFINE_LOCAL_STORAGE_NAME,false);}}},0);$scope.initBreakpoints=function(){$scope.refineData.refinePanelMobile=false;Breakpoints.on({name:'MEDIUM_DOWN_BREAKPOINT',el:jQuery('.srp-container')[0],matched:function(){$scope.refineData.refinePanelMobile=true;$scope.refineData.showRefinePanel=false;angular.element('#refine-arrow-open').addClass('small-size');$scope.$apply();},exit:function(){$scope.refineData.refinePanelMobile=false;angular.element('#refine-arrow-open').removeClass('small-size');$scope.$apply();}});};$timeout($scope.initBreakpoints);}};};angular.module('common.directives').directive('refineSearch',['$rootScope','$timeout','facetStateService','locker','omnitureService','mobileUIService',directiveFn]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('killClick',[function(){var _link=function(scope,element){jQuery(element).click(function(event){event.preventDefault();});};return{link:_link,restrict:'A'};}]);}());(function(){'use strict';var module=angular.module('common.directives');module.directive('icon',['$compile','$http','$templateCache',function($compile,$http,$templateCache){return{restrict:'E',scope:{svg:'@',html:'@'},link:function(scope,element,attrs){var templateUrl,iconPartialsLocation='/static/js/angular/common/partials/icon/';if(attrs.svg!==undefined){templateUrl=iconPartialsLocation+attrs.svg+'.svg';}else if(attrs.html!==undefined){templateUrl=iconPartialsLocation+attrs.html+'.html';}
if(templateUrl!==undefined){element.addClass('icon-directive');$http.get(templateUrl,{cache:$templateCache}).success(function(html){element.html(html);}).then(function(){element.html($compile(element.html())(scope));});}else{return;}}};}]);}());(function(){'use strict';angular.module('common.filters',[]);})();(function(){'use strict';var search=angular.module('common.filters');search.filter('preserveObjectOrder',[function(){return function(input){var array=[],objectKey;if(!angular.isObject(input)){return input;}
for(objectKey in input){if(objectKey){array.push(input[objectKey]);}}
return array;};}]);}());(function(){'use strict';var module=angular.module('common.filters');module.filter('truncate',[function(){return function(text,length,end){if(isNaN(length)){length=30;}
if(end===undefined){end='...';}
if(text.length<=length||text.length-end.length<=length){return text;}else{length=length-(end.length);return String(text).substring(0,length)+end;}};}]);}());BOOMR_start=new Date().getTime();function BOOMR_check_doc_domain(domain){var test;if(!domain){if(window.parent===window||!document.getElementById("boomr-if-as")){return;}
domain=document.domain;}
if(domain.indexOf(".")===-1){return;}
try{test=window.parent.document;return;}
catch(err){document.domain=domain;}
try{test=window.parent.document;return;}
catch(err){domain=domain.replace(/^[\w\-]+\./,"");}
BOOMR_check_doc_domain(domain);}
BOOMR_check_doc_domain();(function(w){var impl,boomr,d,myurl,createCustomEvent,dispatchEvent,visibilityState,visibilityChange;if(w.parent!==w&&document.getElementById("boomr-if-as")&&document.getElementById("boomr-if-as").nodeName.toLowerCase()==="script"){w=w.parent;myurl=document.getElementById("boomr-if-as").src;}
d=w.document;if(!w.BOOMR){w.BOOMR={};}
BOOMR=w.BOOMR;if(BOOMR.version){return;}
BOOMR.version="0.9";BOOMR.window=w;if(!BOOMR.plugins){BOOMR.plugins={};}
(function(){try{if(new w.CustomEvent("CustomEvent")!==undefined){createCustomEvent=function(e_name,params){return new w.CustomEvent(e_name,params);};}}
catch(ignore){}
try{if(!createCustomEvent&&d.createEvent&&d.createEvent("CustomEvent")){createCustomEvent=function(e_name,params){var evt=d.createEvent("CustomEvent");params=params||{cancelable:false,bubbles:false};evt.initCustomEvent(e_name,params.bubbles,params.cancelable,params.detail);return evt;};}}
catch(ignore){}
if(!createCustomEvent&&d.createEventObject){createCustomEvent=function(e_name,params){var evt=d.createEventObject();evt.type=evt.propertyName=e_name;evt.detail=params.detail;return evt;};}
if(!createCustomEvent){createCustomEvent=function(){return undefined;};}}());dispatchEvent=function(e_name,e_data,async){var ev=createCustomEvent(e_name,{"detail":e_data});if(!ev){return;}
function dispatch(){if(d.dispatchEvent){d.dispatchEvent(ev);}
else if(d.fireEvent){d.fireEvent("onpropertychange",ev);}}
if(async){BOOMR.setImmediate(dispatch);}
else{dispatch();}};if(typeof document.hidden!=="undefined"){visibilityState="visibilityState";visibilityChange="visibilitychange";}
else if(typeof document.mozHidden!=="undefined"){visibilityState="mozVisibilityState";visibilityChange="mozvisibilitychange";}
else if(typeof document.msHidden!=="undefined"){visibilityState="msVisibilityState";visibilityChange="msvisibilitychange";}
else if(typeof document.webkitHidden!=="undefined"){visibilityState="webkitVisibilityState";visibilityChange="webkitvisibilitychange";}
impl={beacon_url:"",beacon_type:"AUTO",site_domain:w.location.hostname.replace(/.*?([^.]+\.[^.]+)\.?$/,"$1").toLowerCase(),user_ip:"",strip_query_string:false,onloadfired:false,handlers_attached:false,events:{"page_ready":[],"page_unload":[],"before_unload":[],"dom_loaded":[],"visibility_changed":[],"before_beacon":[],"onbeacon":[],"xhr_load":[],"click":[],"form_submit":[]},public_events:{"before_beacon":"onBeforeBoomerangBeacon","onbeacon":"onBoomerangBeacon","onboomerangloaded":"onBoomerangLoaded"},vars:{},errors:{},disabled_plugins:{},xb_handler:function(type){return function(ev){var target;if(!ev){ev=w.event;}
if(ev.target){target=ev.target;}
else if(ev.srcElement){target=ev.srcElement;}
if(target.nodeType===3){target=target.parentNode;}
if(target&&target.nodeName.toUpperCase()==="OBJECT"&&target.type==="application/x-shockwave-flash"){return;}
impl.fireEvent(type,target);};},fireEvent:function(e_name,data){var i,handler,handlers;e_name=e_name.toLowerCase();if(!this.events.hasOwnProperty(e_name)){return false;}
if(this.public_events.hasOwnProperty(e_name)){dispatchEvent(this.public_events[e_name],data);}
handlers=this.events[e_name];for(i=0;i<handlers.length;i++){try{handler=handlers[i];handler.fn.call(handler.scope,data,handler.cb_data);}
catch(err){BOOMR.addError(err,"fireEvent."+e_name+"<"+i+">");}}
return true;}};boomr={t_lstart:null,t_start:BOOMR_start,t_end:null,url:myurl,utils:{objectToString:function(o,separator,nest_level){var value=[],k;if(!o||typeof o!=="object"){return o;}
if(separator===undefined){separator="\n\t";}
if(!nest_level){nest_level=0;}
if(Object.prototype.toString.call(o)==="[object Array]"){for(k=0;k<o.length;k++){if(nest_level>0&&o[k]!==null&&typeof o[k]==="object"){value.push(this.objectToString(o[k],separator+(separator==="\n\t"?"\t":""),nest_level-1));}
else{if(separator==="&"){value.push(encodeURIComponent(o[k]));}
else{value.push(o[k]);}}}
separator=",";}
else{for(k in o){if(Object.prototype.hasOwnProperty.call(o,k)){if(nest_level>0&&o[k]!==null&&typeof o[k]==="object"){value.push(encodeURIComponent(k)+"="+
this.objectToString(o[k],separator+(separator==="\n\t"?"\t":""),nest_level-1));}
else{if(separator==="&"){value.push(encodeURIComponent(k)+"="+encodeURIComponent(o[k]));}
else{value.push(k+"="+o[k]);}}}}}
return value.join(separator);},getCookie:function(name){if(!name){return null;}
name=" "+name+"=";var i,cookies;cookies=" "+d.cookie+";";if((i=cookies.indexOf(name))>=0){i+=name.length;cookies=cookies.substring(i,cookies.indexOf(";",i));return cookies;}
return null;},setCookie:function(name,subcookies,max_age){var value,nameval,savedval,c,exp;if(!name||!impl.site_domain){BOOMR.debug("No cookie name or site domain: "+name+"/"+impl.site_domain);return false;}
value=this.objectToString(subcookies,"&");nameval=name+"="+value;c=[nameval,"path=/","domain="+impl.site_domain];if(max_age){exp=new Date();exp.setTime(exp.getTime()+max_age*1000);exp=exp.toGMTString();c.push("expires="+exp);}
if(nameval.length<500){d.cookie=c.join("; ");savedval=this.getCookie(name);if(value===savedval){return true;}
BOOMR.warn("Saved cookie value doesn't match what we tried to set:\n"+value+"\n"+savedval);}
else{BOOMR.warn("Cookie too long: "+nameval.length+" "+nameval);}
return false;},getSubCookies:function(cookie){var cookies_a,i,l,kv,gotcookies=false,cookies={};if(!cookie){return null;}
if(typeof cookie!=="string"){BOOMR.debug("TypeError: cookie is not a string: "+typeof cookie);return null;}
cookies_a=cookie.split("&");for(i=0,l=cookies_a.length;i<l;i++){kv=cookies_a[i].split("=");if(kv[0]){kv.push("");cookies[decodeURIComponent(kv[0])]=decodeURIComponent(kv[1]);gotcookies=true;}}
return gotcookies?cookies:null;},removeCookie:function(name){return this.setCookie(name,{},-86400);},cleanupURL:function(url){if(!url){return"";}
if(impl.strip_query_string){return url.replace(/\?.*/,"?qs-redacted");}
return url;},hashQueryString:function(url,stripHash){if(!url){return url;}
if(!url.match){BOOMR.addError("TypeError: Not a string","hashQueryString",typeof url);return"";}
if(url.match(/^\/\//)){url=location.protocol+url;}
if(!url.match(/^(https?|file):/)){BOOMR.error("Passed in URL is invalid: "+url);return"";}
if(stripHash){url=url.replace(/#.*/,"");}
if(!BOOMR.utils.MD5){return url;}
return url.replace(/\?([^#]*)/,function(m0,m1){return"?"+(m1.length>10?BOOMR.utils.MD5(m1):m1);});},pluginConfig:function(o,config,plugin_name,properties){var i,props=0;if(!config||!config[plugin_name]){return false;}
for(i=0;i<properties.length;i++){if(config[plugin_name][properties[i]]!==undefined){o[properties[i]]=config[plugin_name][properties[i]];props++;}}
return(props>0);},addObserver:function(el,config,timeout,callback,callback_data,callback_ctx){var o={observer:null,timer:null};if(!window.MutationObserver||!callback||!el){return null;}
function done(mutations){var run_again=false;if(o.timer){clearTimeout(o.timer);o.timer=null;}
if(callback){run_again=callback.call(callback_ctx,mutations,callback_data);if(!run_again){callback=null;}}
if(!run_again&&o.observer){o.observer.disconnect();o.observer=null;}
if(typeof run_again==="number"&&run_again>0){o.timer=setTimeout(done,run_again);}}
o.observer=new MutationObserver(done);if(timeout){o.timer=setTimeout(done,o.timeout);}
o.observer.observe(el,config);return o;},addListener:function(el,type,fn){if(el.addEventListener){el.addEventListener(type,fn,false);}else if(el.attachEvent){el.attachEvent("on"+type,fn);}},removeListener:function(el,type,fn){if(el.removeEventListener){el.removeEventListener(type,fn,false);}else if(el.detachEvent){el.detachEvent("on"+type,fn);}},pushVars:function(form,vars,prefix){var k,i,l=0,input;for(k in vars){if(vars.hasOwnProperty(k)){if(Object.prototype.toString.call(vars[k])==="[object Array]"){for(i=0;i<vars[k].length;++i){l+=BOOMR.utils.pushVars(form,vars[k][i],k+"["+i+"]");}}else{input=document.createElement("input");input.type="hidden";input.name=(prefix?(prefix+"["+k+"]"):k);input.value=(vars[k]===undefined||vars[k]===null?"":vars[k]);form.appendChild(input);l+=encodeURIComponent(input.name).length+encodeURIComponent(input.value).length+2;}}}
return l;},sendData:function(form,method){var input=document.createElement("input"),urls=[impl.beacon_url];form.method=method;form.id="beacon_form";form.enctype="application/x-www-form-urlencoded";if(impl.secondary_beacons&&impl.secondary_beacons.length){urls.push.apply(urls,impl.secondary_beacons);}
function remove(id){var el=document.getElementById(id);if(el){el.parentNode.removeChild(el);}}
function submit(){var iframe,name="boomerang_post-"+encodeURIComponent(form.action)+"-"+Math.random();try{iframe=document.createElement('<iframe name="'+name+'">');}
catch(ignore){iframe=document.createElement("iframe");}
form.action=urls.shift();form.target=iframe.name=iframe.id=name;iframe.style.display=form.style.display="none";iframe.src="javascript:false";remove(iframe.id);remove(form.id);document.body.appendChild(iframe);document.body.appendChild(form);form.submit();if(urls.length){BOOMR.setImmediate(submit);}
setTimeout(function(){remove(iframe.id);},10000);}
submit();}},init:function(config){var i,k,properties=["beacon_url","beacon_type","site_domain","user_ip","strip_query_string","secondary_beacons"];BOOMR_check_doc_domain();if(!config){config={};}
for(i=0;i<properties.length;i++){if(config[properties[i]]!==undefined){impl[properties[i]]=config[properties[i]];}}
if(config.log!==undefined){this.log=config.log;}
if(!this.log){this.log=function(){};}
for(k in this.plugins){if(this.plugins.hasOwnProperty(k)){if(config[k]&&config[k].hasOwnProperty("enabled")&&config[k].enabled===false){impl.disabled_plugins[k]=1;continue;}
if(impl.disabled_plugins[k]){if(!config[k]||!config[k].hasOwnProperty("enabled")||config[k].enabled!==true){continue;}
delete impl.disabled_plugins[k];}
if(typeof this.plugins[k].init==="function"){try{this.plugins[k].init(config);}
catch(err){BOOMR.addError(err,k+".init");}}}}
if(impl.handlers_attached){return this;}
if(!impl.onloadfired&&(config.autorun===undefined||config.autorun!==false)){if(d.readyState&&d.readyState==="complete"){BOOMR.loadedLate=true;this.setImmediate(BOOMR.page_ready,null,null,BOOMR);}
else{if(w.onpagehide||w.onpagehide===null){BOOMR.utils.addListener(w,"pageshow",BOOMR.page_ready);}
else{BOOMR.utils.addListener(w,"load",BOOMR.page_ready);}}}
BOOMR.utils.addListener(w,"DOMContentLoaded",function(){impl.fireEvent("dom_loaded");});(function(){var forms,iterator;if(visibilityChange!==undefined){BOOMR.utils.addListener(d,visibilityChange,function(){impl.fireEvent("visibility_changed");});BOOMR.subscribe("visibility_changed",function(){BOOMR.lastVisibilityEvent[BOOMR.visibilityState()]=BOOMR.now();});}
BOOMR.utils.addListener(d,"mouseup",impl.xb_handler("click"));forms=d.getElementsByTagName("form");for(iterator=0;iterator<forms.length;iterator++){BOOMR.utils.addListener(forms[iterator],"submit",impl.xb_handler("form_submit"));}
if(!w.onpagehide&&w.onpagehide!==null){BOOMR.utils.addListener(w,"unload",function(){BOOMR.window=w=null;});}}());impl.handlers_attached=true;return this;},page_ready:function(ev){if(!ev){ev=w.event;}
if(!ev){ev={name:"load"};}
if(impl.onloadfired){return this;}
impl.fireEvent("page_ready",ev);impl.onloadfired=true;return this;},setImmediate:function(fn,data,cb_data,cb_scope){var cb=function(){fn.call(cb_scope||null,data,cb_data||{});cb=null;};if(w.setImmediate){w.setImmediate(cb);}
else if(w.msSetImmediate){w.msSetImmediate(cb);}
else if(w.webkitSetImmediate){w.webkitSetImmediate(cb);}
else if(w.mozSetImmediate){w.mozSetImmediate(cb);}
else{setTimeout(cb,10);}},now:(function(){try{if("performance"in window&&window.performance&&window.performance.now){return function(){return Math.round(window.performance.now()+window.performance.timing.navigationStart);};}}
catch(ignore){}
return Date.now||function(){return new Date().getTime();};}()),visibilityState:(visibilityState===undefined?function(){return"visible";}:function(){return d[visibilityState];}),lastVisibilityEvent:{},subscribe:function(e_name,fn,cb_data,cb_scope){var i,handler,ev,unload_handler;e_name=e_name.toLowerCase();if(!impl.events.hasOwnProperty(e_name)){return this;}
ev=impl.events[e_name];for(i=0;i<ev.length;i++){handler=ev[i];if(handler&&handler.fn===fn&&handler.cb_data===cb_data&&handler.scope===cb_scope){return this;}}
ev.push({"fn":fn,"cb_data":cb_data||{},"scope":cb_scope||null});if(e_name==="page_ready"&&impl.onloadfired){this.setImmediate(fn,null,cb_data,cb_scope);}
if(e_name==="page_unload"||e_name==="before_unload"){unload_handler=function(evt){if(fn){fn.call(cb_scope,evt||w.event,cb_data);}};if(e_name==="page_unload"){if(w.onpagehide||w.onpagehide===null){BOOMR.utils.addListener(w,"pagehide",unload_handler);}
else{BOOMR.utils.addListener(w,"unload",unload_handler);}}
BOOMR.utils.addListener(w,"beforeunload",unload_handler);}
return this;},addError:function(err,src,extra){var str;if(typeof err!=="string"){str=String(err);if(str.match(/^\[object/)){str=err.name+": "+(err.description||err.message).replace(/\r\n$/,"");}
err=str;}
if(src!==undefined){err="["+src+":"+BOOMR.now()+"] "+err;}
if(extra){err+=":: "+extra;}
if(impl.errors[err]){impl.errors[err]++;}
else{impl.errors[err]=1;}},addVar:function(name,value){if(typeof name==="string"){impl.vars[name]=value;}
else if(typeof name==="object"){var o=name,k;for(k in o){if(o.hasOwnProperty(k)){impl.vars[k]=o[k];}}}
return this;},removeVar:function(arg0){var i,params;if(!arguments.length){return this;}
if(arguments.length===1&&Object.prototype.toString.apply(arg0)==="[object Array]"){params=arg0;}
else{params=arguments;}
for(i=0;i<params.length;i++){if(impl.vars.hasOwnProperty(params[i])){delete impl.vars[params[i]];}}
return this;},hasVar:function(name){return impl.vars.hasOwnProperty(name);},requestStart:function(name){var t_start=BOOMR.now();BOOMR.plugins.RT.startTimer("xhr_"+name,t_start);return{loaded:function(data){BOOMR.responseEnd(name,t_start,data);}};},responseEnd:function(name,t_start,data){console.log('BOOMerang >>>>>>>>>>>> '+JSON.stringify(name));if(typeof name==="object"&&name.url){impl.fireEvent("xhr_load",name);}
else{BOOMR.plugins.RT.startTimer("xhr_"+name,t_start);impl.fireEvent("xhr_load",{"name":"xhr_"+name,"data":data});}},sendBeacon:function(){var k,form,furl,img,length,errors=[];BOOMR.debug("Checking if we can send beacon");for(k in this.plugins){if(this.plugins.hasOwnProperty(k)){if(impl.disabled_plugins[k]){continue;}
if(!this.plugins[k].is_complete()){BOOMR.debug("Plugin "+k+" is not complete, deferring beacon send");return false;}}}
impl.vars.pgu=BOOMR.utils.cleanupURL(d.URL.replace(/#.*/,""));if(!impl.vars.u){impl.vars.u=impl.vars.pgu;}
if(impl.vars.pgu===impl.vars.u){delete impl.vars.pgu;}
impl.vars.v=BOOMR.version;if(BOOMR.visibilityState()){impl.vars["vis.st"]=BOOMR.visibilityState();if(BOOMR.lastVisibilityEvent.visible){impl.vars["vis.lv"]=BOOMR.now()-BOOMR.lastVisibilityEvent.visible;}
if(BOOMR.lastVisibilityEvent.hidden){impl.vars["vis.lh"]=BOOMR.now()-BOOMR.lastVisibilityEvent.hidden;}}
if(w!==window){impl.vars["if"]="";}
for(k in impl.errors){if(impl.errors.hasOwnProperty(k)){errors.push(k+(impl.errors[k]>1?" (*"+impl.errors[k]+")":""));}}
if(errors.length>0){impl.vars.errors=errors.join("\n");}
impl.errors={};impl.fireEvent("before_beacon",impl.vars);BOOMR.debug("Ready to send beacon: "+BOOMR.utils.objectToString(impl.vars));if(!impl.beacon_url){BOOMR.debug("No beacon URL, so skipping.");return true;}
form=document.createElement("form");length=BOOMR.utils.pushVars(form,impl.vars);impl.fireEvent("onbeacon",impl.vars);if(!length){return this;}
BOOMR.utils.sendData(form,impl.beacon_type==="AUTO"?(length>2000?"POST":"GET"):"POST");return true;}};delete BOOMR_start;if(typeof BOOMR_lstart==="number"){boomr.t_lstart=BOOMR_lstart;delete BOOMR_lstart;}
else if(typeof BOOMR.window.BOOMR_lstart==="number"){boomr.t_lstart=BOOMR.window.BOOMR_lstart;}
(function(){var make_logger;if(typeof console==="object"&&console.log!==undefined){boomr.log=function(m,l,s){console.log(s+": ["+l+"] "+m);};}
make_logger=function(l){return function(m,s){this.log(m,l,"boomerang"+(s?"."+s:""));return this;};};boomr.debug=make_logger("debug");boomr.info=make_logger("info");boomr.warn=make_logger("warn");boomr.error=make_logger("error");}());(function(){var ident;for(ident in boomr){if(boomr.hasOwnProperty(ident)){BOOMR[ident]=boomr[ident];}}
if(!BOOMR.xhr_excludes){BOOMR.xhr_excludes={};}}());dispatchEvent("onBoomerangLoaded",{"BOOMR":BOOMR},true);}(window));(function(w){var d=w.document,impl;BOOMR=BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};if(BOOMR.plugins.RT){return;}
impl={onloadfired:false,unloadfired:false,visiblefired:false,initialized:false,complete:false,timers:{},cookie:"RT",cookie_exp:600,strict_referrer:true,navigationType:0,navigationStart:undefined,responseStart:undefined,t_start:undefined,cached_t_start:undefined,t_fb_approx:undefined,r:undefined,r2:undefined,basic_timers:{t_done:1,t_resp:1,t_page:1},addedVars:[],updateCookie:function(params,timer){var t_end,t_start,subcookies,k;if(!this.cookie){return false;}
subcookies=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie))||{};if(typeof params==="object"){for(k in params){if(params.hasOwnProperty(k)){if(params[k]===undefined){if(subcookies.hasOwnProperty(k)){delete subcookies[k];}}
else{if(k==="nu"||k==="r"){params[k]=BOOMR.utils.hashQueryString(params[k],true);}
subcookies[k]=params[k];}}}}
t_start=BOOMR.now();if(timer){subcookies[timer]=t_start;}
BOOMR.debug("Setting cookie (timer="+timer+")\n"+BOOMR.utils.objectToString(subcookies),"rt");if(!BOOMR.utils.setCookie(this.cookie,subcookies,this.cookie_exp)){BOOMR.error("cannot set start cookie","rt");return false;}
t_end=BOOMR.now();if(t_end-t_start>50){BOOMR.utils.removeCookie(this.cookie);BOOMR.error("took more than 50ms to set cookie... aborting: "
+t_start+" -> "+t_end,"rt");}
return true;},initFromCookie:function(){var url,subcookies;subcookies=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie));if(!subcookies){return;}
subcookies.s=Math.max(+subcookies.ul||0,+subcookies.cl||0);BOOMR.debug("Read from cookie "+BOOMR.utils.objectToString(subcookies),"rt");if(subcookies.s&&(subcookies.r||subcookies.nu)){this.r=subcookies.r;url=BOOMR.utils.hashQueryString(d.URL,true);BOOMR.debug(this.r+" =?= "+this.r2,"rt");BOOMR.debug(subcookies.s+" <? "+(+subcookies.cl+15),"rt");BOOMR.debug(subcookies.nu+" =?= "+url,"rt");if(!this.strict_referrer||(subcookies.nu&&subcookies.nu===url&&subcookies.s<+subcookies.cl+15)||(subcookies.s===+subcookies.ul&&this.r===this.r2)){this.t_start=subcookies.s;if(+subcookies.hd>subcookies.s){this.t_fb_approx=parseInt(subcookies.hd,10);}}
else{this.t_start=this.t_fb_approx=undefined;}}
this.updateCookie({s:undefined,r:undefined,nu:undefined,ul:undefined,cl:undefined,hd:undefined});},getBoomerangTimings:function(){var res,k,urls,url,startTime,data;function trimTiming(time,st){var timeMs=Math.round(time?time:0),startTimeMs=Math.round(st?st:0);timeMs=(timeMs===0?0:(timeMs-startTimeMs));return timeMs?timeMs:"";}
if(BOOMR.t_start){BOOMR.plugins.RT.startTimer("boomerang",BOOMR.t_start);BOOMR.plugins.RT.endTimer("boomerang",BOOMR.t_end);BOOMR.plugins.RT.endTimer("boomr_fb",BOOMR.t_start);if(BOOMR.t_lstart){BOOMR.plugins.RT.endTimer("boomr_ld",BOOMR.t_lstart);BOOMR.plugins.RT.setTimer("boomr_lat",BOOMR.t_start-BOOMR.t_lstart);}}
try
{if(window.performance&&window.performance.getEntriesByName){urls={"rt.bmr":BOOMR.url};for(url in urls){if(urls.hasOwnProperty(url)&&urls[url]){res=window.performance.getEntriesByName(urls[url]);if(!res||res.length===0){continue;}
res=res[0];startTime=trimTiming(res.startTime,0);data=[startTime,trimTiming(res.responseEnd,startTime),trimTiming(res.responseStart,startTime),trimTiming(res.requestStart,startTime),trimTiming(res.connectEnd,startTime),trimTiming(res.secureConnectionStart,startTime),trimTiming(res.connectStart,startTime),trimTiming(res.domainLookupEnd,startTime),trimTiming(res.domainLookupStart,startTime),trimTiming(res.redirectEnd,startTime),trimTiming(res.redirectStart,startTime)].join(",").replace(/,+$/,"");BOOMR.addVar(url,data);impl.addedVars.push(url);}}}}
catch(e)
{BOOMR.addError(e,"rt.getBoomerangTimings");}},checkPreRender:function(){if(BOOMR.visibilityState()!=="prerender"){return false;}
BOOMR.plugins.RT.startTimer("t_load",this.navigationStart);BOOMR.plugins.RT.endTimer("t_load");BOOMR.plugins.RT.startTimer("t_prerender",this.navigationStart);BOOMR.plugins.RT.startTimer("t_postrender");return true;},initFromNavTiming:function(){var ti,p,source;if(this.navigationStart){return;}
p=w.performance||w.msPerformance||w.webkitPerformance||w.mozPerformance;if(p&&p.navigation){this.navigationType=p.navigation.type;}
if(p&&p.timing){ti=p.timing;}
else if(w.chrome&&w.chrome.csi&&w.chrome.csi().startE){ti={navigationStart:w.chrome.csi().startE};source="csi";}
else if(w.gtbExternal&&w.gtbExternal.startE()){ti={navigationStart:w.gtbExternal.startE()};source="gtb";}
if(ti){BOOMR.addVar("rt.start",source||"navigation");this.navigationStart=ti.navigationStart||ti.fetchStart||undefined;this.responseStart=ti.responseStart||undefined;if(navigator.userAgent.match(/Firefox\/[78]\./)){this.navigationStart=ti.unloadEventStart||ti.fetchStart||undefined;}}
else{BOOMR.warn("This browser doesn't support the WebTiming API","rt");}
return;},validateLoadTimestamp:function(t_now,data){var t_done=t_now;if(data&&data.timing&&data.timing.loadEventEnd){t_done=data.timing.loadEventEnd;}
else if(BOOMR.loadedLate){if(w.performance&&w.performance.timing){if(w.performance.timing.loadEventStart&&w.performance.timing.loadEventStart<BOOMR.t_end){t_done=w.performance.timing.loadEventStart;}}
else{t_done=BOOMR.t_lstart||BOOMR.t_start||t_now;}}
return t_done;},setPageLoadTimers:function(ename,t_done,data){var t_resp_start;if(ename!=="xhr"){impl.initFromCookie();impl.initFromNavTiming();if(impl.checkPreRender()){return false;}}
if(ename==="xhr"){if(data&&data.timing){t_resp_start=data.timing.responseStart;}}
else if(impl.responseStart){t_resp_start=impl.responseStart;}
else if(impl.timers.hasOwnProperty("t_page")){BOOMR.plugins.RT.endTimer("t_page");}
else if(impl.t_fb_approx){t_resp_start=impl.t_fb_approx;}
if(t_resp_start){BOOMR.plugins.RT.endTimer("t_resp",t_resp_start);if(impl.timers.t_load){BOOMR.plugins.RT.setTimer("t_page",impl.timers.t_load.end-t_resp_start);}
else{BOOMR.plugins.RT.setTimer("t_page",t_done-t_resp_start);}}
if(impl.timers.hasOwnProperty("t_postrender")){BOOMR.plugins.RT.endTimer("t_postrender");BOOMR.plugins.RT.endTimer("t_prerender");}
return true;},setSupportingTimestamps:function(t_start){if(t_start){BOOMR.addVar("rt.tstart",t_start);}
if(typeof impl.t_start==="number"&&impl.t_start!==t_start){BOOMR.addVar("rt.cstart",impl.t_start);}
BOOMR.addVar("rt.bstart",BOOMR.t_start);if(BOOMR.t_lstart){BOOMR.addVar("rt.blstart",BOOMR.t_lstart);}
BOOMR.addVar("rt.end",impl.timers.t_done.end);},determineTStart:function(ename,data){var t_start;if(ename==="xhr"){if(data&&data.name&&impl.timers[data.name]){t_start=impl.timers[data.name].start;}
else if(data&&data.timing&&data.timing.requestStart){t_start=data.timing.requestStart;}
BOOMR.addVar("rt.start","manual");}
else if(impl.navigationStart){t_start=impl.navigationStart;}
else if(impl.t_start&&impl.navigationType!==2){t_start=impl.t_start;BOOMR.addVar("rt.start","cookie");}
else if(impl.cached_t_start){t_start=impl.cached_t_start;}
else{BOOMR.addVar("rt.start","none");t_start=undefined;}
BOOMR.debug("Got start time: "+t_start,"rt");impl.cached_t_start=t_start;return t_start;},page_ready:function(){this.onloadfired=true;},check_visibility:function(){if(BOOMR.visibilityState()==="visible"){impl.visiblefired=true;}
if(impl.visibilityState==="prerender"&&BOOMR.visibilityState()!=="prerender"){BOOMR.plugins.RT.done(null,"visible");}
impl.visibilityState=BOOMR.visibilityState();},page_unload:function(edata){BOOMR.debug("Unload called with "+BOOMR.utils.objectToString(edata)+" when unloadfired = "+this.unloadfired,"rt");if(!this.unloadfired){BOOMR.plugins.RT.done(edata,"unload");}
this.updateCookie({"r":d.URL},edata.type==="beforeunload"?"ul":"hd");this.unloadfired=true;},_iterable_click:function(name,element,etarget,value_cb){var value;if(!etarget){return;}
BOOMR.debug(name+" called with "+etarget.nodeName,"rt");while(etarget&&etarget.nodeName.toUpperCase()!==element){etarget=etarget.parentNode;}
if(etarget&&etarget.nodeName.toUpperCase()===element){BOOMR.debug("passing through","rt");value=value_cb(etarget);this.updateCookie({"nu":value},"cl");BOOMR.addVar("nu",BOOMR.utils.cleanupURL(value));impl.addedVars.push("nu");}},onclick:function(etarget){impl._iterable_click("Click","A",etarget,function(t){return t.href;});},onsubmit:function(etarget){impl._iterable_click("Submit","FORM",etarget,function(t){var v=t.getAttribute("action")||d.URL||"";return v.match(/\?/)?v:v+"?";});},domloaded:function(){BOOMR.plugins.RT.endTimer("t_domloaded");},clear:function(vars){if(impl.addedVars&&impl.addedVars.length>0){BOOMR.removeVar(impl.addedVars);impl.addedVars=[];}}};BOOMR.plugins.RT={init:function(config){BOOMR.debug("init RT","rt");if(w!==BOOMR.window){w=BOOMR.window;}
d=w.document;BOOMR.utils.pluginConfig(impl,config,"RT",["cookie","cookie_exp","strict_referrer"]);impl.r=impl.r2=BOOMR.utils.hashQueryString(d.referrer,true);impl.initFromCookie();impl.getBoomerangTimings();if(impl.initialized){return this;}
impl.complete=false;impl.timers={};impl.check_visibility();BOOMR.subscribe("page_ready",impl.page_ready,null,impl);BOOMR.subscribe("visibility_changed",impl.check_visibility,null,impl);BOOMR.subscribe("page_ready",this.done,"load",this);BOOMR.subscribe("xhr_load",this.done,"xhr",this);BOOMR.subscribe("dom_loaded",impl.domloaded,null,impl);BOOMR.subscribe("page_unload",impl.page_unload,null,impl);BOOMR.subscribe("click",impl.onclick,null,impl);BOOMR.subscribe("form_submit",impl.onsubmit,null,impl);BOOMR.subscribe("before_beacon",this.addTimersToBeacon,"beacon",this);BOOMR.subscribe("onbeacon",impl.clear,null,impl);impl.initialized=true;return this;},startTimer:function(timer_name,time_value){if(timer_name){if(timer_name==="t_page"){this.endTimer("t_resp",time_value);}
impl.timers[timer_name]={start:(typeof time_value==="number"?time_value:BOOMR.now())};}
return this;},endTimer:function(timer_name,time_value){if(timer_name){impl.timers[timer_name]=impl.timers[timer_name]||{};if(impl.timers[timer_name].end===undefined){impl.timers[timer_name].end=(typeof time_value==="number"?time_value:BOOMR.now());}}
return this;},setTimer:function(timer_name,time_delta){if(timer_name){impl.timers[timer_name]={delta:time_delta};}
return this;},addTimersToBeacon:function(vars,source){var t_name,timer,t_other=[];for(t_name in impl.timers){if(impl.timers.hasOwnProperty(t_name)){timer=impl.timers[t_name];if(typeof timer.delta!=="number"){if(typeof timer.start!=="number"){timer.start=impl.cached_t_start;}
timer.delta=timer.end-timer.start;}
if(isNaN(timer.delta)){continue;}
if(impl.basic_timers.hasOwnProperty(t_name)){BOOMR.addVar(t_name,timer.delta);impl.addedVars.push(t_name);}
else{t_other.push(t_name+"|"+timer.delta);}}}
if(t_other.length){BOOMR.addVar("t_other",t_other.join(","));impl.addedVars.push("t_other");}
if(source==="beacon"){impl.timers={};impl.complete=false;}},done:function(edata,ename){try{BOOMR.debug("Called done with "+BOOMR.utils.objectToString(edata,undefined,1)+", "+ename,"rt");}
catch(err){BOOMR.debug("Called done with "+err+", "+ename,"rt");}
var t_start,t_done,t_now=BOOMR.now(),subresource=false;impl.complete=false;t_done=impl.validateLoadTimestamp(t_now,edata);if(ename==="load"||ename==="visible"||ename==="xhr"){if(!impl.setPageLoadTimers(ename,t_done,edata)){return this;}}
t_start=impl.determineTStart(ename,edata);if(edata&&edata.data){edata=edata.data;}
if(ename==="xhr"&&edata){subresource=edata.subresource;}
this.endTimer("t_done",t_done);BOOMR.removeVar("t_done","t_page","t_resp","t_postrender","t_prerender","t_load","t_other","r","r2","rt.tstart","rt.cstart","rt.bstart","rt.end","rt.subres","rt.abld","http.errno","http.method","xhr.sync");impl.setSupportingTimestamps(t_start);this.addTimersToBeacon();BOOMR.addVar("r",BOOMR.utils.cleanupURL(impl.r));if(impl.r2!==impl.r){BOOMR.addVar("r2",BOOMR.utils.cleanupURL(impl.r2));}
if(ename==="xhr"&&edata){if(edata&&edata.data){edata=edata.data;}}
if(ename==="xhr"&&edata){subresource=edata.subresource;if(edata.url){BOOMR.addVar("u",BOOMR.utils.cleanupURL(edata.url.replace(/#.*/,"")));impl.addedVars.push("u");}
if(edata.status&&(edata.status<-1||edata.status>=400)){BOOMR.addVar("http.errno",edata.status);}
if(edata.method&&edata.method!=="GET"){BOOMR.addVar("http.method",edata.method);}
if(edata.headers){BOOMR.addVar("http.hdr",edata.headers);}
if(edata.synchronous){BOOMR.addVar("xhr.sync",1);}
if(edata.initiator){BOOMR.addVar("http.initiator",edata.initiator);}
impl.addedVars.push("http.errno","http.method","http.hdr","xhr.sync","http.initiator");}
if(subresource){BOOMR.addVar("rt.subres",1);impl.addedVars.push("rt.subres");}
impl.updateCookie();if(ename==="unload"){BOOMR.addVar("rt.quit","");if(!impl.onloadfired){BOOMR.addVar("rt.abld","");}
if(!impl.visiblefired){BOOMR.addVar("rt.ntvu","");}}
impl.complete=true;BOOMR.sendBeacon();return this;},is_complete:function(){return impl.complete;}};}(window));(function(){BOOMR=BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};if(BOOMR.plugins.NavigationTiming){return;}
var impl={complete:false,xhr_done:function(edata){var w=BOOMR.window,res,data={},k;if(!edata){return;}
if(edata.data){edata=edata.data;}
if(edata.url&&w.performance&&w.performance.getEntriesByName){res=w.performance.getEntriesByName(edata.url);if(res&&res.length>0){res=res[0];data={nt_red_st:res.redirectStart,nt_red_end:res.redirectEnd,nt_fet_st:res.fetchStart,nt_dns_st:res.domainLookupStart,nt_dns_end:res.domainLookupEnd,nt_con_st:res.connectStart,nt_con_end:res.connectEnd,nt_req_st:res.requestStart,nt_res_st:res.responseStart,nt_res_end:res.responseEnd};if(res.secureConnectionStart){data.nt_ssl_st=res.secureConnectionStart;}
for(k in data){if(data.hasOwnProperty(k)&&data[k]){data[k]+=w.performance.timing.navigationStart;}}}}
if(edata.timing){res=edata.timing;if(!data.nt_req_st){data.nt_req_st=res.requestStart;}
if(!data.nt_res_st){data.nt_res_st=res.responseStart;}
if(!data.nt_res_end){data.nt_res_end=res.responseEnd;}
data.nt_domint=res.domInteractive;data.nt_domcomp=res.domComplete;data.nt_load_st=res.loadEventEnd;data.nt_load_end=res.loadEventEnd;}
for(k in data){if(data.hasOwnProperty(k)&&!data[k]){delete data[k];}}
BOOMR.addVar(data);try{impl.addedVars.push.apply(impl.addedVars,Object.keys(data));}catch(ignore){}
this.complete=true;BOOMR.sendBeacon();},done:function(){var w=BOOMR.window,p,pn,pt,data;if(this.complete){return this;}
impl.addedVars=[];p=w.performance||w.msPerformance||w.webkitPerformance||w.mozPerformance;if(p&&p.timing&&p.navigation){BOOMR.info("This user agent supports NavigationTiming.","nt");pn=p.navigation;pt=p.timing;data={nt_red_cnt:pn.redirectCount,nt_nav_type:pn.type,nt_nav_st:pt.navigationStart,nt_red_st:pt.redirectStart,nt_red_end:pt.redirectEnd,nt_fet_st:pt.fetchStart,nt_dns_st:pt.domainLookupStart,nt_dns_end:pt.domainLookupEnd,nt_con_st:pt.connectStart,nt_con_end:pt.connectEnd,nt_req_st:pt.requestStart,nt_res_st:pt.responseStart,nt_res_end:pt.responseEnd,nt_domloading:pt.domLoading,nt_domint:pt.domInteractive,nt_domcontloaded_st:pt.domContentLoadedEventStart,nt_domcontloaded_end:pt.domContentLoadedEventEnd,nt_domcomp:pt.domComplete,nt_load_st:pt.loadEventStart,nt_load_end:pt.loadEventEnd,nt_unload_st:pt.unloadEventStart,nt_unload_end:pt.unloadEventEnd};if(pt.secureConnectionStart){data.nt_ssl_st=pt.secureConnectionStart;}
if(pt.msFirstPaint){data.nt_first_paint=pt.msFirstPaint;}
BOOMR.addVar(data);try{impl.addedVars.push.apply(impl.addedVars,Object.keys(data));}catch(ignore){}}
if(w.chrome&&w.chrome.loadTimes){pt=w.chrome.loadTimes();if(pt){data={nt_spdy:(pt.wasFetchedViaSpdy?1:0),nt_cinf:pt.connectionInfo,nt_first_paint:pt.firstPaintTime};BOOMR.addVar(data);try{impl.addedVars.push.apply(impl.addedVars,Object.keys(data));}catch(ignore){}}}
this.complete=true;BOOMR.sendBeacon();},clear:function(vars){if(impl.addedVars&&impl.addedVars.length>0){BOOMR.removeVar(impl.addedVars);impl.addedVars=[];}
this.complete=false;}};BOOMR.plugins.NavigationTiming={init:function(){if(!impl.initialized){BOOMR.subscribe("page_ready",impl.done,null,impl);BOOMR.subscribe("xhr_load",impl.xhr_done,null,impl);BOOMR.subscribe("before_unload",impl.done,null,impl);BOOMR.subscribe("onbeacon",impl.clear,null,impl);impl.initialized=true;}
return this;},is_complete:function(){return impl.complete;}};}());(function(){BOOMR=BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};if(BOOMR.plugins.IstockTiming){return;}
var restricted={redirectStart:"rt_red_st",redirectEnd:"rt_red_end",domainLookupStart:"rt_dns_st",domainLookupEnd:"rt_dns_end",connectStart:"rt_con_st",connectEnd:"rt_con_end",secureConnectionStart:"rt_scon_st",requestStart:"rt_req_st",responseStart:"rt_res_st"},impl={complete:false,targetElements:['img','css'],targetElementsURLContains:undefined,pageType:undefined,done:function(){var p=BOOMR.window.performance,r,data,i,images,firstImageData,lastImageData,pageType=impl.pageType,compImageData;if(impl.complete){return;}
BOOMR.removeVar("istocktiming");if(p&&typeof p.getEntriesByType==="function"){r=p.getEntriesByType("resource");if(r){BOOMR.info("Client supports Resource Timing API","istocktiming");images=[];r.forEach(function(e){if(impl.targetElements.indexOf(e.initiatorType)>-1){if(!impl.targetElementsURLContains||e.name.indexOf(impl.targetElementsURLContains)>-1){images.push(e);}}});function extract(entry){var k;var timings={starttime:entry.startTime,duration:entry.duration,endtime:entry.responseEnd};for(k in restricted){if(restricted.hasOwnProperty(k)&&entry[k]>0){timings[restricted[k]]=entry[k];}}
return timings;};if(images.length>0){if(pageType==='srp'){firstImageData=extract(images[0]);lastImageData=extract(images[images.length-1]);data={it_targeted_num_img:images.length,it_first_img_st:firstImageData.starttime,it_first_img_et:firstImageData.endtime,it_first_img_dur:firstImageData.duration,it_last_img_st:lastImageData.starttime,it_last_img_et:lastImageData.endtime,it_last_img_dur:lastImageData.duration,it_e2e_img_dur:lastImageData.endtime-firstImageData.starttime};}else if(pageType==='adp'){compImageData=extract(images[0]);data={it_comp_img_st:compImageData.starttime,it_comp_img_et:compImageData.endtime,it_comp_img_dur:compImageData.duration};}
BOOMR.addVar(data);}}}
this.complete=true;BOOMR.sendBeacon();}};BOOMR.plugins.IstockTiming={init:function(config){BOOMR.utils.pluginConfig(impl,config,"IstockTiming",['targetElements','targetElementsURLContains','pageType']);BOOMR.subscribe("page_ready",impl.done,null,impl);return this;},is_complete:function(){return impl.complete;}};}());"use strict";var WaveSurfer={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",cursorWidth:1,skipLength:2,minPxPerSec:20,pixelRatio:window.devicePixelRatio,fillParent:!0,scrollParent:!1,hideScrollbar:!1,normalize:!1,audioContext:null,container:null,dragSelection:!0,loopSelection:!0,audioRate:1,interact:!0,splitChannels:!1,renderer:"Canvas",backend:"WebAudio",mediaType:"audio"},init:function(a){if(this.params=WaveSurfer.util.extend({},this.defaultParams,a),this.container="string"==typeof a.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("Container element not found");if(this.mediaContainer="undefined"==typeof this.params.mediaContainer?this.container:"string"==typeof this.params.mediaContainer?document.querySelector(this.params.mediaContainer):this.params.mediaContainer,!this.mediaContainer)throw new Error("Media Container element not found");this.savedVolume=0,this.isMuted=!1,this.tmpEvents=[],this.createDrawer(),this.createBackend()},createDrawer:function(){var a=this;this.drawer=Object.create(WaveSurfer.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){a.drawBuffer(),a.drawer.progress(a.backend.getPlayedPercents())}),this.drawer.on("click",function(b,c){setTimeout(function(){a.seekTo(c)},0)}),this.drawer.on("scroll",function(b){a.fireEvent("scroll",b)})},createBackend:function(){var a=this;this.backend&&this.backend.destroy(),"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend||WaveSurfer.WebAudio.supportsWebAudio()||(this.params.backend="MediaElement"),this.backend=Object.create(WaveSurfer[this.params.backend]),this.backend.init(this.params),this.backend.on("finish",function(){a.fireEvent("finish")}),this.backend.on("audioprocess",function(b){a.fireEvent("audioprocess",b)})},restartAnimationLoop:function(){var a=this,b=window.requestAnimationFrame||window.webkitRequestAnimationFrame,c=function(){a.backend.isPaused()||(a.drawer.progress(a.backend.getPlayedPercents()),b(c))};c()},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(a,b){this.backend.play(a,b),this.restartAnimationLoop(),this.fireEvent("play")},pause:function(){this.backend.pause(),this.fireEvent("pause")},playPause:function(){this.backend.isPaused()?this.play():this.pause()},skipBackward:function(a){this.skip(-a||-this.params.skipLength)},skipForward:function(a){this.skip(a||this.params.skipLength)},skip:function(a){var b=this.getCurrentTime()||0,c=this.getDuration()||1;b=Math.max(0,Math.min(c,b+(a||0))),this.seekAndCenter(b/c)},seekAndCenter:function(a){this.seekTo(a),this.drawer.recenter(a)},seekTo:function(a){var b=this.backend.isPaused(),c=this.params.scrollParent;b&&(this.params.scrollParent=!1),this.backend.seekTo(a*this.getDuration()),this.drawer.progress(this.backend.getPlayedPercents()),b||(this.backend.pause(),this.backend.play()),this.params.scrollParent=c,this.fireEvent("seek",a)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(a){this.backend.setVolume(a)},setPlaybackRate:function(a){this.backend.setPlaybackRate(a)},toggleMute:function(){this.isMuted?(this.backend.setVolume(this.savedVolume),this.isMuted=!1):(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0)},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var a=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),b=this.drawer.getWidth(),c=a;this.params.fillParent&&(!this.params.scrollParent||b>a)&&(c=b);var d=this.backend.getPeaks(c);this.drawer.drawPeaks(d,c),this.fireEvent("redraw",d,c)},loadArrayBuffer:function(a){this.decodeArrayBuffer(a,function(a){this.loadDecodedBuffer(a)}.bind(this))},loadDecodedBuffer:function(a){this.backend.load(a),this.drawBuffer(),this.fireEvent("ready")},loadBlob:function(a){var b=this,c=new FileReader;c.addEventListener("progress",function(a){b.onProgress(a)}),c.addEventListener("load",function(a){b.loadArrayBuffer(a.target.result)}),c.addEventListener("error",function(){b.fireEvent("error","Error reading file")}),c.readAsArrayBuffer(a),this.empty()},load:function(a,b){switch(this.params.backend){case"WebAudio":return this.loadBuffer(a);case"MediaElement":return this.loadMediaElement(a,b)}},loadBuffer:function(a){return this.empty(),this.getArrayBuffer(a,this.loadArrayBuffer.bind(this))},loadMediaElement:function(a,b){this.empty(),this.backend.load(a,this.mediaContainer,b),this.tmpEvents.push(this.backend.once("canplay",function(){this.drawBuffer(),this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(a){this.fireEvent("error",a)}.bind(this))),!b&&this.backend.supportsWebAudio()&&this.getArrayBuffer(a,function(a){this.decodeArrayBuffer(a,function(a){this.backend.buffer=a,this.drawBuffer()}.bind(this))}.bind(this))},decodeArrayBuffer:function(a,b){this.backend.decodeArrayBuffer(a,this.fireEvent.bind(this,"decoded"),this.fireEvent.bind(this,"error","Error decoding audiobuffer")),this.tmpEvents.push(this.once("decoded",b))},getArrayBuffer:function(a,b){var c=this,d=WaveSurfer.util.ajax({url:a,responseType:"arraybuffer"});return this.tmpEvents.push(d.on("progress",function(a){c.onProgress(a)}),d.on("success",b),d.on("error",function(a){c.fireEvent("error","XHR error: "+a.target.statusText)})),d},onProgress:function(a){if(a.lengthComputable)var b=a.loaded/a.total;else b=a.loaded/(a.loaded+1e6);this.fireEvent("loading",Math.round(100*b),a.target)},exportPCM:function(a,b,c){a=a||1024,b=b||1e4,c=c||!1;var d=this.backend.getPeaks(a,b),e=[].map.call(d,function(a){return Math.round(a*b)/b}),f=JSON.stringify(e);return c||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(f)),f},clearTmpEvents:function(){this.tmpEvents.forEach(function(a){a.un()})},empty:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy"),this.clearTmpEvents(),this.unAll(),this.backend.destroy(),this.drawer.destroy()}};WaveSurfer.create=function(a){var b=Object.create(WaveSurfer);return b.init(a),b},WaveSurfer.util={extend:function(a){var b=Array.prototype.slice.call(arguments,1);return b.forEach(function(b){Object.keys(b).forEach(function(c){a[c]=b[c]})}),a},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(a){var b=Object.create(WaveSurfer.Observer),c=new XMLHttpRequest,d=!1;return c.open(a.method||"GET",a.url,!0),c.responseType=a.responseType||"json",c.addEventListener("progress",function(a){b.fireEvent("progress",a),a.lengthComputable&&a.loaded==a.total&&(d=!0)}),c.addEventListener("load",function(a){d||b.fireEvent("progress",a),b.fireEvent("load",a),200==c.status||206==c.status?b.fireEvent("success",c.response,a):b.fireEvent("error",a)}),c.addEventListener("error",function(a){b.fireEvent("error",a)}),c.send(),b.xhr=c,b}},WaveSurfer.Observer={on:function(a,b){this.handlers||(this.handlers={});var c=this.handlers[a];return c||(c=this.handlers[a]=[]),c.push(b),{name:a,callback:b,un:this.un.bind(this,a,b)}},un:function(a,b){if(this.handlers){var c=this.handlers[a];if(c)if(b)for(var d=c.length-1;d>=0;d--)c[d]==b&&c.splice(d,1);else c.length=0}},unAll:function(){this.handlers=null},once:function(a,b){var c=this,d=function(){b.apply(this,arguments),setTimeout(function(){c.un(a,d)},0)};return this.on(a,d)},fireEvent:function(a){if(this.handlers){var b=this.handlers[a],c=Array.prototype.slice.call(arguments,1);b&&b.forEach(function(a){a.apply(null,c)})}}},WaveSurfer.util.extend(WaveSurfer,WaveSurfer.Observer),WaveSurfer.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!(!window.AudioContext&&!window.webkitAudioContext)},getAudioContext:function(){return WaveSurfer.WebAudio.audioContext||(WaveSurfer.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),WaveSurfer.WebAudio.audioContext},getOfflineAudioContext:function(a){return WaveSurfer.WebAudio.offlineAudioContext||(WaveSurfer.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,a)),WaveSurfer.WebAudio.offlineAudioContext},init:function(a){this.params=a,this.ac=a.audioContext||this.getAudioContext(),this.lastPlay=this.ac.currentTime,this.startPosition=0,this.scheduledPause=null,this.states=[Object.create(WaveSurfer.WebAudio.state.playing),Object.create(WaveSurfer.WebAudio.state.paused),Object.create(WaveSurfer.WebAudio.state.finished)],this.setState(this.PAUSED_STATE),this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setPlaybackRate(this.params.audioRate)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(a){a&&a.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))},setState:function(a){this.state!==this.states[a]&&(this.state=this.states[a],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(a){this.disconnectFilters(),a&&a.length&&(this.filters=a,this.analyser.disconnect(),a.reduce(function(a,b){return a.connect(b),b},this.analyser).connect(this.gainNode))},createScriptNode:function(){var a=this,b=this.scriptBufferSize;this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(b):this.ac.createJavaScriptNode(b),this.scriptNode.connect(this.ac.destination),this.scriptNode.onaudioprocess=function(){var b=a.getCurrentTime();a.buffer&&b>a.getDuration()?a.setState(a.FINISHED_STATE):a.buffer&&b>=a.scheduledPause?a.setState(a.PAUSED_STATE):a.state===a.states[a.PLAYING_STATE]&&a.fireEvent("audioprocess",b)}},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(a){this.gainNode.gain.value=a},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(a,b,c){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(a,function(a){b(a)}.bind(this),c)},getPeaks:function(a){for(var b=this.buffer.length/a,c=~~(b/10)||1,d=this.buffer.numberOfChannels,e=[],f=[],g=0;d>g;g++)for(var h=e[g]=[],i=this.buffer.getChannelData(g),j=0;a>j;j++){for(var k=~~(j*b),l=~~(k+b),m=0,n=k;l>n;n+=c){var o=i[n];o>m?m=o:-o>m&&(m=-o)}h[j]=m,(0==g||m>f[j])&&(f[j]=m)}return this.params.splitChannels?e:f},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},destroy:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect()},load:function(a){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=a,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return this.buffer?this.buffer.duration:0},seekTo:function(a,b){return this.scheduledPause=null,null==a&&(a=this.getCurrentTime(),a>=this.getDuration()&&(a=0)),null==b&&(b=this.getDuration()),this.startPosition=a,this.lastPlay=this.ac.currentTime,this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:a,end:b}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(a,b){this.createSource();var c=this.seekTo(a,b);a=c.start,b=c.end,this.scheduledPause=b,this.source.start(0,a,b-a),this.setState(this.PLAYING_STATE)},pause:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(this.PAUSED_STATE)},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},setPlaybackRate:function(a){a=a||1,this.isPaused()?this.playbackRate=a:(this.pause(),this.playbackRate=a,this.play())}},WaveSurfer.WebAudio.state={},WaveSurfer.WebAudio.state.playing={init:function(){},getPlayedPercents:function(){var a=this.getDuration();return this.getCurrentTime()/a||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}},WaveSurfer.WebAudio.state.paused={init:function(){},getPlayedPercents:function(){var a=this.getDuration();return this.getCurrentTime()/a||0},getCurrentTime:function(){return this.startPosition}},WaveSurfer.WebAudio.state.finished={init:function(){this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}},WaveSurfer.util.extend(WaveSurfer.WebAudio,WaveSurfer.Observer),WaveSurfer.MediaElement=Object.create(WaveSurfer.WebAudio),WaveSurfer.util.extend(WaveSurfer.MediaElement,{init:function(a){this.params=a,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},this.mediaType=a.mediaType.toLowerCase(),this.elementPosition=a.elementPosition},load:function(a,b,c){var d=this,e=document.createElement(this.mediaType);e.controls=!1,e.autoplay=!1,e.preload="auto",e.src=a,e.addEventListener("error",function(){d.fireEvent("error","Error loading media element")}),e.addEventListener("canplay",function(){d.fireEvent("canplay")}),e.addEventListener("ended",function(){d.fireEvent("finish")}),e.addEventListener("timeupdate",function(){d.fireEvent("audioprocess",d.getCurrentTime())});var f=b.querySelector(this.mediaType);f&&b.removeChild(f),b.appendChild(e),this.media=e,this.peaks=c,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate)},isPaused:function(){return this.media.paused},getDuration:function(){var a=this.media.duration;return a>=1/0&&(a=this.media.seekable.end()),a},getCurrentTime:function(){return this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},setPlaybackRate:function(a){this.playbackRate=a||1,this.media.playbackRate=this.playbackRate},seekTo:function(a){null!=a&&(this.media.currentTime=a),this.clearPlayEnd()},play:function(a,b){this.seekTo(a),this.media.play(),b&&this.setPlayEnd(b)},pause:function(){this.media.pause(),this.clearPlayEnd()},setPlayEnd:function(a){var b=this;this.onPlayEnd=function(c){c>=a&&(b.pause(),b.seekTo(a))},this.on("audioprocess",this.onPlayEnd)},clearPlayEnd:function(){this.onPlayEnd&&(this.un("audioprocess",this.onPlayEnd),this.onPlayEnd=null)},getPeaks:function(a){return this.buffer?WaveSurfer.WebAudio.getPeaks.call(this,a):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(a){this.media.volume=a},destroy:function(){this.pause(),this.unAll(),this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}),WaveSurfer.AudioElement=WaveSurfer.MediaElement,WaveSurfer.Drawer={init:function(a,b){this.container=a,this.params=b,this.width=0,this.height=b.height*this.params.pixelRatio,this.lastPos=0,this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(a){a.preventDefault();var b=this.wrapper.getBoundingClientRect();return(a.clientX-b.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0},setupWrapperEvents:function(){var a=this;this.wrapper.addEventListener("click",function(b){var c=a.wrapper.offsetHeight-a.wrapper.clientHeight;if(0!=c){var d=a.wrapper.getBoundingClientRect();if(b.clientY>=d.bottom-c)return}a.params.interact&&a.fireEvent("click",b,a.handleEvent(b))}),this.wrapper.addEventListener("scroll",function(b){a.fireEvent("scroll",b)})},drawPeaks:function(a,b){this.resetScroll(),this.setWidth(b),this.drawWave(a)},style:function(a,b){return Object.keys(b).forEach(function(c){a.style[c]!=b[c]&&(a.style[c]=b[c])}),a},resetScroll:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)},recenter:function(a){var b=this.wrapper.scrollWidth*a;this.recenterOnPosition(b,!0)},recenterOnPosition:function(a,b){var c=this.wrapper.scrollLeft,d=~~(this.wrapper.clientWidth/2),e=a-d,f=e-c,g=this.wrapper.scrollWidth-this.wrapper.clientWidth;if(0!=g){if(!b&&f>=-d&&d>f){var h=5;f=Math.max(-h,Math.min(h,f)),e=c+f}e=Math.max(0,Math.min(g,e)),e!=c&&(this.wrapper.scrollLeft=e)}},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(a){a!=this.width&&(this.width=a,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize())},setHeight:function(a){a!=this.height&&(this.height=a,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize())},progress:function(a){var b=1/this.params.pixelRatio,c=Math.round(a*this.width)*b;if(c<this.lastPos||c-this.lastPos>=b){if(this.lastPos=c,this.params.scrollParent){var d=~~(this.wrapper.scrollWidth*a);this.recenterOnPosition(d)}this.updateProgress(a)}},destroy:function(){this.unAll(),this.wrapper&&(this.container.removeChild(this.wrapper),this.wrapper=null)},createElements:function(){},updateSize:function(){},drawWave:function(){},clearWave:function(){},updateProgress:function(){}},WaveSurfer.util.extend(WaveSurfer.Drawer,WaveSurfer.Observer),WaveSurfer.Drawer.Canvas=Object.create(WaveSurfer.Drawer),WaveSurfer.util.extend(WaveSurfer.Drawer.Canvas,{createElements:function(){var a=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,top:0,bottom:0}));if(this.waveCc=a.getContext("2d"),this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.params.waveColor!=this.params.progressColor){var b=this.progressWave.appendChild(document.createElement("canvas"));this.progressCc=b.getContext("2d")}},updateSize:function(){var a=Math.round(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width,this.waveCc.canvas.height=this.height,this.style(this.waveCc.canvas,{width:a+"px"}),this.style(this.progressWave,{display:"block"}),this.progressCc&&(this.progressCc.canvas.width=this.width,this.progressCc.canvas.height=this.height,this.style(this.progressCc.canvas,{width:a+"px"})),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc&&this.progressCc.clearRect(0,0,this.width,this.height)},drawWave:function(a,b){if(a[0]instanceof Array){var c=a;if(this.params.splitChannels)return this.setHeight(c.length*this.params.height*this.params.pixelRatio),void c.forEach(this.drawWave,this);a=c[0]}var d=.5/this.params.pixelRatio,e=this.params.height*this.params.pixelRatio,f=e*b||0,g=e/2,h=a.length,i=1;this.params.fillParent&&this.width!=h&&(i=this.width/h);var j=1;this.params.normalize&&(j=Math.max.apply(Math,a)),this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(b){if(b){b.beginPath(),b.moveTo(d,g+f);for(var c=0;h>c;c++){var e=Math.round(a[c]/j*g);b.lineTo(c*i+d,g+e+f)}b.lineTo(this.width+d,g+f),b.moveTo(d,g+f);for(var c=0;h>c;c++){var e=Math.round(a[c]/j*g);b.lineTo(c*i+d,g-e+f)}b.lineTo(this.width+d,g+f),b.closePath(),b.fill(),b.fillRect(0,g+f-d,this.width,d)}},this)},updateProgress:function(a){var b=Math.round(this.width*a)/this.params.pixelRatio;this.style(this.progressWave,{width:b+"px"})}});'use strict';var StackBlur=(function(){var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function stackBlurImage(imageID,canvasID,radius,blurAlphaChannel){var img,w,h,canvas;if(typeof img==='string'){img=document.getElementById(imageID);}else{img=imageID;}
w=img.width;h=img.height;if(typeof canvas==='string'){canvas=document.getElementById(canvasID);}else{canvas=canvasID;}
canvas.style.width=w+"px";canvas.style.height=h+"px";canvas.width=w;canvas.height=h;var context=canvas.getContext("2d");context.clearRect(0,0,w,h);context.drawImage(img,0,0,w,h);if(isNaN(radius)||radius<1)return;if(blurAlphaChannel)
stackBlurCanvasRGBA(canvasID,0,0,w,h,radius);else
stackBlurCanvasRGB(canvasID,0,0,w,h,radius);}
function stackBlurCanvasRGBA(id,top_x,top_y,width,height,radius){var canvas;if(isNaN(radius)||radius<1)return;radius|=0;if(typeof canvas==='string'){canvas=document.getElementById(id);}else{canvas=id;}
var context=canvas.getContext("2d");var imageData;try{try{imageData=context.getImageData(top_x,top_y,width,height);}catch(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");imageData=context.getImageData(top_x,top_y,width,height);}catch(e){throw new Error("unable to access local image data: "+e);return;}}}catch(e){throw new Error("unable to access image data: "+e);}
var pixels=imageData.data;var x,y,i,p,yp,yi,yw,r_sum,g_sum,b_sum,a_sum,r_out_sum,g_out_sum,b_out_sum,a_out_sum,r_in_sum,g_in_sum,b_in_sum,a_in_sum,pr,pg,pb,pa,rbs;var div=radius+radius+1;var w4=width<<2;var widthMinus1=width-1;var heightMinus1=height-1;var radiusPlus1=radius+1;var sumFactor=radiusPlus1*(radiusPlus1+1)/2;var stackStart=new BlurStack();var stack=stackStart;for(i=1;i<div;i++){stack=stack.next=new BlurStack();if(i==radiusPlus1)var stackEnd=stack;}
stack.next=stackStart;var stackIn=null;var stackOut=null;yw=yi=0;var mul_sum=mul_table[radius];var shg_sum=shg_table[radius];for(y=0;y<height;y++){r_in_sum=g_in_sum=b_in_sum=a_in_sum=r_sum=g_sum=b_sum=a_sum=0;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);a_out_sum=radiusPlus1*(pa=pixels[yi+3]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;a_sum+=sumFactor*pa;stack=stackStart;for(i=0;i<radiusPlus1;i++){stack.r=pr;stack.g=pg;stack.b=pb;stack.a=pa;stack=stack.next;}
for(i=1;i<radiusPlus1;i++){p=yi+((widthMinus1<i?widthMinus1:i)<<2);r_sum+=(stack.r=(pr=pixels[p]))*(rbs=radiusPlus1-i);g_sum+=(stack.g=(pg=pixels[p+1]))*rbs;b_sum+=(stack.b=(pb=pixels[p+2]))*rbs;a_sum+=(stack.a=(pa=pixels[p+3]))*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;a_in_sum+=pa;stack=stack.next;}
stackIn=stackStart;stackOut=stackEnd;for(x=0;x<width;x++){pixels[yi+3]=pa=(a_sum*mul_sum)>>shg_sum;if(pa!=0){pa=255/pa;pixels[yi]=((r_sum*mul_sum)>>shg_sum)*pa;pixels[yi+1]=((g_sum*mul_sum)>>shg_sum)*pa;pixels[yi+2]=((b_sum*mul_sum)>>shg_sum)*pa;}else{pixels[yi]=pixels[yi+1]=pixels[yi+2]=0;}
r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;a_sum-=a_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;a_out_sum-=stackIn.a;p=(yw+((p=x+radius+1)<widthMinus1?p:widthMinus1))<<2;r_in_sum+=(stackIn.r=pixels[p]);g_in_sum+=(stackIn.g=pixels[p+1]);b_in_sum+=(stackIn.b=pixels[p+2]);a_in_sum+=(stackIn.a=pixels[p+3]);r_sum+=r_in_sum;g_sum+=g_in_sum;b_sum+=b_in_sum;a_sum+=a_in_sum;stackIn=stackIn.next;r_out_sum+=(pr=stackOut.r);g_out_sum+=(pg=stackOut.g);b_out_sum+=(pb=stackOut.b);a_out_sum+=(pa=stackOut.a);r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;a_in_sum-=pa;stackOut=stackOut.next;yi+=4;}
yw+=width;}
for(x=0;x<width;x++){g_in_sum=b_in_sum=a_in_sum=r_in_sum=g_sum=b_sum=a_sum=r_sum=0;yi=x<<2;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);a_out_sum=radiusPlus1*(pa=pixels[yi+3]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;a_sum+=sumFactor*pa;stack=stackStart;for(i=0;i<radiusPlus1;i++){stack.r=pr;stack.g=pg;stack.b=pb;stack.a=pa;stack=stack.next;}
yp=width;for(i=1;i<=radius;i++){yi=(yp+x)<<2;r_sum+=(stack.r=(pr=pixels[yi]))*(rbs=radiusPlus1-i);g_sum+=(stack.g=(pg=pixels[yi+1]))*rbs;b_sum+=(stack.b=(pb=pixels[yi+2]))*rbs;a_sum+=(stack.a=(pa=pixels[yi+3]))*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;a_in_sum+=pa;stack=stack.next;if(i<heightMinus1){yp+=width;}}
yi=x;stackIn=stackStart;stackOut=stackEnd;for(y=0;y<height;y++){p=yi<<2;pixels[p+3]=pa=(a_sum*mul_sum)>>shg_sum;if(pa>0){pa=255/pa;pixels[p]=((r_sum*mul_sum)>>shg_sum)*pa;pixels[p+1]=((g_sum*mul_sum)>>shg_sum)*pa;pixels[p+2]=((b_sum*mul_sum)>>shg_sum)*pa;}else{pixels[p]=pixels[p+1]=pixels[p+2]=0;}
r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;a_sum-=a_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;a_out_sum-=stackIn.a;p=(x+(((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width))<<2;r_sum+=(r_in_sum+=(stackIn.r=pixels[p]));g_sum+=(g_in_sum+=(stackIn.g=pixels[p+1]));b_sum+=(b_in_sum+=(stackIn.b=pixels[p+2]));a_sum+=(a_in_sum+=(stackIn.a=pixels[p+3]));stackIn=stackIn.next;r_out_sum+=(pr=stackOut.r);g_out_sum+=(pg=stackOut.g);b_out_sum+=(pb=stackOut.b);a_out_sum+=(pa=stackOut.a);r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;a_in_sum-=pa;stackOut=stackOut.next;yi+=width;}}
context.putImageData(imageData,top_x,top_y);}
function stackBlurCanvasRGB(id,top_x,top_y,width,height,radius){var canvas;if(isNaN(radius)||radius<1)return;radius|=0;if(typeof canvas==='string'){canvas=document.getElementById(id);}else{canvas=id;}
var context=canvas.getContext("2d");var imageData;try{try{imageData=context.getImageData(top_x,top_y,width,height);}catch(e){throw new Error("unable to access local image data: "+e);return;}}catch(e){throw new Error("unable to access image data: "+e);}
var pixels=imageData.data;var x,y,i,p,yp,yi,yw,r_sum,g_sum,b_sum,r_out_sum,g_out_sum,b_out_sum,r_in_sum,g_in_sum,b_in_sum,pr,pg,pb,rbs;var div=radius+radius+1;var w4=width<<2;var widthMinus1=width-1;var heightMinus1=height-1;var radiusPlus1=radius+1;var sumFactor=radiusPlus1*(radiusPlus1+1)/2;var stackStart=new BlurStack();var stack=stackStart;for(i=1;i<div;i++){stack=stack.next=new BlurStack();if(i==radiusPlus1)var stackEnd=stack;}
stack.next=stackStart;var stackIn=null;var stackOut=null;yw=yi=0;var mul_sum=mul_table[radius];var shg_sum=shg_table[radius];for(y=0;y<height;y++){r_in_sum=g_in_sum=b_in_sum=r_sum=g_sum=b_sum=0;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;stack=stackStart;for(i=0;i<radiusPlus1;i++){stack.r=pr;stack.g=pg;stack.b=pb;stack=stack.next;}
for(i=1;i<radiusPlus1;i++){p=yi+((widthMinus1<i?widthMinus1:i)<<2);r_sum+=(stack.r=(pr=pixels[p]))*(rbs=radiusPlus1-i);g_sum+=(stack.g=(pg=pixels[p+1]))*rbs;b_sum+=(stack.b=(pb=pixels[p+2]))*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;stack=stack.next;}
stackIn=stackStart;stackOut=stackEnd;for(x=0;x<width;x++){pixels[yi]=(r_sum*mul_sum)>>shg_sum;pixels[yi+1]=(g_sum*mul_sum)>>shg_sum;pixels[yi+2]=(b_sum*mul_sum)>>shg_sum;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;p=(yw+((p=x+radius+1)<widthMinus1?p:widthMinus1))<<2;r_in_sum+=(stackIn.r=pixels[p]);g_in_sum+=(stackIn.g=pixels[p+1]);b_in_sum+=(stackIn.b=pixels[p+2]);r_sum+=r_in_sum;g_sum+=g_in_sum;b_sum+=b_in_sum;stackIn=stackIn.next;r_out_sum+=(pr=stackOut.r);g_out_sum+=(pg=stackOut.g);b_out_sum+=(pb=stackOut.b);r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;stackOut=stackOut.next;yi+=4;}
yw+=width;}
for(x=0;x<width;x++){g_in_sum=b_in_sum=r_in_sum=g_sum=b_sum=r_sum=0;yi=x<<2;r_out_sum=radiusPlus1*(pr=pixels[yi]);g_out_sum=radiusPlus1*(pg=pixels[yi+1]);b_out_sum=radiusPlus1*(pb=pixels[yi+2]);r_sum+=sumFactor*pr;g_sum+=sumFactor*pg;b_sum+=sumFactor*pb;stack=stackStart;for(i=0;i<radiusPlus1;i++){stack.r=pr;stack.g=pg;stack.b=pb;stack=stack.next;}
yp=width;for(i=1;i<=radius;i++){yi=(yp+x)<<2;r_sum+=(stack.r=(pr=pixels[yi]))*(rbs=radiusPlus1-i);g_sum+=(stack.g=(pg=pixels[yi+1]))*rbs;b_sum+=(stack.b=(pb=pixels[yi+2]))*rbs;r_in_sum+=pr;g_in_sum+=pg;b_in_sum+=pb;stack=stack.next;if(i<heightMinus1){yp+=width;}}
yi=x;stackIn=stackStart;stackOut=stackEnd;for(y=0;y<height;y++){p=yi<<2;pixels[p]=(r_sum*mul_sum)>>shg_sum;pixels[p+1]=(g_sum*mul_sum)>>shg_sum;pixels[p+2]=(b_sum*mul_sum)>>shg_sum;r_sum-=r_out_sum;g_sum-=g_out_sum;b_sum-=b_out_sum;r_out_sum-=stackIn.r;g_out_sum-=stackIn.g;b_out_sum-=stackIn.b;p=(x+(((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width))<<2;r_sum+=(r_in_sum+=(stackIn.r=pixels[p]));g_sum+=(g_in_sum+=(stackIn.g=pixels[p+1]));b_sum+=(b_in_sum+=(stackIn.b=pixels[p+2]));stackIn=stackIn.next;r_out_sum+=(pr=stackOut.r);g_out_sum+=(pg=stackOut.g);b_out_sum+=(pb=stackOut.b);r_in_sum-=pr;g_in_sum-=pg;b_in_sum-=pb;stackOut=stackOut.next;yi+=width;}}
context.putImageData(imageData,top_x,top_y);}
function BlurStack(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null;}
return{stackBlurImage:stackBlurImage,stackBlurCanvasRGBA:stackBlurCanvasRGBA,stackBlurCanvasRGB:stackBlurCanvasRGB}})();(function(){'use strict';var APP='default';angular.module(APP,['ngRoute','ngSanitize','ngAnimate','isLocalization','angular-locker','common.services','common.directives','common.constants','common.filters']);}());(function(){'use strict';var APP='defaultHTML5';angular.module(APP,['ngRoute','ngSanitize','isLocalization','angular-locker','common.services','common.directives','common.constants','common.filters']).config(function($locationProvider){$locationProvider.html5Mode(true);});}());