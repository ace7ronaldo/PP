
(function($,undef)
{if($.fn.dotdotdot)
{return;}
$.fn.dotdotdot=function(o)
{if(this.length==0)
{$.fn.dotdotdot.debug('No element found for "'+this.selector+'".');return this;}
if(this.length>1)
{return this.each(function()
{$(this).dotdotdot(o);});}
var $dot=this;if($dot.data('dotdotdot'))
{$dot.trigger('destroy.dot');}
$dot.data('dotdotdot-style',$dot.attr('style')||'');$dot.css('word-wrap','break-word');if($dot.css('white-space')==='nowrap')
{$dot.css('white-space','normal');}
$dot.bind_events=function()
{$dot.bind('update.dot',function(e,c)
{e.preventDefault();e.stopPropagation();opts.maxHeight=(typeof opts.height=='number')?opts.height:getTrueInnerHeight($dot);opts.maxHeight+=opts.tolerance;if(typeof c!='undefined')
{if(typeof c=='string'||('nodeType'in c&&c.nodeType===1))
{c=$('<div />').append(c).contents();}
if(c instanceof $)
{orgContent=c;}}
$inr=$dot.wrapInner('<div class="dotdotdot" />').children();$inr.contents().detach().end().append(orgContent.clone(true)).find('br').replaceWith('  <br />  ').end().css({'height':'auto','width':'auto','border':'none','padding':0,'margin':0});var after=false,trunc=false;if(conf.afterElement)
{after=conf.afterElement.clone(true);after.show();conf.afterElement.detach();}
if(test($inr,opts))
{if(opts.wrap=='children')
{trunc=children($inr,opts,after);}
else
{trunc=ellipsis($inr,$dot,$inr,opts,after);}}
$inr.replaceWith($inr.contents());$inr=null;if($.isFunction(opts.callback))
{opts.callback.call($dot[0],trunc,orgContent);}
conf.isTruncated=trunc;return trunc;}).bind('isTruncated.dot',function(e,fn)
{e.preventDefault();e.stopPropagation();if(typeof fn=='function')
{fn.call($dot[0],conf.isTruncated);}
return conf.isTruncated;}).bind('originalContent.dot',function(e,fn)
{e.preventDefault();e.stopPropagation();if(typeof fn=='function')
{fn.call($dot[0],orgContent);}
return orgContent;}).bind('destroy.dot',function(e)
{e.preventDefault();e.stopPropagation();$dot.unwatch().unbind_events().contents().detach().end().append(orgContent).attr('style',$dot.data('dotdotdot-style')||'').data('dotdotdot',false);});return $dot;};$dot.unbind_events=function()
{$dot.unbind('.dot');return $dot;};$dot.watch=function()
{$dot.unwatch();if(opts.watch=='window')
{var $window=$(window),_wWidth=$window.width(),_wHeight=$window.height();$window.bind('resize.dot'+conf.dotId,function()
{if(_wWidth!=$window.width()||_wHeight!=$window.height()||!opts.windowResizeFix)
{_wWidth=$window.width();_wHeight=$window.height();if(watchInt)
{clearInterval(watchInt);}
watchInt=setTimeout(function()
{$dot.trigger('update.dot');},100);}});}
else
{watchOrg=getSizes($dot);watchInt=setInterval(function()
{if($dot.is(':visible'))
{var watchNew=getSizes($dot);if(watchOrg.width!=watchNew.width||watchOrg.height!=watchNew.height)
{$dot.trigger('update.dot');watchOrg=watchNew;}}},500);}
return $dot;};$dot.unwatch=function()
{$(window).unbind('resize.dot'+conf.dotId);if(watchInt)
{clearInterval(watchInt);}
return $dot;};var orgContent=$dot.contents(),opts=$.extend(true,{},$.fn.dotdotdot.defaults,o),conf={},watchOrg={},watchInt=null,$inr=null;if(!(opts.lastCharacter.remove instanceof Array))
{opts.lastCharacter.remove=$.fn.dotdotdot.defaultArrays.lastCharacter.remove;}
if(!(opts.lastCharacter.noEllipsis instanceof Array))
{opts.lastCharacter.noEllipsis=$.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis;}
conf.afterElement=getElement(opts.after,$dot);conf.isTruncated=false;conf.dotId=dotId++;$dot.data('dotdotdot',true).bind_events().trigger('update.dot');if(opts.watch)
{$dot.watch();}
return $dot;};$.fn.dotdotdot.defaults={'ellipsis':'... ','wrap':'word','fallbackToLetter':true,'lastCharacter':{},'tolerance':0,'callback':null,'after':null,'height':null,'watch':false,'windowResizeFix':true};$.fn.dotdotdot.defaultArrays={'lastCharacter':{'remove':[' ','\u3000',',',';','.','!','?'],'noEllipsis':[]}};$.fn.dotdotdot.debug=function(msg){};var dotId=1;function children($elem,o,after)
{var $elements=$elem.children(),isTruncated=false;$elem.empty();for(var a=0,l=$elements.length;a<l;a++)
{var $e=$elements.eq(a);$elem.append($e);if(after)
{$elem.append(after);}
if(test($elem,o))
{$e.remove();isTruncated=true;break;}
else
{if(after)
{after.detach();}}}
return isTruncated;}
function ellipsis($elem,$d,$i,o,after)
{var isTruncated=false;var notx='a table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style';var noty='script, .dotdotdot-keep';$elem.contents().detach().each(function()
{var e=this,$e=$(e);if(typeof e=='undefined'||(e.nodeType==3&&$.trim(e.data).length==0))
{return true;}
else if($e.is(noty))
{$elem.append($e);}
else if(isTruncated)
{return true;}
else
{$elem.append($e);if(after&&!$e.is(o.after)&&!$e.find(o.after).length)
{$elem[$elem.is(notx)?'after':'append'](after);}
if(test($i,o))
{if(e.nodeType==3)
{isTruncated=ellipsisElement($e,$d,$i,o,after);}
else
{isTruncated=ellipsis($e,$d,$i,o,after);}
if(!isTruncated)
{$e.detach();isTruncated=true;}}
if(!isTruncated)
{if(after)
{after.detach();}}}});return isTruncated;}
function ellipsisElement($e,$d,$i,o,after)
{var e=$e[0];if(!e)
{return false;}
var txt=getTextContent(e),space=(txt.indexOf(' ')!==-1)?' ':'\u3000',separator=(o.wrap=='letter')?'':space,textArr=txt.split(separator),position=-1,midPos=-1,startPos=0,endPos=textArr.length-1;if(o.fallbackToLetter&&startPos==0&&endPos==0)
{separator='';textArr=txt.split(separator);endPos=textArr.length-1;}
while(startPos<=endPos&&!(startPos==0&&endPos==0))
{var m=Math.floor((startPos+endPos)/2);if(m==midPos)
{break;}
midPos=m;setTextContent(e,textArr.slice(0,midPos+1).join(separator)+o.ellipsis);if(!test($i,o))
{position=midPos;startPos=midPos;}
else
{endPos=midPos;if(o.fallbackToLetter&&startPos==0&&endPos==0)
{separator='';textArr=textArr[0].split(separator);position=-1;midPos=-1;startPos=0;endPos=textArr.length-1;}}}
if(position!=-1&&!(textArr.length==1&&textArr[0].length==0))
{txt=addEllipsis(textArr.slice(0,position+1).join(separator),o);setTextContent(e,txt);}
else
{var $w=$e.parent();$e.detach();var afterLength=(after&&after.closest($w).length)?after.length:0;if($w.contents().length>afterLength)
{e=findLastTextNode($w.contents().eq(-1-afterLength),$d);}
else
{e=findLastTextNode($w,$d,true);if(!afterLength)
{$w.detach();}}
if(e)
{txt=addEllipsis(getTextContent(e),o);setTextContent(e,txt);if(afterLength&&after)
{$(e).parent().append(after);}}}
return true;}
function test($i,o)
{return $i.innerHeight()>o.maxHeight;}
function addEllipsis(txt,o)
{while($.inArray(txt.slice(-1),o.lastCharacter.remove)>-1)
{txt=txt.slice(0,-1);}
if($.inArray(txt.slice(-1),o.lastCharacter.noEllipsis)<0)
{txt+=o.ellipsis;}
return txt;}
function getSizes($d)
{return{'width':$d.innerWidth(),'height':$d.innerHeight()};}
function setTextContent(e,content)
{if(e.innerText)
{e.innerText=content;}
else if(e.nodeValue)
{e.nodeValue=content;}
else if(e.textContent)
{e.textContent=content;}}
function getTextContent(e)
{if(e.innerText)
{return e.innerText;}
else if(e.nodeValue)
{return e.nodeValue;}
else if(e.textContent)
{return e.textContent;}
else
{return"";}}
function getPrevNode(n)
{do
{n=n.previousSibling;}
while(n&&n.nodeType!==1&&n.nodeType!==3);return n;}
function findLastTextNode($el,$top,excludeCurrent)
{var e=$el&&$el[0],p;if(e)
{if(!excludeCurrent)
{if(e.nodeType===3)
{return e;}
if($.trim($el.text()))
{return findLastTextNode($el.contents().last(),$top);}}
p=getPrevNode(e);while(!p)
{$el=$el.parent();if($el.is($top)||!$el.length)
{return false;}
p=getPrevNode($el[0]);}
if(p)
{return findLastTextNode($(p),$top);}}
return false;}
function getElement(e,$i)
{if(!e)
{return false;}
if(typeof e==='string')
{e=$(e,$i);return(e.length)?e:false;}
return!e.jquery?false:e;}
function getTrueInnerHeight($el)
{var h=$el.innerHeight(),a=['paddingTop','paddingBottom'];for(var z=0,l=a.length;z<l;z++)
{var m=parseInt($el.css(a[z]),10);if(isNaN(m))
{m=0;}
h-=m;}
return h;}
var _orgHtml=$.fn.html;$.fn.html=function(str)
{if(str!=undef&&!$.isFunction(str)&&this.data('dotdotdot'))
{return this.trigger('update',[str]);}
return _orgHtml.apply(this,arguments);};var _orgText=$.fn.text;$.fn.text=function(str)
{if(str!=undef&&!$.isFunction(str)&&this.data('dotdotdot'))
{str=$('<div />').text(str).html();return this.trigger('update',[str]);}
return _orgText.apply(this,arguments);};})(jQuery);(function(){'use strict';angular.module('adp.controllers',[]);})();(function(){'use strict';angular.module('adp.services',['restangular']).config(['RestangularProvider',function(RestangularProvider){RestangularProvider.setBaseUrl(istock.restUrl);RestangularProvider.setDefaultHeaders({'Content-Type':'application/json'});RestangularProvider.setResponseExtractor(function(response){if(response.data&&response.status){return response.data;}
return response;});}]);}());(function(){'use strict';angular.module('adp.directives',[]);})();(function(){'use strict';angular.module('adp.filters',[]);})();(function(){'use strict';angular.module('adp.constants',[]);})();(function(){'use strict';var APP='adp',APP_PATH='js/angular/apps/'+APP+'/';(function(){var index,url=window.location.href,urlEncoded;index=url.indexOf('#');if(index>0){url=url.substring(0,index);}
urlEncoded=encodeURI(decodeURI(url));if(url!==urlEncoded&&!(/prerender=true/.test(url))){window.location=urlEncoded;}else if(/#!$/.test(window.location.href)){if('history'in window&&'pushState'in history){history.pushState('',document.title,window.location.pathname);}else{window.location=url;}}}());angular.module(APP,['ngRoute','ngAnimate','ngCookies','mm.foundation','ngTouch','ipCookie','angular-locker','restangular','ngSanitize','isLocalization','common.services','common.directives','common.controllers','common.constants','common.filters',APP+'.controllers',APP+'.directives',APP+'.filters',APP+'.services',APP+'.constants']).config(['$routeProvider','$sceDelegateProvider','url','siteLang','isLocalizeProvider','translations','RestangularProvider','$locationProvider','lockerProvider',function($routeProvider,$sce,url,siteLang,isLocalizeProvider,translations,RestangularProvider,$loc,lockerProvider){var partialsPath=['/static/',APP_PATH,'partials'].join(''),whitelist=[/(?:http(?:s)?:\/\/)?(?:.*)(istock)(img|photo)\.com(.*)?/,istock.restUrl,'self'],cache={};$sce.resourceUrlWhitelist(whitelist);$routeProvider.otherwise({templateUrl:partialsPath+'/index.html',controller:'AdpCtrl'});if(!/prerender=true/.test(window.location.search)){$loc.html5Mode(true).hashPrefix('!');}
cache[siteLang]=translations;isLocalizeProvider.setOptions({baseUrl:['/static/',APP_PATH,'i18n/'].join(''),language:siteLang,cache:cache,loadResourceOnInit:true});lockerProvider.defaults({namespace:'adp'});RestangularProvider.setDefaultHeaders({'Content-Type':'application/json'});RestangularProvider.setBaseUrl(istock.restUrl);}]).run(function($rootScope){$rootScope.$on('$locationChangeStart',function(event,next){if(/#!$/.test(next)){event.preventDefault();}});});}());(function(){'use strict';var APP='adp',adp=angular.module(APP+'.controllers');adp.controller('AdpCtrl',['$scope','$window','$filter','$injectedData','$cacheFactory','$location','boomerangService','accountService','spinnerService','Restangular','adpEnsightenService','adpStateService','authorizationService','adpPaymentClarityService','urlBuilder','OMNITURE_EVENTS','ADP_ERROR_MESSAGING',function($scope,$window,$filter,$injectedData,$cacheFactory,$location,boomerangService,accountService,spinnerService,Restangular,adpEnsightenService,adpStateService,authorizationService,adpPaymentClarityService,urlBuilder,OMNITURE_EVENTS,ERROR_MESSAGING){var attemptedRefreshes=0;$scope.adp=adpStateService;$scope.adp.error={showErrorMessage:false,errorMessage:'',errorCode:''};$scope.serial=istock.serial;$scope.adpReady=false;$scope.urlInfix=urlBuilder.getUrlInfix();$scope.adp.statusMessage='';$scope.omnitureSimilarFileClick=OMNITURE_EVENTS.ADP.SIMILAR_FILE_CLICK;$scope.omnitureZoomClick=OMNITURE_EVENTS.ADP.FILE_ZOOM_CLICK;$scope.init=function(){boomerangService.initBoomerang('adp','file_thumbview_approve');$scope.adpReady=false;angular.element(document).ready(function(){var cache=$cacheFactory.get('$http');cache.removeAll();});$scope.configRequestHeader();spinnerService.show('adp-content-spinner');spinnerService.show('adp-carousel-section-spinner');if(attemptedRefreshes>1){$scope.adp.error.showErrorMessage=true;$scope.adp.error.errorMessage=ERROR_MESSAGING.API_ERROR+'|'+$scope.getContactUrl();$scope.adp.error.errorCode='Code: A1';spinnerService.hide('adp-content-spinner');spinnerService.hide('adp-keywords');}else{adpStateService.init().finally(function(){var data={asset:$scope.adp.asset,user:$scope.adp.user,assetId:$scope.adp.assetId,segmentString:$injectedData.segmentString};if($location.search().cmsDisable){$scope.adp.similarFilesCMS=false;}
adpStateService.fetchAccount().finally(function(){adpStateService.initSimilarFiles().then(function(){spinnerService.hide('carousel-spinner');adpEnsightenService.init();$scope.$broadcast('detailsInit');data.similarFilesSource=$scope.adp.similarFiles.source;if(typeof $injectedData.paymentClarityTestNum!=='undefined'&&$scope.adp.asset.isFreeFile===false){data.paymentClarityVersion=adpPaymentClarityService.getReadableTestVersion($injectedData.paymentClarityTestNum);}
$scope.sendToOmniture(OMNITURE_EVENTS.ADP.ADP_LOAD,data);});if(!$scope.adp.user&&!$scope.adp.alreadyVisited){adpStateService.initCategories();}});}).catch(function(response){if(response.status&&response.status===401){authorizationService.refreshToken().then(function(data){$injectedData.token=data.token;}).catch(function(){$scope.adp.error.showErrorMessage=true;$scope.adp.error.errorMessage=ERROR_MESSAGING.API_ERROR+'|'+$scope.getContactUrl();$scope.adp.error.errorCode='Code: A2';if(response.data.referenceId){$scope.adp.error.errorCode+=' - Reference: '+response.data.referenceId;}}).finally(function(){attemptedRefreshes++;$scope.init();});}else{if($scope.isPrerender()){angular.element('head').append('<meta name="prerender-status-code" content="404">');}else{if(response.status&&response.status===404){$window.location.href=$scope.urlInfix+'/fourohfour';}else{$scope.adp.error.showErrorMessage=true;$scope.adp.error.errorMessage=ERROR_MESSAGING.API_ERROR+'|'+$scope.getContactUrl();$scope.adp.error.errorCode='Code: B1';if(response.data.referenceId){$scope.adp.error.errorCode+=' - Reference: '+response.data.referenceId;}}}}}).finally(function(){spinnerService.hide('adp-content-spinner');spinnerService.hide('adp-keywords');});}
$scope.adminData=$injectedData.adminData;};$scope.isPrerender=function(){var result=false,args=$window.location.search.substr(1).split('&');for(var i=0;i<args.length;i++){result=args[i].split('=')[0]==='prerender';if(result){break;}}
return result;};$scope.setOmnitureCookie=function(type,category){var cookieName='',d=new Date(),expires='';d.setTime(d.getTime()+(1*24*60*60*1000));expires='expires='+d.toUTCString();switch(type){case'category':cookieName='c_c';document.cookie=cookieName+'='+category+';expires='+expires+';domain=.istockphoto.com;path=/';break;case'keyword':cookieName='k_c';document.cookie=cookieName+'=keyword;expires='+
expires+';domain=.istockphoto.com;path=/';break;case'similarFile':cookieName='sf_c';document.cookie=cookieName+'=similarFile;expires='+
expires+';domain=.istockphoto.com;path=/';}};$scope.sendToOmniture=function(event,args){$scope.$broadcast(event,args);};$scope.configRequestHeader=function(){if($injectedData.token){Restangular.setDefaultHeaders({'Authorization':'Bearer '+$injectedData.token});}};$scope.similarFilesCallback=function(result){if(result==='CMS'){adp.similarFilesCMS=true;}else if(result==='callback'||result==='SimilarImages'){adp.similarFilesCMS=false;}
spinnerService.hide('adp-carousel-section-spinner');};$scope.showSimilarFilesSeparator=function(similarFiles){var noSimilarFiles=!similarFiles.assetPreviews.length,notEnoughFiles=(similarFiles.assetPreviews.length<similarFiles.threshold);return(noSimilarFiles||notEnoughFiles)&&!adp.similarFilesCMS;};$scope.getContactUrl=function(){if($scope.urlInfix){return $scope.urlInfix+'/contact_ticket';}else{return'/contact_ticket';}};$scope.$on('$routeChangeSuccess',function(){$scope.init();});$scope.$watch('adp.asset',function(){if($scope.adp.asset&&!$scope.adp.asset.status){$scope.adp.asset.status='Unknown';}
if($scope.adp.asset&&$scope.adp.asset.contributor&&$scope.adp.asset.contributor.isActive!==true){$scope.adp.asset.status='Banned';}
if($scope.adp.asset&&$scope.adp.asset.status){switch($scope.adp.asset.status){case'Active':$scope.adp.statusMessage='This asset is active';break;case'Rejected':$scope.adp.statusMessage='This file has been rejected';break;case'Pending':$scope.adp.statusMessage='This file is pending review';break;case'PendingExecutive':$scope.adp.statusMessage='This file is pending executive review';break;case'Deactivated':$scope.adp.statusMessage='This file has been deactivated';break;case'NeedsModelRelease':$scope.adp.statusMessage='This file requires a model release';break;case'Process':$scope.adp.statusMessage='Processing';break;case'Banned':$scope.adp.statusMessage='The owner of this file has been banned';break;case'PublishSubmitted':$scope.adp.statusMessage='This file is publishing';break;case'PublishFailure':$scope.adp.statusMessage='Publish Failed';break;default:$scope.adp.statusMessage='';break;}}});angular.element(window).on('load',function(){$scope.adpReady=true;});}]);}());(function(){'use strict';var APP='adp',adp=angular.module(APP+'.controllers');adp.controller('FileDetailsCtrl',['$scope','$window','$location','$http','$interval','$cookies','$injectedData','authorizationService','availabilityService','downloadService','metadataService','concreteTypeService','ipCookie','adpStateService','licenseStateService','purchaseStateService','spinnerService','countrySitesService','viewStateService','ctaTitleService','kountService','urlBuilder','adpPaymentClarityService','OMNITURE_EVENTS','TYPE_MAPPING','ADP_ERROR_MESSAGING','isLocalize','locker',function($scope,$window,$location,$http,$interval,$cookies,$injectedData,authorizationService,availabilityService,downloadService,metadataService,concreteTypeService,ipCookie,adpStateService,licenseStateService,purchaseStateService,spinnerService,countrySitesService,viewStateService,ctaTitleService,kountService,urlBuilder,adpPaymentClarityService,OMNITURE_EVENTS,TYPE_MAPPING,ERROR_MESSAGING,isLocalize,locker){$scope.editorialTooltipTitle=isLocalize.getLocalizedString('EDITORIAL_USE_ONLY_TOOLTIP');$scope.metaDataView='';$scope.licenseState=licenseStateService;$scope.viewState=viewStateService;$scope.purchaseState=purchaseStateService;$scope.ctaTitleState=ctaTitleService;$scope.viewStates=viewStateService.views;$scope.warnings=viewStateService.warnings;$scope.purchaseOptions=purchaseStateService.purchaseOptions;$scope.elState=licenseStateService.state;$scope.activeState=$scope.viewState.activeState;$scope.subsAbuseOperationCode=3;$scope.attemptedRefreshes=0;$scope.downloadedFileSize='';$scope.urlInfix=urlBuilder.getUrlInfix();$scope.detailsInit=function(){$scope.inPaymentClarityTest=adpPaymentClarityService.isInTest()&&$scope.adp.asset.isFreeFile===false;$scope.viewState.setActiveState($scope.viewStates.download);if($scope.inPaymentClarityTest===true){$scope.viewState.setActiveState($scope.viewStates['paymentClarityBuyCredits'+$scope.adp.asset.standardPriceInCredits]);}
adpStateService.fetchAsset().then(function(asset){$scope.setMetaDataView(asset);$scope.insertProfilePicUrl();if(asset.assetType==='video'||asset.assetType==='audio'){$scope.populateDropdown();}
adpStateService.fetchAccount().then(function(user){$scope.viewState.init(asset,user,$scope.adp.gettyId);}).catch(function(){$scope.viewState.init(asset,null,$scope.adp.gettyId);}).finally(function(){$scope.ctaTitleState.init();$scope.viewState.setActiveState($scope.viewStates.download);if($scope.inPaymentClarityTest===true){$scope.viewState.setActiveState($scope.viewStates['paymentClarityBuyCredits'+$scope.adp.asset.standardPriceInCredits]);}
$scope.assetTypeConfig=$scope.viewState.getAssetTypeConfig();$scope.setMiniAdpCookie();});});};$scope.getCtaAction=function(funcName,options){options=options||{};$scope.downloadType=options.downloadType||'';$scope.$eval('('+funcName+'())');};$scope.purchaseFile=function(){var extLicensePurchase=$scope.licenseState.isLicenseSelected(),nextState;if($injectedData.adminData&&$injectedData.adminData.permissions&&$injectedData.adminData.permissions.freeAdminDownloadACL){$scope.confirmPurchase();return;}
adpStateService.init().then(function(){$scope.viewState.setRedownloadStateInfo($scope.adp.gettyId).then(function(){var isRedirectToPricing,isPreviousDownload,isCorporateSlave;$scope.sendToOmniture(OMNITURE_EVENTS.CTA_CLICK,$scope.activeState.ctaTitle);if($scope.adp.user!==null){isRedirectToPricing=($scope.adp.user.numCredits===0);isRedirectToPricing=isRedirectToPricing&&($scope.adp.user.numCredits===0);isRedirectToPricing=isRedirectToPricing&&($scope.adp.user.hasSub===false);isRedirectToPricing=isRedirectToPricing&&(!$scope.adp.asset.isFreeFile);if(isRedirectToPricing){isPreviousDownload=($scope.purchaseOptions.availability.reason&&$scope.purchaseOptions.availability.reason.previousDownload);isRedirectToPricing=isRedirectToPricing&&!isPreviousDownload;}
if(isRedirectToPricing){isCorporateSlave=($scope.adp.user.corporateInfo&&$scope.adp.user.corporateInfo.isCorporateSlave);isRedirectToPricing=isRedirectToPricing&&!isCorporateSlave;}
if(isRedirectToPricing){$scope.goToPricing();}else{nextState=$scope.purchaseState.decide(extLicensePurchase,($scope.adp.asset.isFreeFile&&!extLicensePurchase),$scope.viewStates,$scope.warnings);$scope.viewState.setActiveState(nextState);}}else{if($scope.adp.hasCookie||$scope.adp.asset.isFreeFile){var redirectUrl='/'+$scope.adp.asset.assetType+$location.path();$scope.setWindowLocation(urlBuilder.buildReturnUrl('sign-in',redirectUrl));}else{$scope.goToPricing();}}});});};$scope.confirmPurchase=function(){var selectedLicenses=[],omnitureArgs={},vars={'subscription':'false','licenses':[],'concreteType':''},downloadSource='Credits';$scope.languageSupportedByWeTransfer=$injectedData.languageSupportedByWeTransfer;$scope.sendToOmniture(OMNITURE_EVENTS.CTA_CLICK,$scope.activeState.ctaTitle);selectedLicenses=$scope.licenseState.state.selectedLicenses;selectedLicenses.forEach(function(selectedLicense){vars.licenses.push(selectedLicense.licenseType);});if(selectedLicenses.length>0){downloadSource='License';}
if($scope.purchaseOptions.type==='sub'&&selectedLicenses.length===0&&!$scope.adp.asset.isFreeFile){vars.subscription=true;downloadSource='Subscription';}else if(selectedLicenses.length>0){downloadSource='Credits';vars.subscription=false;}
if($scope.purchaseOptions.availability.reason){if($scope.purchaseOptions.availability.reason.previousDownloadSource==='Subscription'&&selectedLicenses.length===0){vars.subscription=true;}else{downloadSource='Credits';vars.subscription=false;}}
if($scope.selectedDropdownOption){vars.concreteType=$scope.selectedDropdownOption.typeId;}else{vars.concreteType=$scope.purchaseOptions.size;}
if($scope.adp.asset.assetType==='vector'){$scope.downloadedFileSize='VECTOR';}else{$scope.downloadedFileSize=vars.concreteType;}
kountService.getKountSession().then(function(kountSession){$scope.adp.kountSession=kountSession;});downloadService.getDownload($scope.adp.gettyId,vars).then(function(downloadResults){var response=downloadResults.data,adpData;$scope.adp.error.showErrorMessage=false;$scope.viewStates.confirmDownload.downloadUrl=response.downloadUrl;if($scope.viewState.focusView){$scope.viewState.setActiveState($scope.viewStates.completeDownloadFocus);}else{$scope.viewState.setActiveState($scope.viewStates.completeDownload);}
$scope.purchaseOptions.availability.isDownloadable=true;$scope.purchaseOptions.availability.reason={previousDownload:true,previousDownloadSource:downloadSource};$scope.adp.user.numCredits-=response.creditBurned;omnitureArgs.asset=$scope.adp.asset;omnitureArgs.user=$scope.adp.user;omnitureArgs.assetId=$scope.adp.assetId;omnitureArgs.downloadInfo=downloadResults.data;omnitureArgs.segmentString=$injectedData.segmentString;omnitureArgs.creditsRemaining=$scope.adp.user.numCredits;if($scope.adp.asset.assetType==='photo'&&locker.supported()===true){adpData=locker.get('adpData');adpData.downloadedSize=$scope.purchaseOptions.concreteType;locker.put('adpData',adpData);}
if(response.isDropBoxDownload===true){$scope.viewStates.completeDownload.showDropboxSyncFeedback=true;if($scope.downloadType==='manual'){$scope.setWindowLocation(response.downloadUrl);}}else{$scope.setWindowLocation(response.downloadUrl);}
$scope.viewStates.completeDownload.showWeTransferCTA=true;$scope.sendToOmniture(OMNITURE_EVENTS.ADP.FILE_DOWNLOAD,omnitureArgs);$interval(function(){if($scope.activeState.stateName==='CompleteState'){$scope.viewState.setActiveState($scope.viewStates.download);}},120000,1);}).catch(function(response){if(response.status){if(response.data.operationStatusCode&&response.status===403&&response.data.operationStatusCode===$scope.subsAbuseOperationCode){countrySitesService.getPlansAndPricingTranslation().then(function(pAndPTranslation){$scope.setWindowLocation(pAndPTranslation+'/team-share');});}else if(response.status===401&&$scope.attemptedRefreshes<=1){$scope.attemptedRefreshes++;authorizationService.refreshToken().then(function(data){$injectedData.token=data.token;$scope.confirmPurchase();}).catch(function(){$scope.adp.error.showErrorMessage=true;$scope.adp.error.errorMessage=ERROR_MESSAGING.DOWNLOAD_ERROR;});}else{$scope.adp.error.showErrorMessage=true;$scope.adp.error.errorMessage=ERROR_MESSAGING.DOWNLOAD_ERROR;}}});};$scope.goToPricing=function(){$scope.sendToOmniture(OMNITURE_EVENTS.CTA_CLICK,$scope.activeState.ctaTitle);if($scope.inPaymentClarityTest===true){$scope.sendToOmniture(OMNITURE_EVENTS.PAYMENT_CLARITY,'pricing');}
countrySitesService.getPlansAndPricingTranslation().then(function(pAndPTranslation){$scope.setWindowLocation(pAndPTranslation);});};$scope.buyCredits=function(){var creditPack=adpPaymentClarityService.getCreditPackId($scope.adp.asset.standardPriceInCredits);$scope.setWindowLocation('/plans-and-pricing/buy-credits?credit-pack='+creditPack);$scope.sendToOmniture(OMNITURE_EVENTS.PAYMENT_CLARITY,'buyCredits');};$scope.clearLicensesAndCancelPurchase=function(){$scope.licenseState.closeLicenseTable();$scope.cancelPurchase();};$scope.cancelPurchase=function(){$scope.viewState.setActiveState($scope.viewStates.download);if($scope.inPaymentClarityTest===true){$scope.viewState.setActiveState($scope.viewStates['paymentClarityBuyCredits'+$scope.adp.asset.standardPriceInCredits]);}
$scope.licenseState.clearLicenses();};$scope.setMiniAdpCookie=function(){var eligibleForSubs=false,totalInfo,value,typeId,collectionId,infoFileTitle='',truncatedFileTitle='',name='file_closeup_mini_adp_fileInfo',days=1,filePreviewUrl='';if($scope.adp.asset.assetType&&$scope.adp.asset.standardPriceInCredits>0){if($scope.adp.asset.assetType==='photo'||$scope.adp.asset.assetType==='illustration'||$scope.adp.asset.assetType==='raster'||$scope.adp.asset.assetType==='vector'){eligibleForSubs=true;}}
typeId=TYPE_MAPPING.FILE_TYPES[$scope.adp.asset.assetType.toUpperCase()];collectionId=TYPE_MAPPING.COLLECTION_TYPES[$scope.adp.asset.collection.toUpperCase()];if($scope.adp.asset.title){infoFileTitle=$scope.adp.asset.title;truncatedFileTitle=$scope.adp.asset.title.slice(0,34);}
filePreviewUrl=$scope.adp.asset.thumbnails.smallUrl;totalInfo={'fileId':$scope.adp.assetId,'creditsCost':$scope.adp.asset.standardPriceInCredits,'collection':collectionId,'abstractTypeId':typeId,'eligibleForSubs':eligibleForSubs,'fileType':$scope.adp.asset.assetType,'typeName':$scope.adp.asset.assetType,'fileTitle':infoFileTitle,'fileTitleTruncated':truncatedFileTitle,'filePreviewUrl':filePreviewUrl};value=JSON.stringify(totalInfo);ipCookie(name,value,{path:'/',expires:days});};$scope.insertProfilePicUrl=function(){if($injectedData.profilePicUrl!==null){$scope.adp.asset.contributor.profilePicUrl=$injectedData.profilePicUrl;}};$scope.setMetaDataView=function(){$scope.metaDataView='/static/js/angular/apps/adp/partials/metadata/_'+
$scope.adp.asset.assetType.toLowerCase()+'Metadata.html';metadataService.setGenericMetaData($scope.adp.asset);metadataService.setTwitterMetaData($scope.adp.asset);metadataService.setOGPMetaData($scope.adp.asset);};$scope.populateDropdown=function(){var option={},optionList=[],audio44100Found=false,audio48000Found=false;if($scope.adp.asset.assetType==='video'){if($scope.adp.asset.videoList){$scope.adp.asset.videoList.forEach(function(videoOption){option={typeId:videoOption.videoId,fileSize:(videoOption.sizeInBytes/(1024*1024)).toFixed(2),presentationString:concreteTypeService.getTypeName(videoOption.videoId)+' | '+
videoOption.widthInPixels+' x '+videoOption.heightInPixels+' @ '+videoOption.framePerSecond+' fps | '+videoOption.format};optionList.push(option);});$scope.selectedDropdownOption=optionList[0];}}else if($scope.adp.asset.assetType==='audio'){if($scope.adp.asset.audioList){$scope.adp.asset.audioList.forEach(function(audioOption){if(audioOption.frequency===44.1&&!audio44100Found||audioOption.frequency===48&&!audio48000Found){option={typeId:audioOption.audioId,presentationString:audioOption.frequency+' kHz | '+$scope.adp.asset.bitDepth+' WAV'};optionList.push(option);if(audioOption.frequency===44.1){audio44100Found=true;}
if(audioOption.frequency===48){audio48000Found=true;}}});}
$scope.selectedDropdownOption=optionList[0];}
$scope.viewStates.download.fileTypeDropdownOptions=optionList;};$scope.sendPortfolioLinkData=function(){$scope.sendToOmniture(OMNITURE_EVENTS.ADP.PORTFOLIO_LINK_CLICK,$scope.adp);};$scope.updateDropdownSelection=function(option){$scope.selectedDropdownOption=option;};$scope.setWindowLocation=function(url){$window.location.href=url;};$scope.$on('detailsInit',function(){$scope.detailsInit();});$scope.$watch('viewState.activeState.showExtendedLicenses',function(newValue){if(newValue===true){$scope.cancelPurchase();}});}]);}());(function(){'use strict';var APP='adp',adp=angular.module(APP+'.controllers');adp.controller('PaymentClarityCtrl',['$scope','adpPaymentClarityService','viewStateService',function($scope,adpPaymentClarityService,viewStateService){$scope.paymentOption='buy';$scope.assetPrice=adpPaymentClarityService.getAssetPriceFragment($scope.adp.asset.standardPriceInCredits);$scope.currentTestValue=adpPaymentClarityService.getCurrentTestValue();$scope.subsPriceFragment=adpPaymentClarityService.getSubscriptionPriceFragment($scope.adp.asset.standardPriceInCredits,$scope.currentTestValue);$scope.$watch('paymentOption',function(){if($scope.paymentOption==='buy'){viewStateService.setActiveState($scope.viewStates['paymentClarityBuyCredits'+$scope.adp.asset.standardPriceInCredits]);}else if($scope.paymentOption==='pnp'){viewStateService.setActiveState($scope.viewStates.paymentClarityPurchasePlan);}});}]);}());(function(){'use strict';var module=angular.module('adp.directives',['ngAnimate']);module.directive('adpZoom',['$window','$timeout','spinnerService',function($window,$timeout,spinnerService){return{restrict:'E',scope:{src:'@src',zoomSrc:'@zoomSrc',altText:'@zoomAltText',width:'@zoomPreviewWidth',height:'@zoomPreviewHeight',clickEvent:'&'},templateUrl:'/static/js/angular/apps/adp/partials/_zoom.html',link:function(scope,element){var thumb=angular.element('#image-thumbnail'),thumbWrapper=angular.element('.zoom-large-url');scope.touchscreen=(('ontouchstart'in $window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0));thumbWrapper.hide();thumb.load(function(){thumbWrapper.fadeIn(600);});scope.zoomModalOpen=function($event){var zoomImage=angular.element('#image-zoom'),bodyElement=angular.element('body');$event.stopPropagation();scope.loaded=false;spinnerService.show('adp-zoom-modal-spinner');if(zoomImage.attr('src')){zoomImage.removeAttr('src');}
zoomImage.attr('src',scope.zoomSrc);bodyElement.addClass('modal-open');scope.loaded=true;scope.zoomed=true;scope.clickEvent();element.closest('body').on('keydown',keyDownCheck);};scope.zoomModalClose=function(){var bodyElement=angular.element('body');bodyElement.removeClass('modal-open');scope.zoomed=false;element.closest('body').off('keydown',keyDownCheck);};scope.setFlag=function(strFlag){angular.element('#image-zoom').addClass(strFlag);};scope.removeFlag=function(strFlag){angular.element('#image-zoom').removeClass(strFlag);};scope.noClick=function(e){e.stopPropagation();};function keyDownCheck(event){if(event.keyCode===27){scope.zoomModalClose();scope.$apply();}}}};}]);}());(function(){'use strict';var module=angular.module('adp.directives');module.directive('adpMediaPlayer',['$location','assetService','flashService','gettyMasterIdService','cookielessUrl','adpStateService',function($location,assetService,flashService,gettyMasterIdService,cookielessUrl,adpStateService){return{restrict:'E',link:function(scope,element){var loadMediaPlayer,buildAudioPlayer,buildVideoPlayer,setCompLink,flashVarArray,MediaPlayer={},flashVars,moreFlashVarsArray,flashString,concreteType='64';adpStateService.fetchAsset().then(function(asset){loadMediaPlayer(asset);});loadMediaPlayer=function(asset){flashVarArray=['videoFileID='+asset.referenceNumber,'bufferPercent=25'];switch(asset.assetType.toLowerCase()){case'audio':buildAudioPlayer(asset);break;case'video':buildVideoPlayer(asset);break;}
flashVarArray=flashVarArray.concat(moreFlashVarsArray);flashVars=flashVarArray.join('&');flashString=flashService.flashTag(MediaPlayer.playerPath,asset,flashVars,350,230);element.html(flashString);};buildVideoPlayer=function(asset){var previewLink;asset.videoList.forEach(function(option){if(option.standard.indexOf('HD')>-1){concreteType='65';}});previewLink=cookielessUrl+'/video_passthrough/'+
asset.referenceNumber+'/'+concreteType+'/'+asset.referenceNumber+'.flv';moreFlashVarsArray=['videoLocation='+encodeURIComponent(previewLink)];MediaPlayer.playerPath=cookielessUrl+'/video_player_wide.swf';setCompLink(previewLink);};buildAudioPlayer=function(asset){var previewLink='/audio_mp3_preview.php?id='+asset.referenceNumber;MediaPlayer.playerPath=cookielessUrl+'/richmedia/audio/audioPlayer.swf';moreFlashVarsArray=['videoLocation='+encodeURIComponent(previewLink),'bitDepth='+asset.bitDepth,'soundField='+asset.soundField,'tempo='+asset.tempo,'waveformUrl='+encodeURIComponent('/audio_passthrough.php?ID='+asset.referenceNumber+'&Type=87'),'timeSignature='+encodeURIComponent(asset.timeSignature)];setCompLink(previewLink);};setCompLink=function(link){var compElement=angular.element('#adp-comp-link');compElement.attr('href',link);};}};}]);}());(function(){'use strict';var module=angular.module('adp.directives');module.directive('adpMetadata',['assetService',function(){return{restrict:'E',transclude:true,templateUrl:'/static/js/angular/apps/adp/partials/details/_metadata.html'};}]);}());(function(){'use strict';var module=angular.module('adp.directives');function truncate(strText,intWidth,element){var arrText=strText.split(' '),intWordCount=arrText.length,x=1;while(x<=intWordCount){var tmpWidth=computeWidth(arrText.slice(0,x).join(' '),element);if(tmpWidth>intWidth){intWordCount=x-1;break;}
x++;}
if(intWordCount===0){intWordCount=1;}
return arrText.slice(0,intWordCount).join(' ');}
function computeWidth(strText,element){var o=angular.element('<div>'+strText+'</div>').css({'position':'absolute','float':'left','white-space':'nowrap','visibility':'hidden','font-family':getElementStyle(element,'font-family'),'font-size':getElementStyle(element,'font-size'),'font-weight':getElementStyle(element,'font-weight'),'font-style':getElementStyle(element,'font-style'),'line-height':getElementStyle(element,'line-height')}).appendTo(angular.element('body')),w=o.width();o.remove();return w;}
function getElementStyle(element,style){var elementValue=angular.element(element).css(style);return elementValue;}
module.directive('adpClamp',[function(){return{restrict:'AE',scope:{titlesrc:'=titlesrc',alttext:'=alttext',keywords:'=keywords'},replace:true,templateUrl:'/static/js/angular/apps/adp/partials/_clamp.html?serial='+istock.serial,link:function($scope,$element,$attrs){$scope.attrs=$attrs;$scope.showFullTitle=false;$scope.showKeywordsAsTitle=false;$scope.fullTitle='';$scope.alternateText=$scope.altText;$scope.toggleShowFullTitle=function(){$scope.showFullTitle=true;};$scope.clampTitle=function(){if(typeof $scope.keywords!=='undefined'){if($scope.keywords.length>0){$scope.clampid=$scope.attrs.id;var keywordsStr=$scope.keywords.join(', '),sWidth=getElementStyle('#'+$attrs.id+' section section h1','width'),iFullWidth=parseInt(sWidth,10),bufferSpace=50,iWidth=iFullWidth-(parseInt(getElementStyle('.adp-show-full-title-button','width'),10)+bufferSpace);if($scope.titlesrc===''){$scope.clampedTitle=truncate(keywordsStr,iWidth,'#'+$scope.attrs.id+' section section h1 small');$scope.clampedKeywords='';$scope.fullTitle=keywordsStr;if($scope.fullTitle.length<iFullWidth){$scope.showFullTitle=true;}
$scope.showKeywordsAsTitle=true;}else{$scope.clampedTitle=truncate($scope.titlesrc,iWidth,'#'+$scope.attrs.id+' section section h1 small');$scope.clampedKeywords=keywordsStr;$scope.fullTitle=$scope.titlesrc;}}else{$scope.clampedTitle=$scope.titlesrc;$scope.clampedKeywords=$scope.titlesrc;}}};$scope.$watch('titlesrc',function(){$scope.clampTitle(window.innerWidth);});$scope.$watch(function(){return{'h':window.innerHeight,'w':window.innerWidth};},function(newValue){$scope.windowHeight=newValue.h;$scope.windowWidth=newValue.w;$scope.clampTitle(newValue);$scope.resizeWithOffset=function(offsetH){return{'height':(newValue.h-offsetH)+'px'};};},true);angular.element(window).bind('resize',function(){$scope.$apply();});}};}]);}());(function(){'use strict';var module=angular.module('adp.directives');module.directive('imageCarousel',['$window','$timeout','searchRequestService','legacyFacetService','omnitureService','OMNITURE_EVENTS','boomerangService','isLocalize','$injectedData',function($window,$timeout,searchRequestService,legacyFacetService,omnitureService,OMNITURE_EVENTS,boomerangService,isLocalize,$injectedData){return{restrict:'EA',templateUrl:'/static/js/angular/apps/adp/partials/_carousel.html',scope:{data:'=?',clickEvent:'&',searchEvent:'&',callback:'&',sectionTitle:'@',sectionTitlePhoto:'@',sectionTitleVideo:'@',sectionTitleAudio:'@',sectionTitleVector:'@',sectionSubLink:'@',sectionSubLinkAnchor:'@',sectionMaxResults:'@',fileCollection:'@',carouselType:'@',queryKeywords:'@',queryFacets:'=?',assetList:'=?',contributor:'=?'},link:function(scope,element){var currentPage=1,boomerangTimer;scope.localdata={};scope.currentRow=[];scope.nextEnabled=false;scope.prevEnabled=false;scope.errorCode=0;scope.searchExecuted=false;scope.searchResultsCount=100;scope.processedKeywords='';if(scope.sectionMaxResults){scope.searchResultsCount=scope.sectionMaxResults;}
scope.go=function(path){omnitureService.adpCarouselSeeAllClick({carouselType:scope.carouselType});if((/\=/).test(path)){var splits=path.match(/(.*\=)(.*)$/);path=splits[1]+encodeURIComponent(splits[2]);}
$window.location.assign(path);};scope.updateButtons=function(){if(scope.localdata){var numberOfImages=currentPage*scope.localdata.filesInARow;scope.nextEnabled=numberOfImages<scope.localdata.totalResults;scope.prevEnabled=currentPage>1;}};scope.updateRow=function(){if(currentPage===0){currentPage=1;}
if(scope.localdata){var currentIndex=(currentPage-1)*scope.localdata.filesInARow;if(currentIndex+scope.localdata.filesInARow>scope.localdata.totalResults){if(scope.localdata.assetPreviews){scope.currentRow=scope.localdata.assetPreviews.slice(currentIndex,scope.localdata.totalResults);}}else{if(scope.localdata.assetPreviews){scope.currentRow=scope.localdata.assetPreviews.slice(currentIndex,currentIndex+scope.localdata.filesInARow);}}}};scope.checkValidPage=function(){if(currentPage<1){currentPage=1;}
if(scope.localdata){if((currentPage*scope.localdata.filesInARow)>scope.localdata.totalResults){currentPage=Math.ceil(scope.localdata.totalResults/scope.localdata.filesInARow);}}};scope.suppressCrossSellCarousel=function(){var adpObject=scope.$parent.adp;return(adpObject.user&&adpObject.user.sub&&adpObject.user.sub.type==='essentials'&&(adpObject.asset.assetType==='photo'||adpObject.asset.assetType==='vector')&&adpObject.user.numCredits<3&&scope.queryFacets.fileCollection&&scope.queryFacets.fileCollection.indexOf('essentials')===-1)===true;};scope.initFromFacets=function(facets){if(scope.searchExecuted){return;}
var options={searchToken:'',isFrontEndSearch:false,endpoint:'related-search'};facets=angular.copy(facets);facets.decoration=['0','1','2','41','59','63'];boomerangTimer=boomerangService.createTimer('image-carousel_load',scope.carouselType);searchRequestService.executeSearch(facets,options).then(function(response){var canonicalThumbType,canonicalMediaThumbType,mediumUrl,thumbType,returnedData={},totalReturnedAssets=0;boomerangTimer.finish();boomerangTimer=null;returnedData.assetPreviews=[];if(response.results){omnitureService.adpCarouselsLoad({carouselType:scope.carouselType});if(response.results.thumbNails){thumbType='srp_thumb';canonicalThumbType='canonical_srp_thumb';canonicalMediaThumbType='canonical_html5_thumb_medium';response.results.thumbNails.forEach(function(objectAsset){mediumUrl=objectAsset.url[thumbType];if($injectedData.useCanonicalUrls){if(!!objectAsset.url[canonicalMediaThumbType]){mediumUrl=objectAsset.url[canonicalMediaThumbType];}else if(!!objectAsset.url[canonicalThumbType]){mediumUrl=objectAsset.url[canonicalThumbType];}}
returnedData.assetPreviews.push({assetUrl:objectAsset.url.page,thumbnailsUrl:{mediumUrl:mediumUrl},title:objectAsset.title});totalReturnedAssets++;});}else{thumbType='thumb_190';response.results.forEach(function(objectAsset){var assetAbstractType=objectAsset.abstractType.string;if(assetAbstractType.indexOf('video')>-1){assetAbstractType='video';}
returnedData.assetPreviews.push({assetType:assetAbstractType,assetUrl:objectAsset.assets.adpUrl,gettyMasterId:'184948930',thumbnailsUrl:{mediumUrl:objectAsset.assets[thumbType]},title:objectAsset.title,licenseTypeID:objectAsset.license.id});totalReturnedAssets++;});}
returnedData.threshold=1;returnedData.filesInARow=6;returnedData.totalResults=totalReturnedAssets;scope.keywordResults=totalReturnedAssets;scope.localdata=returnedData;if(scope.localdata&&scope.localdata.assetPreviews&&scope.localdata.assetPreviews.length>0){scope.onResizeFunction();currentPage=1;scope.updateRow();scope.updateButtons();angular.element($window).bind('resize',function(){scope.onResizeFunction();scope.$apply();});}
if(scope.callback){scope.callback({result:'callback'});}}});scope.searchExecuted=true;};scope.$watch('$parent.adp.asset.assetType',function(){scope.assetType=scope.$parent.adp.asset.assetType;});scope.$watch('$parent.adp.keywords.baseKeywords',function(){scope.baseKeywords=scope.$parent.adp.keywords.baseKeywords;});scope.$watch('contributor',function(){if(scope.carouselType==='PORTFOLIO'&&scope.contributor&&scope.contributor.id){scope.queryFacets={};scope.queryFacets.portfolioID=scope.contributor.id;scope.queryFacets.text=[];scope.queryFacets.fileIdSet=[];if(scope.searchResultsCount){scope.queryFacets.perPage=scope.searchResultsCount;}
if(!scope.sectionTitle&&scope.contributor.copyrightName){scope.sectionTitle=scope.contributor.copyrightName;}
if(!scope.sectionSubLinkAnchor){scope.sectionSubLinkAnchor=scope.contributor.portfolioRelativePath;}
scope.initFromFacets(scope.queryFacets);}});function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n);}
scope.$watch('baseKeywords',function(){var linkFacets,titleMatrix,collection,assetType;if(scope.queryKeywords&&scope.queryKeywords!==''){var processedKeywordsStr='',processedKeywordsNoDelim='',processedKeywords=[];if(isNumeric(scope.queryKeywords)){for(var x=0;x<(+scope.queryKeywords);x++){processedKeywords.push(scope.baseKeywords[x]);}
processedKeywordsStr='"'+processedKeywords.join('","')+'"';processedKeywordsNoDelim=processedKeywords.join('');}else{processedKeywordsStr=scope.queryKeywords;processedKeywordsNoDelim=scope.queryKeywords;processedKeywords.push(scope.queryKeywords);}
if((scope.carouselType==='KEYWORDS'||scope.carouselType==='XSELL')&&processedKeywordsNoDelim!==''){scope.keywordResults=-1;scope.queryFacets={};scope.queryFacets.text=processedKeywords;if(scope.$parent.adp.asset.assetType){switch(scope.$parent.adp.asset.assetType.toUpperCase()){case'PHOTO':if(scope.sectionTitlePhoto!==''){scope.sectionTitle=scope.sectionTitlePhoto;}
scope.queryFacets.abstractType=['photos'];break;case'AUDIO':if(scope.sectionTitleAudio!==''){scope.sectionTitle=scope.sectionTitleAudio;}
scope.queryFacets.abstractType=['audio'];break;case'VECTOR':case'ILLUSTRATION':if(scope.sectionTitleVector!==''){scope.sectionTitle=scope.sectionTitleVector;}
scope.queryFacets.abstractType=['illustrations'];break;case'VIDEO':if(scope.sectionTitleVideo!==''){scope.sectionTitle=scope.sectionTitleVideo;}
scope.queryFacets.abstractType=['video'];break;}}
if(scope.carouselType==='XSELL'){if(scope.fileCollection){scope.queryFacets.fileCollection=scope.fileCollection.split(' ');}else{scope.queryFacets.fileCollection=(scope.$parent.adp.asset.collection==='essentials')?['signature','signature+']:['essentials'];}
if(scope.suppressCrossSellCarousel()){return;}
titleMatrix=[];titleMatrix[0]=['CAROUSEL_XSELL_TITLE_ESSENTIALS_IMAGE','CAROUSEL_XSELL_TITLE_ESSENTIALS_AUDIO','CAROUSEL_XSELL_TITLE_ESSENTIALS_VIDEO'];titleMatrix[1]=['CAROUSEL_XSELL_TITLE_SIGNATURE_IMAGE','CAROUSEL_XSELL_TITLE_SIGNATURE_AUDIO','CAROUSEL_XSELL_TITLE_SIGNATURE_VIDEO'];collection=Number(scope.queryFacets.fileCollection[0]!=='essentials');assetType=['AUDIO','VIDEO'].indexOf(scope.$parent.adp.asset.assetType.toUpperCase())+1;$timeout(function(){scope.sectionTitle=isLocalize.getLocalizedString(titleMatrix[collection][assetType]);},1);}
if(!scope.sectionSubLinkAnchor||scope.sectionSubLinkAnchor===''){linkFacets=jQuery.extend(true,{},scope.queryFacets);if(linkFacets.perpage){delete linkFacets.perpage;}
linkFacets.f=true;scope.sectionSubLinkAnchor='/search/?facets='+JSON.stringify(linkFacets);}
scope.initFromFacets(scope.queryFacets);}}});scope.$watch('carouselType',function(){if(scope.carouselType==='QUERY'&&scope.queryFacets){if(scope.searchResultsCount){scope.queryFacets.perPage=scope.searchResultsCount;}
scope.initFromFacets(scope.queryFacets);scope.sectionSubLinkAnchor='/search/?facets='+JSON.stringify(scope.queryFacets);}
if(scope.carouselType==='ASSETLIST'&&scope.assetList){scope.queryFacets={};scope.queryFacets.fileIdSet=scope.assetList;scope.queryFacets.text=[];if(scope.searchResultsCount){scope.queryFacets.perPage=scope.searchResultsCount;}
scope.initFromFacets(scope.queryFacets);}});scope.$watch('data',function(){if(scope.data&&(scope.data['34']||scope.data['50'])){scope.initFromFacets(scope.data);}else{scope.localdata=scope.data;if((scope.carouselType==='SIMILARFILES')&&scope.localdata&&scope.localdata.contributorLink&&scope.localdata.totalResults>0){omnitureService.adpCarouselsLoad({carouselType:scope.carouselType});scope.sectionSubLinkAnchor=scope.localdata.contributorLink;scope.onResizeFunction();}
if(scope.localdata&&scope.localdata.assetPreviews&&scope.localdata.assetPreviews.length>0){scope.onResizeFunction();currentPage=1;scope.updateRow();scope.updateButtons();angular.element($window).bind('resize',function(){scope.onResizeFunction();scope.$apply();});}
if(scope.callback){scope.onResizeFunction();if(scope.carouselType!==''){scope.callback({result:scope.carouselType});}}}});scope.$watch('itemWidth',function(){if(scope.itemWidth>0){$timeout(function(){scope.onResizeFunction();},50);}});scope.getNewRow=function(nextOrPrev){if(nextOrPrev==='next'){currentPage+=1;}else if(nextOrPrev==='prev'){currentPage-=1;}
scope.checkValidPage();scope.updateRow();scope.updateButtons();};scope.showNewFile=function(assetUrl,event){event.preventDefault();omnitureService.similarFileClick({carouselType:scope.carouselType});if(event.ctrlKey===true||event.metaKey===true){$window.open(assetUrl,'_blank');}else{$window.location.href=assetUrl;}};scope.onResizeFunction=function(){var contentWidth,itemWidth,numToDisplay;itemWidth=element.find('.carousel-items').first().outerWidth(true);scope.itemWidth=itemWidth;if(itemWidth){scope.windowHeight=$window.innerHeight;scope.windowWidth=$window.innerWidth;contentWidth=element.find('.carousel-content').first().width();numToDisplay=Math.max(Math.floor(contentWidth/itemWidth),1);if(scope.localdata){scope.localdata.filesInARow=numToDisplay;}
scope.checkValidPage();scope.updateRow();scope.updateButtons();}};scope.onResizeFunction();}};}]);}());(function(){'use strict';var module=angular.module('adp.directives');module.directive('adpDrag',function($document,$window){return{restrict:'EA',scope:{iszoomed:'=state'},link:function(scope,element){var startX=0,startY=0,x=0,y=0,minX=0,minY=0,maxX=0,maxY=0,width=0,height=0,winElement=angular.element($window),imageLoaded=false;winElement.bind('resize',function(){if(scope.iszoomed){initialize();}});element.bind('load',function(){imageLoaded=true;if(scope.iszoomed){initialize();}});scope.$watch('iszoomed',function(){if(scope.iszoomed){initialize();}},true);function initialize(){if(!imageLoaded){return;}
element.show();width=element[0].getBoundingClientRect().width;height=element[0].getBoundingClientRect().height;minX=winElement.width()-width;minY=winElement.height()-height;centerElement();}
function centerHorizontally(){return Math.round((winElement.width()-width)/2);}
function centerVertically(){return Math.round((winElement.height()-height)/2);}
function centerElement(){y=centerVertically();x=centerHorizontally();element.css({top:y+'px',left:x+'px'});}
element.on('mousedown touchstart',function(evt){evt.preventDefault();if(evt.targetTouches){evt=evt.targetTouches[0];element.on('touchmove',touchmove);element.on('touchend',dragFinished);}
startX=evt.pageX-x;startY=evt.pageY-y;$document.on('mousemove',dragInProgress);$document.on('mouseup',dragFinished);});function touchmove(evt){evt.preventDefault();var touches=evt.targetTouches;if(touches){evt.stopPropagation();dragInProgress(touches[0]);}}
function dragInProgress(evt){var widthSmaller=(width<=winElement.width()),heightSmaller=(height<=winElement.height());if(widthSmaller&&heightSmaller){centerElement();return;}
if(heightSmaller){y=centerVertically();}else if(evt.pageY-startY<=minY){y=minY;}else if(evt.pageY-startY>=maxY){y=maxY;}else{y=evt.pageY-startY;}
if(widthSmaller){x=centerHorizontally();}else if(evt.pageX-startX<=minX){x=minX;}else if(evt.pageX-startX>=maxX){x=maxX;}else{x=evt.pageX-startX;}
element.css({top:y+'px',left:x+'px'});}
function dragFinished(){$document.unbind('mousemove',dragInProgress);$document.unbind('mouseup',dragFinished);element.unbind('touchmove',touchmove);element.unbind('touchend',dragFinished);}}};});}());(function(){'use strict';var module=angular.module('adp.directives');module.directive('adpDescription',[function(){return{restrict:'E',templateUrl:'/static/js/angular/apps/adp/partials/_description.html',scope:{asset:'=asset'},link:function(scope){var descriptionElement=angular.element('.adp-description-field');scope.$watch('asset',function(){descriptionElement.html(scope.asset.description);});}};}]);}());(function(){'use strict';var module=angular.module('adp.directives');module.directive('adpSizeSelector',['$cookies','locker',function($cookies,locker){return{restrict:'E',templateUrl:'/static/js/angular/apps/adp/partials/details/_fileSizeSelector.html',link:function(scope){var setDefaultSelected,orderSizes,removeExtraSmallSizes,mapSizeName;scope.availableSizes=[];scope.selectedTile=0;scope.selectTile=function(tile){var numSizes=scope.availableSizes.length;if(!scope.availableSizes[tile]){tile=numSizes-1;}
if(scope.adp.asset.assetType==='photo'){scope.purchaseOptions.size=scope.availableSizes[tile].photoId;}else{scope.purchaseOptions.size=scope.availableSizes[tile].rasterId;}
scope.purchaseOptions.concreteType=tile;scope.selectedTile=tile;scope.mouseTile(tile);};scope.mouseTile=function(tile){var current=scope.availableSizes[tile],presentation=scope.adp.asset.presentation,ratio=presentation.measurements.conversionRatio;if(scope.adp.asset.assetType==='photo'){scope.adp.asset.assetDimensions.widthInPixels=current.widthInPixels;scope.adp.asset.assetDimensions.heightInPixels=current.heightInPixels;presentation.measurements.dotsPer=(current.dpi/ratio).toFixed(1);presentation.measurements.width=(current.widthInPixels/presentation.measurements.dotsPer).toFixed(1);presentation.measurements.height=(current.heightInPixels/presentation.measurements.dotsPer).toFixed(1);}else{scope.adp.asset.rasterList.widthInPixels=current.widthInPixels;scope.adp.asset.rasterList.heightInPixels=current.heightInPixels;presentation.measurements.dotsPer=(current.dpi/ratio).toFixed(1);presentation.measurements.width=(current.widthInPixels/presentation.measurements.dotsPer).toFixed(1);presentation.measurements.height=(current.heightInPixels/presentation.measurements.dotsPer).toFixed(1);}};setDefaultSelected=function(){var adpData;if(locker.supported()===false){scope.selectTile(scope.availableSizes.length-1);}else{adpData=locker.get('adpData');if(adpData){scope.selectTile(adpData.downloadedSize);}}};removeExtraSmallSizes=function(){var tempSizes=[],list=[],key='';if(scope.adp.asset.assetType==='photo'){key='photoId';list=scope.adp.asset.photoList;}else{key='rasterId';list=scope.adp.asset.rasterList;}
tempSizes=list.filter(function(item){return!(/x+small/i.test(item[key]));});scope.availableSizes=tempSizes;};orderSizes=function(){scope.availableSizes.sort(function(x,y){var xArea=x.widthInPixels*x.heightInPixels,yArea=y.widthInPixels*y.heightInPixels;if(xArea<yArea){return-1;}
if(xArea>yArea){return 1;}
return 0;});};mapSizeName=function(){var assetSize='M';scope.availableSizes.forEach(function(size){if(size.photoId){assetSize=size.photoId;}
if(size.rasterId){assetSize=size.rasterId;}
switch(assetSize){case'XXXSMALL':size.photoDisplay='3XS';break;case'XXSMALL':size.photoDisplay='2XS';break;case'XSMALL':size.photoDisplay='XS';break;case'SMALL':size.photoDisplay='S';break;case'MEDIUM':size.photoDisplay='M';break;case'LARGE':size.photoDisplay='L';break;case'XLARGE':size.photoDisplay='XL';break;case'XXLARGE':size.photoDisplay='2XL';break;case'XXXLARGE':size.photoDisplay='3XL';break;default:size.photoDisplay='M';break;}});};removeExtraSmallSizes();orderSizes();mapSizeName();setDefaultSelected();}};}]);}());(function(){'use strict';var module=angular.module('adp.directives');module.directive('weTransfer',['$document','$rootScope','formValidationService','formFieldsValidatorService','$timeout','adpStateService','weTransferService','$filter','omnitureService','$injectedData','$window','urlBuilder',function($document,$rootScope,formValidation,formFieldsValidatorService,$timeout,adpStateService,weTransferService,$filter,omnitureService,$injectedData,$window,urlBuilder){return{restrict:'E',require:'?ngModel',templateUrl:'/static/js/angular/apps/adp/partials/weTransfer/_index.html',transclude:true,scope:{downloadedFileSize:'=',userEmailAddress:'=',fileType:'='},link:function(scope){var emailFieldDefaultPlaceholder=$filter('i18n')('WE_TRANSFER_PLACEHOLDER_TO'),EMAIL_FIELD_MAX_LIMIT=5,EMAIL_MAX_LENGTH=255,tagsInputFieldElement='#tags-input-field',inputFilledClass='input-filled',reduceWithClass='reduce-width',weTransferButton,windowElement=angular.element($window);weTransferButton='<iframe width="100%" height="50" frameborder="0" src="//we.tl/send/'+
$injectedData.languageSupportedByWeTransfer+'"></iframe>';angular.element('.we-transfer-iframe').append(weTransferButton);scope.emailTags=[];scope.emailPlaceholder=emailFieldDefaultPlaceholder;scope.messagePlaceholder=$filter('i18n')('WE_TRANSFER_PLACEHOLDER_MESSAGE');scope.invalidEmailMessageShown=false;scope.invalidMaxLimitMessageShown=false;scope.loadingState=false;scope.showSuccessfulModal=false;scope.showWeTransferRequestError=false;scope.init=function(){$document.foundation();formValidation.setExpression({emailValidationAndFormat:scope.emailValidationAndFormat});formValidation.setDefaultMsgKey({emailValidationAndFormat:{error:'ERROR_EMAIL'}});formValidation.setExpression({emailTagsUnderMaxLimit:scope.emailTagsUnderMaxLimit});formValidation.setDefaultMsgKey({emailTagsUnderMaxLimit:{error:'EMAIL_MAX_LIMIT'}});angular.element(':input:not(textarea)').keypress(function(event){return(event.keyCode!==13);});scope.contactTicketUrl=urlBuilder.getUrlInfix()+'/contact_ticket';};scope.showWeTransferModal=function(){omnitureService.weTransferModalOpen();if(scope.showSuccessfulModal){scope.resetForm();}
scope.closeDropboxModal();angular.element('html, body').animate({scrollTop:0},1000,'easeOutQuart');angular.element('#we-transfer-modal').foundation('reveal','open');};scope.closeWeTransferModal=function(){angular.element('#we-transfer-modal').foundation('reveal','close');};scope.emailValidationAndFormat=function(emailValue){var emailInputFieldElem=angular.element(tagsInputFieldElement),emailInputFieldValue=emailInputFieldElem.val(),emailValid=true;if(!emailValue){scope.invalidEmailMessageShown=!emailValid;return emailValid;}else if(emailValue.length>EMAIL_MAX_LENGTH){emailValid=false;return emailValid;}
if(formFieldsValidatorService.emailValidation(emailValue)&&(emailInputFieldValue!=='')){emailInputFieldElem.val('');scope.addEmailTag(emailValue);$timeout(function(){emailInputFieldElem.val('');scope.checkInputWidth();},0);}else if(emailInputFieldValue!==''){emailValid=false;}
scope.invalidEmailMessageShown=!emailValid;return emailValid;};scope.checkInputWidth=function(){var emailInputFieldElem=angular.element(tagsInputFieldElement),inputValue=emailInputFieldElem.val();if(scope.emailTags.length!==0&&(!inputValue||inputValue.length===0)){emailInputFieldElem.addClass(reduceWithClass);}else{emailInputFieldElem.removeClass(reduceWithClass);}};scope.emailTagsUnderMaxLimit=function(){var response=scope.emailTags.length<=EMAIL_FIELD_MAX_LIMIT;scope.invalidMaxLimitMessageShown=!response;return response;};scope.addEmailTag=function(emailValue){if(scope.emailPlaceholder!==''){scope.emailPlaceholder='';}
scope.emailTags.push(emailValue);};scope.removeEmailTag=function(index){var emailInputFieldElem=angular.element(tagsInputFieldElement),inputEl;scope.emailTags.splice(index,1);if(scope.emailTags.length===0){inputEl=angular.element('.email-tag-list');inputEl.removeClass(inputFilledClass);emailInputFieldElem.val('');scope.emailPlaceholder=emailFieldDefaultPlaceholder;scope.checkInputWidth();}else if(scope.emailTags.length===EMAIL_FIELD_MAX_LIMIT){$timeout(function(){emailInputFieldElem.blur();},0);}};scope.setInputFocus=function(){var emailInputFieldElem=angular.element(tagsInputFieldElement);emailInputFieldElem.focus();};scope.closeDropboxModal=function(){$rootScope.$broadcast('closeDropboxModal');};scope.sendFileToWeTransfer=function(invalidForm){var gettyId=adpStateService.gettyId,params,omnitureMessage,messageInputFieldElem=angular.element('#message-field');if(invalidForm){return;}
params={'gettyMasterId':gettyId,'assetSize':scope.downloadedFileSize,'toEmails':scope.emailTags,'emailMessage':messageInputFieldElem.val()};scope.loadingState=true;weTransferService.sendToWeTransfer(params).then(function(){scope.loadingState=false;scope.trimUserEmailAddress();scope.showSuccessfulModal=true;scope.showWeTransferRequestError=false;omnitureMessage='You did it! You successfully sent your file with weTransfer.'+'Expect a confirmation email at '+
scope.userEmailAddress+' shortly.';omnitureService.weTransferRequestSent(omnitureMessage);}).catch(function(){scope.loadingState=false;scope.showWeTransferRequestError=true;omnitureMessage='Unable to complete your request at this time. '+'Please try again later or contact us if the issue continues.';omnitureService.weTransferRequestSent(omnitureMessage);});};scope.trimUserEmailAddress=function(){var trimEmail,ellipsis='...';if(windowElement.innerWidth()<800&&scope.userEmailAddress.length>32){trimEmail=scope.userEmailAddress.substring(0,29);trimEmail=trimEmail+ellipsis;scope.trimEmailAddress=trimEmail;}else if(scope.userEmailAddress.length>42){trimEmail=scope.userEmailAddress.substring(0,40);trimEmail=trimEmail+ellipsis;scope.trimEmailAddress=trimEmail;}else{scope.trimEmailAddress=scope.userEmailAddress;}};scope.resetForm=function(){var emailInputFieldElem=angular.element(tagsInputFieldElement),messageInputFieldElem=angular.element('#message-field');scope.showSuccessfulModal=false;scope.emailTags=[];scope.messageData='';scope.emailPlaceholder=emailFieldDefaultPlaceholder;emailInputFieldElem.val('');messageInputFieldElem.val('');emailInputFieldElem.parent().removeClass(inputFilledClass);messageInputFieldElem.parent().removeClass(inputFilledClass);scope.checkInputWidth();};scope.getFileTypeForTranslation=function(){if(scope.fileType==='video'||scope.fileType==='audio'){return(scope.fileType).toUpperCase();}else{return'IMAGE';}};scope.handleBackspaceKey=function(event){var emailInputFieldElem=angular.element(tagsInputFieldElement),emailInputValue=emailInputFieldElem.val().trim();if(event.keyCode===8&&emailInputValue.length===0){scope.emailTags.pop();if(scope.emailTags.length===EMAIL_FIELD_MAX_LIMIT){$timeout(function(){emailInputFieldElem.blur();emailInputFieldElem.focus();},0);}else if(scope.emailTags.length===0){scope.emailPlaceholder=emailFieldDefaultPlaceholder;emailInputFieldElem.removeClass(reduceWithClass);}}};scope.init();}};}]);}());(function(){'use strict';var module=angular.module('adp.directives');module.directive('adpFileSizeInline',[function(){return{restrict:'E',templateUrl:'/static/js/angular/apps/adp/partials/details/_fileSizeInline.html',link:function(scope){var displayLargestSize,removeExtraSmallSizes;removeExtraSmallSizes=function(){var tempSizes=[],list=[],key='';if(scope.adp.asset.assetType==='photo'){key='photoId';list=scope.adp.asset.photoList;}else{if(scope.adp.asset.assetType!=='vector'){key='rasterId';list=scope.adp.asset.rasterList;}}
tempSizes=list.filter(function(item){return!(/x+small/i.test(item[key]));});scope.availableSizes=tempSizes;};displayLargestSize=function(){if(scope.adp.asset.assetType!=='vector'){var current=scope.availableSizes[scope.availableSizes.length-1],presentation=scope.adp.asset.presentation,ratio=presentation.measurements.conversionRatio;if(scope.adp.asset.assetType==='photo'){scope.adp.asset.assetDimensions.widthInPixels=current.widthInPixels;scope.adp.asset.assetDimensions.heightInPixels=current.heightInPixels;presentation.measurements.dotsPer=(current.dpi/ratio).toFixed(1);presentation.measurements.width=(current.widthInPixels/presentation.measurements.dotsPer).toFixed(1);presentation.measurements.height=(current.heightInPixels/presentation.measurements.dotsPer).toFixed(1);}else{scope.adp.asset.rasterList.widthInPixels=current.widthInPixels;scope.adp.asset.rasterList.heightInPixels=current.heightInPixels;presentation.measurements.dotsPer=(current.dpi/ratio).toFixed(1);presentation.measurements.width=(current.widthInPixels/presentation.measurements.dotsPer).toFixed(1);presentation.measurements.height=(current.heightInPixels/presentation.measurements.dotsPer).toFixed(1);}
scope.presentation=presentation;}};removeExtraSmallSizes();displayLargestSize();}};}]);}());(function(){'use strict';var module=angular.module('adp.directives');module.directive('adpKount',[function(){return{restrict:'E',scope:{session:'=session'},link:function(scope,element){scope.$watch('session',function(){if(scope.session.pixelUrl){element.html('<img class="ng-hide" src="'+scope.session.pixelUrl+'"></img>');}});}};}]);}());(function(){'use strict';var module=angular.module('adp.directives');module.directive('adpAdminPanel',['$window','urlBuilder',function($window,urlBuilder){return{restrict:'E',require:'?ngModel',templateUrl:'/static/js/angular/apps/adp/partials/amp/_adminRefinePanel.html',transclude:true,link:function(scope){var MEDIUM_DOWN_BREAKPOINT=1024;scope.init=function(){scope.$watch(function(){return angular.element($window).innerWidth();},function(windowWidth){if(windowWidth<=MEDIUM_DOWN_BREAKPOINT){scope.mobilePanel=true;}else{scope.mobilePanel=false;}},true);scope.collectionSelected=scope.adminData.availableCollections[0];scope.activateFileLabel='Deactivate';if(scope.adminData.removeAdultContentFilter===true){scope.contentFilterLabel='Remove';}else{scope.contentFilterLabel='Apply';}
if(scope.adminData.isFileDeactivated){scope.activateFileLabel='Reactivate';}};scope.manageMoveCollection=function(collectionId){var redirectUrl=[urlBuilder.getUrlInfix(),scope.adminData.fileUrl,'move-collection',collectionId].join('/');$window.location.href=redirectUrl;};scope.contentFilterAction=function(){var filter;if(scope.adminData.removeAdultContentFilter===true){filter='No';}else{filter='Yes';}
$window.location.href=urlBuilder.getUrlInfix()+'/'+scope.adminData.fileUrl+'?applyFilter='+filter;};scope.userCanViewFileDetailsSection=function(){return(scope.adminData.permissions.fileViews||scope.adminData.permissions.downloads||scope.adminData.permissions.inspectedBy);};scope.userCanViewMaintenanceTopSection=function(){return(scope.adminData.permissions.editFileInfo||scope.adminData.permissions.applyContentFilter);};scope.userCanViewMaintenanceBottomSection=function(){return(scope.adminData.permissions.downloadOriginal||scope.adminData.permissions.replaceFile||scope.adminData.permissions.reprocessFile||scope.adminData.permissions.deactivateFile);};scope.userCanViewReleasesSection=function(){return(scope.adminData.permissions.uploadModelRelease||(scope.adminData.permissions.viewModelRelease&&scope.adminData.showModelRelease)||(scope.adminData.permissions.uploadConsentRelease&&scope.adp.asset.isEditorial)||(scope.adminData.permissions.viewConsentRelease&&scope.adp.asset.isEditorial&&scope.adminData.editorialConsentDocuments));};scope.userCanViewCollectionHistory=function(){var collectionHistory=scope.adminData.permissions.collectionHistory&&(scope.adminData.currentTaxonomy||scope.adminData.previousTaxonomy||scope.adminData.modifyBy.username||scope.adminData.premiereNomination);return collectionHistory;};scope.userCanViewVideoInfoSection=function(){return scope.adminData.permissions.viewVideoInfo&&scope.adminData.videoInfo;};scope.init();}};}]);}());(function(){'use strict';var module=angular.module('adp.directives');module.directive('adpAdminModal',[function(){return{restrict:'E',require:'?ngModel',templateUrl:'/static/js/angular/apps/adp/partials/amp/_adminRefineModal.html',transclude:true,link:function(scope){scope.init=function(){scope.showAdminModal=false;};scope.toogleAdminRefinePanel=function(){scope.showAdminModal=!scope.showAdminModal;};scope.onSubmit=function(){scope.showAdminModal=false;};scope.init();}};}]);}());(function(){'use strict';angular.module('adp.services').factory('availabilityService',['$q','OptionsRestangular',function($q,OptionsRestangular){var ASSETS_ENDPOINT='assets',AVAILABILITY_ENDPOINT='availability',_getAvailability;_getAvailability=function(gettyId){var defer=$q.defer();OptionsRestangular.getJavaRestConfig().one(ASSETS_ENDPOINT,gettyId).one(AVAILABILITY_ENDPOINT).get().then(function(availability){defer.resolve(availability);}).then(function(error){defer.reject(error);});return defer.promise;};return{getAvailability:_getAvailability};}]);}());(function(){'use strict';angular.module('adp.services').factory('concreteTypeService',['$filter',function($filter){var _getTypeName;_getTypeName=function(typeId){var typeName='';switch(typeId){case'DV':typeName='DV';break;case'NTSC':typeName='NTSC';break;case'PAL':typeName='PAL';break;case'NTSC_SMALL_WEB_MOV':case'NTSC_SMALL_WEB_MP4':case'PAL_SMALL_WEB_MOV':case'PAL_SMALL_WEB_MP4':case'HD_SMALL_WEB_MOV':case'HD_SMALL_WEB_MP4':typeName=$filter('i18n')('SELECT_SMALL_WEB');break;case'NTSC_BIG_WEB_MOV':case'NTSC_BIG_WEB_MP4':case'PAL_BIG_WEB_MOV':case'PAL_BIG_WEB_MP4':case'HD_BIG_WEB_MOV':case'HD_BIG_WEB_MP4':typeName=$filter('i18n')('SELECT_BIG_WEB');break;case'HD_720':typeName=$filter('i18n')('SELECT_HD')+' 720';break;case'HD_1080':typeName=$filter('i18n')('SELECT_HD')+' 1080';break;case'NATIVE_4K_VIDEO':case'ULTRAHD_4K_VIDEO':typeName=$filter('i18n')('SELECT_NATIVE_4K');break;}
return typeName;};return{getTypeName:_getTypeName};}]);}());(function(){'use strict';angular.module('adp.services').factory('downloadService',['OptionsRestangular',function(OptionsRestangular){var ASSETS_ENDPOINT='assets',_getDownload;_getDownload=function(gettyId,params){var referer=document.referrer;return OptionsRestangular.getJavaFullResponseConfig(referer).one(ASSETS_ENDPOINT,gettyId).customPOST(params);};return{getDownload:_getDownload};}]);}());(function(){'use strict';angular.module('adp.services').factory('extendedLicenseService',['$q','OptionsRestangular',function($q,OptionsRestangular){var ASSETS_ENDPOINT='assets',LICENSES_ENDPOINT='licenses',cachedData={licenses:{}},_getLicenses;_getLicenses=function(gettyId){var defer=$q.defer();if(!(gettyId in cachedData.licenses)){OptionsRestangular.getJavaRestConfig().one(ASSETS_ENDPOINT,gettyId).one(LICENSES_ENDPOINT).get().then(function(response){cachedData.licenses[gettyId]=response;defer.resolve(cachedData.licenses[gettyId]);},function(response){defer.reject(response);});}else{defer.resolve(cachedData.licenses[gettyId]);}
return defer.promise;};return{getLicenses:_getLicenses};}]);}());(function(){'use strict';angular.module('adp.services').factory('similarFilesService',['$q','OptionsRestangular',function($q,OptionsRestangular){var ASSETS_ENDPOINT='assets',SIMILAR_FILES_ENDPOINT='similar',_getSimilarFiles;_getSimilarFiles=function(gettyId,acceptLanguage,pageNumber,itemsPerPage){var params={'Accept-Language':null,'pageNumber':pageNumber,'itemsPerPage':itemsPerPage},defer=$q.defer();OptionsRestangular.getJavaRestConfig().one(ASSETS_ENDPOINT,gettyId).one(SIMILAR_FILES_ENDPOINT).get(params).then(function(similarFiles){defer.resolve(similarFiles);},function(error){defer.reject(error);});return defer.promise;};return{getSimilarFiles:_getSimilarFiles};}]);}());(function(){'use strict';angular.module('adp.services').factory('licenseStateService',['extendedLicenseService','spinnerService','adpStateService','purchaseStateService','viewStateService','ctaTitleService','$filter','$interval','ADP_ERROR_MESSAGING',function(extendedLicenseService,spinnerService,adpStateService,purchaseStateService,viewStateService,ctaTitleService,$filter,$interval,ERROR_MESSAGING){var _purchaseOptions=purchaseStateService.purchaseOptions,_openAMP,_openLicenseTable,_closeLicenseTable,_licenseClicked,_clearLicenses,_purchaseLicenses,_updatePrice,_isLicenseSelected,_state;_state={extendedLicenses:[],selectedLicenses:[],totalExtLicensePrice:0};_openAMP=function(){window.location='//'+window.location.hostname+'/manage/file-closeup/index'+window.location.pathname+'#administration';};_openLicenseTable=function(){if(_state.extendedLicenses.length===0){spinnerService.show('adp-ext-license');_state.extendedLicenses[0]={title:$filter('i18n')('LICENSE_STANDARD'),priceInCredits:adpStateService.asset.standardPriceInCredits,licenseType:'',hasBeenPurchased:false,canBePurchased:true,readOnly:true};extendedLicenseService.getLicenses(adpStateService.gettyId).then(function(licenses){adpStateService.error.showErrorMessage=false;for(var i=0;i<licenses.length;i++){if(!licenses[i].hasBeenPurchased){licenses[i].readOnly=false;}else if(licenses[i].canBePurchased){licenses[i].readOnly=false;}else if(!licenses[i].canBePurchased){licenses[i].readOnly=true;}
licenses[i].title=$filter('i18n')('LICENSE_'+((licenses[i].title).split(' ')[0]).toUpperCase());}
_state.extendedLicenses=_state.extendedLicenses.concat(licenses);angular.element('.adp-set-max-height').each(function(){var t=angular.element(this);t.css({'max-height':t.height()});});}).catch(function(){adpStateService.error.showErrorMessage=true;adpStateService.error.errorMessage=ERROR_MESSAGING.LICENSE_ERROR;}).finally(function(){spinnerService.hide('adp-ext-license');viewStateService.activeState.showExtendedLicenses=true;});if(_purchaseOptions.availability&&_purchaseOptions.availability.reason&&_purchaseOptions.availability.reason.previousDownload){_updatePrice(0);}}else{viewStateService.activeState.showExtendedLicenses=true;}};_closeLicenseTable=function(){viewStateService.activeState.showExtendedLicenses=false;_clearLicenses();};_licenseClicked=function(license){var selected;if(license.readOnly){return;}
if(_state.selectedLicenses.indexOf(license)>=0){_updatePrice(_purchaseOptions.cost-license.priceInCredits);_state.totalExtLicensePrice-=license.priceInCredits;_state.selectedLicenses.splice(_state.selectedLicenses.indexOf(license),1);}else{_updatePrice(_purchaseOptions.cost+license.priceInCredits);_state.totalExtLicensePrice+=license.priceInCredits;_state.selectedLicenses.push(license);}
viewStateService.setActiveState(viewStateService.views.download);selected=_isLicenseSelected();ctaTitleService.decideTitleOnLicenseClick(selected,license.priceInCredits);};_clearLicenses=function(){_state.selectedLicenses=[];_updatePrice(_purchaseOptions.cost-_state.totalExtLicensePrice);_state.totalExtLicensePrice=0;ctaTitleService.resetCtaTitle();};_purchaseLicenses=function(){_state.extendedLicenses.forEach(function(license){if(_state.selectedLicenses.indexOf(license)>=0){license.readOnly=true;_updatePrice(_purchaseOptions.cost+license.priceInCredits);}});};_updatePrice=function(price){purchaseStateService.purchaseOptions.cost=price;};_isLicenseSelected=function(){return _state.selectedLicenses.length>0;};return{openAMP:_openAMP,openLicenseTable:_openLicenseTable,closeLicenseTable:_closeLicenseTable,licenseClicked:_licenseClicked,purchaseLicenses:_purchaseLicenses,clearLicenses:_clearLicenses,isLicenseSelected:_isLicenseSelected,state:_state};}]);}());(function(){'use strict';angular.module('adp.services').factory('purchaseStateService',['adpStateService',function(adpStateService){var _purchaseOptions,_purchaseStatus,_setType,_setDisabled,_setPurchaseStatus,_decideIfSubCanBeUsed,_getStateWithCredits,_getStateWithSub,_decide;_purchaseOptions={type:'',cost:adpStateService.asset.standardPriceInCredits,subDisabled:false,availability:null,size:''};_purchaseStatus={hasCredits:false,enoughCredits:false,hasSub:false,redownload:false,rightSubType:null,downloadsLeft:null,audioVideo:false,isCorporateSlave:false};_setType=function(type){if(_purchaseOptions.subDisabled&&type==='sub'){return;}
_purchaseOptions.type=type;};_setDisabled=function(disabled){_purchaseOptions.subDisabled=disabled;};_decide=function(extLicensePurchase,freeFile,viewStates,warnings){var newState;_setPurchaseStatus(extLicensePurchase);if(_purchaseStatus.redownload){newState=viewStates.redownload;}else if(freeFile){newState=viewStates.confirmDownload;}else if(_purchaseStatus.hasSub&&!extLicensePurchase){newState=_getStateWithSub(viewStates,warnings);}else{newState=_getStateWithCredits(viewStates);}
return newState;};_getStateWithCredits=function(viewStates){var newState;if(_purchaseStatus.enoughCredits){newState=viewStates.confirmDownload;}else{if(_purchaseStatus.isCorporateSlave){newState=viewStates.noSubNoCreditsCorporateSlave;}else{newState=viewStates.noSubNoCredits;}}
return newState;};_getStateWithSub=function(viewStates,warnings){var newState;if(_purchaseStatus.enoughCredits){if(_purchaseStatus.rightSubType&&_purchaseStatus.downloadsLeft){newState=viewStates.withSubWithCredits;}else if(!_purchaseStatus.rightSubType&&_purchaseStatus.downloadsLeft){newState=viewStates.wrongSubTypeWithCredits;}else if(_purchaseStatus.rightSubType&&!_purchaseStatus.downloadsLeft){newState=viewStates.noSubDLWithCredits;}else if(!_purchaseStatus.rightSubType&&!_purchaseStatus.downloadsLeft){newState=viewStates.wrongSubTypeWithCredits;}
if(_purchaseStatus.audioVideo){newState.warningBox=true;newState.warningType=warnings.WRONG_FILE_TYPE_CRED;}}else{if(_purchaseStatus.rightSubType&&_purchaseStatus.downloadsLeft){if(_purchaseStatus.hasCredits){newState=viewStates.subDLInsufficientCredits;}else{newState=viewStates.confirmDownload;}}else if(_purchaseStatus.rightSubType&&!_purchaseStatus.downloadsLeft){if(_purchaseStatus.isCorporateSlave){newState=viewStates.noSubDlInsufficientCreditsCorporateSlave;}else{newState=viewStates.noSubDLNoCredits;}}else if(!_purchaseStatus.rightSubType){if(_purchaseStatus.isCorporateSlave){newState=viewStates.wrongSubTypeNoCreditsCorporateSlave;}else{newState=viewStates.wrongSubTypeNoCredits;}}
if(_purchaseStatus.audioVideo){if(_purchaseStatus.isCorporateSlave){newState=viewStates.noSubNoCreditsCorporateSlave;}else{newState=viewStates.noSubNoCredits;}
newState.warningBox=true;newState.warningType=warnings.WRONG_FILE_TYPE_NO_CREDS;}}
return newState;};_setPurchaseStatus=function(extLicensePurchase){if(adpStateService.user===null){return;}
if(_purchaseOptions.availability!==null){_purchaseStatus.redownload=(_purchaseOptions.availability.isDownloadable&&_purchaseOptions.availability.reason.previousDownload)&&!extLicensePurchase;}
_purchaseStatus.hasCredits=adpStateService.user.numCredits!==0;_purchaseStatus.hasSub=adpStateService.user.hasSub;_purchaseStatus.audioVideo=adpStateService.asset.assetType==='audio'||adpStateService.asset.assetType==='video';_purchaseStatus.enoughCredits=(adpStateService.user.numCredits>=_purchaseOptions.cost)||(adpStateService.asset.isFreeFile&&!extLicensePurchase);if(adpStateService.user.hasSub){_purchaseStatus.rightSubType=!(adpStateService.user.sub.type==='essentials'&&adpStateService.asset.collection==='signature');_purchaseStatus.downloadsLeft=adpStateService.user.sub.downloadsRemaining>0;_decideIfSubCanBeUsed(extLicensePurchase);}
if(adpStateService.user.corporateInfo){_purchaseStatus.isCorporateSlave=!!adpStateService.user.corporateInfo.isCorporateSlave;}};_decideIfSubCanBeUsed=function(extLicensePurchase){var invalidSub,wrongAssetType;invalidSub=(!_purchaseStatus.rightSubType||!_purchaseStatus.downloadsLeft||extLicensePurchase);wrongAssetType=adpStateService.asset.assetType==='audio'||adpStateService.asset.assetType==='video';if(invalidSub||wrongAssetType){_setDisabled(true);_setType('credits');}else{_setDisabled(false);_setType('sub');}};return{purchaseOptions:_purchaseOptions,purchaseStatus:_purchaseStatus,setType:_setType,setDisabled:_setDisabled,setPurchaseStatus:_setPurchaseStatus,decide:_decide};}]);}());(function(){'use strict';angular.module('adp.services').factory('viewStateService',['$q','$filter','adpStateService','availabilityService','purchaseStateService',function($q,$filter,adpStateService,availabilityService,purchaseStateService){var _init,_viewStates,_setActiveState,_updateViewsWithStateInfo,_setSubWithCreditsStateInfo,_setRedownloadStateInfo,_getAssetTypeConfig,_isDownloadState,_assetTypeConfig={},_activeState={},_warningStates={},_assetTypeConfigs={};_assetTypeConfigs={photo:{freeLabel:$filter('i18n')('FREE_PHOTO'),includedInSub:true,showDropDown:false},vector:{freeLabel:$filter('i18n')('FREE_VECTOR'),includedInSub:true,showDropDown:false},raster:{freeLabel:$filter('i18n')('FREE_PHOTO'),includedInSub:true,showDropDown:false},audio:{freeLabel:$filter('i18n')('FREE_AUDIO'),includedInSub:false,showDropDown:true},video:{freeLabel:$filter('i18n')('FREE_VIDEO'),includedInSub:false,showDropDown:true}};_warningStates={NO_SUB_NO_CRED:'no-sub-no-credits',NO_SUB_INSUFFICIENT_CRED:'no-downloads-insufficient-credits',NO_DL_W_CRED:'no-downloads-with-credits',WRONG_SUB_NO_CRED:'wrong-sub-no-credits',WRONG_SUB_W_CRED:'wrong-sub-with-credits',WRONG_FILE_TYPE_CRED:'wrong-file-type-credits',WRONG_FILE_TYPE_NO_CREDS:'wrong-file-type-no-credits-file-cost'};_viewStates={download:{title:'',ctaTitle:'',ctaAction:'purchaseFile',ctaClass:'super-cta',showSubTypeMessage:false,showFileTypeDropdown:true,confirmSection:false,completeSection:false,redownloadSection:false,focusView:false,warningBox:false,paymentSelect:false},confirmDownload:{ctaTitle:$filter('i18n')('CONFIRM_DOWNLOAD_BUTTON'),ctaClass:'primary-cta',ctaAction:'confirmPurchase',confirmSection:true,showSubTypeMessage:false,showFileTypeDropdown:false},completeDownload:{stateName:'CompleteState',title:'DOWNLOAD_COMPLETE_TITLE',ctaTitle:'',ctaClass:'adp-purchase-complete-btn',confirmSection:false,paymentSelect:false,completeSection:true,warningBox:false,showSubTypeMessage:false,showFileTypeDropdown:false,redownloadSection:false,showDropboxSyncFeedback:false,showWeTransferCTA:false},completeDownloadFocus:{title:'DOWNLOAD_COMPLETE_TITLE',stateName:'CompleteState',ctaTitle:'',ctaClass:'adp-purchase-complete-btn',confirmSection:false,completeSection:true,showFileTypeDropdown:false,paymentSelect:false,focusView:true,warningBox:false,redownloadSection:false},redownload:{title:'REDOWNLOAD_TITLE',ctaTitle:$filter('i18n')('CONFIRM_DOWNLOAD_BUTTON'),ctaClass:'primary-cta',ctaAction:'confirmPurchase',focusView:true,confirmSection:false,redownloadSection:true,showExtendedLicenses:false,showSubTypeMessage:false,showFileTypeDropdown:false},noSubNoCredits:{title:'NEED_CREDITS_TITLE',ctaTitle:$filter('i18n')('BUY_CREDITS_BUTTON'),ctaAction:'goToPricing',ctaClass:'primary-cta',showExtendedLicenses:false,focusView:true,showSubTypeMessage:false,showFileTypeDropdown:false,warningBox:true,warningType:_warningStates.NO_SUB_NO_CRED},noSubNoCreditsCorporateSlave:{title:'NEED_CREDITS_TITLE',ctaClass:'hide',showExtendedLicenses:false,focusView:true,showSubTypeMessage:false,showFileTypeDropdown:false,warningBox:true,warningType:_warningStates.NO_SUB_NO_CRED,showPromptForAdmin:true},wrongSubTypeWithCredits:{title:'',ctaTitle:$filter('i18n')('CONFIRM_DOWNLOAD_BUTTON'),ctaClass:'primary-cta',ctaAction:'confirmPurchase',focusView:true,warningBox:true,warningType:_warningStates.WRONG_SUB_W_CRED,paymentSelect:true,showFileTypeDropdown:false,confirmSection:true,showExtendedLicenses:false},noSubDLWithCredits:{title:'',ctaTitle:$filter('i18n')('CONFIRM_DOWNLOAD_BUTTON'),ctaClass:'primary-cta',ctaAction:'confirmPurchase',focusView:true,warningBox:true,warningType:_warningStates.NO_DL_W_CRED,paymentSelect:true,showFileTypeDropdown:false,confirmSection:true,showExtendedLicenses:false},withSubWithCredits:{title:'',ctaTitle:$filter('i18n')('CONFIRM_DOWNLOAD_BUTTON'),ctaAction:'confirmPurchase',ctaClass:'primary-cta',focusView:true,warningBox:false,paymentSelect:true,confirmSection:true,showExtendedLicenses:false,showFileTypeDropdown:false},wrongSubTypeNoCredits:{title:'NEED_CREDITS_TITLE',ctaTitle:$filter('i18n')('BUY_CREDITS_BUTTON'),ctaAction:'goToPricing',ctaClass:'primary-cta',showExtendedLicenses:false,warningBox:true,warningType:_warningStates.WRONG_SUB_NO_CRED,focusView:true,confirmSection:false,showFileTypeDropdown:false},wrongSubTypeNoCreditsCorporateSlave:{title:'NEED_CREDITS_TITLE',ctaClass:'hide',showExtendedLicenses:false,warningBox:true,warningType:_warningStates.WRONG_SUB_NO_CRED,focusView:true,confirmSection:false,showFileTypeDropdown:false,showPromptForAdmin:true},noSubDLNoCredits:{title:'OUT_OF_DOWNLOADS_TITLE',ctaTitle:$filter('i18n')('BUY_CREDITS_BUTTON'),ctaAction:'goToPricing',ctaClass:'primary-cta',showExtendedLicenses:false,warningBox:true,warningType:_warningStates.NO_SUB_INSUFFICIENT_CRED,focusView:true,confirmSection:false,showFileTypeDropdown:false},noSubDlInsufficientCreditsCorporateSlave:{title:'OUT_OF_DOWNLOADS_TITLE',ctaClass:'hide',showExtendedLicenses:false,warningBox:true,warningType:_warningStates.NO_SUB_INSUFFICIENT_CRED,focusView:true,confirmSection:false,showFileTypeDropdown:false,showPromptForAdmin:true},subDLInsufficientCredits:{ctaTitle:$filter('i18n')('CONFIRM_DOWNLOAD_BUTTON'),ctaClass:'primary-cta',ctaAction:'confirmPurchase',confirmSection:true,showSubTypeMessage:false,showFileTypeDropdown:false,paymentSelect:true},buyCredits:{ctaTitle:$filter('i18n')('BUY_CREDITS_BUTTON'),ctaClass:'super-cta',ctaAction:'buyCredits',confirmSection:false,showSubTypeMessage:false,showFileTypeDropdown:false,paymentSelect:false},paymentClarityBuyCredits1:{ctaTitle:'Buy 1 credit',ctaClass:'super-cta',ctaAction:'buyCredits',confirmSection:false,showSubTypeMessage:false,showFileTypeDropdown:false,paymentSelect:false},paymentClarityBuyCredits3:{ctaTitle:'Buy 3 credits',ctaClass:'super-cta',ctaAction:'buyCredits',confirmSection:false,showSubTypeMessage:false,showFileTypeDropdown:false,paymentSelect:false},paymentClarityPurchasePlan:{ctaTitle:'Choose a plan',ctaClass:'super-cta',ctaAction:'goToPricing',confirmSection:false,showSubTypeMessage:false,showFileTypeDropdown:false,paymentSelect:false}};_init=function(asset,user,gettyId){_updateViewsWithStateInfo(asset,user);_setSubWithCreditsStateInfo(asset);_setRedownloadStateInfo(gettyId);};_updateViewsWithStateInfo=function(asset,user){var rightSub=false,preferEssential=adpStateService.paymentPreference==='s',preferSignature=adpStateService.paymentPreference==='p';if(user){if(user.hasSub){rightSub=!(user.sub.type==='essentials'&&asset.collection==='signature');user.rightSub=rightSub;}}else{rightSub=(asset.collection==='signature'&&preferSignature)||(asset.collection==='essentials'&&(preferEssential||preferSignature));}
_assetTypeConfig=_assetTypeConfigs[adpStateService.asset.assetType];_viewStates.download.showSubTypeMessage=rightSub&&_assetTypeConfig.includedInSub;_viewStates.confirmDownload.showSubTypeMessage=rightSub&&_assetTypeConfig.includedInSub;adpStateService.correctSubscription=rightSub;purchaseStateService.purchaseOptions.cost=asset.standardPriceInCredits;_viewStates.download.title=asset.presentation.collection.toUpperCase()+'_COLLECTION';_viewStates.confirmDownload.title=asset.presentation.collection.toUpperCase()+'_DOWNLOAD_TITLE';_viewStates.download.showFileTypeDropdown=_assetTypeConfig.showDropDown;};_setRedownloadStateInfo=function(gettyId){var defer=$q.defer();availabilityService.getAvailability(gettyId).then(function(availability){purchaseStateService.purchaseOptions.availability=availability;defer.resolve(availability);}).then(function(error){defer.resolve(error);});return defer.promise;};_setSubWithCreditsStateInfo=function(asset){var newCollection=(asset.presentation.collection+'_download_title').toUpperCase();_viewStates.wrongSubTypeWithCredits.title=newCollection;_viewStates.noSubDLWithCredits.title=newCollection;_viewStates.withSubWithCredits.title=newCollection;};_setActiveState=function(state){angular.extend(_activeState,state);angular.element('#download-button').removeClass().addClass(state.ctaClass);};_getAssetTypeConfig=function(){return _assetTypeConfig;};_isDownloadState=function(){return!(_activeState.confirmSection||_activeState.completeSection||_activeState.redownloadSection);};return{init:_init,views:_viewStates,warnings:_warningStates,getAssetTypeConfig:_getAssetTypeConfig,setActiveState:_setActiveState,activeState:_activeState,isDownloadState:_isDownloadState,setRedownloadStateInfo:_setRedownloadStateInfo};}]);}());(function(){'use strict';angular.module('adp.services').factory('keywordsService',['urlBuilder',function(urlBuilder){var BASE_NUM_KEYWORDS=18,TOP_NUM_KEYWORDS=5,self,_keywords={baseKeywords:{},extraKeywords:{}};self={getKeywords:function(keywords){var allKeywords=keywords;if(allKeywords){_keywords.baseKeywords=allKeywords.slice(0,BASE_NUM_KEYWORDS);_keywords.extraKeywords=allKeywords.slice(BASE_NUM_KEYWORDS,allKeywords.length);}
return _keywords;},getTopKeywords:function(keywords){var allKeywords=keywords,topKeywords=[];if(allKeywords){topKeywords=allKeywords.slice(0,TOP_NUM_KEYWORDS);}
return topKeywords;},getSearchUrl:function(assetType){if(!assetType){return'';}
var searchUrl={'audio':'PAGE_SRP_AUDIO','illustration':'PAGE_SRP_ILLUSTRATION','vector':'PAGE_SRP_ILLUSTRATION','raster':'PAGE_SRP_ILLUSTRATION','photo':'PAGE_SRP_PHOTO','video':'PAGE_SRP_VIDEO'};return urlBuilder.getTranslatedUrl(searchUrl[assetType.toLowerCase()]);}};return self;}]);}());(function(){'use strict';angular.module('adp.services').factory('seoUrlService',[function(){var getAssetId;getAssetId=function(seoUrl){var results=seoUrl.split(/-([\d]+)$/);if(results.length<2){return 0;}
return results[1];};return{getAssetId:getAssetId};}]);}());(function(){'use strict';angular.module('adp.services').factory('flashService',[function(){return{flashTag:function(playerPath,asset,flashVars,width,height){var tag=new FlashTag(playerPath,width,height);tag.setAlt(asset.title);tag.setTitle(asset.title);tag.setFlashvars(flashVars);return tag.toString();}};}]);}());(function($){'use strict';angular.module('adp.services').factory('adpEnsightenService',['adpStateService','$injectedData',function(adpStateService,injectedData){var self={init:function(){var asset,account={numCredits:''};if(!self.isEnsightenEnabled()){return;}
adpStateService.fetchAsset().then(function(assetInfo){asset=assetInfo;return adpStateService.fetchAccount();}).then(function(_account){account=_account;}).finally(function(){if(asset){self.setTrackingData(asset,account);self.bootstrapEnsighten();}});},setTrackingData:function(asset,account){var trackingData={};self.setDefaultValues(trackingData);self.setAccountValues(trackingData,account);self.setAssetValues(trackingData,asset);window.tracking_data=trackingData;},setDefaultValues:function(trackingData){trackingData.site_id='istock';trackingData.keyword_searched=self.getKeywords();},setAssetValues:function(trackingData,asset){trackingData.collection_type=asset.collection.charAt(0).toUpperCase()+
asset.collection.slice(1);trackingData.file_type=asset.assetType.charAt(0).toUpperCase()+
asset.assetType.slice(1);if(asset.assetType==='vector'){trackingData.page_name='iStock|Product|IllustrationFCP';}else if(trackingData.file_type){trackingData.page_name='iStock|Product|'+trackingData.file_type+'FCP';}
trackingData.product_sku=adpStateService.getAssetId();},setAccountValues:function(trackingData,account){trackingData.credits_remaining=account.numCredits;if(account.hasSub||account.numCredits>0){trackingData.customer_type='Existing';}else{trackingData.customer_type='New';}
if(account.hasSub){trackingData.sub_sku=account.sub.sku;trackingData.duration=account.sub.duration;}},bootstrapEnsighten:function(){if(injectedData.stage){$.getScript('//nexus.ensighten.com/getty/stage/Bootstrap.js');}else{$.getScript('//nexus.ensighten.com/getty/Bootstrap.js');}},isEnsightenEnabled:function(){return injectedData.ensightenEnabled;},getKeywords:function(){return injectedData.keywords;}};return self;}]);}(jQuery));(function(){'use strict';angular.module('adp.services').factory('adpStateService',['$q','$routeParams','$cookies','$filter','$sce','gettyMasterIdService','assetService','accountService','keywordsService','preferenceService','similarFilesService','categoryLinksService','$injectedData','ABSTRACT_TYPE','locker',function($q,$routeParams,$cookies,$filter,$sce,gettyMasterIdService,assetService,accountService,keywordsService,preferenceService,similarFilesService,categoryLinksService,injectedData,ABSTRACT_TYPE,locker){var _asset,_assetId,_gettyId,_preferences,self={adultContent:false,asset:{},kountSession:{},assetId:null,contentLoading:true,correctSubscription:false,ellipsisAltText:$filter('i18n')('ALT_TEXT_ELLIPSIS'),gettyId:null,paymentPreference:'c',keywords:{words:{},baseKeywords:{},extraKeywords:{},showExtraKeywords:false,searchUrl:'',topKeywords:{}},categories:[],hasCookie:false,alreadyVisited:false,metadataPartialName:null,similarFilesCMS:false,similarFiles:{assetPreviews:[],threshold:1,filesInARow:6,totalResults:0,sectionTitle:$filter('i18n')('SIMILAR_FILES_TITLE_PHOTO'),contributorLink:'',source:''},error:{showErrorMessage:false,errorMessage:''},user:null,init:function(){var defer=$q.defer();self.contentLoading=true;self.getAssetId();self.readCookie();if(injectedData.adultContent){self.adultContent=true;}
if(injectedData.showSimilarFilesCMS){self.similarFilesCMS=true;}
self.fetchAccount().finally(function(){self.fetchAsset().then(function(){self.contentLoading=false;defer.resolve();}).catch(function(response){self.contentLoading=false;defer.reject(response);});});return defer.promise;},initSimilarFiles:function(){var similarFilesObject={},defer=$q.defer();similarFilesService.getSimilarFiles(self.gettyId,undefined,1,self.similarFiles.filesInARow).then(function(similarFilesResults){similarFilesObject={assetPreviews:similarFilesResults.assetPreviews,threshold:self.similarFiles.threshold,filesInARow:self.similarFiles.filesInARow,totalResults:similarFilesResults.totalResults,sectionTitle:$filter('i18n')('SIMILAR_FILES_TITLE_'+self.asset.assetType.toUpperCase()),contributorLink:'/search/?facets={"57":"'+self.asset.referenceNumber+'","34":["'+ABSTRACT_TYPE[self.asset.assetType]+'"]}',source:similarFilesResults.source};if(injectedData.useCanonicalUrls&&similarFilesObject.assetPreviews!==undefined&&similarFilesObject.assetPreviews.length>0){similarFilesObject.assetPreviews.forEach(function(asset){if(asset.canonicalThumbnailsUrl!==undefined&&asset.canonicalThumbnailsUrl.mediumUrl!==undefined){asset.thumbnailsUrl.mediumUrl=asset.canonicalThumbnailsUrl.mediumUrl;}});}
self.similarFiles=similarFilesObject;if(similarFilesObject.totalResults>similarFilesObject.assetPreviews.length){similarFilesService.getSimilarFiles(self.gettyId,undefined,1,similarFilesObject.totalResults).then(function(secondResults){similarFilesObject.assetPreviews=secondResults.assetPreviews;self.similarFiles=similarFilesObject;defer.resolve(self.similarFiles);}).catch(defer.reject);}else{defer.resolve(self.similarFiles);}}).catch(defer.reject);return defer.promise;},getAssetId:function(){if(!_assetId){_assetId=injectedData.assetId;self.assetId=_assetId;}
return _assetId;},fetchGettyId:function(){var defer=$q.defer();if(!_gettyId){gettyMasterIdService.getMasterId(self.getAssetId()).then(function(gettyObject){self.gettyId=gettyObject.gettyMasterId;_gettyId=gettyObject.gettyMasterId;defer.resolve(gettyObject.gettyMasterId);}).catch(function(response){defer.reject(response);});}else{defer.resolve(_gettyId);}
return defer.promise;},fetchAsset:function(){var defer=$q.defer();if(!_asset){self.fetchGettyId().then(function(gettyId){self.gettyId=gettyId;return assetService.getAsset(gettyId,self.alreadyVisited,self.user);}).then(function(asset){self.asset=_asset=asset;self.massageAssetData(asset);self.initKeywords(asset,self.keywords);self.initThumbnails(asset);self.metadataMapping(asset);defer.resolve(_asset);}).catch(function(response){defer.reject(response);});}else{defer.resolve(_asset);}
return defer.promise;},fetchAccount:function(){var defer=$q.defer();if(injectedData.token){accountService.getAccount().then(function(account){self.user=account;self.massageUserData(account);self.getPreferences().then(function(){defer.resolve(account);});}).catch(function(response){defer.reject(response);});}else{defer.reject();}
return defer.promise;},getPreferences:function(){var defer=$q.defer();if(!_preferences){preferenceService.getPreferences().then(function(prefs){_preferences=prefs;defer.resolve(prefs);}).catch(defer.resolve);}else{defer.resolve(_preferences);}
return defer.promise;},initKeywords:function(asset,keywords){var words=keywordsService.getKeywords(asset.keywords);keywords.topKeywords=keywordsService.getTopKeywords(asset.keywords);keywords.baseKeywords=words.baseKeywords;keywords.extraKeywords=words.extraKeywords;keywords.searchUrl=keywordsService.getSearchUrl(asset.assetType);},initCategories:function(){self.categories=categoryLinksService.getCategoryLinks(self.asset.assetType);},initThumbnails:function(asset){asset.fullThumbnailSet=asset.thumbnails;if(injectedData.useCanonicalUrls&&asset.canonicalThumbnails){for(var url in asset.canonicalThumbnails){if(asset.canonicalThumbnails.hasOwnProperty(url)){asset.fullThumbnailSet[url]=asset.canonicalThumbnails[url];}}}},metadataMapping:function(asset){self.metadataPartialName=asset.assetType.toLowerCase();},massageAssetData:function(asset){var presentation={collection:'',type:'',title:''},titleMapping='TITLE_'+asset.assetType.toUpperCase(),conversionRatio,dimensions,useCanonicalVideo;if(asset.collection){presentation.collection=self.firstToUpper(asset.collection);}
if(asset.bestMatchCollection){presentation.bestMatchCollection=self.firstToUpper(asset.bestMatchCollection);if(presentation.bestMatchCollection==='Value'){presentation.bestMatchCollection='Value Bin';}}
if(asset.assetType){presentation.type=self.firstToUpper(asset.assetType);}
if(asset.title){presentation.title=$filter('i18n')(titleMapping,asset.title);presentation.altText=$filter('i18n')('ALT_TEXT_'+(asset.assetType).toUpperCase(),asset.title);}
if(asset.editorialCaption){presentation.editorialCaption=$sce.trustAsHtml(asset.editorialCaption);}
if(asset.assetType==='raster'&&asset.rasterList[0]){dimensions=asset.rasterList[0];}else{dimensions=asset.assetDimensions;}
if(dimensions&&dimensions.widthInPixels&&dimensions.heightInPixels&&dimensions.dpi){presentation.measurements={};if(_preferences&&_preferences.useMetric){conversionRatio=2.54;presentation.measurements.dotsPerUnit='px/cm';presentation.measurements.sizeUnit='cm';}else{conversionRatio=1.0;presentation.measurements.dotsPerUnit='dpi';presentation.measurements.sizeUnit='"';}
presentation.measurements.conversionRatio=conversionRatio;presentation.measurements.dotsPer=(dimensions.dpi/conversionRatio).toFixed(1);presentation.measurements.width=(dimensions.widthInPixels/presentation.measurements.dotsPer).toFixed(1);presentation.measurements.height=(dimensions.heightInPixels/presentation.measurements.dotsPer).toFixed(1);}
useCanonicalVideo=injectedData.useCanonicalUrls&&asset.canonicalThumbnails!==undefined&&asset.canonicalThumbnails.largeVideoUrl!==undefined;if(asset.assetType==='video'&&((asset.thumbnails!==undefined&&asset.thumbnails.largeVideoUrl!==undefined)||useCanonicalVideo)){presentation.videoMetadata={previewUrl:useCanonicalVideo?asset.canonicalThumbnails.largeVideoUrl:asset.thumbnails.largeVideoUrl};}
if(asset.assetType==='audio'){presentation.audioMetadata={fileId:self.getAssetId(),previewUrl:['/audio_mp3_preview.php?id=',self.getAssetId()].join('')};}
asset.presentation=presentation;},massageUserData:function(user){if(user.hasSub){user.presentation={};user.presentation.sub=self.firstToUpper(user.sub.type);}},toggleExtraKeywords:function(){self.keywords.showExtraKeywords=!self.keywords.showExtraKeywords;},showAdultContent:function(){self.adultContent=false;},readCookie:function(){var paymentCookieName='d_c',userCookieName='u_c',paymentCookie=$cookies[paymentCookieName],userCookie=$cookies[userCookieName],lockerSupported=locker.supported(),localeStorageKey='adpData',dataObj={},adpData,alreadyVisited;if(paymentCookie&&paymentCookie.indexOf('_ch')!==-1){self.paymentPreference=paymentCookie.substr(paymentCookie.indexOf('_ch')+4,1);}
if(userCookie){self.hasCookie=true;}
if(lockerSupported===true){adpData=locker.get(localeStorageKey);if(adpData){alreadyVisited=adpData.visited;}}
if(alreadyVisited){self.alreadyVisited=true;}else if(locker.supported()===true){dataObj.visited=true;locker.put(localeStorageKey,dataObj);}},firstToUpper:function(lowerString){return lowerString.charAt(0).toUpperCase()+lowerString.slice(1);}};return self;}]);}());(function(){'use strict';angular.module('adp.services').factory('metadataService',['$q','$location','$filter',function($q,$location,$filter){var _setGenericMetaData,_setTwitterMetaData,_setOGPMetaData;_setGenericMetaData=function(asset){var titleType,descriptionType,pageTitleType,translate=$filter('i18n'),translatedTitle,translatedDescription,translatedPageTitle;if(!asset.isEditorial){switch(asset.assetType){case'photo':titleType='META_TITLE_PHOTO';descriptionType='META_DESCRIPTION_PHOTO';pageTitleType='PAGE_TITLE_TYPE_PHOTO';break;case'illustration':titleType='META_TITLE_VECTOR';descriptionType='META_DESCRIPTION_VECTOR';pageTitleType='PAGE_TITLE_TYPE_ILLUSTRATION';break;case'vector':titleType='META_TITLE_VECTOR';descriptionType='META_DESCRIPTION_VECTOR';pageTitleType='PAGE_TITLE_TYPE_VECTOR';break;case'raster':titleType='META_TITLE_RASTER';descriptionType='META_DESCRIPTION_RASTER';pageTitleType='PAGE_TITLE_TYPE_ILLUSTRATION';break;case'audio':titleType='META_TITLE_AUDIO';descriptionType='META_DESCRIPTION_AUDIO';pageTitleType='PAGE_TITLE_TYPE_AUDIO';break;case'video':titleType='META_TITLE_VIDEO';descriptionType='META_DESCRIPTION_VIDEO';pageTitleType='PAGE_TITLE_TYPE_VIDEO';break;}}else{titleType='META_TITLE_EDITORIAL';descriptionType='META_DESCRIPTION_EDITORIAL';pageTitleType='PAGE_TITLE_TYPE_OTHER';}
if(asset.title){translatedTitle=translate(titleType,asset.title);translatedPageTitle=translatedTitle+' '+
translate(pageTitleType)+' '+asset.referenceNumber+' - iStock';translatedDescription=translate(descriptionType,asset.title);}
if(angular.element('title').length===0){angular.element('head').append('<title/>');}
angular.element('title').text(translatedPageTitle);if(angular.element('meta[name=title]').length===0){angular.element('head').append('<meta name="title" content="" />');}
angular.element('meta[name=title]').attr('content',translatedTitle);if(angular.element('meta[name=description]').length===0){angular.element('head').append('<meta name="description" content="" />');}
angular.element('meta[name=description]').attr('content',translatedDescription);};_setTwitterMetaData=function(asset){var jsHead=angular.element('head');jsHead.append('<meta property="twitter:site" content="@istock" />');jsHead.append('<meta property="twitter:domain" content="istockphoto.com" />');jsHead.append('<meta property="twitter:title" content="'+asset.title+'" />');if(asset.assetType==='photo'){jsHead.append('<meta property="twitter:card" content="photo" />');jsHead.append('<meta property="twitter:image" content="'+
asset.fullThumbnailSet.previewUrl+'" />');}
if(asset.assetType==='vector'||asset.assetType==='raster'){jsHead.append('<meta property="twitter:card" content="illustration" />');jsHead.append('<meta property="twitter:image" content="'+
asset.fullThumbnailSet.previewUrl+'" />');}
if(asset.assetType==='photo'||asset.assetType==='vector'){jsHead.append('<meta property="twitter:width" content="'+
asset.assetDimensions.widthInPixels+'" />');jsHead.append('<meta property="twitter:height" content="'+
asset.assetDimensions.heightInPixels+'" />');}
if(asset.assetType==='video'){jsHead.append('<meta property="twitter:player" content="'+
asset.fullThumbnailSet.previewUrl+'" />');jsHead.append('<meta property="twitter:card" content="player" />');jsHead.append('<meta name="twitter:player:width" content="320"> />');jsHead.append('<meta name="twitter:player:height" content="240"> />');jsHead.append('<meta name="twitter:player:stream" content="'+
asset.fullThumbnailSet.previewUrl+'"/>');}
if(asset.assetType==='audio'){jsHead.append('<meta property="twitter:player" content="'+
$location.absUrl()+'" />');jsHead.append('<meta property="twitter:card" content="player" />');jsHead.append('<meta name="twitter:player:width" content="320"> />');jsHead.append('<meta name="twitter:player:height" content="240"> />');jsHead.append('<meta name="twitter:player:stream" content="'+
$location.absUrl()+'"  />');}};_setOGPMetaData=function(asset){var jsHead=angular.element('head');jsHead.append('<meta property="og:url" content="'+$location.url()+'" />');jsHead.append('<meta property="og:site_name" content="iStockphoto" />');jsHead.append('<meta property="og:title" content="'+asset.title+'" />');switch(asset.assetType){case'photo':case'illustration':jsHead.append('<meta name="og:image" content="'+
asset.fullThumbnailSet.previewUrl+'" />');jsHead.append('<meta name="og:width" content="'+
asset.assetDimensions.widthInPixels+'" />');jsHead.append('<meta name="og:height" content="'+
asset.assetDimensions.heightInPixels+'" />');jsHead.append('<meta property="og:image:type" content="image/jpeg" />');break;case'raster':jsHead.append('<meta name="og:image" content="'+
asset.fullThumbnailSet.previewUrl+'" />');jsHead.append('<meta property="og:image:type" content="image/jpeg" />');break;case'audio':jsHead.append('<meta property="og:image" content="'+
asset.fullThumbnailSet.previewUrl+'" />');jsHead.append('<meta property="og:audio" content="'+
$location.absUrl()+'" />');break;case'video':jsHead.append('<meta property="og:video" content="'+
asset.fullThumbnailSet.previewUrl+'" />');jsHead.append('<meta property="og:url" content="'+
$location.absUrl()+'" />');break;}};return{setGenericMetaData:_setGenericMetaData,setTwitterMetaData:_setTwitterMetaData,setOGPMetaData:_setOGPMetaData};}]);}());(function(){'use strict';angular.module('adp.services').factory('ctaTitleService',['$filter','$interval','adpStateService','purchaseStateService','viewStateService','$injectedData',function($filter,$interval,adpStateService,purchaseStateService,viewStateService,injectedData){var _init,_resetCtaTitle,_updateActiveCtaTitle,_animateCtaTitle,_decideTitleOnLicenseClick,_decideSubValidity,_ctaTitles;_ctaTitles={defaultTitle:'',defaultCTA:'',freeTitle:null,subDownloadTitle:null,creditDownloadTitle:null};_init=function(){var asset=adpStateService.asset,user=adpStateService.user,cost=purchaseStateService.purchaseOptions.cost,canUseSub;canUseSub=_decideSubValidity(asset,user);if(asset.isFreeFile){_ctaTitles.defaultTitle=$filter('i18n')('FREE_DOWNLOAD_CTA_TITLE');_ctaTitles.freeTitle=_ctaTitles.defaultTitle;_ctaTitles.defaultCTA=_ctaTitles.defaultTitle;}else if(canUseSub){_ctaTitles.defaultTitle='';_ctaTitles.subDownloadTitle=_ctaTitles.defaultTitle;_ctaTitles.defaultCTA=$filter('i18n')((asset.assetType+'_CTA_TITLE').toUpperCase());}else{if(cost>1){_ctaTitles.defaultTitle=$filter('i18n')('CREDIT_DOWNLOAD_TITLE',cost);}else{_ctaTitles.defaultTitle=$filter('i18n')('ONE_CREDIT_DOWNLOAD_TITLE');}
_ctaTitles.creditDownloadTitle=_ctaTitles.defaultTitle;_ctaTitles.defaultCTA=$filter('i18n')((asset.assetType+'_CTA_TITLE').toUpperCase());}
if(injectedData.adminData&&injectedData.adminData.permissions&&injectedData.adminData.permissions.freeAdminDownloadACL){_ctaTitles.defaultTitle='Free Admin Download';_ctaTitles.freeTitle=_ctaTitles.defaultTitle;_ctaTitles.defaultCTA=_ctaTitles.defaultTitle;}
viewStateService.activeState.creditsTitle=_ctaTitles.defaultTitle;viewStateService.views.download.ctaTitle=_ctaTitles.defaultCTA;};_resetCtaTitle=function(){viewStateService.activeState.creditsTitle=_ctaTitles.defaultTitle;};_updateActiveCtaTitle=function(newTitle){viewStateService.activeState.creditsTitle=newTitle;};_decideTitleOnLicenseClick=function(licenseSelected,licensePrice){var assetCost=adpStateService.asset.standardPriceInCredits,currentCost=purchaseStateService.purchaseOptions.cost,firstSelected=(assetCost+licensePrice===currentCost),nonCreditDl=_ctaTitles.subDownloadTitle!==null||_ctaTitles.freeTitle!==null;if(!licenseSelected){if(nonCreditDl){_resetCtaTitle();}else{_animateCtaTitle(currentCost,assetCost);}}else{if(firstSelected){_animateCtaTitle(assetCost,currentCost);}else{_animateCtaTitle(licensePrice+assetCost,currentCost);}}};_animateCtaTitle=function(currentPrice,finalPrice){var start,intervalId;if(!currentPrice){currentPrice=0;}
start=currentPrice;intervalId=$interval(function(){if(currentPrice>finalPrice){currentPrice--;}else{currentPrice++;}
if(currentPrice>1){_updateActiveCtaTitle($filter('i18n')('CREDIT_DOWNLOAD_TITLE',currentPrice));}else{_updateActiveCtaTitle($filter('i18n')('ONE_CREDIT_DOWNLOAD_TITLE'));}
if(currentPrice===finalPrice){$interval.cancel(intervalId);}},10);};_decideSubValidity=function(asset,user){var goodSub=false,goodAssetType=false;if(user){goodSub=user.rightSub&&user.sub.downloadsRemaining>0;}
if(asset){goodAssetType=asset.assetType!=='audio'&&asset.assetType!=='video';}
return goodSub&&goodAssetType;};return{init:_init,updateActiveCtaTitle:_updateActiveCtaTitle,resetCtaTitle:_resetCtaTitle,animateCtaTitle:_animateCtaTitle,decideTitleOnLicenseClick:_decideTitleOnLicenseClick,ctaTitles:_ctaTitles,decideSubValidity:_decideSubValidity};}]);}());(function(){'use strict';angular.module('adp.services').factory('categoryLinksService',['urlBuilder',function(urlBuilder){var self,_categories={photoCategories:[{name:'Abstract',link:'/photos/abstract'},{name:'Animals',link:'/photos/animal'},{name:'Architecture',link:'/photos/architecture'},{name:'Babies',link:'/photos/baby'},{name:'Backgrounds',link:'/photos/background'},{name:'Beauty',link:'/photos/beauty'},{name:'Business',link:'/photos/business'},{name:'Celebration',link:'/photos/celebration'},{name:'Children',link:'/photos/children'},{name:'Dogs',link:'/photos/dog'},{name:'Family pictures',link:'/photos/family+pictures'},{name:'Fashion',link:'/photos/fashion'},{name:'Fitness',link:'/photos/fitness'},{name:'Flowers',link:'/photos/flower'},{name:'Food',link:'/photos/food'},{name:'Holidays',link:'/photos/holiday'},{name:'Human anatomy',link:'/photos/anatomy'},{name:'Landscapes',link:'/photos/landscape'},{name:'Lifestyle',link:'/photos/lifestyle'},{name:'Love',link:'/photos/love'},{name:'Medical',link:'/photos/medical'},{name:'Nature',link:'/photos/nature'},{name:'People',link:'/photos/people'},{name:'Pets',link:'/photos/pet'},{name:'Romance',link:'/photos/romance'},{name:'Sports',link:'/photos/sports'},{name:'Technology',link:'/photos/technology'},{name:'Travel',link:'/photos/travel'},{name:'Vintage',link:'/photos/vintage'},{name:'Wildlife',link:'/photos/wildlife'}],illustrationCategories:[{name:'Abstract',link:'/illustrations/abstract'},{name:'Animals',link:'/illustrations/animal'},{name:'Babies',link:'/illustrations/babies'},{name:'Backgrounds',link:'/illustrations/backgrounds'},{name:'Borders',link:'/illustrations/borders'},{name:'Buildings',link:'/illustrations/buildings'},{name:'Business',link:'/illustrations/business'},{name:'Cats',link:'/illustrations/cats'},{name:'Children',link:'/illustrations/children'},{name:'Clip art',link:'/illustrations/clip-art'},{name:'Dogs',link:'/illustrations/dogs'},{name:'Emojis',link:'/illustrations/emojis'},{name:'Family',link:'/illustrations/family'},{name:'Fashion',link:'/illustrations/fashion'},{name:'Fitness',link:'/illustrations/fitness'},{name:'Flags',link:'/illustrations/flags'},{name:'Flowers',link:'/illustrations/flowers'},{name:'Food',link:'/illustrations/food'},{name:'Holidays',link:'/illustrations/holidays'},{name:'Human anatomy',link:'/illustrations/anatomy'},{name:'Icons',link:'/illustrations/icons'},{name:'Infographics',link:'/illustrations/infographics'},{name:'Medical',link:'/illustrations/medical'},{name:'Nature',link:'/illustrations/nature'},{name:'Patters',link:'/illustrations/patters'},{name:'People',link:'/illustrations/people'},{name:'Pets',link:'/illustrations/pets'},{name:'Silhouettes',link:'/illustrations/silhouettes'},{name:'Sports',link:'/illustrations/sports'},{name:'Vectors',link:'/illustrations/vectors'}],videoCatgories:[{name:'3d animation',link:'/videos/3d+animation'},{name:'Aerial',link:'/videos/aerial'},{name:'Animals',link:'/videos/animals'},{name:'Beauty',link:'/videos/beauty'},{name:'Business',link:'/videos/business'},{name:'Celebrities',link:'/videos/celebrities'},{name:'Children',link:'/videos/children'},{name:'Education',link:'/videos/education'},{name:'Entertainment',link:'/videos/entertainment'},{name:'Fashion',link:'/videos/fashion'},{name:'Finance',link:'/videos/finance'},{name:'Fitness',link:'/videos/fitness'},{name:'Food',link:'/videos/food'},{name:'Green screen',link:'/videos/green+screen'},{name:'Healthcare',link:'/videos/healthcare'},{name:'Holidays',link:'/videos/holidays'},{name:'Industrial',link:'/videos/industrial'},{name:'Medical',link:'/videos/medical'},{name:'Nature',link:'/videos/nature'},{name:'People',link:'/videos/people'},{name:'Religion',link:'/videos/religion'},{name:'Science',link:'/videos/science'},{name:'Slow motion',link:'/videos/slow+motion'},{name:'Sports',link:'/videos/sports'},{name:'Technology',link:'/videos/technology'},{name:'Time lapse',link:'/videos/time+lapse'},{name:'Travel',link:'/videos/travel'},{name:'War',link:'/videos/war'},{name:'Wildlife',link:'/videos/wildlife'},{name:'Zombies',link:'/videos/zombies'}],audioCategories:[{name:'Acoustic',link:'/music/acoustic'},{name:'Ambient',link:'/music/ambient'},{name:'Background',link:'/music/background'},{name:'Bass',link:'/music/bass'},{name:'Children\'s',link:'/music/childrens'},{name:'Cinematic',link:'/music/cinematic'},{name:'Classical',link:'/music/classical'},{name:'Country',link:'/music/country'},{name:'Dark',link:'/music/dark'},{name:'Drums',link:'/music/drums'},{name:'Electric',link:'/music/electric'},{name:'Guitar',link:'/music/guitar'},{name:'Hip hop',link:'/music/hip+hop'},{name:'House',link:'/music/house'},{name:'Jazz',link:'/music/jazz'},{name:'Latin',link:'/music/latin'},{name:'Orchestra',link:'/music/orchestra'},{name:'Peaceful',link:'/music/peaceful'},{name:'Piano',link:'/music/piano'},{name:'Pop',link:'/music/pop'},{name:'Rock',link:'/music/rock'},{name:'Rock and roll',link:'/music/rock+and+roll'},{name:'Romantic',link:'/music/romantic'},{name:'Sound effects',link:'/music/sound+effects'},{name:'Stingers',link:'/music/stingers'},{name:'Synthesizer',link:'/music/synthesizer'},{name:'Techno',link:'/music/techno'},{name:'Upbeat',link:'/music/upbeat'},{name:'Vocals',link:'/music/vocals'},{name:'World',link:'/music/world'}]},_urlInfix=urlBuilder.getUrlInfix(),key,i;if(_urlInfix){for(key in _categories){if(_categories.hasOwnProperty(key)){for(i=0;i<_categories[key].length;i++){_categories[key][i].link=_urlInfix+_categories[key][i].link;}}}}
self={getCategoryLinks:function(assetType){var categoryList=[];if(!assetType){return[];}
switch(assetType){case'photo':categoryList=_categories.photoCategories;break;case'raster':case'vector':categoryList=_categories.illustrationCategories;break;case'video':categoryList=_categories.videoCatgories;break;case'audio':categoryList=_categories.audioCategories;break;}
return categoryList;}};return self;}]);}());(function(){'use strict';angular.module('adp.services').factory('searchRequestService',['Restangular','$q',function(Restangular,$q){var lastTimestamp,service;Restangular.setBaseUrl('/api/');service={executeSearch:function(facets,options){var requestObj={},deferred=$q.defer(),endpoint='search';requestObj.facets=facets;lastTimestamp=requestObj.timestamp=Date.now();if(options!==undefined){requestObj.searchToken=options.searchToken;requestObj.isFrontEndSearch=options.isFrontEndSearch;if(options.endpoint){endpoint=options.endpoint;}}
Restangular.one(endpoint).customPOST(requestObj).then(function(response){response.isLatest=lastTimestamp===response.timestamp;deferred.resolve(response);});return deferred.promise;},headers:function(){var headers={'Content-Type':'application/json'};if(istock.urls.urlInfix){headers['Accept-Language']=istock.urls.urlInfix;}
return headers;}};return service;}]);}());(function(){'use strict';var APP=angular.module('adp.constants');APP.constant('TYPE_MAPPING',{FILE_TYPES:{PHOTO:1,ILLUSTRATION:7,VIDEO:8,AUDIO:9},COLLECTION_TYPES:{ESSENTIALS:1,SIGNATURE:4}});})();(function(){'use strict';var APP=angular.module('adp.constants');APP.constant('ADP_ERROR_MESSAGING',{DOWNLOAD_ERROR:'DOWNLOAD_ERROR',LICENSE_ERROR:'LICENSE_ERROR',LIGHTBOX_ERROR:'LIGHTBOX_ERROR',API_ERROR:'API_ERROR'});})();function Exception(name,message)
{if(name)
this.name=name;if(message)
this.message=message;}
Exception.prototype.setName=function(name)
{this.name=name;}
Exception.prototype.getName=function()
{return this.name;}
Exception.prototype.setMessage=function(msg)
{this.message=msg;}
Exception.prototype.getMessage=function()
{return this.message;}
function FlashTag(src,width,height)
{this.src=src;this.width=width;this.height=height;this.version='7,0,14,0';this.id=null;this.bgcolor='ffffff';this.flashVars=null;this.alt='';this.title='';this.wmode='opaque';}
FlashTag.prototype.setVersion=function(v)
{this.version=v;}
FlashTag.prototype.setId=function(id)
{this.id=id;}
FlashTag.prototype.setBgcolor=function(bgc)
{this.bgcolor=bgc;}
FlashTag.prototype.setFlashvars=function(fv)
{this.flashVars=fv;}
FlashTag.prototype.setAlt=function(alt)
{this.alt=alt;}
FlashTag.prototype.setTitle=function(title)
{this.title=title;}
FlashTag.prototype.setWmode=function(wmode){this.wmode=wmode;}
FlashTag.prototype.toString=function()
{var ie=(navigator.appName.indexOf("Microsoft")!=-1)?1:0;var flashTag=new String();if(ie)
{flashTag+='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" ';if(this.id!=null)
{flashTag+='id="'+this.id+'" ';}
flashTag+='codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version='+this.version+'" ';flashTag+='width="'+this.width+'" ';flashTag+='height="'+this.height+'" ';flashTag+='alt="'+this.alt+'" ';flashTag+='title="'+this.title+'">';flashTag+='<param name="movie" value="'+this.src+'"/>';flashTag+='<param name="quality" value="high"/>';flashTag+='<param name="bgcolor" value="#'+this.bgcolor+'"/>';flashTag+='<param name="wmode" value="'+this.wmode+'">';if(this.flashVars!=null)
{flashTag+='<param name="flashvars" value="'+this.flashVars+'"/>';}
flashTag+='</object>';}
else
{flashTag+='<embed src="'+this.src+'" ';flashTag+='quality="high" ';flashTag+='bgcolor="#'+this.bgcolor+'" ';flashTag+='width="'+this.width+'" ';flashTag+='height="'+this.height+'" ';flashTag+='wmode="'+this.wmode+'" ';flashTag+='alt="'+this.alt+'" ';flashTag+='title="'+this.title+'" ';flashTag+='type="application/x-shockwave-flash" ';if(this.flashVars!=null)
{flashTag+='flashvars="'+this.flashVars+'" ';}
if(this.id!=null)
{flashTag+='name="'+this.id+'" ';}
flashTag+='pluginspage="http://www.macromedia.com/go/getflashplayer">';flashTag+='</embed>';}
return flashTag;}
FlashTag.prototype.write=function(doc)
{doc.write(this.toString());}
function FlashSerializer(useCdata)
{this.useCdata=useCdata;}
FlashSerializer.prototype.serialize=function(args)
{var qs=new String();for(var i=0;i<args.length;++i)
{switch(typeof(args[i]))
{case'undefined':qs+='t'+(i)+'=undf';break;case'string':qs+='t'+(i)+'=str&d'+(i)+'='+escape(args[i]);break;case'number':qs+='t'+(i)+'=num&d'+(i)+'='+escape(args[i]);break;case'boolean':qs+='t'+(i)+'=bool&d'+(i)+'='+escape(args[i]);break;case'object':if(args[i]==null)
{qs+='t'+(i)+'=null';}
else if(args[i]instanceof Date)
{qs+='t'+(i)+'=date&d'+(i)+'='+escape(args[i].getTime());}
else
{try
{qs+='t'+(i)+'=xser&d'+(i)+'='+escape(this._serializeXML(args[i]));}
catch(exception)
{throw new Exception("FlashSerializationException","The following error occurred during complex object serialization: "+exception.getMessage());}}
break;default:throw new Exception("FlashSerializationException","You can only serialize strings, numbers, booleans, dates, objects, arrays, nulls, and undefined.");}
if(i!=(args.length-1))
{qs+='&';}}
return qs;}
FlashSerializer.prototype._serializeXML=function(obj)
{var doc=new Object();doc.xml='<fp>';this._serializeNode(obj,doc,null);doc.xml+='</fp>';return doc.xml;}
FlashSerializer.prototype._serializeNode=function(obj,doc,name)
{switch(typeof(obj))
{case'undefined':doc.xml+='<undf'+this._addName(name)+'/>';break;case'string':doc.xml+='<str'+this._addName(name)+'>'+this._escapeXml(obj)+'</str>';break;case'number':doc.xml+='<num'+this._addName(name)+'>'+obj+'</num>';break;case'boolean':doc.xml+='<bool'+this._addName(name)+' val="'+obj+'"/>';break;case'object':if(obj==null)
{doc.xml+='<null'+this._addName(name)+'/>';}
else if(obj instanceof Date)
{doc.xml+='<date'+this._addName(name)+'>'+obj.getTime()+'</date>';}
else if(obj instanceof Array)
{doc.xml+='<array'+this._addName(name)+'>';for(var i=0;i<obj.length;++i)
{this._serializeNode(obj[i],doc,null);}
doc.xml+='</array>';}
else
{doc.xml+='<obj'+this._addName(name)+'>';for(var n in obj)
{if(typeof(obj[n])=='function')
continue;this._serializeNode(obj[n],doc,n);}
doc.xml+='</obj>';}
break;default:throw new Exception("FlashSerializationException","You can only serialize strings, numbers, booleans, objects, dates, arrays, nulls and undefined");break;}}
FlashSerializer.prototype._addName=function(name)
{if(name!=null)
{return' name="'+name+'"';}
return'';}
FlashSerializer.prototype._escapeXml=function(str)
{if(this.useCdata)
return'<![CDATA['+str+']]>';else
return str.replace(/&/g,'&amp;').replace(/</g,'&lt;');}
function FlashProxy(uid,proxySwfName)
{this.uid=uid;this.proxySwfName=proxySwfName;this.flashSerializer=new FlashSerializer(false);}
FlashProxy.prototype.call=function()
{if(arguments.length==0)
{throw new Exception("Flash Proxy Exception","The first argument should be the function name followed by any number of additional arguments.");}
var qs='lcId='+escape(this.uid)+'&functionName='+escape(arguments[0]);if(arguments.length>1)
{var justArgs=new Array();for(var i=1;i<arguments.length;++i)
{justArgs.push(arguments[i]);}
qs+=('&'+this.flashSerializer.serialize(justArgs));}
var divName='_flash_proxy_'+this.uid;if(!document.getElementById(divName))
{var newTarget=document.createElement("div");newTarget.id=divName;document.body.appendChild(newTarget);}
var target=document.getElementById(divName);var ft=new FlashTag(this.proxySwfName,1,1);ft.setVersion('6,0,65,0');ft.setFlashvars(qs);ft.setWmode('');target.innerHTML=ft.toString();}
FlashProxy.callJS=function()
{var functionToCall=eval(arguments[0]);var argArray=new Array();for(var i=1;i<arguments.length;++i)
{argArray.push(arguments[i]);}
functionToCall.apply(functionToCall,argArray);}